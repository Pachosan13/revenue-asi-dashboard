./docs/director-engine/README.md:130:- Writes into `touch_runs`:
./docs/director-engine/README.md:160:  - Each reminder becomes a `touch_runs` record (`step` 200/201/202 with payload).
./docs/director-engine/README.md:164:  - `handle_appointment_outcome` â†’ writes follow-up `touch_runs` (e.g. no-show follow-up).
./docs/director-engine/README.md:199:- `touch_runs`
./docs/director-engine/README.md:221:### 4.2 `touch_runs`
./docs/director-engine/README.md:251:- Touch orchestrator v4 (multi-channel, queued, using `touch_runs`).
./docs/director-engine/README.md:252:- Appointments engine + outcomes + reminders â†’ reminders become `touch_runs`.
./docs/director-engine/README.md:308:  - appointment reminders â†’ `touch_runs` â†’ timelines.
./docs/director-engine/README.md:316:  - outbound calls using `touch_runs`.
./.next/server/chunks/ssr/src_app_voice-insights_page_tsx_47114a37._.js:1:module.exports=[48516,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(90669),e=a.i(69012),f=a.i(96221),g=a.i(28790),h=a.i(33508),i=a.i(19272),j=a.i(86143);a.i(57626);var k=a.i(52878),l=a.i(50600),m=a.i(28573),n=a.i(3103),o=a.i(52143),p=a.i(62996),q=a.i(10849);let r=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});function s(){let a=(0,c.useMemo)(()=>!0,[]),[d,s]=(0,c.useState)([]),[v,w]=(0,c.useState)({}),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)("all"),[H,I]=(0,c.useState)("all"),[J,K]=(0,c.useState)("all"),[L,M]=(0,c.useState)("all"),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)(null),[T,U]=(0,c.useState)(null);(0,c.useEffect)(()=>{let b=!0;return async function(){if(!a){S("Supabase is not configured. Add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to load data."),Q(!1);return}Q(!0),S(null);let c=(0,q.supabaseBrowser)(),{data:d,error:e}=await c.from("voice_insights_calls_v1").select("id, lead_id, touch_run_id, status, provider, provider_call_id, to_phone, meta, updated_at").order("updated_at",{ascending:!1}).limit(100);if(!b)return;if(e){console.error(e),S("Unable to fetch voice calls."),Q(!1);return}let f=d??[];s(f);let g=Array.from(new Set(f.map(a=>a.lead_id)));if(0===g.length){w({}),y([]),A([]),C([]),E({}),Q(!1);return}let[h,i,j,k,l]=await Promise.all([c.from("leads").select("id, contact_name, company, phone, state, email").in("id",g),c.from("lead_events").select("id, lead_id, event_type, payload, created_at").in("event_type",["voice_completed","voice_failed","appointment_created"]).order("created_at",{ascending:!1}).limit(200),c.from("appointments").select("id, lead_id, scheduled_for, status").in("lead_id",g),c.from("touch_runs").select("id, lead_id, status, error, campaign_id").in("lead_id",g),c.from("campaigns").select("id, name").limit(500)]);if(!b)return;h.error&&(console.error(h.error),S(`Unable to fetch leads for voice calls. DB says: ${h.error.message}`)),i.error&&console.error(i.error),j.error&&console.error(j.error),k.error&&console.error(k.error),l.error&&console.error(l.error);let m=(h.data??[]).reduce((a,b)=>(a[b.id]=b,a),{}),n=(l.data??[]).reduce((a,b)=>(a[b.id]=b,a),{});w(m),y(i.data??[]),A(j.data??[]),C(k.data??[]),E(n),Q(!1)}(),()=>{b=!1}},[a]);let V=(0,c.useMemo)(()=>{let a=new Date;return z.reduce((b,c)=>("scheduled"===c.status&&new Date(c.scheduled_for)>=a&&(b[c.lead_id]=c),b),{})},[z]),W=(0,c.useMemo)(()=>{let a={};return B.forEach(b=>{"stopped"===b.status&&"appointment_created"===b.error&&(a[b.lead_id]=!0)}),a},[B]),X=(0,c.useMemo)(()=>{let a={};return B.forEach(b=>{b.campaign_id&&!a[b.lead_id]&&(a[b.lead_id]=b.campaign_id)}),a},[B]),Y=(0,c.useMemo)(()=>d.map(a=>{let b=a.meta?.voice_webhook??null,c=b?.transcript??a.meta?.transcript??"",d=x.find(b=>b.lead_id===a.lead_id&&b.event_type.startsWith("voice_")),e=d?.payload?.intent,f=a.meta?.intent??"unknown",g=(e??f??"unknown").toLowerCase(),h=X[a.lead_id]??null,i=h&&D[h]?D[h].name??"Untitled":null;return{...a,transcript:c,intent:g,hasAppointment:!!V[a.lead_id],cadenceStopped:!!W[a.lead_id],campaign_id:h,campaign_name:i}}),[V,W,X,D,d,x]),Z=(0,c.useMemo)(()=>{let a=new Set;return Y.forEach(b=>{b.campaign_id&&a.add(b.campaign_id)}),Array.from(a)},[Y]),$=(0,c.useMemo)(()=>Y.filter(a=>{if("all"!==F&&a.intent!==F||"yes"===H&&!a.hasAppointment||"no"===H&&a.hasAppointment||"stopped"===J&&!a.cadenceStopped||"active"===J&&a.cadenceStopped||"all"!==L&&a.campaign_id!==L)return!1;if(N){let b=v[a.lead_id];if(!`${b?.contact_name??""} ${b?.company??""} ${b?.email??""} ${b?.phone??""}`.toLowerCase().includes(N.toLowerCase()))return!1}return!0}),[H,L,Y,J,F,v,N]),_=(0,c.useMemo)(()=>$.find(a=>a.id===T)??null,[$,T]),aa=_?v[_.lead_id]??null:null,ab=_?V[_.lead_id]??null:null,ac=(0,c.useMemo)(()=>{if(0===Y.length)return{total:0,withAppointment:0,interested:0,failed:0,last7d:0};let a=Date.now(),b=0,c=0,d=0,e=0;return Y.forEach(f=>{f.hasAppointment&&(b+=1),"appointment"===f.intent&&(c+=1),f.status&&"failed"===f.status.toLowerCase()&&(d+=1);let g=new Date(f.updated_at).getTime();!Number.isNaN(g)&&a-g<=6048e5&&(e+=1)}),{total:Y.length,withAppointment:b,interested:c,failed:d,last7d:e}},[Y]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Voice Â· Calls & intents"}),(0,b.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Voice Insights"}),(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Latest 100 calls with transcript previews, intent signals, campaign and appointment status."})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>{G("all"),I("all"),K("all"),M("all"),O("")},className:"gap-2",children:[(0,b.jsx)(g.RefreshCcw,{size:16}),"Reset view"]})})]}),(0,b.jsx)(m.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,b.jsxs)(m.CardContent,{className:"grid gap-4 p-4 sm:grid-cols-5",children:[(0,b.jsx)(u,{label:"Total calls",value:ac.total,helper:"Last 100 records"}),(0,b.jsx)(u,{label:"Interested",value:ac.interested,helper:"Intent = appointment"}),(0,b.jsx)(u,{label:"With appointment",value:ac.withAppointment,helper:"Upcoming scheduled"}),(0,b.jsx)(u,{label:"Failed",value:ac.failed,helper:"Status = failed"}),(0,b.jsx)(u,{label:"Calls last 7 days",value:ac.last7d,helper:"Based on updated_at"})]})}),(0,b.jsx)(m.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,b.jsxs)(m.CardContent,{className:"space-y-4 pt-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-medium uppercase tracking-[0.14em] text-white/70",children:[(0,b.jsx)(e.Filter,{size:14}),(0,b.jsx)("span",{children:"Filters"})]}),(0,b.jsxs)(o.Select,{value:F,onChange:a=>G(a.target.value),className:"w-44",children:[(0,b.jsx)("option",{value:"all",children:"All intents"}),(0,b.jsx)("option",{value:"appointment",children:"Appointment"}),(0,b.jsx)("option",{value:"unknown",children:"Unknown"})]}),(0,b.jsxs)(o.Select,{value:H,onChange:a=>I(a.target.value),className:"w-48",children:[(0,b.jsx)("option",{value:"all",children:"Appointment?"}),(0,b.jsx)("option",{value:"yes",children:"Has upcoming"}),(0,b.jsx)("option",{value:"no",children:"No appointment"})]}),(0,b.jsxs)(o.Select,{value:J,onChange:a=>K(a.target.value),className:"w-40",children:[(0,b.jsx)("option",{value:"all",children:"Cadence"}),(0,b.jsx)("option",{value:"stopped",children:"Stopped"}),(0,b.jsx)("option",{value:"active",children:"Active"})]}),(0,b.jsxs)(o.Select,{value:L,onChange:a=>M(a.target.value),className:"w-56",children:[(0,b.jsx)("option",{value:"all",children:"All campaigns"}),Z.map(a=>(0,b.jsx)("option",{value:a,children:D[a]?.name??a},a))]}),(0,b.jsx)(n.Input,{placeholder:"Search lead / company / email / phone",value:N,onChange:a=>O(a.target.value),className:"w-72"})]}),R?(0,b.jsx)("div",{className:"rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100",children:R}):null,P?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[(0,b.jsx)(f.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading voice callsâ€¦"]}):(0,b.jsxs)("div",{className:"flex items-center gap-3 text-xs text-white/50",children:[(0,b.jsxs)("span",{className:"rounded-full border border-white/10 bg-white/5 px-2 py-1",children:[$.length," calls visible"]}),(0,b.jsxs)("span",{className:"rounded-full border border-white/5 bg-white/5/10 px-2 py-1",children:["Raw: ",d.length]})]})]})}),(0,b.jsx)(m.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,b.jsxs)(m.CardContent,{className:"pt-4",children:[P||0!==$.length?null:(0,b.jsx)("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-sm text-white/70",children:"No calls match the selected filters."}),!P&&$.length>0?(0,b.jsx)("div",{className:"overflow-auto rounded-2xl border border-white/10",children:(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHead,{children:(0,b.jsxs)(p.TableRow,{className:"bg-white/5",children:[(0,b.jsx)(p.TableHeaderCell,{children:"Lead"}),(0,b.jsx)(p.TableHeaderCell,{children:"Campaign"}),(0,b.jsx)(p.TableHeaderCell,{children:"Phone"}),(0,b.jsx)(p.TableHeaderCell,{children:"Status"}),(0,b.jsx)(p.TableHeaderCell,{children:"Transcript"}),(0,b.jsx)(p.TableHeaderCell,{children:"Intent"}),(0,b.jsx)(p.TableHeaderCell,{children:"Appointment"}),(0,b.jsx)(p.TableHeaderCell,{children:"Cadence"}),(0,b.jsx)(p.TableHeaderCell,{children:"Updated"})]})}),(0,b.jsx)(p.TableBody,{children:$.map(a=>{let c=v[a.lead_id],d=a.transcript,e=d?`${d.slice(0,140)}${d.length>140?"â€¦":""}`:"â€”",f=new Date(a.updated_at),g=V[a.lead_id],h=c?.contact_name||c?.company||c?.phone||c?.email||"Unknown lead",i=a.campaign_name??"â€”";return(0,b.jsxs)(p.TableRow,{className:"cursor-pointer border-t border-white/5 bg-black/40 transition hover:bg-white/5",onClick:()=>U(a.id),children:[(0,b.jsx)(p.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("a",{href:`/leads/${a.lead_id}`,className:"font-semibold text-emerald-200 hover:text-emerald-100",onClick:a=>a.stopPropagation(),children:h}),(0,b.jsx)(j.LeadStateBadge,{state:c?.state})]})}),(0,b.jsx)(p.TableCell,{className:"text-sm text-white/80",children:i}),(0,b.jsx)(p.TableCell,{className:"text-sm text-white/80",children:c?.phone??a.to_phone??"â€”"}),(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(k.Badge,{variant:"outline",className:"border-white/15 bg-white/5 text-xs text-white/80 capitalize",children:a.status??"â€”"})}),(0,b.jsx)(p.TableCell,{className:"max-w-md text-sm text-white/80",children:e}),(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(j.IntentBadge,{intent:a.intent})}),(0,b.jsx)(p.TableCell,{children:a.hasAppointment?(0,b.jsxs)(k.Badge,{variant:"outline",className:"gap-2 border-emerald-400/50 bg-emerald-500/10 text-xs text-emerald-100",children:[(0,b.jsx)(t,{}),"Upcoming",(0,b.jsx)("span",{className:"text-[11px] text-white/60",children:g?r.format(new Date(g.scheduled_for)):null})]}):(0,b.jsx)(k.Badge,{variant:"outline",className:"border-white/15 bg-white/5 text-xs text-white/70",children:"No appointment"})}),(0,b.jsx)(p.TableCell,{children:a.cadenceStopped?(0,b.jsx)(k.Badge,{variant:"outline",className:"border-amber-400/60 bg-amber-500/10 text-xs text-amber-100",children:"Cadence stopped"}):(0,b.jsx)(k.Badge,{variant:"outline",className:"border-emerald-400/60 bg-emerald-500/10 text-xs text-emerald-100",children:"Active"})}),(0,b.jsx)(p.TableCell,{className:"whitespace-nowrap text-sm text-white/70",children:r.format(f)})]},a.id)})})]})}):null,P?(0,b.jsxs)("div",{className:"flex items-center gap-2 py-8 text-sm text-white/60",children:[(0,b.jsx)(f.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading voice callsâ€¦"]}):null]})})]}),_&&(0,b.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,b.jsx)("button",{className:"h-full flex-1 bg-black/60 backdrop-blur-sm",onClick:()=>U(null),"aria-label":"Close call details"}),(0,b.jsxs)("div",{className:"h-full w-full max-w-md border-l border-white/10 bg-[#020617] p-5 shadow-[0_0_60px_rgba(15,23,42,0.9)]",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Voice call"}),(0,b.jsxs)("h2",{className:"flex items-center gap-2 text-xl font-semibold text-white",children:[(0,b.jsx)(i.PhoneCall,{className:"h-4 w-4 text-emerald-300"}),aa?.contact_name??aa?.company??aa?.phone??aa?.email??"Unknown lead"]}),aa&&(0,b.jsxs)("p",{className:"text-xs text-white/50",children:[aa.email??"no-email"," Â·"," ",aa.phone??"no-phone"]})]}),(0,b.jsx)("button",{className:"rounded-full border border-white/20 bg-white/10 p-1 text-white/70 hover:bg-white/20",onClick:()=>U(null),children:(0,b.jsx)(h.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(k.Badge,{className:"border-white/20 bg-white/10 text-xs text-white/80",children:_.provider??"provider-unknown"}),(0,b.jsx)(k.Badge,{className:"border-white/20 bg-white/10 text-xs text-white/80 capitalize",children:_.status??"status-unknown"}),(0,b.jsx)(j.IntentBadge,{intent:_.intent}),_.hasAppointment&&(0,b.jsx)(k.Badge,{className:"border-emerald-400/60 bg-emerald-500/15 text-xs text-emerald-100",children:"Appointment scheduled"}),_.cadenceStopped&&(0,b.jsx)(k.Badge,{className:"border-amber-400/60 bg-amber-500/15 text-xs text-amber-100",children:"Cadence stopped"})]}),(0,b.jsx)(m.Card,{className:"border-white/10 bg-white/5",children:(0,b.jsxs)(m.CardContent,{className:"space-y-1 p-4 text-xs text-white/70",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"To"}),(0,b.jsx)("span",{children:_.to_phone??"â€”"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Updated"}),(0,b.jsx)("span",{children:r.format(new Date(_.updated_at))})]}),ab&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Appointment"}),(0,b.jsx)("span",{children:r.format(new Date(ab.scheduled_for))})]})]})}),(0,b.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-slate-900/80 p-4",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Transcript"}),_.transcript?(0,b.jsx)("p",{className:"max-h-64 overflow-y-auto whitespace-pre-wrap text-sm text-white/80",children:_.transcript}):(0,b.jsx)("p",{className:"text-xs text-white/60",children:"No transcript available for this call."})]}),_.meta&&(0,b.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-black/60 p-4",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Raw meta"}),(0,b.jsx)("pre",{className:"max-h-40 overflow-y-auto text-[11px] text-white/70",children:JSON.stringify(_.meta,null,2)})]})]})]})]})]})}function t(){return(0,b.jsx)(d.Activity,{size:14})}function u({label:a,value:c,helper:d}){return(0,b.jsxs)("div",{className:"space-y-1 rounded-2xl border border-white/10 bg-white/5 p-3",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-[0.16em] text-white/50",children:a}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-white",children:c}),(0,b.jsx)("p",{className:"text-[11px] text-white/50",children:d})]})}a.s(["default",()=>s])}];
./.next/server/chunks/ssr/_a6b62dc1._.js.map:1:{"version":3,"sources":["../../../../node_modules/lucide-react/src/icons/refresh-cw.ts","../../../../src/app/health/page.tsx","../../../../node_modules/lucide-react/src/icons/signal.ts","../../../../node_modules/lucide-react/src/icons/shield.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8', key: 'v9h5vc' }],\n  ['path', { d: 'M21 3v5h-5', key: '1q7to0' }],\n  ['path', { d: 'M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16', key: '3uifl3' }],\n  ['path', { d: 'M8 16H3v5', key: '1cv678' }],\n];\n\n/**\n * @component @name RefreshCw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAwIDEgOS05IDkuNzUgOS43NSAwIDAgMSA2Ljc0IDIuNzRMMjEgOCIgLz4KICA8cGF0aCBkPSJNMjEgM3Y1aC01IiAvPgogIDxwYXRoIGQ9Ik0yMSAxMmE5IDkgMCAwIDEtOSA5IDkuNzUgOS43NSAwIDAgMS02Ljc0LTIuNzRMMyAxNiIgLz4KICA8cGF0aCBkPSJNOCAxNkgzdjUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/refresh-cw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RefreshCw = createLucideIcon('refresh-cw', __iconNode);\n\nexport default RefreshCw;\n","\"use client\"\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\"\nimport { RefreshCw, Shield, Signal } from \"lucide-react\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport { Button, Card, CardContent, CardHeader, StatCard } from \"@/components/ui-custom\"\n\ntype JobRun = {\n  id: string\n  job_name?: string | null\n  status?: string | null\n  created_at?: string | null\n  duration_ms?: number | null\n}\n\ntype TouchRun = {\n  id: string\n  status?: string | null\n  created_at?: string | null\n}\n\nexport default function HealthPage() {\n  const supabase = useMemo(() => {\n    const hasEnv = process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    return hasEnv ? supabaseBrowser() : null\n  }, [])\n  const [runs, setRuns] = useState<JobRun[]>([])\n  const [loading, setLoading] = useState(true)\n  const [jobCounts, setJobCounts] = useState({ success: 0, failed: 0 })\n  const [touchRun, setTouchRun] = useState<TouchRun | null>(null)\n  const [lastJobRun, setLastJobRun] = useState<JobRun | null>(null)\n\n  const refreshHealth = useCallback(async () => {\n    if (!supabase) {\n      setLoading(false)\n      return\n    }\n\n    setLoading(true)\n    const since = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()\n\n    const [jobResp, touchResp] = await Promise.all([\n      supabase\n        .from(\"job_runs\")\n        .select(\"id, job_name, status, created_at, duration_ms\")\n        .order(\"created_at\", { ascending: false })\n        .limit(20),\n      supabase.from(\"touch_runs\").select(\"id, status, created_at\").order(\"created_at\", { ascending: false }).limit(1),\n    ])\n\n    if (jobResp.error) {\n      console.warn(\"Failed to load job_runs\", jobResp.error)\n      setRuns([])\n      setJobCounts({ success: 0, failed: 0 })\n      setLastJobRun(null)\n    } else {\n      const filtered = (jobResp.data ?? []).filter((run) => (run.created_at ?? \"\") >= since)\n      const success = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"succeeded\").length\n      const failed = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"failed\").length\n      setRuns(jobResp.data ?? [])\n      setJobCounts({ success, failed })\n      setLastJobRun(jobResp.data?.[0] ?? null)\n    }\n\n    if (touchResp.error) {\n      console.warn(\"Failed to load touch_runs\", touchResp.error)\n      setTouchRun(null)\n    } else {\n      setTouchRun(touchResp.data?.[0] ?? null)\n    }\n\n    setLoading(false)\n  }, [supabase])\n\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/set-state-in-effect\n    void refreshHealth()\n  }, [refreshHealth])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">Systems</p>\n          <h1 className=\"text-3xl font-semibold text-white\">Health</h1>\n          <p className=\"text-sm text-white/60\">Heartbeat across cadences, enrichers, and dispatchers.</p>\n        </div>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"gap-2\"\n          onClick={refreshHealth}\n          aria-label=\"Refresh health\"\n        >\n          <RefreshCw size={16} />\n          Refresh\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Jobs\"\n          value={`${jobCounts.success} succeeded / ${jobCounts.failed} failed`}\n          helper=\"job_runs last 24h\"\n          delta={supabase ? \"Live\" : \"Offline\"}\n        />\n        <StatCard\n          label=\"Dispatch\"\n          value={\n            touchRun\n              ? `${touchRun.status ?? \"pending\"}`\n              : supabase\n                ? \"No dispatch runs\"\n                : \"Supabase env missing\"\n          }\n          helper={\n            touchRun?.created_at\n              ? new Date(touchRun.created_at).toLocaleString()\n              : \"Watching cadence triggers\"\n          }\n          delta={touchRun ? \"Latest\" : \"Idle\"}\n        />\n        <StatCard\n          label=\"Run cadence\"\n          value={lastJobRun ? lastJobRun.status ?? \"pending\" : \"No runs\"}\n          helper={lastJobRun?.created_at ? new Date(lastJobRun.created_at).toLocaleString() : \"Cron via SQL\"}\n          delta={lastJobRun ? \"Latest\" : \"Idle\"}\n        />\n      </div>\n\n      <Card>\n        <CardHeader\n          title=\"Recent checks\"\n          description=\"Edge functions and workers reporting back from Supabase\"\n          action={\n            <div className=\"flex items-center gap-2 text-sm text-white/60\">\n              <Signal size={16} />\n              {loading ? \"Loading\" : `${runs.length} pings`}\n            </div>\n          }\n        />\n        <CardContent className=\"space-y-3\">\n          {loading ? (\n            <div className=\"space-y-2\">\n              {[1, 2, 3].map((row) => (\n                <div key={row} className=\"h-12 animate-pulse rounded-xl bg-white/5\" />\n              ))}\n            </div>\n          ) : runs.length === 0 ? (\n            <div className=\"rounded-2xl border border-dashed border-emerald-400/40 bg-white/5 px-5 py-6 text-center\">\n              <p className=\"text-lg font-semibold text-white\">No health signals yet</p>\n              <p className=\"text-sm text-white/60\">We will surface job_runs as they arrive.</p>\n            </div>\n          ) : (\n            <div className=\"grid gap-2\">\n              {runs.map((run) => {\n                const status = (run.status ?? \"\").toLowerCase()\n                const ok = status === \"succeeded\" || status === \"success\"\n                return (\n                  <div\n                    key={run.id}\n                    className=\"flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-4 py-3\"\n                  >\n                    <div className=\"space-y-1\">\n                      <p className=\"font-semibold text-white\">{run.job_name ?? \"Unknown job\"}</p>\n                      <p className=\"text-xs text-white/50\">{new Date(run.created_at ?? \"\").toLocaleString()}</p>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                      <Shield size={16} className={ok ? \"text-emerald-300\" : \"text-amber-300\"} />\n                      <span className={ok ? \"text-emerald-200\" : \"text-amber-200\"}>\n                        {status || \"pending\"}\n                      </span>\n                      {typeof run.duration_ms === \"number\" && (\n                        <span className=\"text-xs text-white/50\">{Math.round(run.duration_ms)} ms</span>\n                      )}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M2 20h.01', key: '4haj6o' }],\n  ['path', { d: 'M7 20v-4', key: 'j294jx' }],\n  ['path', { d: 'M12 20v-8', key: 'i3yub9' }],\n  ['path', { d: 'M17 20V8', key: '1tkaf5' }],\n  ['path', { d: 'M22 4v16', key: 'sih9yq' }],\n];\n\n/**\n * @component @name Signal\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMiAyMGguMDEiIC8+CiAgPHBhdGggZD0iTTcgMjB2LTQiIC8+CiAgPHBhdGggZD0iTTEyIDIwdi04IiAvPgogIDxwYXRoIGQ9Ik0xNyAyMFY4IiAvPgogIDxwYXRoIGQ9Ik0yMiA0djE2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/signal\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Signal = createLucideIcon('signal', __iconNode);\n\nexport default Signal;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z',\n      key: 'oel41y',\n    },\n  ],\n];\n\n/**\n * @component @name Shield\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgMTNjMCA1LTMuNSA3LjUtNy42NiA4Ljk1YTEgMSAwIDAgMS0uNjctLjAxQzcuNSAyMC41IDQgMTggNCAxM1Y2YTEgMSAwIDAgMSAxLTFjMiAwIDQuNS0xLjIgNi4yNC0yLjcyYTEuMTcgMS4xNyAwIDAgMSAxLjUyIDBDMTQuNTEgMy44MSAxNyA1IDE5IDVhMSAxIDAgMCAxIDEgMXoiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/shield\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Shield = createLucideIcon('shield', __iconNode);\n\nexport default Shield;\n"],"names":[],"mappings":"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","ignoreList":[0,2,3]}
./.next/server/chunks/ssr/src_app_operator_page_tsx_506ff481._.js:1:module.exports=[872,a=>{"use strict";var b=a.i(7997),c=a.i(95936),d=a.i(70891);a.i(14796);var e=a.i(66218),f=a.i(64941),g=a.i(33644),h=a.i(28783),i=a.i(1269);let j=(0,i.default)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);var k=a.i(11952);let l=(0,i.default)("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),m=(0,i.default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),n=(0,i.default)("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),o=(0,i.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),p=(0,i.default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var q=a.i(77695);function r(){let a=new Date;a.setUTCHours(0,0,0,0);let b=new Date;return b.setUTCHours(24,0,0,0),{start:a.toISOString(),end:b.toISOString()}}let s=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});function t(a){if(!a)return"â€”";let b=new Date(a);return Number.isNaN(b.getTime())?"â€”":s.format(b)}function u(a){if(!a)return"â€”";let b=new Date(a);if(Number.isNaN(b.getTime()))return"â€”";let c=Math.round((Date.now()-b.getTime())/6e4);if(c<1)return"just now";if(c<60)return`hace ${c} min`;let d=Math.round(c/60);if(d<24)return`hace ${d} h`;let e=Math.round(d/24);return`hace ${e} d`}async function v(a){if(!a)return[];let{data:b,error:c}=await a.from("touch_runs").select("id, campaign_id, lead_id, step, channel, scheduled_at, sent_at, status, error, created_at, type, intent, outcome, retry_count, max_retries, message_class").in("status",["queued","scheduled"]).order("scheduled_at",{ascending:!0}).limit(50);return b&&b?c?(console.error(c),[]):b&&Array.isArray(b)?b.filter(a=>!a?.error):[]:[]}async function w(a){if(!a)return[];let{start:b,end:c}=r(),{data:d,error:e}=await a.from("touch_runs").select("id, campaign_id, lead_id, step, channel, scheduled_at, sent_at, status, error, created_at, type, intent, outcome, retry_count, max_retries, message_class").eq("status","failed").gte("created_at",b).lt("created_at",c).order("created_at",{ascending:!1}).limit(30);return e?(console.error(e),[]):d&&Array.isArray(d)?d.filter(a=>!a?.error):[]}async function x(a){if(!a)return{touchesTotalToday:0,touchesSentToday:0,touchesFailedToday:0,touchesQueuedToday:0,appointmentNotificationsToday:0};let{start:b,end:c}=r(),[d,e,f,g,h]=await Promise.all([a.from("touch_runs").select("id",{count:"exact",head:!0}).gte("created_at",b).lt("created_at",c),a.from("touch_runs").select("id",{count:"exact",head:!0}).eq("status","sent").gte("created_at",b).lt("created_at",c),a.from("touch_runs").select("id",{count:"exact",head:!0}).eq("status","failed").gte("created_at",b).lt("created_at",c),a.from("touch_runs").select("id",{count:"exact",head:!0}).in("status",["queued","scheduled"]).gte("created_at",b).lt("created_at",c),a.from("appointments_notifications").select("id",{count:"exact",head:!0}).gte("notify_at",b).lt("notify_at",c)]);return{touchesTotalToday:d.count??0,touchesSentToday:e.count??0,touchesFailedToday:f.count??0,touchesQueuedToday:g.count??0,appointmentNotificationsToday:h.count??0}}async function y(a){if(!a)return[];let{start:b,end:c}=r(),{data:d,error:e}=await a.from("appointments_notifications").select("id, org_id, appointment_id, channel, notify_at, status, created_at, sent_at, error").in("status",["queued","pending"]).gte("notify_at",b).lt("notify_at",c).order("notify_at",{ascending:!0}).limit(30);return e?(console.error(e),[]):d&&Array.isArray(d)?d.filter(a=>!a?.error):[]}function z(a){let c,d,e=(a??"").toLowerCase(),f="inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]";return"email"===e?f+=" border-sky-400/60 bg-sky-500/10 text-sky-100":"whatsapp"===e?f+=" border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"sms"===e?f+=" border-indigo-400/60 bg-indigo-500/10 text-indigo-100":"voice"===e||"phone"===e?f+=" border-amber-400/60 bg-amber-500/10 text-amber-100":"zoom"===e?f+=" border-fuchsia-400/60 bg-fuchsia-500/10 text-fuchsia-100":f+=" border-white/20 bg-white/5 text-white/70",(0,b.jsxs)("span",{className:f,children:[(c=(a??"").toLowerCase(),d="h-4 w-4","email"===c?(0,b.jsx)(h.Mail,{className:d}):"whatsapp"===c?(0,b.jsx)(j,{className:d}):"sms"===c?(0,b.jsx)(l,{className:d}):"voice"===c||"phone"===c?(0,b.jsx)(k.PhoneCall,{className:d}):"zoom"===c?(0,b.jsx)(n,{className:d}):(0,b.jsx)(m,{className:d})),(0,b.jsx)("span",{className:"capitalize",children:a??"â€”"})]})}function A(a){let c=(a??"").toLowerCase(),d="inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]";return"sent"===c?(d+=" border-emerald-400/70 bg-emerald-500/10 text-emerald-100 shadow-[0_0_20px_rgba(16,185,129,0.35)]",(0,b.jsxs)("span",{className:d,children:[(0,b.jsx)(p,{className:"h-3 w-3"}),"sent"]})):"failed"===c?(d+=" border-rose-400/70 bg-rose-500/10 text-rose-100 shadow-[0_0_20px_rgba(244,63,94,0.45)]",(0,b.jsxs)("span",{className:d,children:[(0,b.jsx)(o,{className:"h-3 w-3"}),"failed"]})):"queued"===c||"scheduled"===c?(d+=" border-amber-400/70 bg-amber-500/10 text-amber-100 shadow-[0_0_20px_rgba(251,191,36,0.35)]",(0,b.jsxs)("span",{className:d,children:[(0,b.jsx)(q.Zap,{className:"h-3 w-3"}),c]})):(d+=" border-white/20 bg-white/5 text-white/70",(0,b.jsx)("span",{className:d,children:a??"unknown"}))}function B({label:a,value:c,helper:d,icon:e}){return(0,b.jsx)(f.Card,{className:"border-white/10 bg-gradient-to-b from-slate-900/40 via-slate-900/10 to-slate-900/0",children:(0,b.jsxs)(f.CardContent,{className:"flex items-center gap-3 p-4",children:[(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-2xl bg-white/10",children:e}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-[0.16em] text-white/50",children:a}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-white",children:c}),(0,b.jsx)("p",{className:"text-[11px] text-white/50",children:d})]})]})})}function C({rows:a}){return(0,b.jsxs)(f.Card,{className:"border-white/10 bg-white/5",children:[(0,b.jsx)(f.CardHeader,{title:"Live queue",description:"Touches en cola listos para salir (multi-canal)."}),(0,b.jsx)(f.CardContent,{className:"p-0",children:0===a.length?(0,b.jsx)("p",{className:"p-4 text-sm text-white/60",children:"No hay touches en cola ahora mismo."}):(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHead,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHeaderCell,{children:"Lead"}),(0,b.jsx)(g.TableHeaderCell,{children:"Channel"}),(0,b.jsx)(g.TableHeaderCell,{children:"Step"}),(0,b.jsx)(g.TableHeaderCell,{children:"Status"}),(0,b.jsx)(g.TableHeaderCell,{children:"Meta"}),(0,b.jsx)(g.TableHeaderCell,{className:"text-right",children:"Scheduled / Age"})]})}),(0,b.jsx)(g.TableBody,{children:a.map(a=>{let d=a.lead_id?.slice(0,8).toUpperCase()??"UNKNOWN",e=a.campaign_id?.slice(0,8).toUpperCase()??"â€”",f=[];return a.type&&f.push(a.type),a.intent&&f.push(a.intent),a.message_class&&f.push(a.message_class),(0,b.jsxs)(g.TableRow,{className:"transition hover:bg-white/10",children:[(0,b.jsx)(g.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[a.lead_id?(0,b.jsx)(c.default,{href:`/leads/${a.lead_id}`,className:"text-sm font-semibold text-white hover:underline",children:d}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:d}),(0,b.jsxs)("p",{className:"text-[11px] text-white/45",children:["Campaign: ",e]})]})}),(0,b.jsx)(g.TableCell,{children:z(a.channel)}),(0,b.jsx)(g.TableCell,{className:"text-sm text-white/80",children:null!=a.step?(0,b.jsxs)("span",{className:"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[11px] text-white/70",children:["#",a.step]}):"â€”"}),(0,b.jsx)(g.TableCell,{children:A(a.status)}),(0,b.jsx)(g.TableCell,{children:0===f.length?(0,b.jsx)("span",{className:"text-[11px] text-white/40",children:"â€”"}):(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:f.map(a=>(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] text-white/60",children:a},a))})}),(0,b.jsx)(g.TableCell,{className:"text-right text-[11px] text-white/60",children:(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)("span",{children:t(a.scheduled_at)}),(0,b.jsx)("span",{className:"block text-white/40",children:u(a.scheduled_at)})]})})]},a.id)})})]})})]})}function D({rows:a}){return(0,b.jsxs)(f.Card,{className:"border-white/10 bg-white/5",children:[(0,b.jsx)(f.CardHeader,{title:"Recent errors",description:"Fallos de entrega hoy por canal."}),(0,b.jsx)(f.CardContent,{className:"p-0",children:0===a.length?(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 text-sm text-emerald-200",children:[(0,b.jsx)(p,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Sin errores hoy. Motor limpio. ðŸ™Œ"})]}):(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHead,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHeaderCell,{children:"When"}),(0,b.jsx)(g.TableHeaderCell,{children:"Lead"}),(0,b.jsx)(g.TableHeaderCell,{children:"Channel"}),(0,b.jsx)(g.TableHeaderCell,{children:"Error"}),(0,b.jsx)(g.TableHeaderCell,{className:"text-right",children:"Status"})]})}),(0,b.jsx)(g.TableBody,{children:a.map(a=>{let d=a.lead_id?.slice(0,8).toUpperCase()??"UNKNOWN",e=a.error??"unknown error",f=e.length>90?`${e.slice(0,90)}â€¦`:e;return(0,b.jsxs)(g.TableRow,{className:"transition hover:bg-white/10",children:[(0,b.jsx)(g.TableCell,{className:"text-[11px] text-white/70",children:(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)("span",{children:t(a.created_at)}),(0,b.jsx)("span",{className:"block text-white/40",children:u(a.created_at)})]})}),(0,b.jsx)(g.TableCell,{children:a.lead_id?(0,b.jsx)(c.default,{href:`/leads/${a.lead_id}`,className:"text-sm font-semibold text-white hover:underline",children:d}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:d})}),(0,b.jsx)(g.TableCell,{children:z(a.channel)}),(0,b.jsx)(g.TableCell,{className:"max-w-md text-xs text-rose-200",children:f}),(0,b.jsx)(g.TableCell,{className:"text-right",children:A(a.status)})]},a.id)})})]})})]})}function E({rows:a}){return(0,b.jsxs)(f.Card,{className:"border-white/10 bg-white/5",children:[(0,b.jsx)(f.CardHeader,{title:"Appointment notifications",description:"Recordatorios de citas en cola para hoy."}),(0,b.jsx)(f.CardContent,{className:"p-0",children:0===a.length?(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 text-sm text-white/60",children:[(0,b.jsx)(n,{className:"h-4 w-4 text-white/40"}),(0,b.jsx)("span",{children:"No hay notificaciones de citas en cola para hoy."})]}):(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHead,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHeaderCell,{children:"Appointment"}),(0,b.jsx)(g.TableHeaderCell,{children:"Channel"}),(0,b.jsx)(g.TableHeaderCell,{children:"Status"}),(0,b.jsx)(g.TableHeaderCell,{className:"text-right",children:"Notify at"})]})}),(0,b.jsx)(g.TableBody,{children:a.map(a=>{let c=a.appointment_id?.slice(0,8).toUpperCase()??"UNKNOWN";return(0,b.jsxs)(g.TableRow,{className:"transition hover:bg-white/10",children:[(0,b.jsx)(g.TableCell,{className:"text-sm text-white",children:c}),(0,b.jsx)(g.TableCell,{children:z(a.channel)}),(0,b.jsx)(g.TableCell,{children:A(a.status)}),(0,b.jsx)(g.TableCell,{className:"text-right text-[11px] text-white/70",children:(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)("span",{children:t(a.notify_at)}),(0,b.jsx)("span",{className:"block text-white/40",children:u(a.notify_at)})]})})]},a.id)})})]})})]})}async function F(){let a=(0,d.supabaseServer)(),[c,f,g,h]=await Promise.all([v(a),w(a),x(a),y(a)]),i=c.length,j=f.length>0,k=j?"Execution engine con errores hoy":i>0?`Execution engine activo \xb7 ${i} en cola`:"Execution engine idle pero sano",l=j?"destructive":i>0?"neutral":"warning";return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-[0.16em] text-white/50",children:"Operations Â· Execution layer"}),(0,b.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Operator Cockpit"}),(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Vista en tiempo casi real del motor que manda emails, WhatsApps, SMS, llamadas y recordatorios de citas."}),(0,b.jsx)("p",{className:"text-[11px] text-white/40",children:(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] uppercase tracking-[0.16em] text-white/50",children:"Today Â· UTC"})})]}),(0,b.jsxs)(e.Badge,{variant:l,className:"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80",children:[(0,b.jsx)("span",{className:`inline-block h-2 w-2 rounded-full ${"destructive"===l?"bg-rose-400":"warning"===l?"bg-amber-400":"bg-emerald-400"}`}),k]})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-5",children:[(0,b.jsx)(B,{label:"Touches hoy",value:g.touchesTotalToday,helper:"Todos los canales",icon:(0,b.jsx)(q.Zap,{className:"h-4 w-4 text-emerald-200"})}),(0,b.jsx)(B,{label:"Sent",value:g.touchesSentToday,helper:"Entregados hoy",icon:(0,b.jsx)(p,{className:"h-4 w-4 text-emerald-200"})}),(0,b.jsx)(B,{label:"Failed",value:g.touchesFailedToday,helper:"Con error hoy",icon:(0,b.jsx)(o,{className:"h-4 w-4 text-rose-200"})}),(0,b.jsx)(B,{label:"Queued",value:g.touchesQueuedToday,helper:"Creados hoy",icon:(0,b.jsx)(m,{className:"h-4 w-4 text-amber-200"})}),(0,b.jsx)(B,{label:"Cita â€“ notifs",value:g.appointmentNotificationsToday,helper:"Recordatorios hoy",icon:(0,b.jsx)(n,{className:"h-4 w-4 text-sky-200"})})]}),(0,b.jsxs)("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]",children:[(0,b.jsx)(C,{rows:c}),(0,b.jsx)(D,{rows:f})]}),(0,b.jsx)(E,{rows:h})]})}a.s(["default",()=>F,"revalidate",0,0],872)}];
./.next/server/chunks/ssr/src_app_leads_[id]_page_tsx_18f8b797._.js.map:1:{"version":3,"sources":["../../../../src/components/leads/LeadActivityTimeline.tsx","../../../../src/app/leads/%5Bid%5D/page.tsx","../../../../src/components/leads/lead-activity-labels.ts","../../../../node_modules/lucide-react/src/icons/building-2.ts","../../../../node_modules/lucide-react/src/icons/arrow-left.ts","../../../../node_modules/lucide-react/src/icons/calendar.ts","../../../../node_modules/lucide-react/src/icons/circle-check.ts","../../../../node_modules/lucide-react/src/icons/user.ts","../../../../node_modules/lucide-react/src/icons/clock-3.ts","../../../../node_modules/lucide-react/src/icons/circle-x.ts","../../../../node_modules/lucide-react/src/icons/map-pin.ts","../../../../src/components/leads/timeline-utils.ts"],"sourcesContent":["import {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n} from \"@/components/ui-custom\"\n\nimport {\n  Calendar,\n  CheckCircle2,\n  Clock3,\n  Mail,\n  MessageCircle,\n  PhoneCall,\n  XCircle,\n} from \"lucide-react\"\n\nexport type LeadTimelineEventType =\n  | \"touch_run\"\n  | \"appointment\"\n  | \"appointment_outcome\"\n  | \"appointment_reminder\"\n\nexport interface LeadTimelineEvent {\n  id: string\n  occurredAt: string\n  type: LeadTimelineEventType\n  channel?: string | null\n  step?: number | null\n  label: string\n  description?: string | null\n  status?: string | null\n  meta?: Record<string, unknown>\n}\n\nfunction formatDateTime(value: string) {\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return value\n  return date.toLocaleString()\n}\n\nfunction iconForEvent(event: LeadTimelineEvent) {\n  if (event.type === \"appointment\") return <Calendar size={16} />\n  if (event.type === \"appointment_outcome\") {\n    const outcome = event.status?.toLowerCase()\n    if (outcome === \"show\" || outcome === \"attended\") {\n      return <CheckCircle2 size={16} />\n    }\n    if (outcome === \"no_show\") {\n      return <XCircle size={16} />\n    }\n    return <CheckCircle2 size={16} />\n  }\n  if (event.type === \"appointment_reminder\") return <Clock3 size={16} />\n  if (event.channel === \"voice\") return <PhoneCall size={16} />\n  if (event.channel === \"email\") return <Mail size={16} />\n  return <MessageCircle size={16} />\n}\n\nfunction channelBadgeVariant(channel?: string | null) {\n  const normalized = channel?.toLowerCase()\n  if (normalized === \"email\") return \"info\" as const\n  if (normalized === \"voice\") return \"warning\" as const\n  if (normalized === \"sms\" || normalized === \"whatsapp\") return \"success\" as const\n  return \"neutral\" as const\n}\n\ntype LeadActivityTimelineProps = {\n  events: LeadTimelineEvent[]\n}\n\nexport function LeadActivityTimeline({ events }: LeadActivityTimelineProps) {\n  return (\n    <Card>\n      <CardHeader title=\"Activity timeline\" description=\"Touches, appointments and reminders for this lead\" />\n      <CardContent>\n        {events.length === 0 ? (\n          <p className=\"text-sm text-white/70\">No activity yet for this lead.</p>\n        ) : (\n          <div className=\"relative space-y-4\">\n            <div className=\"absolute left-4 top-0 h-full border-l border-white/10\" aria-hidden />\n            {events.map((event) => (\n              <div key={event.id} className=\"relative flex gap-3 pl-10\">\n                <div className=\"absolute left-0 flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white\">\n                  {iconForEvent(event)}\n                </div>\n                <div className=\"flex-1 space-y-1 rounded-xl border border-white/10 bg-white/5 p-3\">\n                  <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                    <div>\n                      <p className=\"text-sm font-semibold text-white\">{event.label}</p>\n                      <p className=\"text-xs text-white/60\">{formatDateTime(event.occurredAt)}</p>\n                    </div>\n                    <div className=\"flex flex-wrap items-center gap-2\">\n                      {event.channel ? (\n                        <Badge variant={channelBadgeVariant(event.channel)} className=\"capitalize\">\n                          {event.channel}\n                        </Badge>\n                      ) : null}\n                      {event.step ? (\n                        <Badge variant=\"outline\">Step {event.step}</Badge>\n                      ) : null}\n                      {event.status ? (\n                        <Badge variant=\"outline\" className=\"capitalize\">\n                          {event.status}\n                        </Badge>\n                      ) : null}\n                    </div>\n                  </div>\n                  {event.description ? (\n                    <p className=\"text-sm text-white/80\">{event.description}</p>\n                  ) : null}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n","\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport Link from \"next/link\"\nimport { useParams } from \"next/navigation\"\nimport { ArrowLeft, Building2, Mail, MapPin, PhoneCall, User } from \"lucide-react\"\n\nimport { LeadActivityTimeline, type LeadTimelineEvent } from \"@/components/leads/LeadActivityTimeline\"\nimport { Badge, Button, Card, CardContent, CardHeader } from \"@/components/ui-custom\"\nimport { StatCard } from \"@/components/ui-custom/stat-card\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport type { LeadEnriched } from \"@/types/lead\"\nimport {\n  describeAppointmentOutcome,\n  describeReminder,\n  describeTouchRun,\n} from \"@/components/leads/lead-activity-labels\"\nimport { touchRunSelect, type TouchRunRow } from \"@/components/leads/timeline-utils\"\n\ntype LeadDetail = LeadEnriched & {\n  company_name?: string | null\n  notes?: string | null\n}\n\ntype AppointmentRow = {\n  id: string\n  lead_id: string | null\n  channel: string | null\n  status: string | null\n  outcome: string | null\n  notes: string | null\n  starts_at: string | null\n  scheduled_for: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  appointment_id: string | null\n  notify_at: string | null\n  status: string | null\n  payload: Record<string, any> | null\n  created_at?: string | null\n}\n\ntype LeadGenome = {\n  industry: string | null\n  sub_industry: string | null\n  pain_points: string[] | null\n  objections: string[] | null\n  emotional_state: Record<string, any> | null\n  urgency_score: number | null\n  budget_estimate: string | null\n  decision_authority_score: number | null\n  conversion_likelihood: number | null\n  recommended_channel: string | null\n  recommended_cadence: Record<string, any> | null\n  recommended_persona: string | null\n  ai_lead_score: number | null\n  status: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype LeadDataResult = {\n  lead: LeadDetail | null\n  genome: LeadGenome | null\n  events: LeadTimelineEvent[]\n  stats: {\n    touches: number\n    appointments: number\n    reminders: number\n  }\n}\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return null\n  return date.toLocaleString()\n}\n\nfunction deriveLeadTitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin nombre\"\n  return (\n    lead.full_name ||\n    (lead as any).contact_name ||\n    lead.email ||\n    lead.phone ||\n    \"Sin nombre\"\n  )\n}\n\nfunction deriveLeadSubtitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin contacto\"\n  const email = lead.email ?? \"Sin email\"\n  const phone = lead.phone ?? \"Sin telÃ©fono\"\n  return `${email} Â· ${phone}`\n}\n\nfunction appointmentTime(appt: AppointmentRow) {\n  return appt.starts_at ?? appt.scheduled_for ?? appt.created_at\n}\n\nfunction mapTouchRuns(touchRuns: TouchRunRow[]): LeadTimelineEvent[] {\n  return touchRuns.map((touch) => {\n    const occurredAt = touch.scheduled_at ?? touch.created_at\n    const { label, description } = describeTouchRun(touch)\n\n    return {\n      id: `touch-${touch.id}`,\n      occurredAt: occurredAt ?? new Date().toISOString(),\n      type: \"touch_run\" as const,\n      channel: touch.channel,\n      step: touch.step,\n      label,\n      description,\n      status: touch.status,\n      meta: touch.meta ?? undefined,\n    }\n  })\n}\n\nfunction mapAppointments(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments.map((appointment) => {\n    const when = appointmentTime(appointment) ?? new Date().toISOString()\n    const formatted = formatDateTime(when)\n    const description = formatted\n      ? `Scheduled for ${formatted}${\n          appointment.notes ? ` Â· ${appointment.notes}` : \"\"\n        }`\n      : appointment.notes ?? undefined\n\n    return {\n      id: `appointment-${appointment.id}`,\n      occurredAt: when,\n      type: \"appointment\" as const,\n      channel: appointment.channel,\n      step: null,\n      label: \"Appointment scheduled\",\n      description,\n      status: appointment.status,\n      meta: { appointmentId: appointment.id },\n    }\n  })\n}\n\nfunction mapAppointmentOutcomes(\n  appointments: AppointmentRow[],\n): LeadTimelineEvent[] {\n  return appointments\n    .filter((appointment) => Boolean(appointment.outcome))\n    .map((appointment) => {\n      const label = describeAppointmentOutcome(appointment.outcome)\n      const when =\n        appointment.updated_at ??\n        appointmentTime(appointment) ??\n        new Date().toISOString()\n      const apptTime = appointmentTime(appointment)\n      const formatted = formatDateTime(apptTime)\n\n      const description = formatted\n        ? `Outcome for appointment on ${formatted}`\n        : \"Appointment outcome updated\"\n\n      return {\n        id: `appointment-outcome-${appointment.id}`,\n        occurredAt: when,\n        type: \"appointment_outcome\" as const,\n        channel: appointment.channel,\n        step: null,\n        label,\n        description,\n        status: appointment.outcome,\n        meta: { appointmentId: appointment.id },\n      }\n    })\n}\n\nfunction mapAppointmentReminders(\n  reminders: AppointmentNotificationRow[],\n  appointmentById: Map<string, AppointmentRow>,\n  leadId: string,\n): LeadTimelineEvent[] {\n  return reminders\n    .filter((reminder) => {\n      const payloadLeadId =\n        (reminder.payload?.lead_id as string | undefined) ?? null\n      const appointmentLeadId = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)?.lead_id ?? null\n        : null\n      return payloadLeadId === leadId || appointmentLeadId === leadId\n    })\n    .map((reminder) => {\n      const appointment = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)\n        : undefined\n      const when =\n        reminder.notify_at ??\n        appointmentTime(\n          appointment ?? ({} as AppointmentRow),\n        ) ??\n        new Date().toISOString()\n      const kind = (reminder.payload?.kind as string | undefined) ?? null\n      const reminderLabel = describeReminder(kind) ?? \"Appointment reminder\"\n      const appointmentDate = appointmentTime(\n        appointment ?? ({} as AppointmentRow),\n      )\n      const formatted = formatDateTime(appointmentDate)\n\n      return {\n        id: `appointment-reminder-${reminder.id}`,\n        occurredAt: when,\n        type: \"appointment_reminder\" as const,\n        channel: appointment?.channel ?? null,\n        step: null,\n        label: reminderLabel,\n        description: formatted\n          ? `Reminder for appointment on ${formatted}`\n          : undefined,\n        status: reminder.status,\n        meta: { appointmentId: reminder.appointment_id, kind },\n      }\n    })\n}\n\nasync function loadLeadDataBrowser(leadId: string): Promise<LeadDataResult> {\n  const client = supabaseBrowser()\n\n  // 1) Vista rica: lead_enriched\n  const { data: enrichedRow, error: enrichedError } = await client\n    .from(\"lead_enriched\")\n    .select(\n      \"id, full_name, email, phone, state, last_touch_at, channel_last, campaign_id, campaign_name, company_name, enriched\",\n    )\n    .eq(\"id\", leadId)\n    .maybeSingle()\n\n  let lead: LeadDetail | null = null\n\n  if (enrichedRow) {\n    lead = {\n      ...(enrichedRow as any),\n      company_name:\n        (enrichedRow as any).company_name ??\n        (enrichedRow as any).company ??\n        null,\n    }\n  } else {\n    // 2) Fallback: tabla leads (import original)\n    const { data: baseRow } = await client\n      .from(\"leads\")\n      .select(\n        \"id, contact_name, email, phone, state, last_touched_at, last_channel, campaign_id, campaign_name, company_name, enriched\",\n      )\n      .eq(\"id\", leadId)\n      .maybeSingle()\n\n    if (baseRow) {\n      lead = {\n        id: baseRow.id,\n        full_name: (baseRow as any).contact_name ?? null,\n        email: baseRow.email ?? null,\n        phone: baseRow.phone ?? null,\n        state: baseRow.state ?? null,\n        last_touch_at: (baseRow as any).last_touched_at ?? null,\n        campaign_id: (baseRow as any).campaign_id ?? null,\n        campaign_name: (baseRow as any).campaign_name ?? null,\n        channel_last: (baseRow as any).last_channel ?? null,\n        company_name: (baseRow as any).company_name ?? null,\n        enriched: (baseRow as any).enriched ?? null,\n      } as any\n    }\n\n    if (!baseRow && enrichedError) {\n      console.warn(\"lead_enriched error:\", enrichedError)\n    }\n  }\n\n  // Si aÃºn no tenemos lead, devolvemos dummy pero con ID\n  if (!lead) {\n    lead = {\n      id: leadId,\n      full_name: null,\n      email: null,\n      phone: null,\n      state: \"unknown\",\n      last_touch_at: null,\n      campaign_id: null,\n      campaign_name: null,\n      channel_last: null,\n      company_name: null,\n      notes: null,\n      enriched: null,\n    } as any\n  }\n\n  // 3) Lead Genome: Ãºltimo enrichment_v2 completado\n  let genome: LeadGenome | null = null\n\n  const { data: enrichmentRow, error: enrichmentError } = await client\n    .from(\"lead_enrichments_v2\")\n    .select(\n      `\n      industry,\n      sub_industry,\n      pain_points,\n      objections,\n      emotional_state,\n      urgency_score,\n      budget_estimate,\n      decision_authority_score,\n      conversion_likelihood,\n      recommended_channel,\n      recommended_cadence,\n      recommended_persona,\n      ai_lead_score,\n      status,\n      created_at,\n      updated_at\n    `,\n    )\n    .eq(\"lead_id\", leadId)\n    .order(\"created_at\", { ascending: false })\n    .limit(1)\n    .maybeSingle()\n\n  if (enrichmentError) {\n    console.warn(\"lead_enrichments_v2 error:\", enrichmentError)\n  }\n\n  if (enrichmentRow) {\n    genome = {\n      industry: enrichmentRow.industry ?? null,\n      sub_industry: enrichmentRow.sub_industry ?? null,\n      pain_points: (enrichmentRow.pain_points as string[] | null) ?? null,\n      objections: (enrichmentRow.objections as string[] | null) ?? null,\n      emotional_state:\n        (enrichmentRow.emotional_state as Record<string, any> | null) ?? null,\n      urgency_score:\n        typeof enrichmentRow.urgency_score === \"number\"\n          ? enrichmentRow.urgency_score\n          : enrichmentRow.urgency_score != null\n          ? Number(enrichmentRow.urgency_score)\n          : null,\n      budget_estimate: enrichmentRow.budget_estimate ?? null,\n      decision_authority_score:\n        typeof enrichmentRow.decision_authority_score === \"number\"\n          ? enrichmentRow.decision_authority_score\n          : enrichmentRow.decision_authority_score != null\n          ? Number(enrichmentRow.decision_authority_score)\n          : null,\n      conversion_likelihood:\n        typeof enrichmentRow.conversion_likelihood === \"number\"\n          ? enrichmentRow.conversion_likelihood\n          : enrichmentRow.conversion_likelihood != null\n          ? Number(enrichmentRow.conversion_likelihood)\n          : null,\n      recommended_channel: enrichmentRow.recommended_channel ?? null,\n      recommended_cadence:\n        (enrichmentRow.recommended_cadence as Record<string, any> | null) ??\n        null,\n      recommended_persona: enrichmentRow.recommended_persona ?? null,\n      ai_lead_score:\n        typeof enrichmentRow.ai_lead_score === \"number\"\n          ? enrichmentRow.ai_lead_score\n          : enrichmentRow.ai_lead_score != null\n          ? Number(enrichmentRow.ai_lead_score)\n          : null,\n      status: enrichmentRow.status ?? null,\n      created_at: enrichmentRow.created_at ?? null,\n      updated_at: enrichmentRow.updated_at ?? null,\n    }\n  }\n\n  // 4) Timeline y stats\n  const [touchRunsResult, appointmentsResult, remindersResult] =\n    await Promise.all([\n      client\n        .from(\"touch_runs\")\n        .select(touchRunSelect)\n        .eq(\"lead_id\", leadId)\n        .order(\"scheduled_at\", {\n          ascending: false,\n          nullsLast: true,\n        } as any)\n        .order(\"created_at\", { ascending: false }),\n      client\n        .from(\"appointments\")\n        .select(\n          \"id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at\",\n        )\n        .eq(\"lead_id\", leadId),\n      client\n        .from(\"appointments_notifications\")\n        .select(\n          \"id, appointment_id, notify_at, status, payload, created_at\",\n        ),\n    ])\n\n  const touchRuns = (touchRunsResult.data ?? []) as TouchRunRow[]\n  const appointments = (appointmentsResult.data ?? []) as AppointmentRow[]\n  const reminders =\n    (remindersResult.data ?? []) as AppointmentNotificationRow[]\n\n  const appointmentById = new Map<string, AppointmentRow>()\n  appointments.forEach((row) => appointmentById.set(row.id, row))\n\n  const events: LeadTimelineEvent[] = [\n    ...mapTouchRuns(touchRuns),\n    ...mapAppointments(appointments),\n    ...mapAppointmentOutcomes(appointments),\n    ...mapAppointmentReminders(reminders, appointmentById, leadId),\n  ].sort((a, b) => {\n    const aTime = new Date(a.occurredAt).getTime()\n    const bTime = new Date(b.occurredAt).getTime()\n    const safeA = Number.isNaN(aTime) ? 0 : aTime\n    const safeB = Number.isNaN(bTime) ? 0 : bTime\n    return safeB - safeA\n  })\n\n  return {\n    lead,\n    genome,\n    events,\n    stats: {\n      touches: touchRuns.length,\n      appointments: appointments.length,\n      reminders: reminders.length,\n    },\n  }\n}\n\nexport default function LeadDetailPage() {\n  const params = useParams<{ id: string }>()\n  const leadId = params.id\n\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [lead, setLead] = useState<LeadDetail | null>(null)\n  const [genome, setGenome] = useState<LeadGenome | null>(null)\n  const [events, setEvents] = useState<LeadTimelineEvent[]>([])\n  const [stats, setStats] = useState({\n    touches: 0,\n    appointments: 0,\n    reminders: 0,\n  })\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (!supabaseReady || !leadId) return\n\n    let alive = true\n\n    ;(async () => {\n      setLoading(true)\n      const result = await loadLeadDataBrowser(leadId)\n      if (!alive) return\n      setLead(result.lead)\n      setGenome(result.genome)\n      setEvents(result.events)\n      setStats(result.stats)\n      setLoading(false)\n    })()\n\n    return () => {\n      alive = false\n    }\n  }, [leadId, supabaseReady])\n\n  const title = deriveLeadTitle(lead)\n  const subtitle = deriveLeadSubtitle(lead)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/leads\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft size={16} />\n              Back\n            </Button>\n          </Link>\n          <div>\n            <p className=\"text-sm uppercase tracking-[0.16em] text-white/50\">\n              Lead\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Lead timeline\n            </h1>\n            <p className=\"text-sm text-white/80\">{title}</p>\n            <p className=\"text-xs text-white/60\">\n              {subtitle} Â· ID: {leadId}\n            </p>\n          </div>\n        </div>\n        {lead?.state ? (\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {lead.state}\n          </Badge>\n        ) : null}\n      </div>\n\n      {/* Overview */}\n      <Card>\n        <CardHeader\n          title=\"Lead overview\"\n          description=\"Basic details and last touch information\"\n        />\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex items-center gap-2 text-white\">\n              <User size={16} className=\"text-white/60\" />\n              <span className=\"font-semibold\">{title}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Mail size={14} className=\"text-white/50\" />\n              <span>{lead?.email ?? \"Sin email\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <PhoneCall size={14} className=\"text-white/50\" />\n              <span>{lead?.phone ?? \"Sin telÃ©fono\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Building2 size={14} className=\"text-white/50\" />\n              <span>{lead?.company_name ?? \"Sin compaÃ±Ã­a\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <MapPin size={14} className=\"text-white/50\" />\n              <span>{lead?.channel_last ?? \"Sin canal\"}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80\">\n            <p className=\"text-sm text-white/60\">Last touch</p>\n            <p className=\"text-lg font-semibold text-white\">\n              {formatDateTime(lead?.last_touch_at ?? null) ??\n                \"No touches yet\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Channel: {lead?.channel_last ?? \"â€”\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Campaign:{\" \"}\n              {lead?.campaign_name ?? lead?.campaign_id ?? \"â€”\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Lead Genome V2 */}\n      {genome && (\n        <Card>\n          <CardHeader\n            title=\"Lead Genome\"\n            description=\"Industry, pains, objections and AI recommendations for this lead\"\n          />\n          <CardContent className=\"grid gap-4 md:grid-cols-2 text-sm text-white/80\">\n            <div className=\"space-y-2\">\n              <p>\n                <span className=\"text-white/50\">Industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.industry ?? \"Unknown\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Sub-industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.sub_industry ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">\n                  Recommended channel:\n                </span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_channel ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Persona:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_persona ?? \"â€”\"}\n                </span>\n              </p>\n              {typeof genome.ai_lead_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">AI Lead score:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.ai_lead_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.urgency_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">Urgency:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.urgency_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.decision_authority_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Decision authority:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.decision_authority_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.conversion_likelihood === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Conversion likelihood:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.conversion_likelihood}\n                  </span>\n                </p>\n              )}\n            </div>\n            <div className=\"space-y-3\">\n              {Array.isArray(genome.pain_points) &&\n                genome.pain_points.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Pain points\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.pain_points.map((p, idx) => (\n                        <li key={idx}>{p}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              {Array.isArray(genome.objections) &&\n                genome.objections.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Objections\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.objections.map((o, idx) => (\n                        <li key={idx}>{o}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Stats */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Total activity\"\n          value={events.length.toString()}\n          helper=\"Touches, appointments and reminders\"\n        />\n        <StatCard\n          label=\"Touch runs\"\n          value={stats.touches.toString()}\n          helper=\"touch_runs registrados\"\n        />\n        <StatCard\n          label=\"Appointments\"\n          value={stats.appointments.toString()}\n          helper=\"Incluye outcomes y reminders\"\n        />\n      </div>\n\n      {/* Timeline */}\n      <LeadActivityTimeline events={events} />\n\n      {loading ? (\n        <div className=\"space-y-3\">\n          <div className=\"h-10 animate-pulse rounded-xl bg-white/5\" />\n          <div className=\"h-52 animate-pulse rounded-2xl bg-white/5\" />\n          <div className=\"h-32 animate-pulse rounded-2xl bg-white/5\" />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n","import { type TouchRunRow } from \"./timeline-utils\"\n\nexport function formatTouchPreview(payload: unknown): string {\n  if (!payload) return \"\"\n\n  const payloadObject =\n    typeof payload === \"object\" && payload !== null ? (payload as Record<string, unknown>) : null\n\n  const source = typeof payloadObject?.source === \"string\" ? payloadObject.source : null\n\n  if (source === \"appointment_reminder\") {\n    const kind = typeof payloadObject?.kind === \"string\" ? payloadObject.kind : null\n    if (kind === \"appointment_reminder_24h\") return \"Recordatorio 24h antes de la cita\"\n    if (kind === \"appointment_reminder_1h\") return \"Recordatorio 1h antes de la cita\"\n    if (kind === \"appointment_reminder_10m\") return \"Recordatorio 10m antes de la cita\"\n  }\n\n  if (source === \"appointment_outcome\") {\n    const kind = typeof payloadObject?.kind === \"string\" ? payloadObject.kind : null\n    if (kind === \"no_show_followup_15m\") return \"Follow-up por no-show (15 min despuÃ©s)\"\n    if (kind === \"attended_followup_30m\") return \"Follow-up despuÃ©s de cita atendida (30 min)\"\n  }\n\n  const script = payloadObject?.script\n  if (typeof script === \"string\") {\n    const trimmed = script.trim()\n    return trimmed.length > 120 ? `${trimmed.slice(0, 120)}â€¦` : trimmed\n  }\n\n  const maybeMessage = payloadObject?.message ?? payloadObject?.body ?? payloadObject?.subject\n  if (typeof maybeMessage === \"string\") {\n    const trimmed = maybeMessage.trim()\n    if (trimmed) return trimmed.length > 120 ? `${trimmed.slice(0, 120)}â€¦` : trimmed\n  }\n\n  if (typeof payload === \"string\") {\n    const trimmed = payload.trim()\n    return trimmed.length > 120 ? `${trimmed.slice(0, 120)}â€¦` : trimmed\n  }\n\n  if (typeof payloadObject?.reason === \"string\") {\n    return `Motivo interno: ${payloadObject.reason}`\n  }\n\n  return \"\"\n}\n\ntype ReminderKind =\n  | \"appointment_reminder_24h\"\n  | \"appointment_reminder_1h\"\n  | \"appointment_reminder_10m\"\n  | string\n\nexport function describeTouchRun(step: TouchRunRow) {\n  const source =\n    (step.payload?.source as string | undefined) ??\n    (step.meta?.source as string | undefined) ??\n    null\n  const kind =\n    (step.payload?.kind as ReminderKind | undefined) ??\n    (step.meta?.kind as ReminderKind | undefined) ??\n    null\n  const stepNumber = step.step ?? undefined\n\n  if (source === \"appointment_reminder\" && stepNumber) {\n    const reminderLabel = describeReminder(kind)\n    return {\n      label: reminderLabel ?? \"Appointment reminder\", // fallback\n      description: formatTouchPreview(step.payload),\n    }\n  }\n\n  if (source === \"appointment_outcome\" && stepNumber) {\n    const followup = kind === \"no_show_followup_15m\"\n    const attended = kind === \"attended_followup_30m\"\n    return {\n      label: followup\n        ? \"No-show follow-up\"\n        : attended\n          ? \"Attended follow-up\"\n          : \"Appointment outcome follow-up\",\n      description: formatTouchPreview(step.payload),\n    }\n  }\n\n  return {\n    label: stepNumber ? `Cadence touch (step ${stepNumber})` : \"Cadence touch\",\n    description: formatTouchPreview(step.payload),\n  }\n}\n\nexport function describeReminder(kind: ReminderKind | null | undefined) {\n  if (!kind) return null\n\n  if (kind === \"appointment_reminder_24h\") {\n    return \"Appointment reminder (24h before)\"\n  }\n  if (kind === \"appointment_reminder_1h\") {\n    return \"Appointment reminder (1h before)\"\n  }\n  if (kind === \"appointment_reminder_10m\") {\n    return \"Appointment reminder (10m before)\"\n  }\n\n  return null\n}\n\nexport function describeAppointmentOutcome(outcome: string | null | undefined) {\n  const normalized = outcome?.toLowerCase()\n  if (!normalized) return \"Appointment outcome\"\n  if (normalized === \"show\" || normalized === \"attended\") {\n    return \"Appointment attended\"\n  }\n  if (normalized === \"no_show\") {\n    return \"Appointment no-show\"\n  }\n  return \"Appointment outcome\"\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M10 12h4', key: 'a56b0p' }],\n  ['path', { d: 'M10 8h4', key: '1sr2af' }],\n  ['path', { d: 'M14 21v-3a2 2 0 0 0-4 0v3', key: '1rgiei' }],\n  [\n    'path',\n    {\n      d: 'M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2',\n      key: 'secmi2',\n    },\n  ],\n  ['path', { d: 'M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16', key: '16ra0t' }],\n];\n\n/**\n * @component @name Building2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTJoNCIgLz4KICA8cGF0aCBkPSJNMTAgOGg0IiAvPgogIDxwYXRoIGQ9Ik0xNCAyMXYtM2EyIDIgMCAwIDAtNCAwdjMiIC8+CiAgPHBhdGggZD0iTTYgMTBINGEyIDIgMCAwIDAtMiAydjdhMiAyIDAgMCAwIDIgMmgxNmEyIDIgMCAwIDAgMi0yVjlhMiAyIDAgMCAwLTItMmgtMiIgLz4KICA8cGF0aCBkPSJNNiAyMVY1YTIgMiAwIDAgMSAyLTJoOGEyIDIgMCAwIDEgMiAydjE2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/building-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Building2 = createLucideIcon('building-2', __iconNode);\n\nexport default Building2;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n];\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('arrow-left', __iconNode);\n\nexport default ArrowLeft;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M8 2v4', key: '1cmpym' }],\n  ['path', { d: 'M16 2v4', key: '4m81vk' }],\n  ['rect', { width: '18', height: '18', x: '3', y: '4', rx: '2', key: '1hopcy' }],\n  ['path', { d: 'M3 10h18', key: '8toen8' }],\n];\n\n/**\n * @component @name Calendar\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNOCAydjQiIC8+CiAgPHBhdGggZD0iTTE2IDJ2NCIgLz4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHg9IjMiIHk9IjQiIHJ4PSIyIiAvPgogIDxwYXRoIGQ9Ik0zIDEwaDE4IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/calendar\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Calendar = createLucideIcon('calendar', __iconNode);\n\nexport default Calendar;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'm9 12 2 2 4-4', key: 'dzmm74' }],\n];\n\n/**\n * @component @name CircleCheck\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJtOSAxMiAyIDIgNC00IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/circle-check\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleCheck = createLucideIcon('circle-check', __iconNode);\n\nexport default CircleCheck;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2', key: '975kel' }],\n  ['circle', { cx: '12', cy: '7', r: '4', key: '17ys0d' }],\n];\n\n/**\n * @component @name User\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTkgMjF2LTJhNCA0IDAgMCAwLTQtNEg5YTQgNCAwIDAgMC00IDR2MiIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/user\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst User = createLucideIcon('user', __iconNode);\n\nexport default User;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M12 6v6h4', key: '135r8i' }],\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n];\n\n/**\n * @component @name Clock3\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgNnY2aDQiIC8+CiAgPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/clock-3\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Clock3 = createLucideIcon('clock-3', __iconNode);\n\nexport default Clock3;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'm15 9-6 6', key: '1uzhvr' }],\n  ['path', { d: 'm9 9 6 6', key: 'z0biqf' }],\n];\n\n/**\n * @component @name CircleX\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJtMTUgOS02IDYiIC8+CiAgPHBhdGggZD0ibTkgOSA2IDYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/circle-x\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleX = createLucideIcon('circle-x', __iconNode);\n\nexport default CircleX;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0',\n      key: '1r0f0z',\n    },\n  ],\n  ['circle', { cx: '12', cy: '10', r: '3', key: 'ilqhr7' }],\n];\n\n/**\n * @component @name MapPin\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgMTBjMCA0Ljk5My01LjUzOSAxMC4xOTMtNy4zOTkgMTEuNzk5YTEgMSAwIDAgMS0xLjIwMiAwQzkuNTM5IDIwLjE5MyA0IDE0Ljk5MyA0IDEwYTggOCAwIDAgMSAxNiAwIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTAiIHI9IjMiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/map-pin\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MapPin = createLucideIcon('map-pin', __iconNode);\n\nexport default MapPin;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport type TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  campaign_run_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  status: string | null\n  payload: any\n  scheduled_at: string | null\n  sent_at: string | null\n  created_at: string\n  error: string | null\n  meta: any\n}\n\nexport const touchRunSelect =\n  \"id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta\"\n\nexport const channelLabel: Record<string, string> = {\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n  voice: \"Voice\",\n}\n\nexport function getWhen(step: TouchRunRow) {\n  return step.sent_at ?? step.scheduled_at ?? step.created_at ?? null\n}\n\nexport function formatPreview(payload: any) {\n  if (!payload) return \"â€”\"\n  let preview: string\n\n  if (typeof payload === \"string\") {\n    preview = payload\n  } else if (typeof payload === \"object\") {\n    const maybeMessage = (payload as Record<string, unknown>).message\n    const maybeBody = (payload as Record<string, unknown>).body\n    const maybeSubject = (payload as Record<string, unknown>).subject\n    if (typeof maybeMessage === \"string\") preview = maybeMessage\n    else if (typeof maybeBody === \"string\") preview = maybeBody\n    else if (typeof maybeSubject === \"string\") preview = maybeSubject\n    else preview = JSON.stringify(payload)\n  } else {\n    preview = String(payload)\n  }\n\n  if (preview.length > 140) return `${preview.slice(0, 140)}â€¦`\n  return preview\n}\n\nexport function statusVariant(status: string | null) {\n  const normalized = status?.toLowerCase()\n  if (normalized === \"sent\") return \"success\" as const\n  if (normalized === \"scheduled\" || normalized === \"pending\") return \"warning\" as const\n  if (normalized === \"failed\" || normalized === \"error\") return \"destructive\" as const\n  return \"neutral\" as const\n}\n\nexport function formatDate(dateString: string | null, options?: Intl.DateTimeFormatOptions) {\n  if (!dateString) return null\n  const parsed = new Date(dateString)\n  if (Number.isNaN(parsed.getTime())) return null\n  return new Intl.DateTimeFormat(\"en-US\", options).format(parsed)\n}\n\nexport async function fetchLeadTouchRuns(\n  client: Pick<\n    import(\"@supabase/supabase-js\").SupabaseClient,\n    \"from\"\n  >,\n  leadId: string,\n) {\n  return client\n    .from(\"touch_runs\")\n    .select(touchRunSelect)\n    .eq(\"lead_id\", leadId)\n    .order(\"sent_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"scheduled_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"created_at\", { ascending: false })\n}\n"],"names":[],"mappings":"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","ignoreList":[3,4,5,6,7,8,9,10]}
./.next/server/chunks/ssr/src_app_director_page_tsx_dfc149d6._.js:1:module.exports=[17894,a=>{"use strict";var b=a.i(7997),c=a.i(95936),d=a.i(70891);function e(){return{generated_at:new Date().toISOString(),dashboard_overview:{total_leads:0,leads_attempting:0,leads_booked:0,campaigns_live:0},campaign_funnel_by_channel:[],campaign_funnel_summary:[],lead_state_summary:[],lead_activity_summary:[],campaign_kpis:[],enrichment_v2_summary:{total_leads:0,completed:0,pending:0,failed:0}}}async function f(){let a=(0,d.supabaseServer)();if(!a)return e();let{data:b,error:c}=await a.rpc("api_get_system_snapshot");c&&console.error("api_get_system_snapshot error",c);let f=b??{},g=e();return{generated_at:f.generated_at??g.generated_at,dashboard_overview:f.dashboard_overview??g.dashboard_overview,campaign_funnel_by_channel:f.campaign_funnel_by_channel??g.campaign_funnel_by_channel,campaign_funnel_summary:f.campaign_funnel_summary??g.campaign_funnel_summary,lead_state_summary:f.lead_state_summary??g.lead_state_summary,lead_activity_summary:f.lead_activity_summary??g.lead_activity_summary,campaign_kpis:f.campaign_kpis??g.campaign_kpis,enrichment_v2_summary:{total_leads:f.enrichment_v2_summary?.total_leads??g.enrichment_v2_summary.total_leads,completed:f.enrichment_v2_summary?.completed??g.enrichment_v2_summary.completed,pending:f.enrichment_v2_summary?.pending??g.enrichment_v2_summary.pending,failed:f.enrichment_v2_summary?.failed??g.enrichment_v2_summary.failed}}}a.i(14796);var g=a.i(66218),h=a.i(64941),i=a.i(33644),j=a.i(28783),k=a.i(11952);let l=(0,a.i(1269).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var m=a.i(77695);let n=["campaign_engine_5m","run_enrichment_5m","dispatch-touch-every-minute","run-cadence-every-5m","revenue-asi-run-enrichment-5min","revenue-asi-touch-fake-5min","revenue-asi-recompute-leads-5min","cron_dispatch_appointment_notifications"],o=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});function p(){let a=new Date;a.setUTCHours(0,0,0,0);let b=new Date;return b.setUTCHours(24,0,0,0),{start:a.toISOString(),end:b.toISOString()}}async function q(a){if(!a)return n.map(a=>({name:a,schedule:null,lastRun:null,status:"No data"}));let[b,c]=await Promise.all([a.from("cron.job").select("name, schedule").in("name",n),a.from("dispatch_logs").select("id, created_at, kind, payload").in("kind",n).order("created_at",{ascending:!1}).limit(200)]),d=new Map;b.data?.forEach(a=>{d.set(a.name,a.schedule)});let e=new Map;return c.data?.forEach(a=>{e.has(a.kind)||e.set(a.kind,a)}),n.map(a=>{let b=e.get(a),c=!!(b?.payload&&"object"==typeof b.payload&&"error"in b.payload),f="No data";return b&&(f=c?"Error":"OK"),{name:a,schedule:d.get(a)??null,lastRun:b?.created_at??null,status:f}})}async function r(a){if(!a)return{appointmentsToday:0,remindersToday:0,reminderTouchRunsToday:0};let{start:b,end:c}=p(),[d,e,f]=await Promise.all([a.from("appointments").select("id",{count:"exact",head:!0}).gte("starts_at",b).lt("starts_at",c),a.from("appointments_notifications").select("id",{count:"exact",head:!0}).gte("notify_at",b).lt("notify_at",c),a.from("touch_runs").select("id",{count:"exact",head:!0}).in("step",[200,201,202]).gte("scheduled_at",b).lt("scheduled_at",c)]);return{appointmentsToday:d.count??0,remindersToday:e.count??0,reminderTouchRunsToday:f.count??0}}async function s(a){if(!a)return{newLeadsToday:0,leadsWithAppointments:0,showsToday:0,noShowsToday:0};let{start:b,end:c}=p(),[d,e,f,g]=await Promise.all([a.from("leads").select("id",{count:"exact",head:!0}).gte("created_at",b).lt("created_at",c),a.from("appointments").select("id",{count:"exact",head:!0}).eq("outcome","show").gte("starts_at",b).lt("starts_at",c),a.from("appointments").select("id",{count:"exact",head:!0}).eq("outcome","no_show").gte("starts_at",b).lt("starts_at",c),a.from("appointments").select("lead_id")]),h=new Set((g.data??[]).map(a=>a.lead_id).filter(a=>!!a));return{newLeadsToday:d.count??0,showsToday:e.count??0,noShowsToday:f.count??0,leadsWithAppointments:h.size}}async function t(a){if(!a)return[];let{data:b,error:c}=await a.from("campaign_funnel_overview").select("campaign_id, campaign_name, total_touches, leads_touched, engaged_leads, reply_rate, error_rate, leads_attempting, leads_engaged, leads_booked, leads_booked_show, leads_booked_no_show, first_touch_at, last_touch_at").order("last_touch_at",{ascending:!1}).limit(10);return c?(console.error("campaign_funnel_overview error",c),[]):b??[]}async function u(a){if(!a)return[];let{data:b,error:c}=await a.from("core_memory_events").select("id, created_at, event_type, event_source, score_delta, payload").order("created_at",{ascending:!1}).limit(20);return c?(console.error("core_memory_events error",c),[]):b??[]}async function v(a){if(!a)return[];let{data:b,error:c}=await a.from("lead_next_action_view_v5").select(`
./.next/server/chunks/ssr/src_app_voice-insights_page_tsx_47114a37._.js.map:1:{"version":3,"sources":["../../../../src/app/voice-insights/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport {\n  Activity,\n  Filter,\n  Loader2,\n  RefreshCcw,\n  X,\n  PhoneCall,\n} from \"lucide-react\"\n\nimport { IntentBadge, LeadStateBadge } from \"@/components/leads/badges\"\nimport {\n  Badge,\n  Button,\n  Card,\n  CardContent,\n  Input,\n  Select,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype VoiceCallBase = {\n  id: string\n  lead_id: string\n  touch_run_id: string | null\n  status: string | null\n  provider: string | null\n  provider_call_id: string | null\n  to_phone: string | null\n  meta: Record<string, unknown> | null\n  updated_at: string\n}\n\ntype Lead = {\n  id: string\n  contact_name: string | null\n  company: string | null\n  phone: string | null\n  state: string | null\n  email: string | null\n}\n\ntype LeadEvent = {\n  id: string\n  lead_id: string\n  event_type: string\n  payload: Record<string, unknown> | null\n  created_at: string\n}\n\ntype Appointment = {\n  id: string\n  lead_id: string\n  scheduled_for: string\n  status: string\n}\n\ntype TouchRun = {\n  id: string\n  lead_id: string\n  status: string\n  error: string | null\n  campaign_id: string | null\n}\n\ntype CampaignMeta = {\n  id: string\n  name: string | null\n}\n\ntype IntentFilter = \"all\" | \"appointment\" | \"unknown\"\ntype AppointmentFilter = \"all\" | \"yes\" | \"no\"\ntype CadenceFilter = \"all\" | \"stopped\" | \"active\"\n\ntype VoiceCallRow = VoiceCallBase & {\n  transcript: string\n  intent: string\n  hasAppointment: boolean\n  cadenceStopped: boolean\n  campaign_id: string | null\n  campaign_name: string | null\n}\n\nconst dateFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"numeric\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\n// -----------------------------------------------------------------------------\n// Page\n// -----------------------------------------------------------------------------\n\nexport default function VoiceInsightsPage() {\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [calls, setCalls] = useState<VoiceCallBase[]>([])\n  const [leads, setLeads] = useState<Record<string, Lead>>({})\n  const [events, setEvents] = useState<LeadEvent[]>([])\n  const [appointments, setAppointments] = useState<Appointment[]>([])\n  const [touchRuns, setTouchRuns] = useState<TouchRun[]>([])\n  const [campaigns, setCampaigns] = useState<Record<string, CampaignMeta>>({})\n\n  const [intentFilter, setIntentFilter] = useState<IntentFilter>(\"all\")\n  const [appointmentFilter, setAppointmentFilter] =\n    useState<AppointmentFilter>(\"all\")\n  const [cadenceFilter, setCadenceFilter] = useState<CadenceFilter>(\"all\")\n  const [campaignFilter, setCampaignFilter] = useState<string>(\"all\")\n\n  const [search, setSearch] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const [activeCallId, setActiveCallId] = useState<string | null>(null)\n\n  // ---------------------------------------------------------------------------\n  // Load data\n  // ---------------------------------------------------------------------------\n\n  useEffect(() => {\n    let alive = true\n\n    async function loadData() {\n      if (!supabaseReady) {\n        setError(\n          \"Supabase is not configured. Add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to load data.\",\n        )\n        setLoading(false)\n        return\n      }\n\n      setLoading(true)\n      setError(null)\n\n      const client = supabaseBrowser()\n\n      const { data: callsData, error: callsError } = await client\n        .from(\"voice_insights_calls_v1\")\n        .select(\n          \"id, lead_id, touch_run_id, status, provider, provider_call_id, to_phone, meta, updated_at\",\n        )\n        .order(\"updated_at\", { ascending: false })\n        .limit(100)\n\n      if (!alive) return\n\n      if (callsError) {\n        console.error(callsError)\n        setError(\"Unable to fetch voice calls.\")\n        setLoading(false)\n        return\n      }\n\n      const safeCalls = (callsData ?? []) as VoiceCallBase[]\n      setCalls(safeCalls)\n\n      const leadIds = Array.from(new Set(safeCalls.map((call) => call.lead_id)))\n\n      if (leadIds.length === 0) {\n        setLeads({})\n        setEvents([])\n        setAppointments([])\n        setTouchRuns([])\n        setCampaigns({})\n        setLoading(false)\n        return\n      }\n\n      const [\n        leadsResult,\n        eventsResult,\n        appointmentsResult,\n        touchRunsResult,\n        campaignsResult,\n      ] = await Promise.all([\n        client\n          .from(\"leads\")\n          .select(\"id, contact_name, company, phone, state, email\")\n          .in(\"id\", leadIds),\n        client\n          .from(\"lead_events\")\n          .select(\"id, lead_id, event_type, payload, created_at\")\n          .in(\"event_type\", [\n            \"voice_completed\",\n            \"voice_failed\",\n            \"appointment_created\",\n          ])\n          .order(\"created_at\", { ascending: false })\n          .limit(200),\n        client\n          .from(\"appointments\")\n          .select(\"id, lead_id, scheduled_for, status\")\n          .in(\"lead_id\", leadIds),\n        client\n          .from(\"touch_runs\")\n          .select(\"id, lead_id, status, error, campaign_id\")\n          .in(\"lead_id\", leadIds),\n        client.from(\"campaigns\").select(\"id, name\").limit(500),\n      ])\n\n      if (!alive) return\n\n      if (leadsResult.error) {\n        console.error(leadsResult.error)\n        setError(\n          `Unable to fetch leads for voice calls. DB says: ${leadsResult.error.message}`,\n        )\n      }\n\n      if (eventsResult.error) console.error(eventsResult.error)\n      if (appointmentsResult.error) console.error(appointmentsResult.error)\n      if (touchRunsResult.error) console.error(touchRunsResult.error)\n      if (campaignsResult.error) console.error(campaignsResult.error)\n\n      const leadMap = (leadsResult.data ?? []).reduce(\n        (acc, lead) => {\n          acc[lead.id] = lead as Lead\n          return acc\n        },\n        {} as Record<string, Lead>,\n      )\n\n      const campaignMap = (campaignsResult.data ?? []).reduce(\n        (acc, c) => {\n          acc[c.id] = c as CampaignMeta\n          return acc\n        },\n        {} as Record<string, CampaignMeta>,\n      )\n\n      setLeads(leadMap)\n      setEvents((eventsResult.data ?? []) as LeadEvent[])\n      setAppointments((appointmentsResult.data ?? []) as Appointment[])\n      setTouchRuns((touchRunsResult.data ?? []) as TouchRun[])\n      setCampaigns(campaignMap)\n      setLoading(false)\n    }\n\n    void loadData()\n\n    return () => {\n      alive = false\n    }\n  }, [supabaseReady])\n\n  // ---------------------------------------------------------------------------\n  // Derived maps\n  // ---------------------------------------------------------------------------\n\n  const appointmentByLead = useMemo(() => {\n    const now = new Date()\n    return appointments.reduce(\n      (acc, appt) => {\n        if (appt.status === \"scheduled\" && new Date(appt.scheduled_for) >= now) {\n          acc[appt.lead_id] = appt\n        }\n        return acc\n      },\n      {} as Record<string, Appointment>,\n    )\n  }, [appointments])\n\n  const cadenceStoppedByLead = useMemo(() => {\n    const map: Record<string, boolean> = {}\n    touchRuns.forEach((run) => {\n      if (run.status === \"stopped\" && run.error === \"appointment_created\") {\n        map[run.lead_id] = true\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const campaignByLead = useMemo(() => {\n    const map: Record<string, string | null> = {}\n    touchRuns.forEach((run) => {\n      if (run.campaign_id && !map[run.lead_id]) {\n        map[run.lead_id] = run.campaign_id\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const callRows: VoiceCallRow[] = useMemo(() => {\n    return calls.map((call) => {\n      const voiceWebhook =\n        (call.meta as { voice_webhook?: { transcript?: string } } | null)\n          ?.voice_webhook ?? null\n      const transcript =\n        voiceWebhook?.transcript ??\n        ((call.meta as { transcript?: string } | null)?.transcript ?? \"\")\n\n      const relevantEvent = events.find(\n        (event) =>\n          event.lead_id === call.lead_id &&\n          event.event_type.startsWith(\"voice_\"),\n      )\n\n      const intentFromEvent =\n        (relevantEvent?.payload as { intent?: string } | null)?.intent\n      const intentFromMeta =\n        (call.meta as { intent?: string } | null)?.intent ?? \"unknown\"\n\n      const intent = (intentFromEvent ?? intentFromMeta ?? \"unknown\").toLowerCase()\n\n      const campaignId = campaignByLead[call.lead_id] ?? null\n      const campaignName =\n        campaignId && campaigns[campaignId]\n          ? campaigns[campaignId].name ?? \"Untitled\"\n          : null\n\n      return {\n        ...call,\n        transcript,\n        intent,\n        hasAppointment: Boolean(appointmentByLead[call.lead_id]),\n        cadenceStopped: Boolean(cadenceStoppedByLead[call.lead_id]),\n        campaign_id: campaignId,\n        campaign_name: campaignName,\n      }\n    })\n  }, [\n    appointmentByLead,\n    cadenceStoppedByLead,\n    campaignByLead,\n    campaigns,\n    calls,\n    events,\n  ])\n\n  const campaignOptions = useMemo(() => {\n    const ids = new Set<string>()\n    callRows.forEach((row) => {\n      if (row.campaign_id) ids.add(row.campaign_id)\n    })\n    return Array.from(ids)\n  }, [callRows])\n\n  const filtered: VoiceCallRow[] = useMemo(() => {\n    return callRows.filter((row) => {\n      if (intentFilter !== \"all\" && row.intent !== intentFilter) return false\n      if (appointmentFilter === \"yes\" && !row.hasAppointment) return false\n      if (appointmentFilter === \"no\" && row.hasAppointment) return false\n      if (cadenceFilter === \"stopped\" && !row.cadenceStopped) return false\n      if (cadenceFilter === \"active\" && row.cadenceStopped) return false\n      if (campaignFilter !== \"all\" && row.campaign_id !== campaignFilter)\n        return false\n\n      if (search) {\n        const lead = leads[row.lead_id]\n        const haystack = `${lead?.contact_name ?? \"\"} ${lead?.company ?? \"\"} ${\n          lead?.email ?? \"\"\n        } ${lead?.phone ?? \"\"}`.toLowerCase()\n        if (!haystack.includes(search.toLowerCase())) return false\n      }\n\n      return true\n    })\n  }, [\n    appointmentFilter,\n    campaignFilter,\n    callRows,\n    cadenceFilter,\n    intentFilter,\n    leads,\n    search,\n  ])\n\n  const activeCall = useMemo(\n    () => filtered.find((c) => c.id === activeCallId) ?? null,\n    [filtered, activeCallId],\n  )\n\n  const activeLead = activeCall ? leads[activeCall.lead_id] ?? null : null\n  const activeAppointment = activeCall\n    ? appointmentByLead[activeCall.lead_id] ?? null\n    : null\n\n  // ---------------------------------------------------------------------------\n  // High-level metrics\n  // ---------------------------------------------------------------------------\n\n  const metrics = useMemo(() => {\n    if (callRows.length === 0) {\n      return {\n        total: 0,\n        withAppointment: 0,\n        interested: 0,\n        failed: 0,\n        last7d: 0,\n      }\n    }\n\n    const now = Date.now()\n    const sevenDaysMs = 7 * 24 * 60 * 60 * 1000\n\n    let withAppointment = 0\n    let interested = 0\n    let failed = 0\n    let last7d = 0\n\n    callRows.forEach((row) => {\n      if (row.hasAppointment) withAppointment += 1\n      if (row.intent === \"appointment\") interested += 1\n      if (row.status && row.status.toLowerCase() === \"failed\") failed += 1\n\n      const updatedMs = new Date(row.updated_at).getTime()\n      if (!Number.isNaN(updatedMs) && now - updatedMs <= sevenDaysMs) {\n        last7d += 1\n      }\n    })\n\n    return {\n      total: callRows.length,\n      withAppointment,\n      interested,\n      failed,\n      last7d,\n    }\n  }, [callRows])\n\n  // ---------------------------------------------------------------------------\n  // Render\n  // ---------------------------------------------------------------------------\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3\">\n          <div>\n            <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n              Voice Â· Calls & intents\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Voice Insights\n            </h1>\n            <p className=\"text-sm text-white/60\">\n              Latest 100 calls with transcript previews, intent signals,\n              campaign and appointment status.\n            </p>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => {\n                setIntentFilter(\"all\")\n                setAppointmentFilter(\"all\")\n                setCadenceFilter(\"all\")\n                setCampaignFilter(\"all\")\n                setSearch(\"\")\n              }}\n              className=\"gap-2\"\n            >\n              <RefreshCcw size={16} />\n              Reset view\n            </Button>\n          </div>\n        </div>\n\n        {/* KPIs */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"grid gap-4 p-4 sm:grid-cols-5\">\n            <MetricTile\n              label=\"Total calls\"\n              value={metrics.total}\n              helper=\"Last 100 records\"\n            />\n            <MetricTile\n              label=\"Interested\"\n              value={metrics.interested}\n              helper=\"Intent = appointment\"\n            />\n            <MetricTile\n              label=\"With appointment\"\n              value={metrics.withAppointment}\n              helper=\"Upcoming scheduled\"\n            />\n            <MetricTile\n              label=\"Failed\"\n              value={metrics.failed}\n              helper=\"Status = failed\"\n            />\n            <MetricTile\n              label=\"Calls last 7 days\"\n              value={metrics.last7d}\n              helper=\"Based on updated_at\"\n            />\n          </CardContent>\n        </Card>\n\n        {/* Filters + search + status */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"space-y-4 pt-4\">\n            <div className=\"flex flex-wrap items-center gap-3\">\n              <div className=\"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-medium uppercase tracking-[0.14em] text-white/70\">\n                <Filter size={14} />\n                <span>Filters</span>\n              </div>\n\n              <Select\n                value={intentFilter}\n                onChange={(e) =>\n                  setIntentFilter(e.target.value as IntentFilter)\n                }\n                className=\"w-44\"\n              >\n                <option value=\"all\">All intents</option>\n                <option value=\"appointment\">Appointment</option>\n                <option value=\"unknown\">Unknown</option>\n              </Select>\n\n              <Select\n                value={appointmentFilter}\n                onChange={(e) =>\n                  setAppointmentFilter(e.target.value as AppointmentFilter)\n                }\n                className=\"w-48\"\n              >\n                <option value=\"all\">Appointment?</option>\n                <option value=\"yes\">Has upcoming</option>\n                <option value=\"no\">No appointment</option>\n              </Select>\n\n              <Select\n                value={cadenceFilter}\n                onChange={(e) =>\n                  setCadenceFilter(e.target.value as CadenceFilter)\n                }\n                className=\"w-40\"\n              >\n                <option value=\"all\">Cadence</option>\n                <option value=\"stopped\">Stopped</option>\n                <option value=\"active\">Active</option>\n              </Select>\n\n              <Select\n                value={campaignFilter}\n                onChange={(e) => setCampaignFilter(e.target.value)}\n                className=\"w-56\"\n              >\n                <option value=\"all\">All campaigns</option>\n                {campaignOptions.map((id) => (\n                  <option key={id} value={id}>\n                    {campaigns[id]?.name ?? id}\n                  </option>\n                ))}\n              </Select>\n\n              <Input\n                placeholder=\"Search lead / company / email / phone\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"w-72\"\n              />\n            </div>\n\n            {error ? (\n              <div className=\"rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100\">\n                {error}\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-3 text-xs text-white/50\">\n                <span className=\"rounded-full border border-white/10 bg-white/5 px-2 py-1\">\n                  {filtered.length} calls visible\n                </span>\n                <span className=\"rounded-full border border-white/5 bg-white/5/10 px-2 py-1\">\n                  Raw: {calls.length}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Table / list */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"pt-4\">\n            {!loading && filtered.length === 0 ? (\n              <div className=\"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-sm text-white/70\">\n                No calls match the selected filters.\n              </div>\n            ) : null}\n\n            {!loading && filtered.length > 0 ? (\n              <div className=\"overflow-auto rounded-2xl border border-white/10\">\n                <Table>\n                  <TableHead>\n                    <TableRow className=\"bg-white/5\">\n                      <TableHeaderCell>Lead</TableHeaderCell>\n                      <TableHeaderCell>Campaign</TableHeaderCell>\n                      <TableHeaderCell>Phone</TableHeaderCell>\n                      <TableHeaderCell>Status</TableHeaderCell>\n                      <TableHeaderCell>Transcript</TableHeaderCell>\n                      <TableHeaderCell>Intent</TableHeaderCell>\n                      <TableHeaderCell>Appointment</TableHeaderCell>\n                      <TableHeaderCell>Cadence</TableHeaderCell>\n                      <TableHeaderCell>Updated</TableHeaderCell>\n                    </TableRow>\n                  </TableHead>\n                  <TableBody>\n                    {filtered.map((row) => {\n                      const lead = leads[row.lead_id]\n                      const transcriptPreview = row.transcript\n\n                      const preview = transcriptPreview\n                        ? `${transcriptPreview.slice(0, 140)}${\n                            transcriptPreview.length > 140 ? \"â€¦\" : \"\"\n                          }`\n                        : \"â€”\"\n\n                      const updated = new Date(row.updated_at)\n                      const appointment = appointmentByLead[row.lead_id]\n\n                      const displayName =\n                        lead?.contact_name ||\n                        lead?.company ||\n                        lead?.phone ||\n                        lead?.email ||\n                        \"Unknown lead\"\n\n                      const campaignName = row.campaign_name ?? \"â€”\"\n\n                      return (\n                        <TableRow\n                          key={row.id}\n                          className=\"cursor-pointer border-t border-white/5 bg-black/40 transition hover:bg-white/5\"\n                          onClick={() => setActiveCallId(row.id)}\n                        >\n                          {/* Lead */}\n                          <TableCell>\n                            <div className=\"flex flex-col gap-1\">\n                              <a\n                                href={`/leads/${row.lead_id}`}\n                                className=\"font-semibold text-emerald-200 hover:text-emerald-100\"\n                                onClick={(e) => e.stopPropagation()}\n                              >\n                                {displayName}\n                              </a>\n                              <LeadStateBadge state={lead?.state} />\n                            </div>\n                          </TableCell>\n\n                          {/* Campaign */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {campaignName}\n                          </TableCell>\n\n                          {/* Phone */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {lead?.phone ?? row.to_phone ?? \"â€”\"}\n                          </TableCell>\n\n                          {/* Call status */}\n                          <TableCell>\n                            <Badge\n                              variant=\"outline\"\n                              className=\"border-white/15 bg-white/5 text-xs text-white/80 capitalize\"\n                            >\n                              {row.status ?? \"â€”\"}\n                            </Badge>\n                          </TableCell>\n\n                          {/* Transcript */}\n                          <TableCell className=\"max-w-md text-sm text-white/80\">\n                            {preview}\n                          </TableCell>\n\n                          {/* Intent */}\n                          <TableCell>\n                            <IntentBadge intent={row.intent} />\n                          </TableCell>\n\n                          {/* Appointment */}\n                          <TableCell>\n                            {row.hasAppointment ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"gap-2 border-emerald-400/50 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                <CalendarIcon />\n                                Upcoming\n                                <span className=\"text-[11px] text-white/60\">\n                                  {appointment\n                                    ? dateFormatter.format(\n                                        new Date(appointment.scheduled_for),\n                                      )\n                                    : null}\n                                </span>\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-white/15 bg-white/5 text-xs text-white/70\"\n                              >\n                                No appointment\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Cadence */}\n                          <TableCell>\n                            {row.cadenceStopped ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-amber-400/60 bg-amber-500/10 text-xs text-amber-100\"\n                              >\n                                Cadence stopped\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-emerald-400/60 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                Active\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Updated */}\n                          <TableCell className=\"whitespace-nowrap text-sm text-white/70\">\n                            {dateFormatter.format(updated)}\n                          </TableCell>\n                        </TableRow>\n                      )\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 py-8 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : null}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Drawer */}\n      {activeCall && (\n        <div className=\"fixed inset-0 z-40 flex\">\n          <button\n            className=\"h-full flex-1 bg-black/60 backdrop-blur-sm\"\n            onClick={() => setActiveCallId(null)}\n            aria-label=\"Close call details\"\n          />\n          <div className=\"h-full w-full max-w-md border-l border-white/10 bg-[#020617] p-5 shadow-[0_0_60px_rgba(15,23,42,0.9)]\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Voice call\n                </p>\n                <h2 className=\"flex items-center gap-2 text-xl font-semibold text-white\">\n                  <PhoneCall className=\"h-4 w-4 text-emerald-300\" />\n                  {activeLead?.contact_name ??\n                    activeLead?.company ??\n                    activeLead?.phone ??\n                    activeLead?.email ??\n                    \"Unknown lead\"}\n                </h2>\n                {activeLead && (\n                  <p className=\"text-xs text-white/50\">\n                    {activeLead.email ?? \"no-email\"} Â·{\" \"}\n                    {activeLead.phone ?? \"no-phone\"}\n                  </p>\n                )}\n              </div>\n              <button\n                className=\"rounded-full border border-white/20 bg-white/10 p-1 text-white/70 hover:bg-white/20\"\n                onClick={() => setActiveCallId(null)}\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              {/* Top badges */}\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80\">\n                  {activeCall.provider ?? \"provider-unknown\"}\n                </Badge>\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80 capitalize\">\n                  {activeCall.status ?? \"status-unknown\"}\n                </Badge>\n                <IntentBadge intent={activeCall.intent} />\n                {activeCall.hasAppointment && (\n                  <Badge className=\"border-emerald-400/60 bg-emerald-500/15 text-xs text-emerald-100\">\n                    Appointment scheduled\n                  </Badge>\n                )}\n                {activeCall.cadenceStopped && (\n                  <Badge className=\"border-amber-400/60 bg-amber-500/15 text-xs text-amber-100\">\n                    Cadence stopped\n                  </Badge>\n                )}\n              </div>\n\n              {/* Meta */}\n              <Card className=\"border-white/10 bg-white/5\">\n                <CardContent className=\"space-y-1 p-4 text-xs text-white/70\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">To</span>\n                    <span>{activeCall.to_phone ?? \"â€”\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">Updated</span>\n                    <span>\n                      {dateFormatter.format(new Date(activeCall.updated_at))}\n                    </span>\n                  </div>\n                  {activeAppointment && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-white/50\">Appointment</span>\n                      <span>\n                        {dateFormatter.format(\n                          new Date(activeAppointment.scheduled_for),\n                        )}\n                      </span>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Transcript */}\n              <div className=\"space-y-2 rounded-2xl border border-white/10 bg-slate-900/80 p-4\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Transcript\n                </p>\n                {activeCall.transcript ? (\n                  <p className=\"max-h-64 overflow-y-auto whitespace-pre-wrap text-sm text-white/80\">\n                    {activeCall.transcript}\n                  </p>\n                ) : (\n                  <p className=\"text-xs text-white/60\">\n                    No transcript available for this call.\n                  </p>\n                )}\n              </div>\n\n              {/* Raw meta */}\n              {activeCall.meta && (\n                <div className=\"space-y-2 rounded-2xl border border-white/10 bg-black/60 p-4\">\n                  <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                    Raw meta\n                  </p>\n                  <pre className=\"max-h-40 overflow-y-auto text-[11px] text-white/70\">\n                    {JSON.stringify(activeCall.meta, null, 2)}\n                  </pre>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n\nfunction CalendarIcon() {\n  return <Activity size={14} />\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <div className=\"space-y-1 rounded-2xl border border-white/10 bg-white/5 p-3\">\n      <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n        {label}\n      </p>\n      <p className=\"text-2xl font-semibold text-white\">{value}</p>\n      <p className=\"text-[11px] text-white/50\">{helper}</p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}
./.next/server/chunks/ssr/_a6b62dc1._.js:1:module.exports=[69520,a=>{"use strict";let b=(0,a.i(70106).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],69520)},11040,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69520),e=a.i(70106);let f=(0,e.default)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),g=(0,e.default)("signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]);var h=a.i(10849);a.i(57626);var i=a.i(50600),j=a.i(28573),k=a.i(892);function l(){let a=(0,c.useMemo)(()=>(0,h.supabaseBrowser)(),[]),[e,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)({success:0,failed:0}),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),u=(0,c.useCallback)(async()=>{if(!a)return void n(!1);n(!0);let b=new Date(Date.now()-864e5).toISOString(),[c,d]=await Promise.all([a.from("job_runs").select("id, job_name, status, created_at, duration_ms").order("created_at",{ascending:!1}).limit(20),a.from("touch_runs").select("id, status, created_at").order("created_at",{ascending:!1}).limit(1)]);if(c.error)console.warn("Failed to load job_runs",c.error),l([]),p({success:0,failed:0}),t(null);else{let a=(c.data??[]).filter(a=>(a.created_at??"")>=b),d=a.filter(a=>"succeeded"===(a.status??"").toLowerCase()).length,e=a.filter(a=>"failed"===(a.status??"").toLowerCase()).length;l(c.data??[]),p({success:d,failed:e}),t(c.data?.[0]??null)}d.error?(console.warn("Failed to load touch_runs",d.error),r(null)):r(d.data?.[0]??null),n(!1)},[a]);return(0,c.useEffect)(()=>{u()},[u]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Systems"}),(0,b.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Health"}),(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Heartbeat across cadences, enrichers, and dispatchers."})]}),(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"gap-2",onClick:u,"aria-label":"Refresh health",children:[(0,b.jsx)(d.RefreshCw,{size:16}),"Refresh"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsx)(k.StatCard,{label:"Jobs",value:`${o.success} succeeded / ${o.failed} failed`,helper:"job_runs last 24h",delta:a?"Live":"Offline"}),(0,b.jsx)(k.StatCard,{label:"Dispatch",value:q?`${q.status??"pending"}`:a?"No dispatch runs":"Supabase env missing",helper:q?.created_at?new Date(q.created_at).toLocaleString():"Watching cadence triggers",delta:q?"Latest":"Idle"}),(0,b.jsx)(k.StatCard,{label:"Run cadence",value:s?s.status??"pending":"No runs",helper:s?.created_at?new Date(s.created_at).toLocaleString():"Cron via SQL",delta:s?"Latest":"Idle"})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{title:"Recent checks",description:"Edge functions and workers reporting back from Supabase",action:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[(0,b.jsx)(g,{size:16}),m?"Loading":`${e.length} pings`]})}),(0,b.jsx)(j.CardContent,{className:"space-y-3",children:m?(0,b.jsx)("div",{className:"space-y-2",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-12 animate-pulse rounded-xl bg-white/5"},a))}):0===e.length?(0,b.jsxs)("div",{className:"rounded-2xl border border-dashed border-emerald-400/40 bg-white/5 px-5 py-6 text-center",children:[(0,b.jsx)("p",{className:"text-lg font-semibold text-white",children:"No health signals yet"}),(0,b.jsx)("p",{className:"text-sm text-white/60",children:"We will surface job_runs as they arrive."})]}):(0,b.jsx)("div",{className:"grid gap-2",children:e.map(a=>{let c=(a.status??"").toLowerCase(),d="succeeded"===c||"success"===c;return(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-4 py-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"font-semibold text-white",children:a.job_name??"Unknown job"}),(0,b.jsx)("p",{className:"text-xs text-white/50",children:new Date(a.created_at??"").toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/80",children:[(0,b.jsx)(f,{size:16,className:d?"text-emerald-300":"text-amber-300"}),(0,b.jsx)("span",{className:d?"text-emerald-200":"text-amber-200",children:c||"pending"}),"number"==typeof a.duration_ms&&(0,b.jsxs)("span",{className:"text-xs text-white/50",children:[Math.round(a.duration_ms)," ms"]})]})]},a.id)})})})]})]})}a.s(["default",()=>l],11040)}];
./.next/server/chunks/ssr/src_app_director_page_tsx_dfc149d6._.js.map:1:{"version":3,"sources":["../../../../src/app/director/page.tsx","../../../../node_modules/lucide-react/src/icons/message-square.ts","../../../../src/lib/director/system-snapshot.ts"],"sourcesContent":["import React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport { getSystemSnapshot } from \"@/lib/director/system-snapshot\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport {\n  Mail,\n  PhoneCall,\n  MessageSquare,\n  Zap,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// ---------- Constantes & tipos ----------\n\nconst JOB_NAMES = [\n  \"campaign_engine_5m\",\n  \"run_enrichment_5m\",\n  \"dispatch-touch-every-minute\",\n  \"run-cadence-every-5m\",\n  \"revenue-asi-run-enrichment-5min\",\n  \"revenue-asi-touch-fake-5min\",\n  \"revenue-asi-recompute-leads-5min\",\n  \"cron_dispatch_appointment_notifications\",\n]\n\ntype CronJobRow = {\n  name: string\n  schedule: string | null\n}\n\ntype DispatchLogRow = {\n  id: string\n  created_at: string\n  kind: string\n  payload: Record<string, unknown> | null\n}\n\ntype EngineStatus = {\n  name: string\n  schedule: string | null\n  lastRun: string | null\n  status: \"OK\" | \"Error\" | \"No data\"\n}\n\ntype AppointmentMetrics = {\n  appointmentsToday: number\n  remindersToday: number\n  reminderTouchRunsToday: number\n}\n\ntype LeadMetrics = {\n  newLeadsToday: number\n  leadsWithAppointments: number\n  showsToday: number\n  noShowsToday: number\n}\n\ntype CampaignEngineRow = {\n  campaign_id: string\n  campaign_name: string | null\n  total_touches: number\n  leads_touched: number\n  engaged_leads: number\n  reply_rate: number\n  error_rate: number\n  leads_attempting: number\n  leads_engaged: number\n  leads_booked: number\n  leads_booked_show: number\n  leads_booked_no_show: number\n  first_touch_at: string | null\n  last_touch_at: string | null\n}\n\ntype DirectorAlertRow = {\n  id: string\n  created_at: string\n  event_type: string | null\n  event_source: string | null\n  score_delta: number | null\n  payload: Record<string, any> | null\n}\n\n// ðŸ”— Next actions + enrichment genome (solo el tipo unificado que usamos en la tabla)\n\ntype NextActionRow = {\n  lead_id: string\n  lead_name: string | null\n  email: string | null\n  phone: string | null\n  lead_state: string | null\n  lead_brain_bucket: string | null\n  recommended_channel: string | null\n  recommended_action: string | null\n  recommended_delay_minutes: number | null\n  priority_score: number | null\n  reason: string | null\n  industry?: string | null\n  sub_industry?: string | null\n  enrichment_status?: string | null\n  ai_lead_score?: number | null\n}\n\n// ðŸ”¬ Enrichment Engine v2 overview\n\ntype EnrichmentQueueStat = {\n  status: string | null\n  total: number\n}\n\ntype EnrichmentSummaryRow = {\n  enrichment_status: string | null\n  total: number\n  avg_ai_lead_score: number | null\n}\n\ntype EnrichmentOverview = {\n  queue: EnrichmentQueueStat[]\n  summary: EnrichmentSummaryRow[]\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  year: \"numeric\",\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\nfunction getTodayRange() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\n// ---------- Loaders (server-side) ----------\n\nasync function loadEngines(client: ReturnType<typeof supabaseServer>) {\n  if (!client) {\n    return JOB_NAMES.map<EngineStatus>((name) => ({\n      name,\n      schedule: null,\n      lastRun: null,\n      status: \"No data\",\n    }))\n  }\n\n  const [cronJobs, logs] = await Promise.all([\n    client.from(\"cron.job\").select(\"name, schedule\").in(\"name\", JOB_NAMES),\n    client\n      .from(\"dispatch_logs\")\n      .select(\"id, created_at, kind, payload\")\n      .in(\"kind\", JOB_NAMES)\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n  ])\n\n  const scheduleMap = new Map<string, string | null>()\n  ;(cronJobs.data as CronJobRow[] | null)?.forEach((row) => {\n    scheduleMap.set(row.name, row.schedule)\n  })\n\n  const latestLogMap = new Map<string, DispatchLogRow>()\n  ;(logs.data as DispatchLogRow[] | null)?.forEach((row) => {\n    if (!latestLogMap.has(row.kind)) {\n      latestLogMap.set(row.kind, row)\n    }\n  })\n\n  return JOB_NAMES.map<EngineStatus>((name) => {\n    const log = latestLogMap.get(name)\n    const payloadHasError = Boolean(\n      log?.payload && typeof log.payload === \"object\" && \"error\" in log.payload,\n    )\n\n    let status: EngineStatus[\"status\"] = \"No data\"\n    if (log) status = payloadHasError ? \"Error\" : \"OK\"\n\n    return {\n      name,\n      schedule: scheduleMap.get(name) ?? null,\n      lastRun: log?.created_at ?? null,\n      status,\n    }\n  })\n}\n\nasync function loadAppointmentMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentMetrics> {\n  const fallback: AppointmentMetrics = {\n    appointmentsToday: 0,\n    remindersToday: 0,\n    reminderTouchRunsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [appointments, reminders, touchReminders] = await Promise.all([\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"step\", [200, 201, 202])\n      .gte(\"scheduled_at\", start)\n      .lt(\"scheduled_at\", end),\n  ])\n\n  return {\n    appointmentsToday: appointments.count ?? 0,\n    remindersToday: reminders.count ?? 0,\n    reminderTouchRunsToday: touchReminders.count ?? 0,\n  }\n}\n\nasync function loadLeadMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<LeadMetrics> {\n  const fallback: LeadMetrics = {\n    newLeadsToday: 0,\n    leadsWithAppointments: 0,\n    showsToday: 0,\n    noShowsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [newLeads, shows, noShows, leadAppointments] = await Promise.all([\n    client\n      .from(\"leads\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"no_show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client.from(\"appointments\").select(\"lead_id\"),\n  ])\n\n  const leadIds = new Set(\n    (leadAppointments.data ?? [])\n      .map((row) => (row as { lead_id: string | null }).lead_id)\n      .filter((id): id is string => Boolean(id)),\n  )\n\n  return {\n    newLeadsToday: newLeads.count ?? 0,\n    showsToday: shows.count ?? 0,\n    noShowsToday: noShows.count ?? 0,\n    leadsWithAppointments: leadIds.size,\n  }\n}\n\nasync function loadCampaignEngine(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<CampaignEngineRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"campaign_funnel_overview\")\n    .select(\n      [\n        \"campaign_id\",\n        \"campaign_name\",\n        \"total_touches\",\n        \"leads_touched\",\n        \"engaged_leads\",\n        \"reply_rate\",\n        \"error_rate\",\n        \"leads_attempting\",\n        \"leads_engaged\",\n        \"leads_booked\",\n        \"leads_booked_show\",\n        \"leads_booked_no_show\",\n        \"first_touch_at\",\n        \"last_touch_at\",\n      ].join(\", \"),\n    )\n    .order(\"last_touch_at\", { ascending: false })\n    .limit(10)\n\n  if (error) {\n    console.error(\"campaign_funnel_overview error\", error)\n    return []\n  }\n\n  // Supabase types allow GenericStringError[] in `data`,\n  // asÃ­ que lo pasamos por `unknown` antes de castear.\n  const typed = (data ?? []) as unknown as CampaignEngineRow[]\n  return typed\n}\n\nasync function loadDirectorAlerts(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<DirectorAlertRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"core_memory_events\")\n    .select(\"id, created_at, event_type, event_source, score_delta, payload\")\n    .order(\"created_at\", { ascending: false })\n    .limit(20)\n\n  if (error) {\n    console.error(\"core_memory_events error\", error)\n    return []\n  }\n\n  return (data as DirectorAlertRow[] | null) ?? []\n}\n\n// ðŸ”¥ Lead Next Actions loader + Genome v2 merge\n\nasync function loadNextActions(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<NextActionRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"lead_next_action_view_v5\")\n    .select(\n      `\n      lead_id,\n      lead_name,\n      email,\n      phone,\n      lead_state,\n      lead_brain_bucket,\n      recommended_channel,\n      effective_channel,\n      recommended_action,\n      recommended_delay_minutes,\n      priority_score,\n      reason\n    `,\n    )\n    .order(\"priority_score\", { ascending: false })\n    .limit(100)\n\n  if (error || !data) {\n    console.error(\"lead_next_action_view_v5 error\", error)\n    return []\n  }\n\n  const rows = data as {\n    lead_id: string | null\n    lead_name?: string | null\n    email: string | null\n    phone: string | null\n    lead_state: string | null\n    lead_brain_bucket: string | null\n    recommended_channel: string | null\n    effective_channel: string | null\n    recommended_action: string | null\n    recommended_delay_minutes: number | null\n    priority_score: number | null\n    reason: string | null\n  }[]\n\n  const leadIds = rows\n    .map((r) => r.lead_id)\n    .filter((id): id is string => Boolean(id))\n\n  let genomeMap = new Map<\n    string,\n    {\n      industry: string | null\n      sub_industry: string | null\n      enrichment_status: string | null\n      ai_lead_score: number | null\n    }\n  >()\n\n  if (leadIds.length > 0) {\n    const { data: genomeData, error: genomeError } = await client\n      .from(\"v_lead_with_enrichment_v2\")\n      .select(\n        [\n          \"id\",\n          \"industry\",\n          \"sub_industry\",\n          \"enrichment_status\",\n          \"ai_lead_score\",\n        ].join(\", \"),\n      )\n      .in(\"id\", leadIds)\n\n    if (genomeError) {\n      console.error(\"v_lead_with_enrichment_v2 error\", genomeError)\n    }\n\n    genomeMap = new Map()\n    ;(genomeData ?? []).forEach((row: any) => {\n      if (!row.id) return\n      genomeMap.set(row.id, {\n        industry: row.industry ?? null,\n        sub_industry: row.sub_industry ?? null,\n        enrichment_status: row.enrichment_status ?? null,\n        ai_lead_score:\n          row.ai_lead_score == null ? null : Number(row.ai_lead_score) || 0,\n      })\n    })\n  }\n\n  return rows.map((row) => {\n    const key = row.lead_id ?? \"\"\n    const g = key ? genomeMap.get(key) : undefined\n\n    return {\n      lead_id: key,\n      lead_name: row.lead_name ?? null,\n      email: row.email,\n      phone: row.phone,\n      lead_state: row.lead_state,\n      lead_brain_bucket: row.lead_brain_bucket,\n      recommended_channel:\n        row.effective_channel ?? row.recommended_channel ?? null,\n      recommended_action: row.recommended_action,\n      recommended_delay_minutes: row.recommended_delay_minutes,\n      priority_score: row.priority_score,\n      reason: row.reason,\n      industry: g?.industry ?? null,\n      sub_industry: g?.sub_industry ?? null,\n      enrichment_status: g?.enrichment_status ?? null,\n      ai_lead_score: g?.ai_lead_score ?? null,\n    }\n  })\n}\n\n// ðŸ”¬ Enrichment Engine v2 loader\n\nasync function loadEnrichmentOverview(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<EnrichmentOverview> {\n  if (!client) return { queue: [], summary: [] }\n\n  const { data: queueData, error: queueError } = await client\n    .from(\"enrichment_queue\")\n    .select(\"status\")\n\n  if (queueError) {\n    console.error(\"enrichment_queue error\", queueError)\n  }\n\n  const queueMap = new Map<string | null, number>()\n  ;(queueData as { status: string | null }[] | null)?.forEach((row) => {\n    const key = row.status ?? \"unknown\"\n    queueMap.set(key, (queueMap.get(key) ?? 0) + 1)\n  })\n\n  const queue: EnrichmentQueueStat[] = Array.from(queueMap.entries()).map(\n    ([status, total]) => ({\n      status,\n      total,\n    }),\n  )\n\n  const { data: summaryData, error: summaryError } = await client\n    .from(\"v_lead_with_enrichment_v2\")\n    .select(\"enrichment_status, ai_lead_score\")\n\n  if (summaryError) {\n    console.error(\"v_lead_with_enrichment_v2 summary error\", summaryError)\n  }\n\n  const summaryMap = new Map<\n    string | null,\n    { total: number; sumScore: number; countWithScore: number }\n  >()\n\n  ;(summaryData as { enrichment_status: string | null; ai_lead_score: any }[] | null)?.forEach(\n    (row) => {\n      const key = row.enrichment_status ?? \"unknown\"\n      const existing = summaryMap.get(key) ?? {\n        total: 0,\n        sumScore: 0,\n        countWithScore: 0,\n      }\n      const score =\n        row.ai_lead_score == null ? null : Number(row.ai_lead_score) || 0\n\n      existing.total += 1\n      if (score != null) {\n        existing.sumScore += score\n        existing.countWithScore += 1\n      }\n\n      summaryMap.set(key, existing)\n    },\n  )\n\n  const summary: EnrichmentSummaryRow[] = Array.from(\n    summaryMap.entries(),\n  ).map(([status, agg]) => ({\n    enrichment_status: status,\n    total: agg.total,\n    avg_ai_lead_score:\n      agg.countWithScore > 0 ? agg.sumScore / agg.countWithScore : null,\n  }))\n\n  return { queue, summary }\n}\n\n// ---------- UI helpers ----------\n\nfunction StatusBadge({ status }: { status: EngineStatus[\"status\"] }) {\n  const variant =\n    status === \"Error\"\n      ? \"destructive\"\n      : status === \"No data\"\n      ? \"warning\"\n      : \"neutral\"\n\n  return <Badge variant={variant}>{status}</Badge>\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <Card className=\"bg-white/5\">\n      <CardContent className=\"space-y-1 p-4\">\n        <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n          {label}\n        </p>\n        <p className=\"text-2xl font-semibold text-white\">{value}</p>\n        <p className=\"text-xs text-white/50\">{helper}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction formatPercent(value: number | null | undefined) {\n  if (value == null || Number.isNaN(value)) return \"0%\"\n  return `${(value * 100).toFixed(1)}%`\n}\n\nfunction CampaignEngineSection({ rows }: { rows: CampaignEngineRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Campaign funnel\"\n        description=\"Performance de cada campaÃ±a: touches, replies y bookings.\"\n      />\n      <CardContent>\n        {rows.length === 0 ? (\n          <p className=\"text-sm text-white/60\">\n            No hay campaÃ±as con actividad todavÃ­a.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Campaign</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Leads touched\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Engaged\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Booked\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Show / No-show\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Reply rate\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right text-rose-300\">\n                  Error rate\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow key={row.campaign_id}>\n                  <TableCell className=\"font-semibold text-white\">\n                    {row.campaign_id ? (\n                      <Link\n                        href={`/leads?campaign_id=${row.campaign_id}`}\n                        className=\"hover:underline\"\n                      >\n                        {row.campaign_name ?? \"Sin nombre\"}\n                      </Link>\n                    ) : (\n                      row.campaign_name ?? \"Sin nombre\"\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_touched}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_engaged}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_booked}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_booked_show} / {row.leads_booked_no_show}\n                  </TableCell>\n                  <TableCell className=\"text-right text-emerald-300\">\n                    {formatPercent(row.reply_rate)}\n                  </TableCell>\n                  <TableCell className=\"text-right text-rose-300\">\n                    {formatPercent(row.error_rate)}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction SystemSnapshotCard({ snapshot }: { snapshot: any }) {\n  const overview = snapshot?.dashboard_overview ?? {}\n\n  const items: { label: string; value: number | string }[] = [\n    { label: \"Total leads\", value: overview.total_leads ?? 0 },\n    { label: \"Leads attempting\", value: overview.leads_attempting ?? 0 },\n    { label: \"Leads booked\", value: overview.leads_booked ?? 0 },\n    { label: \"Campaigns live\", value: overview.campaigns_live ?? 0 },\n  ]\n\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"System snapshot\"\n        description=\"Resumen que ve el Director Brain.\"\n      />\n      <CardContent className=\"grid gap-3 sm:grid-cols-2\">\n        {items.map((item) => (\n          <div key={item.label} className=\"space-y-1\">\n            <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n              {item.label}\n            </p>\n            <p className=\"text-lg font-semibold text-white\">\n              {item.value ?? 0}\n            </p>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction DirectorAlertsSection({ alerts }: { alerts: DirectorAlertRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Director Brain â€“ Alerts\"\n        description=\"Ãšltimos eventos internos del sistema.\"\n      />\n      <CardContent className=\"space-y-4\">\n        {alerts.length === 0 ? (\n          <p className=\"text-sm text-white/60\">No hay eventos aÃºn.</p>\n        ) : (\n          alerts.map((alert) => {\n            const payload = alert.payload ?? {}\n            const label =\n              payload.label ??\n              payload.title ??\n              alert.event_type ??\n              \"System event\"\n\n            const time = new Date(alert.created_at).toLocaleString()\n\n            const actor = alert.event_source ?? \"system\"\n            const importance =\n              payload.importance ??\n              alert.score_delta ??\n              1\n\n            return (\n              <div\n                key={alert.id}\n                className=\"space-y-2 rounded-xl border border-white/10 bg-white/5 p-4\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div>\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                      {actor}\n                    </p>\n                    <p className=\"text-sm font-semibold text-white\">\n                      {label}\n                    </p>\n                  </div>\n                  <Badge className=\"border border-white/20 bg-white/10 text-xs text-white/70\">\n                    {importance}\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-white/50\">{time}</p>\n                {payload.notes ? (\n                  <p className=\"text-sm text-white/70\">{payload.notes}</p>\n                ) : null}\n              </div>\n            )\n          })\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --- Helpers visuales para Next Actions ---\n\nfunction ChannelIcon({ channel }: { channel: string | null }) {\n  if (!channel) return <Zap size={14} className=\"text-white/40\" />\n\n  switch (channel) {\n    case \"email\":\n      return <Mail size={14} className=\"text-emerald-300\" />\n    case \"voice\":\n      return <PhoneCall size={14} className=\"text-amber-300\" />\n    case \"whatsapp\":\n      return <MessageSquare size={14} className=\"text-green-400\" />\n    case \"sms\":\n      return <MessageSquare size={14} className=\"text-blue-400\" />\n    default:\n      return <Zap size={14} className=\"text-white/40\" />\n  }\n}\n\nfunction BrainBucketBadge({ bucket }: { bucket: string | null }) {\n  if (!bucket)\n    return (\n      <Badge className=\"bg-white/10 text-white/60 border border-white/20 text-xs\">\n        unknown\n      </Badge>\n    )\n\n  const base = \"px-2 py-0.5 text-xs border\"\n  if (bucket === \"hot\")\n    return (\n      <Badge\n        className={`${base} bg-rose-600/30 text-rose-100 border-rose-500/60`}\n      >\n        hot\n      </Badge>\n    )\n  if (bucket === \"warm\")\n    return (\n      <Badge\n        className={`${base} bg-amber-500/20 text-amber-100 border-amber-400/60`}\n      >\n        warm\n      </Badge>\n    )\n  return (\n    <Badge\n      className={`${base} bg-sky-500/20 text-sky-100 border-sky-400/60`}\n    >\n      cold\n    </Badge>\n  )\n}\n\nfunction ActionBadge({ action }: { action: string | null }) {\n  if (!action) return null\n  const base = \"px-2 py-0.5 text-xs border\"\n\n  if (action === \"send\")\n    return (\n      <Badge\n        className={`${base} bg-emerald-500/20 text-emerald-100 border-emerald-400/60`}\n      >\n        send\n      </Badge>\n    )\n  if (action === \"cooldown\")\n    return (\n      <Badge\n        className={`${base} bg-amber-500/20 text-amber-100 border-amber-400/60`}\n      >\n        cooldown\n      </Badge>\n    )\n  if (action === \"review\")\n    return (\n      <Badge\n        className={`${base} bg-rose-600/20 text-rose-100 border-rose-500/60`}\n      >\n        review\n      </Badge>\n    )\n  return (\n    <Badge className={`${base} bg-white/10 text-white/60 border-white/30`}>\n      {action}\n    </Badge>\n  )\n}\n\nfunction UrgencyBar({ score }: { score: number | null }) {\n  const v = Math.min(Math.max(score ?? 0, 0), 100)\n  const color =\n    v >= 70 ? \"bg-rose-500\" : v >= 40 ? \"bg-amber-400\" : \"bg-emerald-400\"\n\n  return (\n    <div className=\"h-2 w-full rounded-full bg-white/10 overflow-hidden\">\n      <div className={`${color} h-full`} style={{ width: `${v}%` }} />\n    </div>\n  )\n}\n\nfunction NextActionsSection({ rows }: { rows: NextActionRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Next actions queue\"\n        description=\"Lo que el Lead Brain quiere hacer ahora mismo.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay acciones pendientes todavÃ­a.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Bucket</TableHeaderCell>\n                <TableHeaderCell>Canal</TableHeaderCell>\n                <TableHeaderCell>AcciÃ³n</TableHeaderCell>\n                <TableHeaderCell>Delay</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Prioridad\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow\n                  key={row.lead_id}\n                  className=\"hover:bg-white/10 cursor-pointer\"\n                >\n                  <TableCell>\n                    <div className=\"flex flex-col gap-0.5\">\n                      <Link\n                        href={`/leads/${row.lead_id}`}\n                        className=\"text-sm font-semibold text-white hover:underline\"\n                      >\n                        {row.lead_name ??\n                          row.email ??\n                          row.phone ??\n                          row.lead_id.slice(0, 8).toUpperCase()}\n                      </Link>\n                      {row.reason ? (\n                        <p className=\"text-xs text-white/60\">{row.reason}</p>\n                      ) : null}\n                      <div className=\"mt-1 flex flex-wrap gap-1.5\">\n                        {row.industry && (\n                          <span className=\"rounded-full border border-emerald-400/60 bg-emerald-500/15 px-2 py-0.5 text-[11px] text-emerald-100\">\n                            {row.industry}\n                          </span>\n                        )}\n                        {row.sub_industry && (\n                          <span className=\"rounded-full border border-emerald-400/60 bg-emerald-500/10 px-2 py-0.5 text-[11px] text-emerald-50\">\n                            {row.sub_industry}\n                          </span>\n                        )}\n                        {row.enrichment_status && (\n                          <span className=\"rounded-full border border-white/20 bg-white/10 px-2 py-0.5 text-[11px] text-white/70\">\n                            {row.enrichment_status}\n                          </span>\n                        )}\n                      </div>\n                      {row.ai_lead_score != null && (\n                        <p className=\"text-[11px] text-white/50\">\n                          AI score: {row.ai_lead_score.toFixed(0)}\n                        </p>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <BrainBucketBadge bucket={row.lead_brain_bucket} />\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2 text-sm text-white/70\">\n                      <ChannelIcon channel={row.recommended_channel} />\n                      <span className=\"capitalize\">\n                        {row.recommended_channel ?? \"--\"}\n                      </span>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <ActionBadge action={row.recommended_action} />\n                  </TableCell>\n                  <TableCell className=\"text-sm text-white/70\">\n                    {row.recommended_delay_minutes != null\n                      ? `${row.recommended_delay_minutes} min`\n                      : \"--\"}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex flex-col items-end gap-1\">\n                      <span className=\"text-xs text-white/60\">\n                        {row.priority_score ?? 0}\n                      </span>\n                      <UrgencyBar score={row.priority_score} />\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ðŸ”¬ Enrichment Engine v2 â€“ UI\n\nfunction EnrichmentEngineV2Section({\n  overview,\n}: {\n  overview: EnrichmentOverview\n}) {\n  const queue = overview.queue\n  const summary = overview.summary\n\n  const totalInQueue = queue.reduce((acc, q) => acc + q.total, 0)\n  const pending =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"pending\")\n      ?.total ?? 0\n  const failed =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"failed\")\n      ?.total ?? 0\n  const completed =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"completed\")\n      ?.total ?? 0\n\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Enrichment Engine v2\"\n        description=\"Cola y estado de los leads enriquecidos.\"\n      />\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid gap-3 sm:grid-cols-4\">\n          <MetricTile\n            label=\"En cola\"\n            value={totalInQueue}\n            helper=\"Registros en enrichment_queue\"\n          />\n          <MetricTile\n            label=\"Pending\"\n            value={pending}\n            helper=\"AÃºn por procesar\"\n          />\n          <MetricTile\n            label=\"Completed\"\n            value={completed}\n            helper=\"Marcados como completados\"\n          />\n          <MetricTile\n            label=\"Failed\"\n            value={failed}\n            helper=\"Errores recientes\"\n          />\n        </div>\n\n        <div className=\"rounded-2xl border border-white/10 bg-black/30\">\n          {summary.length === 0 ? (\n            <p className=\"p-4 text-sm text-white/60\">\n              AÃºn no hay leads con enrichment v2.\n            </p>\n          ) : (\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Status</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Leads\n                  </TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Avg AI score\n                  </TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {summary.map((row) => (\n                  <TableRow key={row.enrichment_status ?? \"unknown\"}>\n                    <TableCell className=\"capitalize text-white\">\n                      {row.enrichment_status ?? \"unknown\"}\n                    </TableCell>\n                    <TableCell className=\"text-right text-white/80\">\n                      {row.total}\n                    </TableCell>\n                    <TableCell className=\"text-right text-white/80\">\n                      {row.avg_ai_lead_score != null\n                        ? row.avg_ai_lead_score.toFixed(1)\n                        : \"â€”\"}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ---------- PÃ¡gina principal ----------\n\nexport default async function DirectorPage() {\n  const supabase = supabaseServer()\n\n  const [\n    nextActions,\n    engines,\n    appointmentMetrics,\n    leadMetrics,\n    snapshot,\n    campaignRows,\n    alerts,\n    enrichmentOverview,\n  ] = await Promise.all([\n    loadNextActions(supabase),\n    loadEngines(supabase),\n    loadAppointmentMetrics(supabase),\n    loadLeadMetrics(supabase),\n    getSystemSnapshot(),\n    loadCampaignEngine(supabase),\n    loadDirectorAlerts(supabase),\n    loadEnrichmentOverview(supabase),\n  ])\n\n  const hasError = engines.some((e) => e.status === \"Error\")\n  const hasAnyRun = engines.some((e) => e.lastRun !== null)\n\n  const engineLabel = hasError\n    ? \"Engine con issues Â· revisa logs\"\n    : hasAnyRun\n    ? \"Engine ok Â· cron corriendo\"\n    : \"Sin datos aÃºn Â· engine idle\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasError\n    ? \"destructive\"\n    : hasAnyRun\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Operations & campaigns\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Director Dashboard\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Pulso de los motores de Revenue ASI, next actions y performance de\n            campaÃ±as.\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      <NextActionsSection rows={nextActions} />\n\n      <div className=\"grid items-start gap-6 xl:grid-cols-[minmax(0,1.7fr)_minmax(0,1.3fr)]\">\n        <Card className=\"border-white/10 bg-white/5\">\n          <CardHeader\n            title=\"Engines\"\n            description=\"Core cron jobs y su Ãºltima actividad.\"\n          />\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Job</TableHeaderCell>\n                  <TableHeaderCell>Schedule</TableHeaderCell>\n                  <TableHeaderCell>Last run</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Status\n                  </TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {engines.map((engine) => (\n                  <TableRow key={engine.name}>\n                    <TableCell className=\"font-semibold text-white\">\n                      {engine.name}\n                    </TableCell>\n                    <TableCell className=\"text-white/70\">\n                      {engine.schedule ?? \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {engine.lastRun\n                        ? dateTimeFormatter.format(new Date(engine.lastRun))\n                        : \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <StatusBadge status={engine.status} />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-4\">\n          <SystemSnapshotCard snapshot={snapshot} />\n\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Appointments\"\n              description=\"Actividad agendada hoy.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-3\">\n              <MetricTile\n                label=\"Appointments\"\n                value={appointmentMetrics.appointmentsToday}\n                helper=\"Starts today\"\n              />\n              <MetricTile\n                label=\"Reminders\"\n                value={appointmentMetrics.remindersToday}\n                helper=\"Notification jobs\"\n              />\n              <MetricTile\n                label=\"Reminder touch runs\"\n                value={\n                  appointmentMetrics.reminderTouchRunsToday\n                }\n                helper=\"Steps 200â€“202\"\n              />\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Lead Flow\"\n              description=\"Top-of-funnel signals.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-4\">\n              <MetricTile\n                label=\"New leads\"\n                value={leadMetrics.newLeadsToday}\n                helper=\"Created today\"\n              />\n              <MetricTile\n                label=\"Leads w/ appts\"\n                value={leadMetrics.leadsWithAppointments}\n                helper=\"Distinct leads\"\n              />\n              <MetricTile\n                label=\"Shows\"\n                value={leadMetrics.showsToday}\n                helper=\"Outcome: show\"\n              />\n              <MetricTile\n                label=\"No-shows\"\n                value={leadMetrics.noShowsToday}\n                helper=\"Outcome: no_show\"\n              />\n            </CardContent>\n          </Card>\n\n          <EnrichmentEngineV2Section overview={enrichmentOverview} />\n        </div>\n      </div>\n\n      <CampaignEngineSection rows={campaignRows} />\n      <DirectorAlertsSection alerts={alerts} />\n    </div>\n  )\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z',\n      key: '18887p',\n    },\n  ],\n];\n\n/**\n * @component @name MessageSquare\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTdhMiAyIDAgMCAxLTIgMkg2LjgyOGEyIDIgMCAwIDAtMS40MTQuNTg2bC0yLjIwMiAyLjIwMkEuNzEuNzEgMCAwIDEgMiAyMS4yODZWNWEyIDIgMCAwIDEgMi0yaDE2YTIgMiAwIDAgMSAyIDJ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/message-square\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MessageSquare = createLucideIcon('message-square', __iconNode);\n\nexport default MessageSquare;\n","// src/lib/director/system-snapshot.ts\nimport { supabaseServer } from \"@/lib/supabase-server\"\n\nexport type SystemSnapshot = {\n  generated_at: string\n  dashboard_overview: Record<string, any>\n  campaign_funnel_by_channel: any[]\n  campaign_funnel_summary: any[]\n  lead_state_summary: any[]\n  lead_activity_summary: any[]\n  campaign_kpis: any[]\n  enrichment_v2_summary: {\n    total_leads: number\n    completed: number\n    pending: number\n    failed: number\n  }\n}\n\nfunction fallbackSnapshot(): SystemSnapshot {\n  return {\n    generated_at: new Date().toISOString(),\n    dashboard_overview: {\n      total_leads: 0,\n      leads_attempting: 0,\n      leads_booked: 0,\n      campaigns_live: 0,\n    },\n    campaign_funnel_by_channel: [],\n    campaign_funnel_summary: [],\n    lead_state_summary: [],\n    lead_activity_summary: [],\n    campaign_kpis: [],\n    enrichment_v2_summary: {\n      total_leads: 0,\n      completed: 0,\n      pending: 0,\n      failed: 0,\n    },\n  }\n}\n\nexport async function getSystemSnapshot(): Promise<SystemSnapshot> {\n  const supabase = supabaseServer()\n  if (!supabase) {\n    return fallbackSnapshot()\n  }\n\n  const { data, error } = await supabase.rpc(\"api_get_system_snapshot\")\n\n  if (error) {\n    console.error(\"api_get_system_snapshot error\", error)\n  }\n\n  const raw = (data ?? {}) as any\n  const base = fallbackSnapshot()\n\n  return {\n    generated_at: raw.generated_at ?? base.generated_at,\n    dashboard_overview:\n      raw.dashboard_overview ?? base.dashboard_overview,\n    campaign_funnel_by_channel:\n      raw.campaign_funnel_by_channel ??\n      base.campaign_funnel_by_channel,\n    campaign_funnel_summary:\n      raw.campaign_funnel_summary ?? base.campaign_funnel_summary,\n    lead_state_summary:\n      raw.lead_state_summary ?? base.lead_state_summary,\n    lead_activity_summary:\n      raw.lead_activity_summary ?? base.lead_activity_summary,\n    campaign_kpis: raw.campaign_kpis ?? base.campaign_kpis,\n    enrichment_v2_summary: {\n      total_leads:\n        raw.enrichment_v2_summary?.total_leads ??\n        base.enrichment_v2_summary.total_leads,\n      completed:\n        raw.enrichment_v2_summary?.completed ??\n        base.enrichment_v2_summary.completed,\n      pending:\n        raw.enrichment_v2_summary?.pending ??\n        base.enrichment_v2_summary.pending,\n      failed:\n        raw.enrichment_v2_summary?.failed ??\n        base.enrichment_v2_summary.failed,\n    },\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}
./.next/server/chunks/ssr/src_app_operator_page_tsx_506ff481._.js.map:1:{"version":3,"sources":["../../../../src/app/operator/page.tsx","../../../../node_modules/lucide-react/src/icons/activity.ts","../../../../node_modules/lucide-react/src/icons/calendar-clock.ts","../../../../node_modules/lucide-react/src/icons/circle-check.ts","../../../../node_modules/lucide-react/src/icons/waves.ts","../../../../node_modules/lucide-react/src/icons/triangle-alert.ts","../../../../node_modules/lucide-react/src/icons/message-circle.ts"],"sourcesContent":["// src/app/operator/page.tsx\nimport React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport {\n  Mail,\n  MessageCircle,\n  PhoneCall,\n  Waves,\n  Activity,\n  CalendarClock,\n  AlertTriangle,\n  CheckCircle2,\n  Zap,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// --------- Tipos base ---------\n\ntype TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  scheduled_at: string | null\n  sent_at: string | null\n  status: string | null\n  error: string | null\n  created_at: string | null\n  type: string | null\n  intent: string | null\n  outcome: string | null\n  retry_count: number | null\n  max_retries: number | null\n  message_class: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  org_id: string | null\n  appointment_id: string | null\n  channel: string | null\n  notify_at: string | null\n  status: string | null\n  created_at: string | null\n  sent_at: string | null\n  error: string | null\n}\n\ntype ActivityToday = {\n  touchesTotalToday: number\n  touchesSentToday: number\n  touchesFailedToday: number\n  touchesQueuedToday: number\n  appointmentNotificationsToday: number\n}\n\n// --------- Helpers de fecha ---------\n\nfunction getTodayRangeUTC() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\nfunction formatDate(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  return dateTimeFormatter.format(d)\n}\n\nfunction timeAgo(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  const diffMs = Date.now() - d.getTime()\n  const diffMin = Math.round(diffMs / 60000)\n  if (diffMin < 1) return \"just now\"\n  if (diffMin < 60) return `hace ${diffMin} min`\n  const diffH = Math.round(diffMin / 60)\n  if (diffH < 24) return `hace ${diffH} h`\n  const diffD = Math.round(diffH / 24)\n  return `hace ${diffD} d`\n}\n\n// --------- Loaders (server-side) ---------\n\nasync function loadLiveQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"scheduled\"])\n    .order(\"scheduled_at\", { ascending: true })\n    .limit(50)\n\n    if (!data) return []\n\n    // si viene en formato de error, salimos con []\n    if (!data) return []\n\n    // si viene en formato de error, salimos con []\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos cualquier cosa que tenga `error` (GenericStringError)\n      const rows = (data as any[]).filter(\n        (row): row is TouchRunRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\nasync function loadRecentErrors(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .eq(\"status\", \"failed\")\n    .gte(\"created_at\", start)\n    .lt(\"created_at\", end)\n    .order(\"created_at\", { ascending: false })\n    .limit(30)\n\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos cualquier cosa que tenga `error` (GenericStringError)\n      const rows = (data as any[]).filter(\n        (row): row is TouchRunRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\nasync function loadActivityToday(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<ActivityToday> {\n  const fallback: ActivityToday = {\n    touchesTotalToday: 0,\n    touchesSentToday: 0,\n    touchesFailedToday: 0,\n    touchesQueuedToday: 0,\n    appointmentNotificationsToday: 0,\n  }\n\n  if (!client) return fallback\n\n  const { start, end } = getTodayRangeUTC()\n\n  const [\n    totalTouches,\n    sentTouches,\n    failedTouches,\n    queuedTouches,\n    apptNotifs,\n  ] = await Promise.all([\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"sent\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"failed\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"status\", [\"queued\", \"scheduled\"])\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n  ])\n\n  return {\n    touchesTotalToday: totalTouches.count ?? 0,\n    touchesSentToday: sentTouches.count ?? 0,\n    touchesFailedToday: failedTouches.count ?? 0,\n    touchesQueuedToday: queuedTouches.count ?? 0,\n    appointmentNotificationsToday: apptNotifs.count ?? 0,\n  }\n}\n\nasync function loadAppointmentsNotificationsQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentNotificationRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"appointments_notifications\")\n    .select(\n      [\n        \"id\",\n        \"org_id\",\n        \"appointment_id\",\n        \"channel\",\n        \"notify_at\",\n        \"status\",\n        \"created_at\",\n        \"sent_at\",\n        \"error\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"pending\"])\n    .gte(\"notify_at\", start)\n    .lt(\"notify_at\", end)\n    .order(\"notify_at\", { ascending: true })\n    .limit(30)\n\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos posibles GenericStringError[]\n      const rows = (data as any[]).filter(\n        (row): row is AppointmentNotificationRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\n// --------- Helpers UI ---------\n\nfunction channelIcon(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  const base = \"h-4 w-4\"\n\n  if (c === \"email\") return <Mail className={base} />\n  if (c === \"whatsapp\") return <MessageCircle className={base} />\n  if (c === \"sms\") return <Waves className={base} />\n  if (c === \"voice\" || c === \"phone\") return <PhoneCall className={base} />\n  if (c === \"zoom\") return <CalendarClock className={base} />\n  return <Activity className={base} />\n}\n\nfunction channelBadge(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  let classes =\n    \"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (c === \"email\") {\n    classes += \" border-sky-400/60 bg-sky-500/10 text-sky-100\"\n  } else if (c === \"whatsapp\") {\n    classes += \" border-emerald-400/60 bg-emerald-500/10 text-emerald-100\"\n  } else if (c === \"sms\") {\n    classes += \" border-indigo-400/60 bg-indigo-500/10 text-indigo-100\"\n  } else if (c === \"voice\" || c === \"phone\") {\n    classes += \" border-amber-400/60 bg-amber-500/10 text-amber-100\"\n  } else if (c === \"zoom\") {\n    classes += \" border-fuchsia-400/60 bg-fuchsia-500/10 text-fuchsia-100\"\n  } else {\n    classes += \" border-white/20 bg-white/5 text-white/70\"\n  }\n\n  return (\n    <span className={classes}>\n      {channelIcon(channel)}\n      <span className=\"capitalize\">{channel ?? \"â€”\"}</span>\n    </span>\n  )\n}\n\nfunction statusBadge(status: string | null) {\n  const s = (status ?? \"\").toLowerCase()\n  let className =\n    \"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (s === \"sent\") {\n    className +=\n      \" border-emerald-400/70 bg-emerald-500/10 text-emerald-100 shadow-[0_0_20px_rgba(16,185,129,0.35)]\"\n    return (\n      <span className={className}>\n        <CheckCircle2 className=\"h-3 w-3\" />\n        sent\n      </span>\n    )\n  }\n\n  if (s === \"failed\") {\n    className +=\n      \" border-rose-400/70 bg-rose-500/10 text-rose-100 shadow-[0_0_20px_rgba(244,63,94,0.45)]\"\n    return (\n      <span className={className}>\n        <AlertTriangle className=\"h-3 w-3\" />\n        failed\n      </span>\n    )\n  }\n\n  if (s === \"queued\" || s === \"scheduled\") {\n    className +=\n      \" border-amber-400/70 bg-amber-500/10 text-amber-100 shadow-[0_0_20px_rgba(251,191,36,0.35)]\"\n    return (\n      <span className={className}>\n        <Zap className=\"h-3 w-3\" />\n        {s}\n      </span>\n    )\n  }\n\n  className += \" border-white/20 bg-white/5 text-white/70\"\n  return <span className={className}>{status ?? \"unknown\"}</span>\n}\n\nfunction tinyPill(text: string) {\n  return (\n    <span className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] uppercase tracking-[0.16em] text-white/50\">\n      {text}\n    </span>\n  )\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n  icon,\n}: {\n  label: string\n  value: number\n  helper: string\n  icon: React.ReactNode\n}) {\n  return (\n    <Card className=\"border-white/10 bg-gradient-to-b from-slate-900/40 via-slate-900/10 to-slate-900/0\">\n      <CardContent className=\"flex items-center gap-3 p-4\">\n        <div className=\"flex h-9 w-9 items-center justify-center rounded-2xl bg-white/10\">\n          {icon}\n        </div>\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n            {label}\n          </p>\n          <p className=\"text-2xl font-semibold text-white\">{value}</p>\n          <p className=\"text-[11px] text-white/50\">{helper}</p>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- Secciones UI ---------\n\nfunction LiveQueueSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Live queue\"\n        description=\"Touches en cola listos para salir (multi-canal).\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay touches en cola ahora mismo.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Step</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell>Meta</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Scheduled / Age\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const campaignLabel =\n                  row.campaign_id?.slice(0, 8).toUpperCase() ?? \"â€”\"\n                const metaChips: string[] = []\n                if (row.type) metaChips.push(row.type)\n                if (row.intent) metaChips.push(row.intent)\n                if (row.message_class) metaChips.push(row.message_class)\n\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell>\n                      <div className=\"flex flex-col gap-0.5\">\n                        {row.lead_id ? (\n                          <Link\n                            href={`/leads/${row.lead_id}`}\n                            className=\"text-sm font-semibold text-white hover:underline\"\n                          >\n                            {leadLabel}\n                          </Link>\n                        ) : (\n                          <span className=\"text-sm font-semibold text-white\">\n                            {leadLabel}\n                          </span>\n                        )}\n                        <p className=\"text-[11px] text-white/45\">\n                          Campaign: {campaignLabel}\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.step != null ? (\n                        <span className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[11px] text-white/70\">\n                          #{row.step}\n                        </span>\n                      ) : (\n                        \"â€”\"\n                      )}\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell>\n                      {metaChips.length === 0 ? (\n                        <span className=\"text-[11px] text-white/40\">\n                          â€”\n                        </span>\n                      ) : (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {metaChips.map((m) => (\n                            <span\n                              key={m}\n                              className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] text-white/60\"\n                            >\n                              {m}\n                            </span>\n                          ))}\n                        </div>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right text-[11px] text-white/60\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.scheduled_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.scheduled_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction RecentErrorsSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Recent errors\"\n        description=\"Fallos de entrega hoy por canal.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <div className=\"flex items-center gap-2 p-4 text-sm text-emerald-200\">\n            <CheckCircle2 className=\"h-4 w-4\" />\n            <span>Sin errores hoy. Motor limpio. ðŸ™Œ</span>\n          </div>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>When</TableHeaderCell>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Error</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Status\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const errorText = row.error ?? \"unknown error\"\n                const shortError =\n                  errorText.length > 90\n                    ? `${errorText.slice(0, 90)}â€¦`\n                    : errorText\n\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell className=\"text-[11px] text-white/70\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.created_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.created_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {row.lead_id ? (\n                        <Link\n                          href={`/leads/${row.lead_id}`}\n                          className=\"text-sm font-semibold text-white hover:underline\"\n                        >\n                          {leadLabel}\n                        </Link>\n                      ) : (\n                        <span className=\"text-sm font-semibold text-white\">\n                          {leadLabel}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell className=\"max-w-md text-xs text-rose-200\">\n                      {shortError}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {statusBadge(row.status)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction AppointmentNotificationsSection({\n  rows,\n}: {\n  rows: AppointmentNotificationRow[]\n}) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Appointment notifications\"\n        description=\"Recordatorios de citas en cola para hoy.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <div className=\"flex items-center gap-2 p-4 text-sm text-white/60\">\n            <CalendarClock className=\"h-4 w-4 text-white/40\" />\n            <span>No hay notificaciones de citas en cola para hoy.</span>\n          </div>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Appointment</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Notify at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const apptLabel =\n                  row.appointment_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell className=\"text-sm text-white\">\n                      {apptLabel}\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-right text-[11px] text-white/70\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.notify_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.notify_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- PÃ¡gina principal ---------\n\nexport default async function OperatorPage() {\n  const supabase = supabaseServer()\n\n  const [liveQueue, recentErrors, activityToday, apptNotifications] =\n    await Promise.all([\n      loadLiveQueue(supabase),\n      loadRecentErrors(supabase),\n      loadActivityToday(supabase),\n      loadAppointmentsNotificationsQueue(supabase),\n    ])\n\n  const totalQueued = liveQueue.length\n  const hasErrorsToday = recentErrors.length > 0\n\n  const engineLabel = hasErrorsToday\n    ? \"Execution engine con errores hoy\"\n    : totalQueued > 0\n    ? `Execution engine activo Â· ${totalQueued} en cola`\n    : \"Execution engine idle pero sano\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasErrorsToday\n    ? \"destructive\"\n    : totalQueued > 0\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n            Operations Â· Execution layer\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Operator Cockpit\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Vista en tiempo casi real del motor que manda emails, WhatsApps,\n            SMS, llamadas y recordatorios de citas.\n          </p>\n          <p className=\"text-[11px] text-white/40\">\n            {tinyPill(\"Today Â· UTC\")}\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* Tiles actividad hoy */}\n      <div className=\"grid gap-3 md:grid-cols-5\">\n        <MetricTile\n          label=\"Touches hoy\"\n          value={activityToday.touchesTotalToday}\n          helper=\"Todos los canales\"\n          icon={<Zap className=\"h-4 w-4 text-emerald-200\" />}\n        />\n        <MetricTile\n          label=\"Sent\"\n          value={activityToday.touchesSentToday}\n          helper=\"Entregados hoy\"\n          icon={<CheckCircle2 className=\"h-4 w-4 text-emerald-200\" />}\n        />\n        <MetricTile\n          label=\"Failed\"\n          value={activityToday.touchesFailedToday}\n          helper=\"Con error hoy\"\n          icon={<AlertTriangle className=\"h-4 w-4 text-rose-200\" />}\n        />\n        <MetricTile\n          label=\"Queued\"\n          value={activityToday.touchesQueuedToday}\n          helper=\"Creados hoy\"\n          icon={<Activity className=\"h-4 w-4 text-amber-200\" />}\n        />\n        <MetricTile\n          label=\"Cita â€“ notifs\"\n          value={activityToday.appointmentNotificationsToday}\n          helper=\"Recordatorios hoy\"\n          icon={<CalendarClock className=\"h-4 w-4 text-sky-200\" />}\n        />\n      </div>\n\n      {/* Live queue + errores */}\n      <div className=\"grid gap-6 xl:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]\">\n        <LiveQueueSection rows={liveQueue} />\n        <RecentErrorsSection rows={recentErrors} />\n      </div>\n\n      {/* Notifs de citas */}\n      <AppointmentNotificationsSection rows={apptNotifications} />\n    </div>\n  )\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2',\n      key: '169zse',\n    },\n  ],\n];\n\n/**\n * @component @name Activity\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTJoLTIuNDhhMiAyIDAgMCAwLTEuOTMgMS40NmwtMi4zNSA4LjM2YS4yNS4yNSAwIDAgMS0uNDggMEw5LjI0IDIuMThhLjI1LjI1IDAgMCAwLS40OCAwbC0yLjM1IDguMzZBMiAyIDAgMCAxIDQuNDkgMTJIMiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/activity\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Activity = createLucideIcon('activity', __iconNode);\n\nexport default Activity;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M16 14v2.2l1.6 1', key: 'fo4ql5' }],\n  ['path', { d: 'M16 2v4', key: '4m81vk' }],\n  ['path', { d: 'M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5', key: '1osxxc' }],\n  ['path', { d: 'M3 10h5', key: 'r794hk' }],\n  ['path', { d: 'M8 2v4', key: '1cmpym' }],\n  ['circle', { cx: '16', cy: '16', r: '6', key: 'qoo3c4' }],\n];\n\n/**\n * @component @name CalendarClock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTYgMTR2Mi4ybDEuNiAxIiAvPgogIDxwYXRoIGQ9Ik0xNiAydjQiIC8+CiAgPHBhdGggZD0iTTIxIDcuNVY2YTIgMiAwIDAgMC0yLTJINWEyIDIgMCAwIDAtMiAydjE0YTIgMiAwIDAgMCAyIDJoMy41IiAvPgogIDxwYXRoIGQ9Ik0zIDEwaDUiIC8+CiAgPHBhdGggZD0iTTggMnY0IiAvPgogIDxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/calendar-clock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CalendarClock = createLucideIcon('calendar-clock', __iconNode);\n\nexport default CalendarClock;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'm9 12 2 2 4-4', key: 'dzmm74' }],\n];\n\n/**\n * @component @name CircleCheck\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJtOSAxMiAyIDIgNC00IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/circle-check\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleCheck = createLucideIcon('circle-check', __iconNode);\n\nexport default CircleCheck;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1',\n      key: 'knzxuh',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1',\n      key: '2jd2cc',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1',\n      key: 'rd2r6e',\n    },\n  ],\n];\n\n/**\n * @component @name Waves\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMiA2Yy42LjUgMS4yIDEgMi41IDFDNyA3IDcgNSA5LjUgNWMyLjYgMCAyLjQgMiA1IDIgMi41IDAgMi41LTIgNS0yIDEuMyAwIDEuOS41IDIuNSAxIiAvPgogIDxwYXRoIGQ9Ik0yIDEyYy42LjUgMS4yIDEgMi41IDEgMi41IDAgMi41LTIgNS0yIDIuNiAwIDIuNCAyIDUgMiAyLjUgMCAyLjUtMiA1LTIgMS4zIDAgMS45LjUgMi41IDEiIC8+CiAgPHBhdGggZD0iTTIgMThjLjYuNSAxLjIgMSAyLjUgMSAyLjUgMCAyLjUtMiA1LTIgMi42IDAgMi40IDIgNSAyIDIuNSAwIDIuNS0yIDUtMiAxLjMgMCAxLjkuNSAyLjUgMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/waves\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Waves = createLucideIcon('waves', __iconNode);\n\nexport default Waves;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'm21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3',\n      key: 'wmoenq',\n    },\n  ],\n  ['path', { d: 'M12 9v4', key: 'juzpu7' }],\n  ['path', { d: 'M12 17h.01', key: 'p32p05' }],\n];\n\n/**\n * @component @name TriangleAlert\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMjEuNzMgMTgtOC0xNGEyIDIgMCAwIDAtMy40OCAwbC04IDE0QTIgMiAwIDAgMCA0IDIxaDE2YTIgMiAwIDAgMCAxLjczLTMiIC8+CiAgPHBhdGggZD0iTTEyIDl2NCIgLz4KICA8cGF0aCBkPSJNMTIgMTdoLjAxIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/triangle-alert\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst TriangleAlert = createLucideIcon('triangle-alert', __iconNode);\n\nexport default TriangleAlert;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719',\n      key: '1sd12s',\n    },\n  ],\n];\n\n/**\n * @component @name MessageCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMi45OTIgMTYuMzQyYTIgMiAwIDAgMSAuMDk0IDEuMTY3bC0xLjA2NSAzLjI5YTEgMSAwIDAgMCAxLjIzNiAxLjE2OGwzLjQxMy0uOTk4YTIgMiAwIDAgMSAxLjA5OS4wOTIgMTAgMTAgMCAxIDAtNC43NzctNC43MTkiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/message-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MessageCircle = createLucideIcon('message-circle', __iconNode);\n\nexport default MessageCircle;\n"],"names":[],"mappings":"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,ADZ9B,CCY8B,ADZ9B,CCY8B,ADZ9B,CCY8B,ADZ9B,CCY8B,ADZ9B,CCY8B,ADZ9B,CAAA,ACY8B,CDZ9B,ACY8B,CAAA,ADZ9B,CAAA,ACY8B,CDZ9B,ACY8B,CDZ9B,ACY8B,CDZ9B,ACY8B,CDZ9B,ACY8B,CDZ9B,ACY8B,CDZ9B,CCYgD,CAAA,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCYgD,ADZhD,CCY0D,ADZ1D,CCY0D,ADZ1D,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,4DCHN,CHYH,AGZG,CHYH,AGZG,KAAQ,CAAA,AAAE,EAAG,CAAA,CAAA,CAAA,AHYV,CAAA,AGZU,CHYV,AGZU,KAAW,CHYL,AGZK,CHYL,AGZK,CHYL,AGZK,CAAA,AAAK,AHYV,CAAA,AGZU,CAAA,AHYV,CGZU,AHYV,CGZU,AHYV,CGZU,AHYV,KGZoB,CHYH,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AGX5B,CHW4B,AGX5B,AAAE,CHW0B,ADCjC,CCDiC,ADCjC,8BKlBF,EAAA,CAAA,EAAA,EAAA,OAAA,EHaiC,CCZ5B,ACAA,AJAA,AKAA,AJAuB,ACYK,CCZ5B,AEAA,AJAuB,AGAvB,AJAA,AEY4B,CFZ5B,AKAA,AFAA,ACAA,AFY4B,aAAgB,CFZ5C,AIAA,ACAA,AFAA,ADY4C,CAAA,AFZ5C,AKAA,AFAA,ACAA,CAAA,AJAA,AGAA,AEAA,AHY4C,CEZ5C,AJAA,AGAA,AEAA,AHY4C,CCZ5C,AEAA,ALAA,AIAA,AFY4C,CFZ5C,AGAA,AEAA,ADAA,AFY4C,CCZ5C,AEAA,ADAA,AJAA,AEY4C,CCZ5C,AEAA,ADAA,AJAA,AEY4C,CAAA,ACZ5C,ACAA,AJAA,AKAA,CLAA,AIAA,AFYsD,ACZtD,AEAA,CAAA,AHYsD,AEZtD,ADAA,AHAA,AEHM,CCGN,AHAA,AIAA,ACAA,CLAA,AKAA,ADAA,ADAA,CEAA,ADAA,ADAA,AHAA,AEHM,CGGN,ADAA,ADAA,AHAA,CGAA,AEAA,ADAA,AJAA,CIAA,ACAA,ALAA,AGAA,CCAA,AJAA,AGAA,AEAA,CDAA,AJAA,AKAA,AFAA,CEAA,ALAA,AIAA,ADAA,CCAA,ADAA,AEAA,ALAA,CKAA,ALAA,AIAA,ADAA,CAAA,AEAA,ADAA,AJAA,CKAA,ADAA,AJAA,AGAA,CAAA,ACAA,AJAA,AKAA,CFAA,AHAA,AIAA,ACAA,CLAA,AGAA,ACAA,ACAA,AHH0B,CGG1B,AFAA,AHAA,AIAA,CFH6B,AGG7B,AFAA,ACAA,AJAA,CEH6B,ADAF,AIG3B,ALAA,AGAA,ACAA,CFH6B,AFG7B,AGAA,AEAA,AJH2B,CDG3B,AGAA,AEAA,CAAA,ALAA,AGAA,CHAA,AKAA,AFAA,CEAA,AFAA,AHAA,CKAA,AFAA,AHAA,CAAA,AKAA,AFAA,CDHwC,AGGxC,AFAA,AHAA,CGAA,AHAA,AKAA,CLAA,AKAA,AFAA,CHAA,AKAA,AFAA,CHAA,AKAA,AFAA,CHAA,AKAA,AFAA,CHAA,AKAA,CLAA,AKAA,CHHwC,AFGxC,AKAA,CHHkD,AGGlD,ALAA,CEHkD,AFGlD,AKAA,CAAA,ALAA,CKAA,ALAA,CAAA,AKAA,CLAA,AKAA,CLAA,AKAA,CLAA,AKAA,CAAA,ALAA,CAAA,AKAA,CHFE,AFEF,AKAA,CJFE,ACAA,AAAE,AFEJ,AKAA,CLAA,AKAA,CHFO,AFEP,AKAA,CJFO,ACAA,AFEP,AKAA,CAAA,AJFO,ACAA,AFEP,CAAA,AEFO,ADAA,AIEP,CJFO,ACAA,AGEP,ALAA,CCFO,ACAA,AFEP,AKAA,CJFO,ACAA,AFEP,AKAA,CJFO,ACAA,AFEP,AKAA,CJFO,ACAA,AFEP,AKAA,CLAA,AKAA,AJFO,ACAA,CAAA,AFEP,AKAA,AJFO,CDEP,AKAA,CAAA,ALAA,CKAA,ALAA,CAAA,AKAA,CLAA,AKAA,CLAA,AKAA,CAAA,ALAA,CKAA,ALAA,CAAA,AKAA,CAAA,ALAA,CKAA,OHF6B,CAAU,CAAA,CAChD,EHUA,IAAA,EAAA,EAAA,CAAA,CAAA,OAyDA,SAAS,IACP,IAAM,EAAQ,IAAI,KAClB,EAAM,WAAW,CAAC,EAAG,EAAG,EAAG,GAC3B,IAAM,EAAM,IAAI,KAEhB,OADA,EAAI,WAAW,CAAC,GAAI,EAAG,EAAG,GACnB,CAAE,MAAO,EAAM,WAAW,GAAI,IAAK,EAAI,WAAW,EAAG,CAC9D,CAEA,IAAM,EAAoB,IAAI,KAAK,cAAc,CAAC,QAAS,CACzD,MAAO,QACP,IAAK,UACL,KAAM,UACN,OAAQ,SACV,GAEA,SAAS,EAAW,CAAoB,EACtC,GAAI,CAAC,EAAO,MAAO,IACnB,IAAM,EAAI,IAAI,KAAK,UACnB,AAAI,OAAO,KAAK,CAAC,EAAE,OAAO,IAAY,CAAP,GACxB,EAAkB,MAAM,CAAC,EAClC,CAEA,SAAS,EAAQ,CAAoB,EACnC,GAAI,CAAC,EAAO,MAAO,IACnB,IAAM,EAAI,IAAI,KAAK,GACnB,GAAI,OAAO,KAAK,CAAC,EAAE,OAAO,IAAK,MAAO,IAEtC,IAAM,EAAU,KAAK,KAAK,CAAC,CADZ,KAAK,GAAG,GAAK,EAAE,OAAO,EAAA,EACD,KACpC,GAAI,EAAU,EAAG,MAAO,WACxB,GAAI,EAAU,GAAI,MAAO,CAAC,KAAK,EAAE,EAAQ,IAAI,CAAC,CAC9C,IAAM,EAAQ,KAAK,KAAK,CAAC,EAAU,IACnC,GAAI,EAAQ,GAAI,MAAO,CAAC,KAAK,EAAE,EAAM,EAAE,CAAC,CACxC,IAAM,EAAQ,KAAK,KAAK,CAAC,EAAQ,IACjC,MAAO,CAAC,KAAK,EAAE,EAAM,EAAE,CAAC,AAC1B,CAIA,eAAe,EACb,CAAyC,EAEzC,GAAI,CAAC,EAAQ,MAAO,EAAE,CAEtB,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,cACL,MAAM,CACL,6JAmBD,EAAE,CAAC,SAAU,CAAC,SAAU,YAAY,EACpC,KAAK,CAAC,eAAgB,CAAE,WAAW,CAAK,GACxC,KAAK,CAAC,WAEP,AAAK,GAGA,CAHD,CAMA,CANO,EAOP,CAJO,GAGA,IAHO,AAIN,EAJQ,GAIH,CAAC,GACP,EAAE,EAGN,AAAD,GAAU,KAAD,CAAO,OAAO,CAAC,GAKd,EAAe,EALM,IAKA,CACjC,AAAC,GAA4B,CAAE,GAAa,OALrC,EAAE,CAZK,EAqBlB,AArBoB,CAuBxB,eAAe,EACb,CAAyC,EAEzC,GAAI,CAAC,EAAQ,MAAO,EAAE,CAEtB,GAAM,CAAE,OAAK,KAAE,CAAG,CAAE,CAAG,IAEjB,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,cACL,MAAM,CACL,6JAmBD,EAAE,CAAC,SAAU,UACb,GAAG,CAAC,aAAc,GAClB,EAAE,CAAC,aAAc,GACjB,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,WAEP,AAAI,GACA,IADO,IACC,KAAK,CAAC,GACP,EAAE,EAGP,AAAC,GAAS,KAAD,CAAO,OAAO,CAAC,GAKd,EAAe,EALM,IAKA,CACjC,AAAC,GAA4B,CAAE,GAAa,OALrC,EASX,AATa,CAWjB,eAAe,EACb,CAAyC,EAUzC,GAAI,CAAC,EAAQ,MARmB,CAC9B,AAOkB,kBAPC,EACnB,iBAAkB,EAClB,mBAAoB,EACpB,mBAAoB,EACpB,8BAA+B,CACjC,EAIA,GAAM,OAAE,CAAK,KAAE,CAAG,CAAE,CAAG,IAEjB,CACJ,EACA,EACA,EACA,EACA,EACD,CAAG,MAAM,QAAQ,GAAG,CAAC,CACpB,EACG,IAAI,CAAC,cACL,MAAM,CAAC,KAAM,CAAE,MAAO,QAAS,MAAM,CAAK,GAC1C,GAAG,CAAC,aAAc,GAClB,EAAE,CAAC,aAAc,GACpB,EACG,IAAI,CAAC,cACL,MAAM,CAAC,KAAM,CAAE,MAAO,QAAS,MAAM,CAAK,GAC1C,EAAE,CAAC,SAAU,QACb,GAAG,CAAC,aAAc,GAClB,EAAE,CAAC,aAAc,GACpB,EACG,IAAI,CAAC,cACL,MAAM,CAAC,KAAM,CAAE,MAAO,QAAS,MAAM,CAAK,GAC1C,EAAE,CAAC,SAAU,UACb,GAAG,CAAC,aAAc,GAClB,EAAE,CAAC,aAAc,GACpB,EACG,IAAI,CAAC,cACL,MAAM,CAAC,KAAM,CAAE,MAAO,QAAS,MAAM,CAAK,GAC1C,EAAE,CAAC,SAAU,CAAC,SAAU,YAAY,EACpC,GAAG,CAAC,aAAc,GAClB,EAAE,CAAC,aAAc,GACpB,EACG,IAAI,CAAC,8BACL,MAAM,CAAC,KAAM,CAAE,MAAO,QAAS,MAAM,CAAK,GAC1C,GAAG,CAAC,YAAa,GACjB,EAAE,CAAC,YAAa,GACpB,EAED,MAAO,CACL,kBAAmB,EAAa,KAAK,EAAI,EACzC,iBAAkB,EAAY,KAAK,EAAI,EACvC,mBAAoB,EAAc,KAAK,EAAI,EAC3C,mBAAoB,EAAc,KAAK,EAAI,EAC3C,8BAA+B,EAAW,KAAK,EAAI,CACrD,CACF,CAEA,eAAe,EACb,CAAyC,EAEzC,GAAI,CAAC,EAAQ,MAAO,EAAE,CAEtB,GAAM,OAAE,CAAK,KAAE,CAAG,CAAE,CAAG,IAEjB,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,8BACL,MAAM,CACL,sFAYD,EAAE,CAAC,SAAU,CAAC,SAAU,UAAU,EAClC,GAAG,CAAC,YAAa,GACjB,EAAE,CAAC,YAAa,GAChB,KAAK,CAAC,YAAa,CAAE,WAAW,CAAK,GACrC,KAAK,CAAC,WAEP,AAAI,GACA,IADO,IACC,KAAK,CAAC,GACP,EAAE,EAGP,AAAC,GAAS,KAAD,CAAO,OAAO,CAAC,GAKd,EAAe,EALM,IAKA,CACjC,AAAC,GAA2C,CAAE,GAAa,OALpD,EASX,AATa,CAyBjB,SAAS,EAAa,CAAsB,EAC1C,MAXM,EAWA,EAAI,CAAC,GAAW,EAAA,CAAE,CAAE,WAAW,GACjC,EACF,6EAgBF,MAdU,SAAS,CAAf,EACF,GAAW,gDACI,YAAY,CAAlB,EACT,GAAW,4DACI,OAAO,CAAb,EACT,GAAW,yDACF,AAAM,aAAW,AAAM,SAAS,GACzC,GAAW,sDACI,QAAQ,CAAd,EACT,GAAW,4DAEX,GAAW,4CAIX,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAW,aA/Bb,EAAI,CAAC,AAgCM,GAhCK,EAAA,CAAE,CAAE,WAAW,KACxB,UAEb,AAAU,SAAS,CAAf,EAAsB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAW,IACjC,YAAY,CAAlB,EAAyB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAW,IAC7C,OAAO,CAAb,EAAoB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAM,UAAW,IAChC,UAAN,GAAuB,SAAS,CAAf,EAAsB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAW,IACvD,QAAQ,CAAd,EAAqB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAW,IAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAS,UAAW,KAyBxB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,sBAAc,GAAW,QAG/C,CAEA,SAAS,EAAY,CAAqB,EACxC,IAAM,EAAI,AAAC,IAAU,EAAA,CAAE,CAAE,WAAW,GAChC,EACF,mFAEF,AAAI,AAAM,QAAQ,IAChB,GACE,oGAEA,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAW,YACf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAa,UAAU,YAAY,WAMhC,UAAU,CAAhB,GACF,GACE,0FAEA,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAW,YACf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAU,YAAY,aAMjC,WAAN,GAAwB,aAAa,CAAnB,GACpB,GACE,8FAEA,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAW,YACf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,GAAG,CAAA,CAAC,UAAU,YACd,OAKP,GAAa,4CACN,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAW,WAAY,GAAU,YAChD,CAUA,SAAS,EAAW,OAClB,CAAK,OACL,CAAK,QACL,CAAM,MACN,CAAI,CAML,EACC,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8FACd,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,wCACrB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4EACZ,IAEH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iEACV,IAEH,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,6CAAqC,IAClD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qCAA6B,WAKpD,CAIA,SAAS,EAAiB,MAAE,CAAI,CAA2B,EACzD,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,uCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CACT,MAAM,aACN,YAAY,qDAEd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,eACpB,AAAgB,MAAX,MAAM,CACV,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qCAA4B,wCAIzC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,WACJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACR,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,SACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,YACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,SACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,WACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,SACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,sBAAa,yBAK5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACP,EAAK,GAAG,CAAC,AAAC,IACT,IAAM,EACJ,EAAI,OAAO,EAAE,MAAM,EAAG,GAAG,eAAiB,UACtC,EACJ,EAAI,WAAW,EAAE,MAAM,EAAG,GAAG,eAAiB,IAC1C,EAAsB,EAAE,CAK9B,OAJI,EAAI,IAAI,EAAE,EAAU,IAAI,CAAC,EAAI,IAAI,EACjC,EAAI,MAAM,EAAE,EAAU,IAAI,CAAC,EAAI,MAAM,EACrC,EAAI,aAAa,EAAE,EAAU,IAAI,CAAC,EAAI,aAAa,EAGrD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,CAEP,UAAU,yCAEV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACR,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCACZ,EAAI,OAAO,CACV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,OAAO,EAAE,EAAI,OAAO,CAAA,CAAE,CAC7B,UAAU,4DAET,IAGH,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4CACb,IAGL,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,sCAA4B,aAC5B,UAIjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAE,EAAa,EAAI,OAAO,IACpC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,iCACN,MAAZ,EAAI,IAAI,CACP,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,qGAA2F,IACvG,EAAI,IAAI,IAGZ,MAGJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAE,EAAY,EAAI,MAAM,IAClC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACc,IAArB,EAAU,MAAM,CACf,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qCAA4B,MAI5C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCACZ,EAAU,GAAG,CAAC,AAAC,GACd,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAEC,UAAU,oGAET,GAHI,QASf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,gDACnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,EAAW,EAAI,YAAY,IAClC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BACb,EAAQ,EAAI,YAAY,WAvD1B,EAAI,EAAE,CA6DjB,YAOd,CAEA,SAAS,EAAoB,MAAE,CAAI,CAA2B,EAC5D,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,uCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CACT,MAAM,gBACN,YAAY,qCAEd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,eACJ,IAAhB,EAAK,MAAM,CACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iEACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAa,UAAU,YACxB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,yCAGR,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,WACJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACR,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,SACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,SACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,YACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,UACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,sBAAa,gBAK5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACP,EAAK,GAAG,CAAC,AAAC,IACT,IAAM,EACJ,EAAI,OAAO,EAAE,MAAM,EAAG,GAAG,eAAiB,UACtC,EAAY,EAAI,KAAK,EAAI,gBACzB,EACJ,EAAU,MAAM,CAAG,GACf,CAAA,EAAG,EAAU,KAAK,CAAC,EAAG,IAAI,CAAC,CAAC,CAC5B,EAEN,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,CAEP,UAAU,yCAEV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qCACnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,EAAW,EAAI,UAAU,IAChC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BACb,EAAQ,EAAI,UAAU,SAI7B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACP,EAAI,OAAO,CACV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,OAAO,EAAE,EAAI,OAAO,CAAA,CAAE,CAC7B,UAAU,4DAET,IAGH,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4CACb,MAIP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAE,EAAa,EAAI,OAAO,IACpC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,0CAClB,IAEH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,sBAClB,EAAY,EAAI,MAAM,MA9BpB,EAAI,EAAE,CAkCjB,YAOd,CAEA,SAAS,EAAgC,MACvC,CAAI,CAGL,EACC,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,uCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CACT,MAAM,4BACN,YAAY,6CAEd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,eACJ,IAAhB,EAAK,MAAM,CACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8DACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAU,0BACzB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,wDAGR,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,WACJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACR,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,gBACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,YACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,WACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,sBAAa,mBAK5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UACP,EAAK,GAAG,CAAC,AAAC,IACT,IAAM,EACJ,EAAI,cAAc,EAAE,MAAM,EAAG,GAAG,eAAiB,UACnD,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,CAEP,UAAU,yCAEV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,8BAClB,IAEH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAE,EAAa,EAAI,OAAO,IACpC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAE,EAAY,EAAI,MAAM,IAClC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,gDACnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,EAAW,EAAI,SAAS,IAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BACb,EAAQ,EAAI,SAAS,WAZvB,EAAI,EAAE,CAkBjB,YAOd,CAIe,eAAe,IAC5B,IAAM,EAAW,CAAA,EAAA,EAAA,cAAA,AAAc,IAEzB,CAAC,EAAW,EAAc,EAAe,EAAkB,CAC/D,MAAM,QAAQ,GAAG,CAAC,CAChB,EAAc,GACd,EAAiB,GACjB,EAAkB,GAClB,EAAmC,GACpC,EAEG,EAAc,EAAU,MAAM,CAC9B,EAAiB,EAAa,MAAM,CAAG,EAEvC,EAAc,EAChB,mCACA,EAAc,EACd,CAAC,6BAA0B,EAAE,EAAY,QAAQ,CAAC,CAClD,kCAEE,EAAuD,EACzD,cACA,EAAc,EACd,UACA,UAEJ,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBAEb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8DACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iEAAwD,iCAGrE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,qBAGlD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,6GAIrC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qCA5UnB,CAAA,AA6US,EA7UT,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,gIA6UE,CA5Uf,oBA+UC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,CACJ,QAAS,EACT,UAAU,oHAEV,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAW,CAAC,kCAAkC,EAC1B,gBAAlB,EACI,cACkB,YAAlB,EACA,eACA,iBAAA,CACJ,GAEH,QAKL,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACC,MAAM,cACN,MAAO,EAAc,iBAAiB,CACtC,OAAO,oBACP,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,GAAG,CAAA,CAAC,UAAU,+BAEvB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACC,MAAM,OACN,MAAO,EAAc,gBAAgB,CACrC,OAAO,iBACP,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAa,UAAU,+BAEhC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACC,MAAM,SACN,MAAO,EAAc,kBAAkB,CACvC,OAAO,gBACP,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAU,4BAEjC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACC,MAAM,SACN,MAAO,EAAc,kBAAkB,CACvC,OAAO,cACP,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAS,UAAU,6BAE5B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACC,MAAM,gBACN,MAAO,EAAc,6BAA6B,CAClD,OAAO,oBACP,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,UAAU,8BAKnC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sEACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAiB,KAAM,IACxB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAoB,KAAM,OAI7B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAgC,KAAM,MAG7C,qCAzwB0B","ignoreList":[1,2,3,4,5,6]}
./.next/server/chunks/ssr/src_app_leads_[id]_page_tsx_18f8b797._.js:18:    `).eq("lead_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();h&&console.warn("lead_enrichments_v2 error:",h),g&&(f={industry:g.industry??null,sub_industry:g.sub_industry??null,pain_points:g.pain_points??null,objections:g.objections??null,emotional_state:g.emotional_state??null,urgency_score:"number"==typeof g.urgency_score?g.urgency_score:null!=g.urgency_score?Number(g.urgency_score):null,budget_estimate:g.budget_estimate??null,decision_authority_score:"number"==typeof g.decision_authority_score?g.decision_authority_score:null!=g.decision_authority_score?Number(g.decision_authority_score):null,conversion_likelihood:"number"==typeof g.conversion_likelihood?g.conversion_likelihood:null!=g.conversion_likelihood?Number(g.conversion_likelihood):null,recommended_channel:g.recommended_channel??null,recommended_cadence:g.recommended_cadence??null,recommended_persona:g.recommended_persona??null,ai_lead_score:"number"==typeof g.ai_lead_score?g.ai_lead_score:null!=g.ai_lead_score?Number(g.ai_lead_score):null,status:g.status??null,created_at:g.created_at??null,updated_at:g.updated_at??null});let[i,j,k]=await Promise.all([b.from("touch_runs").select("id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta").eq("lead_id",a).order("scheduled_at",{ascending:!1,nullsLast:!0}).order("created_at",{ascending:!1}),b.from("appointments").select("id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at").eq("lead_id",a),b.from("appointments_notifications").select("id, appointment_id, notify_at, status, payload, created_at")]),l=i.data??[],m=j.data??[],n=k.data??[],o=new Map;return m.forEach(a=>o.set(a.id,a)),{lead:e,genome:f,events:[...l.map(a=>{let b=a.scheduled_at??a.created_at,{label:c,description:d}=function(a){let b=a.payload?.source??a.meta?.source??null,c=a.payload?.kind??a.meta?.kind??null,d=a.step??void 0;if("appointment_reminder"===b&&d)return{label:y(c)??"Appointment reminder",description:x(a.payload)};if("appointment_outcome"===b&&d){let b="no_show_followup_15m"===c,d="attended_followup_30m"===c;return{label:b?"No-show follow-up":d?"Attended follow-up":"Appointment outcome follow-up",description:x(a.payload)}}return{label:d?`Cadence touch (step ${d})`:"Cadence touch",description:x(a.payload)}}(a);return{id:`touch-${a.id}`,occurredAt:b??new Date().toISOString(),type:"touch_run",channel:a.channel,step:a.step,label:c,description:d,status:a.status,meta:a.meta??void 0}}),...m.map(a=>{let b=A(a)??new Date().toISOString(),c=z(b),d=c?`Scheduled for ${c}${a.notes?` \xb7 ${a.notes}`:""}`:a.notes??void 0;return{id:`appointment-${a.id}`,occurredAt:b,type:"appointment",channel:a.channel,step:null,label:"Appointment scheduled",description:d,status:a.status,meta:{appointmentId:a.id}}}),...m.filter(a=>!!a.outcome).map(a=>{var b;let c,d=(b=a.outcome,(c=b?.toLowerCase())?"show"===c||"attended"===c?"Appointment attended":"no_show"===c?"Appointment no-show":"Appointment outcome":"Appointment outcome"),e=a.updated_at??A(a)??new Date().toISOString(),f=z(A(a)),g=f?`Outcome for appointment on ${f}`:"Appointment outcome updated";return{id:`appointment-outcome-${a.id}`,occurredAt:e,type:"appointment_outcome",channel:a.channel,step:null,label:d,description:g,status:a.outcome,meta:{appointmentId:a.id}}}),...n.filter(b=>{let c=b.payload?.lead_id??null,d=b.appointment_id?o.get(b.appointment_id)?.lead_id??null:null;return c===a||d===a}).map(a=>{let b=a.appointment_id?o.get(a.appointment_id):void 0,c=a.notify_at??A(b??{})??new Date().toISOString(),d=a.payload?.kind??null,e=y(d)??"Appointment reminder",f=z(A(b??{}));return{id:`appointment-reminder-${a.id}`,occurredAt:c,type:"appointment_reminder",channel:b?.channel??null,step:null,label:e,description:f?`Reminder for appointment on ${f}`:void 0,status:a.status,meta:{appointmentId:a.appointment_id,kind:d}}})].sort((a,b)=>{let c=new Date(a.occurredAt).getTime(),d=new Date(b.occurredAt).getTime(),e=Number.isNaN(c)?0:c;return(Number.isNaN(d)?0:d)-e}),stats:{touches:l.length,appointments:m.length,reminders:n.length}}}function C(){let a=(0,e.useParams)().id,f=(0,c.useMemo)(()=>!0,[]),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,w]=(0,c.useState)([]),[x,y]=(0,c.useState)({touches:0,appointments:0,reminders:0}),[A,C]=(0,c.useState)(!0);(0,c.useEffect)(()=>{if(!f||!a)return;let b=!0;return(async()=>{C(!0);let c=await B(a);b&&(p(c.lead),r(c.genome),w(c.events),y(c.stats),C(!1))})(),()=>{b=!1}},[a,f]);let D=o&&(o.full_name||o.contact_name||o.email||o.phone)||"Sin nombre",E=function(a){if(!a)return"Sin contacto";let b=a.email??"Sin email",c=a.phone??"Sin telÃ©fono";return`${b} \xb7 ${c}`}(o);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(d.default,{href:"/leads",children:(0,b.jsxs)(u.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(g,{size:16}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm uppercase tracking-[0.16em] text-white/50",children:"Lead"}),(0,b.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Lead timeline"}),(0,b.jsx)("p",{className:"text-sm text-white/80",children:D}),(0,b.jsxs)("p",{className:"text-xs text-white/60",children:[E," Â· ID: ",a]})]})]}),o?.state?(0,b.jsx)(m.Badge,{variant:"outline",className:"capitalize",children:o.state}):null]}),(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{title:"Lead overview",description:"Basic details and last touch information"}),(0,b.jsxs)(n.CardContent,{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-white",children:[(0,b.jsx)(l,{size:16,className:"text-white/60"}),(0,b.jsx)("span",{className:"font-semibold",children:D})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,b.jsx)(i.Mail,{size:14,className:"text-white/50"}),(0,b.jsx)("span",{children:o?.email??"Sin email"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,b.jsx)(k.PhoneCall,{size:14,className:"text-white/50"}),(0,b.jsx)("span",{children:o?.phone??"Sin telÃ©fono"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,b.jsx)(h,{size:14,className:"text-white/50"}),(0,b.jsx)("span",{children:o?.company_name??"Sin compaÃ±Ã­a"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,b.jsx)(j,{size:14,className:"text-white/50"}),(0,b.jsx)("span",{children:o?.channel_last??"Sin canal"})]})]}),(0,b.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80",children:[(0,b.jsx)("p",{className:"text-sm text-white/60",children:"Last touch"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-white",children:z(o?.last_touch_at??null)??"No touches yet"}),(0,b.jsxs)("p",{className:"text-sm text-white/60",children:["Channel: ",o?.channel_last??"â€”"]}),(0,b.jsxs)("p",{className:"text-sm text-white/60",children:["Campaign:"," ",o?.campaign_name??o?.campaign_id??"â€”"]})]})]})]}),q&&(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{title:"Lead Genome",description:"Industry, pains, objections and AI recommendations for this lead"}),(0,b.jsxs)(n.CardContent,{className:"grid gap-4 md:grid-cols-2 text-sm text-white/80",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Industry:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.industry??"Unknown"})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Sub-industry:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.sub_industry??"â€”"})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Recommended channel:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.recommended_channel??"â€”"})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Persona:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.recommended_persona??"â€”"})]}),"number"==typeof q.ai_lead_score&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"AI Lead score:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.ai_lead_score})]}),"number"==typeof q.urgency_score&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Urgency:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.urgency_score})]}),"number"==typeof q.decision_authority_score&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Decision authority:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.decision_authority_score})]}),"number"==typeof q.conversion_likelihood&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"text-white/50",children:"Conversion likelihood:"})," ",(0,b.jsx)("span",{className:"text-white",children:q.conversion_likelihood})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[Array.isArray(q.pain_points)&&q.pain_points.length>0&&(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Pain points"}),(0,b.jsx)("ul",{className:"space-y-1 list-disc pl-4 text-xs text-white/80",children:q.pain_points.map((a,c)=>(0,b.jsx)("li",{children:a},c))})]}),Array.isArray(q.objections)&&q.objections.length>0&&(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Objections"}),(0,b.jsx)("ul",{className:"space-y-1 list-disc pl-4 text-xs text-white/80",children:q.objections.map((a,c)=>(0,b.jsx)("li",{children:a},c))})]})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsx)(v.StatCard,{label:"Total activity",value:s.length.toString(),helper:"Touches, appointments and reminders"}),(0,b.jsx)(v.StatCard,{label:"Touch runs",value:x.touches.toString(),helper:"touch_runs registrados"}),(0,b.jsx)(v.StatCard,{label:"Appointments",value:x.appointments.toString(),helper:"Incluye outcomes y reminders"})]}),(0,b.jsx)(t,{events:s}),A?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"h-10 animate-pulse rounded-xl bg-white/5"}),(0,b.jsx)("div",{className:"h-52 animate-pulse rounded-2xl bg-white/5"}),(0,b.jsx)("div",{className:"h-32 animate-pulse rounded-2xl bg-white/5"})]}):null]})}a.s(["default",()=>C],33832)}];
./.next/static/chunks/a4da70ef4d5e846b.js:1:(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},90092,e=>{"use strict";let t=(0,e.i(75254).default)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);e.s(["RefreshCcw",()=>t],90092)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},3156,e=>{"use strict";var t=e.i(43476);function a(...e){return e.filter(Boolean).join(" ")}function s({channel:e}){if(!e)return(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-[11px] font-medium text-white/60",children:"Unknown"});let a=e.toLowerCase(),s=e;return["voice","call","phone"].includes(a)&&(s="Voice"),"email"===a&&(s="Email"),["sms","text"].includes(a)&&(s="SMS"),"whatsapp"===a&&(s="WhatsApp"),["zoom","video"].includes(a)&&(s="Zoom"),(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-[11px] font-medium text-white/80",children:s})}function l({intent:e}){let s=e?.toLowerCase()??"",l="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium";return s?["interested","hot","warm","interest"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30"),children:"Interested"}):["not_interested","cold","disinterest"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-rose-500/10 text-rose-300 border border-rose-500/30"),children:"Not interested"}):["callback","follow_up","followup"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-amber-500/15 text-amber-300 border border-amber-500/30"),children:"Call back"}):["no_answer","ringing"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-slate-500/20 text-slate-200 border border-slate-500/40"),children:"No answer"}):["voicemail","vm"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-indigo-500/15 text-indigo-200 border border-indigo-500/30"),children:"Voicemail"}):"appointment"===s?(0,t.jsx)("span",{className:a(l,"bg-emerald-500/15 text-emerald-200 border border-emerald-500/30"),children:"Appointment"}):"unknown"===s?(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/60"),children:"Unknown"}):(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/80"),children:e}):(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/60"),children:"No intent"})}function r({state:e}){let s=e?.toLowerCase()??"",l="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium";return s?["new","imported"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-sky-500/15 text-sky-200 border border-sky-500/30"),children:"New"}):["enriched"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-violet-500/15 text-violet-200 border border-violet-500/30"),children:"Enriched"}):["in_campaign","in_cadence","attempting"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-amber-500/15 text-amber-200 border border-amber-500/30"),children:"In campaign"}):["active","engaged","qualified"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-emerald-500/15 text-emerald-200 border border-emerald-500/30"),children:"Active"}):["won","customer","booked"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-lime-500/20 text-lime-100 border border-lime-500/40"),children:"Won"}):["lost"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-rose-500/15 text-rose-100 border border-rose-500/40"),children:"Lost"}):["dead"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-slate-600/50 text-slate-200 border border-slate-600"),children:"Dead"}):["do_not_contact","dnc"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-red-800/60 text-red-100 border border-red-700"),children:"Do not contact"}):["unqualified"].includes(s)?(0,t.jsx)("span",{className:a(l,"bg-white/5 text-white/50 border border-white/15"),children:"Unqualified"}):(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/80"),children:e}):(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/60"),children:"No state"})}function n({status:e}){let s=e?.toLowerCase()??"",l="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium";return s?"scheduled"===s?(0,t.jsx)("span",{className:a(l,"bg-emerald-500/15 text-emerald-100 border border-emerald-500/30"),children:"Scheduled"}):"completed"===s?(0,t.jsx)("span",{className:a(l,"bg-sky-500/15 text-sky-100 border border-sky-500/30"),children:"Completed"}):"cancelled"===s?(0,t.jsx)("span",{className:a(l,"bg-amber-500/15 text-amber-100 border border-amber-500/30"),children:"Cancelled"}):"no_show"===s?(0,t.jsx)("span",{className:a(l,"bg-rose-500/15 text-rose-100 border border-rose-500/30"),children:"No show"}):(0,t.jsx)("span",{className:a(l,"border border-white/10 bg-white/5 text-white/80"),children:e}):null}e.s(["AppointmentStatusBadge",()=>n,"ChannelBadge",()=>s,"IntentBadge",()=>l,"LeadStateBadge",()=>r])},9291,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(21218),l=e.i(87130),r=e.i(31278),n=e.i(90092),i=e.i(37727),d=e.i(18724),c=e.i(3156);e.i(75982);var o=e.i(11518),x=e.i(76033),h=e.i(2634),m=e.i(66445),p=e.i(8413),u=e.i(80794),b=e.i(7471);let w=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});function j(){let e=(0,a.useMemo)(()=>!0,[]),[s,j]=(0,a.useState)([]),[N,v]=(0,a.useState)({}),[_,C]=(0,a.useState)([]),[y,k]=(0,a.useState)([]),[S,A]=(0,a.useState)([]),[T,B]=(0,a.useState)({}),[L,U]=(0,a.useState)("all"),[M,I]=(0,a.useState)("all"),[D,E]=(0,a.useState)("all"),[H,z]=(0,a.useState)("all"),[P,R]=(0,a.useState)(""),[$,F]=(0,a.useState)(!0),[q,V]=(0,a.useState)(null),[O,W]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=!0;return async function(){if(!e){V("Supabase is not configured. Add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to load data."),F(!1);return}F(!0),V(null);let a=(0,b.supabaseBrowser)(),{data:s,error:l}=await a.from("voice_insights_calls_v1").select("id, lead_id, touch_run_id, status, provider, provider_call_id, to_phone, meta, updated_at").order("updated_at",{ascending:!1}).limit(100);if(!t)return;if(l){console.error(l),V("Unable to fetch voice calls."),F(!1);return}let r=s??[];j(r);let n=Array.from(new Set(r.map(e=>e.lead_id)));if(0===n.length){v({}),C([]),k([]),A([]),B({}),F(!1);return}let[i,d,c,o,x]=await Promise.all([a.from("leads").select("id, contact_name, company, phone, state, email").in("id",n),a.from("lead_events").select("id, lead_id, event_type, payload, created_at").in("event_type",["voice_completed","voice_failed","appointment_created"]).order("created_at",{ascending:!1}).limit(200),a.from("appointments").select("id, lead_id, scheduled_for, status").in("lead_id",n),a.from("touch_runs").select("id, lead_id, status, error, campaign_id").in("lead_id",n),a.from("campaigns").select("id, name").limit(500)]);if(!t)return;i.error&&(console.error(i.error),V(`Unable to fetch leads for voice calls. DB says: ${i.error.message}`)),d.error&&console.error(d.error),c.error&&console.error(c.error),o.error&&console.error(o.error),x.error&&console.error(x.error);let h=(i.data??[]).reduce((e,t)=>(e[t.id]=t,e),{}),m=(x.data??[]).reduce((e,t)=>(e[t.id]=t,e),{});v(h),C(d.data??[]),k(c.data??[]),A(o.data??[]),B(m),F(!1)}(),()=>{t=!1}},[e]);let K=(0,a.useMemo)(()=>{let e=new Date;return y.reduce((t,a)=>("scheduled"===a.status&&new Date(a.scheduled_for)>=e&&(t[a.lead_id]=a),t),{})},[y]),X=(0,a.useMemo)(()=>{let e={};return S.forEach(t=>{"stopped"===t.status&&"appointment_created"===t.error&&(e[t.lead_id]=!0)}),e},[S]),J=(0,a.useMemo)(()=>{let e={};return S.forEach(t=>{t.campaign_id&&!e[t.lead_id]&&(e[t.lead_id]=t.campaign_id)}),e},[S]),Y=(0,a.useMemo)(()=>s.map(e=>{let t=e.meta?.voice_webhook??null,a=t?.transcript??e.meta?.transcript??"",s=_.find(t=>t.lead_id===e.lead_id&&t.event_type.startsWith("voice_")),l=s?.payload?.intent,r=e.meta?.intent??"unknown",n=(l??r??"unknown").toLowerCase(),i=J[e.lead_id]??null,d=i&&T[i]?T[i].name??"Untitled":null;return{...e,transcript:a,intent:n,hasAppointment:!!K[e.lead_id],cadenceStopped:!!X[e.lead_id],campaign_id:i,campaign_name:d}}),[K,X,J,T,s,_]),Z=(0,a.useMemo)(()=>{let e=new Set;return Y.forEach(t=>{t.campaign_id&&e.add(t.campaign_id)}),Array.from(e)},[Y]),G=(0,a.useMemo)(()=>Y.filter(e=>{if("all"!==L&&e.intent!==L||"yes"===M&&!e.hasAppointment||"no"===M&&e.hasAppointment||"stopped"===D&&!e.cadenceStopped||"active"===D&&e.cadenceStopped||"all"!==H&&e.campaign_id!==H)return!1;if(P){let t=N[e.lead_id];if(!`${t?.contact_name??""} ${t?.company??""} ${t?.email??""} ${t?.phone??""}`.toLowerCase().includes(P.toLowerCase()))return!1}return!0}),[M,H,Y,D,L,N,P]),Q=(0,a.useMemo)(()=>G.find(e=>e.id===O)??null,[G,O]),ee=Q?N[Q.lead_id]??null:null,et=Q?K[Q.lead_id]??null:null,ea=(0,a.useMemo)(()=>{if(0===Y.length)return{total:0,withAppointment:0,interested:0,failed:0,last7d:0};let e=Date.now(),t=0,a=0,s=0,l=0;return Y.forEach(r=>{r.hasAppointment&&(t+=1),"appointment"===r.intent&&(a+=1),r.status&&"failed"===r.status.toLowerCase()&&(s+=1);let n=new Date(r.updated_at).getTime();!Number.isNaN(n)&&e-n<=6048e5&&(l+=1)}),{total:Y.length,withAppointment:t,interested:a,failed:s,last7d:l}},[Y]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Voice Â· Calls & intents"}),(0,t.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Voice Insights"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Latest 100 calls with transcript previews, intent signals, campaign and appointment status."})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>{U("all"),I("all"),E("all"),z("all"),R("")},className:"gap-2",children:[(0,t.jsx)(n.RefreshCcw,{size:16}),"Reset view"]})})]}),(0,t.jsx)(h.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,t.jsxs)(h.CardContent,{className:"grid gap-4 p-4 sm:grid-cols-5",children:[(0,t.jsx)(f,{label:"Total calls",value:ea.total,helper:"Last 100 records"}),(0,t.jsx)(f,{label:"Interested",value:ea.interested,helper:"Intent = appointment"}),(0,t.jsx)(f,{label:"With appointment",value:ea.withAppointment,helper:"Upcoming scheduled"}),(0,t.jsx)(f,{label:"Failed",value:ea.failed,helper:"Status = failed"}),(0,t.jsx)(f,{label:"Calls last 7 days",value:ea.last7d,helper:"Based on updated_at"})]})}),(0,t.jsx)(h.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,t.jsxs)(h.CardContent,{className:"space-y-4 pt-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-medium uppercase tracking-[0.14em] text-white/70",children:[(0,t.jsx)(l.Filter,{size:14}),(0,t.jsx)("span",{children:"Filters"})]}),(0,t.jsxs)(p.Select,{value:L,onChange:e=>U(e.target.value),className:"w-44",children:[(0,t.jsx)("option",{value:"all",children:"All intents"}),(0,t.jsx)("option",{value:"appointment",children:"Appointment"}),(0,t.jsx)("option",{value:"unknown",children:"Unknown"})]}),(0,t.jsxs)(p.Select,{value:M,onChange:e=>I(e.target.value),className:"w-48",children:[(0,t.jsx)("option",{value:"all",children:"Appointment?"}),(0,t.jsx)("option",{value:"yes",children:"Has upcoming"}),(0,t.jsx)("option",{value:"no",children:"No appointment"})]}),(0,t.jsxs)(p.Select,{value:D,onChange:e=>E(e.target.value),className:"w-40",children:[(0,t.jsx)("option",{value:"all",children:"Cadence"}),(0,t.jsx)("option",{value:"stopped",children:"Stopped"}),(0,t.jsx)("option",{value:"active",children:"Active"})]}),(0,t.jsxs)(p.Select,{value:H,onChange:e=>z(e.target.value),className:"w-56",children:[(0,t.jsx)("option",{value:"all",children:"All campaigns"}),Z.map(e=>(0,t.jsx)("option",{value:e,children:T[e]?.name??e},e))]}),(0,t.jsx)(m.Input,{placeholder:"Search lead / company / email / phone",value:P,onChange:e=>R(e.target.value),className:"w-72"})]}),q?(0,t.jsx)("div",{className:"rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100",children:q}):null,$?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[(0,t.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading voice callsâ€¦"]}):(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-white/50",children:[(0,t.jsxs)("span",{className:"rounded-full border border-white/10 bg-white/5 px-2 py-1",children:[G.length," calls visible"]}),(0,t.jsxs)("span",{className:"rounded-full border border-white/5 bg-white/5/10 px-2 py-1",children:["Raw: ",s.length]})]})]})}),(0,t.jsx)(h.Card,{className:"border-white/10 bg-black/40 backdrop-blur-sm",children:(0,t.jsxs)(h.CardContent,{className:"pt-4",children:[$||0!==G.length?null:(0,t.jsx)("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-sm text-white/70",children:"No calls match the selected filters."}),!$&&G.length>0?(0,t.jsx)("div",{className:"overflow-auto rounded-2xl border border-white/10",children:(0,t.jsxs)(u.Table,{children:[(0,t.jsx)(u.TableHead,{children:(0,t.jsxs)(u.TableRow,{className:"bg-white/5",children:[(0,t.jsx)(u.TableHeaderCell,{children:"Lead"}),(0,t.jsx)(u.TableHeaderCell,{children:"Campaign"}),(0,t.jsx)(u.TableHeaderCell,{children:"Phone"}),(0,t.jsx)(u.TableHeaderCell,{children:"Status"}),(0,t.jsx)(u.TableHeaderCell,{children:"Transcript"}),(0,t.jsx)(u.TableHeaderCell,{children:"Intent"}),(0,t.jsx)(u.TableHeaderCell,{children:"Appointment"}),(0,t.jsx)(u.TableHeaderCell,{children:"Cadence"}),(0,t.jsx)(u.TableHeaderCell,{children:"Updated"})]})}),(0,t.jsx)(u.TableBody,{children:G.map(e=>{let a=N[e.lead_id],s=e.transcript,l=s?`${s.slice(0,140)}${s.length>140?"â€¦":""}`:"â€”",r=new Date(e.updated_at),n=K[e.lead_id],i=a?.contact_name||a?.company||a?.phone||a?.email||"Unknown lead",d=e.campaign_name??"â€”";return(0,t.jsxs)(u.TableRow,{className:"cursor-pointer border-t border-white/5 bg-black/40 transition hover:bg-white/5",onClick:()=>W(e.id),children:[(0,t.jsx)(u.TableCell,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("a",{href:`/leads/${e.lead_id}`,className:"font-semibold text-emerald-200 hover:text-emerald-100",onClick:e=>e.stopPropagation(),children:i}),(0,t.jsx)(c.LeadStateBadge,{state:a?.state})]})}),(0,t.jsx)(u.TableCell,{className:"text-sm text-white/80",children:d}),(0,t.jsx)(u.TableCell,{className:"text-sm text-white/80",children:a?.phone??e.to_phone??"â€”"}),(0,t.jsx)(u.TableCell,{children:(0,t.jsx)(o.Badge,{variant:"outline",className:"border-white/15 bg-white/5 text-xs text-white/80 capitalize",children:e.status??"â€”"})}),(0,t.jsx)(u.TableCell,{className:"max-w-md text-sm text-white/80",children:l}),(0,t.jsx)(u.TableCell,{children:(0,t.jsx)(c.IntentBadge,{intent:e.intent})}),(0,t.jsx)(u.TableCell,{children:e.hasAppointment?(0,t.jsxs)(o.Badge,{variant:"outline",className:"gap-2 border-emerald-400/50 bg-emerald-500/10 text-xs text-emerald-100",children:[(0,t.jsx)(g,{}),"Upcoming",(0,t.jsx)("span",{className:"text-[11px] text-white/60",children:n?w.format(new Date(n.scheduled_for)):null})]}):(0,t.jsx)(o.Badge,{variant:"outline",className:"border-white/15 bg-white/5 text-xs text-white/70",children:"No appointment"})}),(0,t.jsx)(u.TableCell,{children:e.cadenceStopped?(0,t.jsx)(o.Badge,{variant:"outline",className:"border-amber-400/60 bg-amber-500/10 text-xs text-amber-100",children:"Cadence stopped"}):(0,t.jsx)(o.Badge,{variant:"outline",className:"border-emerald-400/60 bg-emerald-500/10 text-xs text-emerald-100",children:"Active"})}),(0,t.jsx)(u.TableCell,{className:"whitespace-nowrap text-sm text-white/70",children:w.format(r)})]},e.id)})})]})}):null,$?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-8 text-sm text-white/60",children:[(0,t.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading voice callsâ€¦"]}):null]})})]}),Q&&(0,t.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,t.jsx)("button",{className:"h-full flex-1 bg-black/60 backdrop-blur-sm",onClick:()=>W(null),"aria-label":"Close call details"}),(0,t.jsxs)("div",{className:"h-full w-full max-w-md border-l border-white/10 bg-[#020617] p-5 shadow-[0_0_60px_rgba(15,23,42,0.9)]",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Voice call"}),(0,t.jsxs)("h2",{className:"flex items-center gap-2 text-xl font-semibold text-white",children:[(0,t.jsx)(d.PhoneCall,{className:"h-4 w-4 text-emerald-300"}),ee?.contact_name??ee?.company??ee?.phone??ee?.email??"Unknown lead"]}),ee&&(0,t.jsxs)("p",{className:"text-xs text-white/50",children:[ee.email??"no-email"," Â·"," ",ee.phone??"no-phone"]})]}),(0,t.jsx)("button",{className:"rounded-full border border-white/20 bg-white/10 p-1 text-white/70 hover:bg-white/20",onClick:()=>W(null),children:(0,t.jsx)(i.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(o.Badge,{className:"border-white/20 bg-white/10 text-xs text-white/80",children:Q.provider??"provider-unknown"}),(0,t.jsx)(o.Badge,{className:"border-white/20 bg-white/10 text-xs text-white/80 capitalize",children:Q.status??"status-unknown"}),(0,t.jsx)(c.IntentBadge,{intent:Q.intent}),Q.hasAppointment&&(0,t.jsx)(o.Badge,{className:"border-emerald-400/60 bg-emerald-500/15 text-xs text-emerald-100",children:"Appointment scheduled"}),Q.cadenceStopped&&(0,t.jsx)(o.Badge,{className:"border-amber-400/60 bg-amber-500/15 text-xs text-amber-100",children:"Cadence stopped"})]}),(0,t.jsx)(h.Card,{className:"border-white/10 bg-white/5",children:(0,t.jsxs)(h.CardContent,{className:"space-y-1 p-4 text-xs text-white/70",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-white/50",children:"To"}),(0,t.jsx)("span",{children:Q.to_phone??"â€”"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-white/50",children:"Updated"}),(0,t.jsx)("span",{children:w.format(new Date(Q.updated_at))})]}),et&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-white/50",children:"Appointment"}),(0,t.jsx)("span",{children:w.format(new Date(et.scheduled_for))})]})]})}),(0,t.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-slate-900/80 p-4",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Transcript"}),Q.transcript?(0,t.jsx)("p",{className:"max-h-64 overflow-y-auto whitespace-pre-wrap text-sm text-white/80",children:Q.transcript}):(0,t.jsx)("p",{className:"text-xs text-white/60",children:"No transcript available for this call."})]}),Q.meta&&(0,t.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-black/60 p-4",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Raw meta"}),(0,t.jsx)("pre",{className:"max-h-40 overflow-y-auto text-[11px] text-white/70",children:JSON.stringify(Q.meta,null,2)})]})]})]})]})]})}function g(){return(0,t.jsx)(s.Activity,{size:14})}function f({label:e,value:a,helper:s}){return(0,t.jsxs)("div",{className:"space-y-1 rounded-2xl border border-white/10 bg-white/5 p-3",children:[(0,t.jsx)("p",{className:"text-[11px] uppercase tracking-[0.16em] text-white/50",children:e}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-white",children:a}),(0,t.jsx)("p",{className:"text-[11px] text-white/50",children:s})]})}e.s(["default",()=>j])}]);
./.next/static/chunks/b99043a9c62b396c.js:1:(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16715,e=>{"use strict";let t=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],16715)},20342,e=>{"use strict";e.i(47167);var t=e.i(43476),a=e.i(71645),s=e.i(16715),r=e.i(75254);let l=(0,r.default)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),i=(0,r.default)("signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]);var d=e.i(7471);e.i(75982);var c=e.i(76033),n=e.i(2634),o=e.i(57268);function h(){let e=(0,a.useMemo)(()=>(0,d.supabaseBrowser)(),[]),[r,h]=(0,a.useState)([]),[u,x]=(0,a.useState)(!0),[m,p]=(0,a.useState)({success:0,failed:0}),[j,f]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),w=(0,a.useCallback)(async()=>{if(!e)return void x(!1);x(!0);let t=new Date(Date.now()-864e5).toISOString(),[a,s]=await Promise.all([e.from("job_runs").select("id, job_name, status, created_at, duration_ms").order("created_at",{ascending:!1}).limit(20),e.from("touch_runs").select("id, status, created_at").order("created_at",{ascending:!1}).limit(1)]);if(a.error)console.warn("Failed to load job_runs",a.error),h([]),p({success:0,failed:0}),b(null);else{let e=(a.data??[]).filter(e=>(e.created_at??"")>=t),s=e.filter(e=>"succeeded"===(e.status??"").toLowerCase()).length,r=e.filter(e=>"failed"===(e.status??"").toLowerCase()).length;h(a.data??[]),p({success:s,failed:r}),b(a.data?.[0]??null)}s.error?(console.warn("Failed to load touch_runs",s.error),f(null)):f(s.data?.[0]??null),x(!1)},[e]);return(0,a.useEffect)(()=>{w()},[w]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/50",children:"Systems"}),(0,t.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Health"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Heartbeat across cadences, enrichers, and dispatchers."})]}),(0,t.jsxs)(c.Button,{variant:"ghost",size:"sm",className:"gap-2",onClick:w,"aria-label":"Refresh health",children:[(0,t.jsx)(s.RefreshCw,{size:16}),"Refresh"]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsx)(o.StatCard,{label:"Jobs",value:`${m.success} succeeded / ${m.failed} failed`,helper:"job_runs last 24h",delta:e?"Live":"Offline"}),(0,t.jsx)(o.StatCard,{label:"Dispatch",value:j?`${j.status??"pending"}`:e?"No dispatch runs":"Supabase env missing",helper:j?.created_at?new Date(j.created_at).toLocaleString():"Watching cadence triggers",delta:j?"Latest":"Idle"}),(0,t.jsx)(o.StatCard,{label:"Run cadence",value:g?g.status??"pending":"No runs",helper:g?.created_at?new Date(g.created_at).toLocaleString():"Cron via SQL",delta:g?"Latest":"Idle"})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{title:"Recent checks",description:"Edge functions and workers reporting back from Supabase",action:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[(0,t.jsx)(i,{size:16}),u?"Loading":`${r.length} pings`]})}),(0,t.jsx)(n.CardContent,{className:"space-y-3",children:u?(0,t.jsx)("div",{className:"space-y-2",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-12 animate-pulse rounded-xl bg-white/5"},e))}):0===r.length?(0,t.jsxs)("div",{className:"rounded-2xl border border-dashed border-emerald-400/40 bg-white/5 px-5 py-6 text-center",children:[(0,t.jsx)("p",{className:"text-lg font-semibold text-white",children:"No health signals yet"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"We will surface job_runs as they arrive."})]}):(0,t.jsx)("div",{className:"grid gap-2",children:r.map(e=>{let a=(e.status??"").toLowerCase(),s="succeeded"===a||"success"===a;return(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-4 py-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-semibold text-white",children:e.job_name??"Unknown job"}),(0,t.jsx)("p",{className:"text-xs text-white/50",children:new Date(e.created_at??"").toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white/80",children:[(0,t.jsx)(l,{size:16,className:s?"text-emerald-300":"text-amber-300"}),(0,t.jsx)("span",{className:s?"text-emerald-200":"text-amber-200",children:a||"pending"}),"number"==typeof e.duration_ms&&(0,t.jsxs)("span",{className:"text-xs text-white/50",children:[Math.round(e.duration_ms)," ms"]})]})]},e.id)})})})]})]})}e.s(["default",()=>h],20342)}]);
./.next/static/chunks/9262556c7fd81c40.js:18:    `).eq("lead_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();r&&console.warn("lead_enrichments_v2 error:",r),l&&(i={industry:l.industry??null,sub_industry:l.sub_industry??null,pain_points:l.pain_points??null,objections:l.objections??null,emotional_state:l.emotional_state??null,urgency_score:"number"==typeof l.urgency_score?l.urgency_score:null!=l.urgency_score?Number(l.urgency_score):null,budget_estimate:l.budget_estimate??null,decision_authority_score:"number"==typeof l.decision_authority_score?l.decision_authority_score:null!=l.decision_authority_score?Number(l.decision_authority_score):null,conversion_likelihood:"number"==typeof l.conversion_likelihood?l.conversion_likelihood:null!=l.conversion_likelihood?Number(l.conversion_likelihood):null,recommended_channel:l.recommended_channel??null,recommended_cadence:l.recommended_cadence??null,recommended_persona:l.recommended_persona??null,ai_lead_score:"number"==typeof l.ai_lead_score?l.ai_lead_score:null!=l.ai_lead_score?Number(l.ai_lead_score):null,status:l.status??null,created_at:l.created_at??null,updated_at:l.updated_at??null});let[c,d,o]=await Promise.all([t.from("touch_runs").select("id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta").eq("lead_id",e).order("scheduled_at",{ascending:!1,nullsLast:!0}).order("created_at",{ascending:!1}),t.from("appointments").select("id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at").eq("lead_id",e),t.from("appointments_notifications").select("id, appointment_id, notify_at, status, payload, created_at")]),m=c.data??[],p=d.data??[],u=o.data??[],h=new Map;return p.forEach(e=>h.set(e.id,e)),{lead:s,genome:i,events:[...m.map(e=>{let t=e.scheduled_at??e.created_at,{label:n,description:a}=function(e){let t=e.payload?.source??e.meta?.source??null,n=e.payload?.kind??e.meta?.kind??null,a=e.step??void 0;if("appointment_reminder"===t&&a)return{label:b(n)??"Appointment reminder",description:v(e.payload)};if("appointment_outcome"===t&&a){let t="no_show_followup_15m"===n,a="attended_followup_30m"===n;return{label:t?"No-show follow-up":a?"Attended follow-up":"Appointment outcome follow-up",description:v(e.payload)}}return{label:a?`Cadence touch (step ${a})`:"Cadence touch",description:v(e.payload)}}(e);return{id:`touch-${e.id}`,occurredAt:t??new Date().toISOString(),type:"touch_run",channel:e.channel,step:e.step,label:n,description:a,status:e.status,meta:e.meta??void 0}}),...p.map(e=>{let t=S(e)??new Date().toISOString(),n=k(t),a=n?`Scheduled for ${n}${e.notes?` \xb7 ${e.notes}`:""}`:e.notes??void 0;return{id:`appointment-${e.id}`,occurredAt:t,type:"appointment",channel:e.channel,step:null,label:"Appointment scheduled",description:a,status:e.status,meta:{appointmentId:e.id}}}),...p.filter(e=>!!e.outcome).map(e=>{var t;let n,a=(t=e.outcome,(n=t?.toLowerCase())?"show"===n||"attended"===n?"Appointment attended":"no_show"===n?"Appointment no-show":"Appointment outcome":"Appointment outcome"),s=e.updated_at??S(e)??new Date().toISOString(),i=k(S(e)),l=i?`Outcome for appointment on ${i}`:"Appointment outcome updated";return{id:`appointment-outcome-${e.id}`,occurredAt:s,type:"appointment_outcome",channel:e.channel,step:null,label:a,description:l,status:e.outcome,meta:{appointmentId:e.id}}}),...u.filter(t=>{let n=t.payload?.lead_id??null,a=t.appointment_id?h.get(t.appointment_id)?.lead_id??null:null;return n===e||a===e}).map(e=>{let t=e.appointment_id?h.get(e.appointment_id):void 0,n=e.notify_at??S(t??{})??new Date().toISOString(),a=e.payload?.kind??null,s=b(a)??"Appointment reminder",i=k(S(t??{}));return{id:`appointment-reminder-${e.id}`,occurredAt:n,type:"appointment_reminder",channel:t?.channel??null,step:null,label:s,description:i?`Reminder for appointment on ${i}`:void 0,status:e.status,meta:{appointmentId:e.appointment_id,kind:a}}})].sort((e,t)=>{let n=new Date(e.occurredAt).getTime(),a=new Date(t.occurredAt).getTime(),s=Number.isNaN(n)?0:n;return(Number.isNaN(a)?0:a)-s}),stats:{touches:m.length,appointments:p.length,reminders:u.length}}}function C(){let e=(0,s.useParams)().id,i=(0,n.useMemo)(()=>!0,[]),[h,x]=(0,n.useState)(null),[_,y]=(0,n.useState)(null),[f,N]=(0,n.useState)([]),[v,b]=(0,n.useState)({touches:0,appointments:0,reminders:0}),[S,C]=(0,n.useState)(!0);(0,n.useEffect)(()=>{if(!i||!e)return;let t=!0;return(async()=>{C(!0);let n=await A(e);t&&(x(n.lead),y(n.genome),N(n.events),b(n.stats),C(!1))})(),()=>{t=!1}},[e,i]);let z=h&&(h.full_name||h.contact_name||h.email||h.phone)||"Sin nombre",M=function(e){if(!e)return"Sin contacto";let t=e.email??"Sin email",n=e.phone??"Sin telÃ©fono";return`${t} \xb7 ${n}`}(h);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(a.default,{href:"/leads",children:(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(l,{size:16}),"Back"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm uppercase tracking-[0.16em] text-white/50",children:"Lead"}),(0,t.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Lead timeline"}),(0,t.jsx)("p",{className:"text-sm text-white/80",children:z}),(0,t.jsxs)("p",{className:"text-xs text-white/60",children:[M," Â· ID: ",e]})]})]}),h?.state?(0,t.jsx)(p.Badge,{variant:"outline",className:"capitalize",children:h.state}):null]}),(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{title:"Lead overview",description:"Basic details and last touch information"}),(0,t.jsxs)(u.CardContent,{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(m,{size:16,className:"text-white/60"}),(0,t.jsx)("span",{className:"font-semibold",children:z})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,t.jsx)(c.Mail,{size:14,className:"text-white/50"}),(0,t.jsx)("span",{children:h?.email??"Sin email"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,t.jsx)(o.PhoneCall,{size:14,className:"text-white/50"}),(0,t.jsx)("span",{children:h?.phone??"Sin telÃ©fono"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,t.jsx)(r,{size:14,className:"text-white/50"}),(0,t.jsx)("span",{children:h?.company_name??"Sin compaÃ±Ã­a"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-white/80",children:[(0,t.jsx)(d,{size:14,className:"text-white/50"}),(0,t.jsx)("span",{children:h?.channel_last??"Sin canal"})]})]}),(0,t.jsxs)("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Last touch"}),(0,t.jsx)("p",{className:"text-lg font-semibold text-white",children:k(h?.last_touch_at??null)??"No touches yet"}),(0,t.jsxs)("p",{className:"text-sm text-white/60",children:["Channel: ",h?.channel_last??"â€”"]}),(0,t.jsxs)("p",{className:"text-sm text-white/60",children:["Campaign:"," ",h?.campaign_name??h?.campaign_id??"â€”"]})]})]})]}),_&&(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{title:"Lead Genome",description:"Industry, pains, objections and AI recommendations for this lead"}),(0,t.jsxs)(u.CardContent,{className:"grid gap-4 md:grid-cols-2 text-sm text-white/80",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Industry:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.industry??"Unknown"})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Sub-industry:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.sub_industry??"â€”"})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Recommended channel:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.recommended_channel??"â€”"})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Persona:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.recommended_persona??"â€”"})]}),"number"==typeof _.ai_lead_score&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"AI Lead score:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.ai_lead_score})]}),"number"==typeof _.urgency_score&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Urgency:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.urgency_score})]}),"number"==typeof _.decision_authority_score&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Decision authority:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.decision_authority_score})]}),"number"==typeof _.conversion_likelihood&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-white/50",children:"Conversion likelihood:"})," ",(0,t.jsx)("span",{className:"text-white",children:_.conversion_likelihood})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[Array.isArray(_.pain_points)&&_.pain_points.length>0&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Pain points"}),(0,t.jsx)("ul",{className:"space-y-1 list-disc pl-4 text-xs text-white/80",children:_.pain_points.map((e,n)=>(0,t.jsx)("li",{children:e},n))})]}),Array.isArray(_.objections)&&_.objections.length>0&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.16em] text-white/40",children:"Objections"}),(0,t.jsx)("ul",{className:"space-y-1 list-disc pl-4 text-xs text-white/80",children:_.objections.map((e,n)=>(0,t.jsx)("li",{children:e},n))})]})]})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsx)(w.StatCard,{label:"Total activity",value:f.length.toString(),helper:"Touches, appointments and reminders"}),(0,t.jsx)(w.StatCard,{label:"Touch runs",value:v.touches.toString(),helper:"touch_runs registrados"}),(0,t.jsx)(w.StatCard,{label:"Appointments",value:v.appointments.toString(),helper:"Incluye outcomes y reminders"})]}),(0,t.jsx)(j,{events:f}),S?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-10 animate-pulse rounded-xl bg-white/5"}),(0,t.jsx)("div",{className:"h-52 animate-pulse rounded-2xl bg-white/5"}),(0,t.jsx)("div",{className:"h-32 animate-pulse rounded-2xl bg-white/5"})]}):null]})}e.s(["default",()=>C],49978)}]);
./.next/dev/server/chunks/[root-of-the-server]__6de3021e._.js:81:Cron & Jobs (touch_runs, enrichment, etc.)
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:602:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:643:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:685:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:689:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:693:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js:697:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js:924:    return client.from("touch_runs").select(touchRunSelect).eq("lead_id", leadId).order("sent_at", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js:1156:    // 6) Activity: touch_runs + citas + reminders
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js:1158:        supabase.from("touch_runs").select(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$leads$2f$timeline$2d$utils$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["touchRunSelect"]).eq("lead_id", leadId).order("scheduled_at", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js:1516:                        helper: "touch_runs registrados"
./.next/dev/server/chunks/ssr/src_2fe59184._.js:65:            supabase.from("touch_runs").select("id, status, created_at").order("created_at", {
./.next/dev/server/chunks/ssr/src_2fe59184._.js:89:            console.warn("Failed to load touch_runs", touchResp.error);
./.next/dev/server/chunks/ssr/[root-of-the-server]__36c9e6ba._.js.map:18:    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/director/page.tsx"],"sourcesContent":["// src/app/director/page.tsx\nimport React from \"react\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport { getSystemSnapshot } from \"@/lib/director/system-snapshot\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\n\nexport const revalidate = 0\n\n// --------- Tipos y constantes base ---------\n\nconst JOB_NAMES = [\n  \"campaign_engine_5m\",\n  \"run_enrichment_5m\",\n  \"dispatch-touch-every-minute\",\n  \"run-cadence-every-5m\",\n  \"revenue-asi-run-enrichment-5min\",\n  \"revenue-asi-touch-fake-5min\",\n  \"revenue-asi-recompute-leads-5min\",\n  \"cron_dispatch_appointment_notifications\",\n]\n\ntype CronJobRow = {\n  name: string\n  schedule: string | null\n}\n\ntype DispatchLogRow = {\n  id: string\n  created_at: string\n  kind: string\n  payload: Record<string, unknown> | null\n}\n\ntype EngineStatus = {\n  name: string\n  schedule: string | null\n  lastRun: string | null\n  status: \"OK\" | \"Error\" | \"No data\"\n}\n\ntype AppointmentMetrics = {\n  appointmentsToday: number\n  remindersToday: number\n  reminderTouchRunsToday: number\n}\n\ntype LeadMetrics = {\n  newLeadsToday: number\n  leadsWithAppointments: number\n  showsToday: number\n  noShowsToday: number\n}\n\ntype CampaignEngineRow = {\n  campaign_id: string | null\n  campaign_name: string | null\n  total_touches: number | null\n  queued: number | null\n  scheduled: number | null\n  processing: number | null\n  sent: number | null\n  failed: number | null\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  year: \"numeric\",\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\nfunction getTodayRange() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\n// --------- Loaders ---------\n\nasync function loadEngines(client: ReturnType<typeof supabaseServer>) {\n  if (!client) {\n    return JOB_NAMES.map<EngineStatus>((name) => ({\n      name,\n      schedule: null,\n      lastRun: null,\n      status: \"No data\",\n    }))\n  }\n\n  const [cronJobs, logs] = await Promise.all([\n    client.from(\"cron.job\").select(\"name, schedule\").in(\"name\", JOB_NAMES),\n    client\n      .from(\"dispatch_logs\")\n      .select(\"id, created_at, kind, payload\")\n      .in(\"kind\", JOB_NAMES)\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n  ])\n\n  const scheduleMap = new Map<string, string | null>()\n  ;(cronJobs.data as CronJobRow[] | null)?.forEach((row) => {\n    scheduleMap.set(row.name, row.schedule)\n  })\n\n  const latestLogMap = new Map<string, DispatchLogRow>()\n  ;(logs.data as DispatchLogRow[] | null)?.forEach((row) => {\n    if (!latestLogMap.has(row.kind)) {\n      latestLogMap.set(row.kind, row)\n    }\n  })\n\n  return JOB_NAMES.map<EngineStatus>((name) => {\n    const log = latestLogMap.get(name)\n    const payloadHasError = Boolean(\n      log?.payload && typeof log.payload === \"object\" && \"error\" in log.payload,\n    )\n\n    let status: EngineStatus[\"status\"] = \"No data\"\n    if (log) status = payloadHasError ? \"Error\" : \"OK\"\n\n    const lastRun = log?.created_at ?? null\n\n    return {\n      name,\n      schedule: scheduleMap.get(name) ?? null,\n      lastRun,\n      status,\n    }\n  })\n}\n\nasync function loadAppointmentMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentMetrics> {\n  const fallback: AppointmentMetrics = {\n    appointmentsToday: 0,\n    remindersToday: 0,\n    reminderTouchRunsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [appointments, reminders, touchReminders] = await Promise.all([\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"step\", [200, 201, 202])\n      .gte(\"scheduled_at\", start)\n      .lt(\"scheduled_at\", end),\n  ])\n\n  return {\n    appointmentsToday: appointments.count ?? 0,\n    remindersToday: reminders.count ?? 0,\n    reminderTouchRunsToday: touchReminders.count ?? 0,\n  }\n}\n\nasync function loadLeadMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<LeadMetrics> {\n  const fallback: LeadMetrics = {\n    newLeadsToday: 0,\n    leadsWithAppointments: 0,\n    showsToday: 0,\n    noShowsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [newLeads, shows, noShows, leadAppointments] = await Promise.all([\n    client\n      .from(\"leads\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"no_show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client.from(\"appointments\").select(\"lead_id\"),\n  ])\n\n  const leadIds = new Set(\n    (leadAppointments.data ?? [])\n      .map((row) => (row as { lead_id: string | null }).lead_id)\n      .filter((id): id is string => Boolean(id)),\n  )\n\n  return {\n    newLeadsToday: newLeads.count ?? 0,\n    showsToday: shows.count ?? 0,\n    noShowsToday: noShows.count ?? 0,\n    leadsWithAppointments: leadIds.size,\n  }\n}\n\nasync function loadCampaignEngine(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<CampaignEngineRow[]> {\n  if (!client) return []\n  const { data } = await client\n    .from(\"v_touch_funnel_campaign_summary\")\n    .select(\n      \"campaign_id, campaign_name, total_touches, queued, scheduled, processing, sent, failed\",\n    )\n    .order(\"total_touches\", { ascending: false })\n    .limit(5)\n\n  return (data as CampaignEngineRow[] | null) ?? []\n}\n\n// --------- UI helpers ---------\n\nfunction StatusBadge({ status }: { status: EngineStatus[\"status\"] }) {\n  const variant =\n    status === \"Error\"\n      ? \"destructive\"\n      : status === \"No data\"\n      ? \"warning\"\n      : \"neutral\"\n\n  return <Badge variant={variant}>{status}</Badge>\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <Card className=\"bg-white/5\">\n      <CardContent className=\"space-y-1 p-4\">\n        <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n          {label}\n        </p>\n        <p className=\"text-2xl font-semibold text-white\">{value}</p>\n        <p className=\"text-xs text-white/50\">{helper}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction CampaignEngineSection({ rows }: { rows: CampaignEngineRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Campaign engine\"\n        description=\"Performance de campaÃ±as por touch y engagement.\"\n      />\n      <CardContent>\n        {rows.length === 0 ? (\n          <p className=\"text-sm text-white/60\">\n            No hay campaÃ±as con actividad todavÃ­a.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Campaign</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Total touches\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Sent\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right text-rose-300\">\n                  Failed\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow key={row.campaign_id ?? \"null\"}>\n                  <TableCell className=\"font-semibold text-white\">\n                    {row.campaign_name ?? \"Sin nombre\"}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.total_touches ?? 0}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.sent ?? 0}\n                  </TableCell>\n                  <TableCell className=\"text-right text-rose-300\">\n                    {row.failed ?? 0}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- PÃ¡gina principal ---------\n\nexport default async function DirectorPage() {\n  const supabase = supabaseServer()\n\n  const [engines, appointmentMetrics, leadMetrics, campaignRows] =\n    await Promise.all([\n      loadEngines(supabase),\n      loadAppointmentMetrics(supabase),\n      loadLeadMetrics(supabase),\n      loadCampaignEngine(supabase),\n    ])\n\n  const hasError = engines.some((e) => e.status === \"Error\")\n  const hasAnyRun = engines.some((e) => e.lastRun !== null)\n\n  const engineLabel = hasError\n    ? \"Engine con issues Â· revisa logs\"\n    : hasAnyRun\n    ? \"Engine ok Â· summaries refresh every hour\"\n    : \"Sin datos aÃºn Â· engine idle\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasError\n    ? \"destructive\"\n    : hasAnyRun\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header con alerta compacta */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Operations & campaigns\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Director Dashboard\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Pulso de los motores de Revenue ASI y performance de campaÃ±as.\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* Primera fila: Engines + Appointments/Lead Flow */}\n      <div className=\"grid gap-6 xl:grid-cols-[minmax(0,1.7fr)_minmax(0,1.3fr)] items-start\">\n        {/* Engines */}\n        <Card className=\"border-white/10 bg-white/5\">\n          <CardHeader\n            title=\"Engines\"\n            description=\"Core cron jobs y su Ãºltima actividad.\"\n          />\n          <Card className=\"border-white/10 bg-white/5\">\n  <CardHeader\n    title=\"System snapshot\"\n    description=\"Payload que ve el Director Brain\"\n  />\n  <CardContent>\n    <pre className=\"max-h-56 overflow-auto text-xs text-white/60\">\n      {JSON.stringify(snapshot.dashboard_overview ?? {}, null, 2)}\n    </pre>\n  </CardContent>\n  </Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Job</TableHeaderCell>\n                  <TableHeaderCell>Schedule</TableHeaderCell>\n                  <TableHeaderCell>Last run</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Status\n                  </TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {engines.map((engine) => (\n                  <TableRow key={engine.name}>\n                    <TableCell className=\"font-semibold text-white\">\n                      {engine.name}\n                    </TableCell>\n                    <TableCell className=\"text-white/70\">\n                      {engine.schedule ?? \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {engine.lastRun\n                        ? dateTimeFormatter.format(new Date(engine.lastRun))\n                        : \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <StatusBadge status={engine.status} />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* Columna derecha */}\n        <div className=\"space-y-4\">\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Appointments\"\n              description=\"Actividad agendada hoy.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-3\">\n              <MetricTile\n                label=\"Appointments\"\n                value={appointmentMetrics.appointmentsToday}\n                helper=\"Starts today\"\n              />\n              <MetricTile\n                label=\"Reminders\"\n                value={appointmentMetrics.remindersToday}\n                helper=\"Notification jobs\"\n              />\n              <MetricTile\n                label=\"Reminder touch runs\"\n                value={appointmentMetrics.reminderTouchRunsToday}\n                helper=\"Steps 200â€“202\"\n              />\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Lead Flow\"\n              description=\"Top-of-funnel signals.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-4\">\n              <MetricTile\n                label=\"New leads\"\n                value={leadMetrics.newLeadsToday}\n                helper=\"Created today\"\n              />\n              <MetricTile\n                label=\"Leads w/ appts\"\n                value={leadMetrics.leadsWithAppointments}\n                helper=\"Distinct leads\"\n              />\n              <MetricTile\n                label=\"Shows\"\n                value={leadMetrics.showsToday}\n                helper=\"Outcome: show\"\n              />\n              <MetricTile\n                label=\"No-shows\"\n                value={leadMetrics.noShowsToday}\n                helper=\"Outcome: no_show\"\n              />\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Campaign engine */}\n      <CampaignEngineSection rows={campaignRows} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/[root-of-the-server]__f5208ee6._.js:950:        supabase.from("touch_runs").select(touchRunSelect).eq("lead_id", leadId).order("scheduled_at", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__f5208ee6._.js:1308:                        helper: "touch_runs registrados"
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:68:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:100:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:137:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:141:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:145:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/src_85f24f3d._.js:149:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/src_2fe59184._.js.map:6:    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/health/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\"\nimport { RefreshCw, Shield, Signal } from \"lucide-react\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport { Button, Card, CardContent, CardHeader, StatCard } from \"@/components/ui-custom\"\n\ntype JobRun = {\n  id: string\n  job_name?: string | null\n  status?: string | null\n  created_at?: string | null\n  duration_ms?: number | null\n}\n\ntype TouchRun = {\n  id: string\n  status?: string | null\n  created_at?: string | null\n}\n\nexport default function HealthPage() {\n  const supabase = useMemo(() => {\n    const hasEnv = process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    return hasEnv ? supabaseBrowser() : null\n  }, [])\n  const [runs, setRuns] = useState<JobRun[]>([])\n  const [loading, setLoading] = useState(true)\n  const [jobCounts, setJobCounts] = useState({ success: 0, failed: 0 })\n  const [touchRun, setTouchRun] = useState<TouchRun | null>(null)\n  const [lastJobRun, setLastJobRun] = useState<JobRun | null>(null)\n\n  const refreshHealth = useCallback(async () => {\n    if (!supabase) {\n      setLoading(false)\n      return\n    }\n\n    setLoading(true)\n    const since = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()\n\n    const [jobResp, touchResp] = await Promise.all([\n      supabase\n        .from(\"job_runs\")\n        .select(\"id, job_name, status, created_at, duration_ms\")\n        .order(\"created_at\", { ascending: false })\n        .limit(20),\n      supabase.from(\"touch_runs\").select(\"id, status, created_at\").order(\"created_at\", { ascending: false }).limit(1),\n    ])\n\n    if (jobResp.error) {\n      console.warn(\"Failed to load job_runs\", jobResp.error)\n      setRuns([])\n      setJobCounts({ success: 0, failed: 0 })\n      setLastJobRun(null)\n    } else {\n      const filtered = (jobResp.data ?? []).filter((run) => (run.created_at ?? \"\") >= since)\n      const success = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"succeeded\").length\n      const failed = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"failed\").length\n      setRuns(jobResp.data ?? [])\n      setJobCounts({ success, failed })\n      setLastJobRun(jobResp.data?.[0] ?? null)\n    }\n\n    if (touchResp.error) {\n      console.warn(\"Failed to load touch_runs\", touchResp.error)\n      setTouchRun(null)\n    } else {\n      setTouchRun(touchResp.data?.[0] ?? null)\n    }\n\n    setLoading(false)\n  }, [supabase])\n\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/set-state-in-effect\n    void refreshHealth()\n  }, [refreshHealth])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">Systems</p>\n          <h1 className=\"text-3xl font-semibold text-white\">Health</h1>\n          <p className=\"text-sm text-white/60\">Heartbeat across cadences, enrichers, and dispatchers.</p>\n        </div>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"gap-2\"\n          onClick={refreshHealth}\n          aria-label=\"Refresh health\"\n        >\n          <RefreshCw size={16} />\n          Refresh\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Jobs\"\n          value={`${jobCounts.success} succeeded / ${jobCounts.failed} failed`}\n          helper=\"job_runs last 24h\"\n          delta={supabase ? \"Live\" : \"Offline\"}\n        />\n        <StatCard\n          label=\"Dispatch\"\n          value={\n            touchRun\n              ? `${touchRun.status ?? \"pending\"}`\n              : supabase\n                ? \"No dispatch runs\"\n                : \"Supabase env missing\"\n          }\n          helper={\n            touchRun?.created_at\n              ? new Date(touchRun.created_at).toLocaleString()\n              : \"Watching cadence triggers\"\n          }\n          delta={touchRun ? \"Latest\" : \"Idle\"}\n        />\n        <StatCard\n          label=\"Run cadence\"\n          value={lastJobRun ? lastJobRun.status ?? \"pending\" : \"No runs\"}\n          helper={lastJobRun?.created_at ? new Date(lastJobRun.created_at).toLocaleString() : \"Cron via SQL\"}\n          delta={lastJobRun ? \"Latest\" : \"Idle\"}\n        />\n      </div>\n\n      <Card>\n        <CardHeader\n          title=\"Recent checks\"\n          description=\"Edge functions and workers reporting back from Supabase\"\n          action={\n            <div className=\"flex items-center gap-2 text-sm text-white/60\">\n              <Signal size={16} />\n              {loading ? \"Loading\" : `${runs.length} pings`}\n            </div>\n          }\n        />\n        <CardContent className=\"space-y-3\">\n          {loading ? (\n            <div className=\"space-y-2\">\n              {[1, 2, 3].map((row) => (\n                <div key={row} className=\"h-12 animate-pulse rounded-xl bg-white/5\" />\n              ))}\n            </div>\n          ) : runs.length === 0 ? (\n            <div className=\"rounded-2xl border border-dashed border-emerald-400/40 bg-white/5 px-5 py-6 text-center\">\n              <p className=\"text-lg font-semibold text-white\">No health signals yet</p>\n              <p className=\"text-sm text-white/60\">We will surface job_runs as they arrive.</p>\n            </div>\n          ) : (\n            <div className=\"grid gap-2\">\n              {runs.map((run) => {\n                const status = (run.status ?? \"\").toLowerCase()\n                const ok = status === \"succeeded\" || status === \"success\"\n                return (\n                  <div\n                    key={run.id}\n                    className=\"flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-4 py-3\"\n                  >\n                    <div className=\"space-y-1\">\n                      <p className=\"font-semibold text-white\">{run.job_name ?? \"Unknown job\"}</p>\n                      <p className=\"text-xs text-white/50\">{new Date(run.created_at ?? \"\").toLocaleString()}</p>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                      <Shield size={16} className={ok ? \"text-emerald-300\" : \"text-amber-300\"} />\n                      <span className={ok ? \"text-emerald-200\" : \"text-amber-200\"}>\n                        {status || \"pending\"}\n                      </span>\n                      {typeof run.duration_ms === \"number\" && (\n                        <span className=\"text-xs text-white/50\">{Math.round(run.duration_ms)} ms</span>\n                      )}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/[root-of-the-server]__f5208ee6._.js.map:19:    {"offset": {"line": 785, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/leads/%5Bid%5D/page.tsx"],"sourcesContent":["import Link from \"next/link\"\nimport { createClient } from \"@supabase/supabase-js\"   // â¬…ï¸ NUEVO\n\nimport { LeadActivityTimeline, type LeadTimelineEvent } from \"@/components/leads/LeadActivityTimeline\"\nimport {\n  AppointmentStatusBadge,\n  IntentBadge,\n  LeadStateBadge,\n} from \"@/components/leads/badges\"\nimport { supabaseBrowser } from \"@/lib/supabase\" // si ya no se usa, puedes borrarlo luego\nimport {\n  Badge,\n  Button,\n  Card,\n  CardContent,\n  CardHeader,\n} from \"@/components/ui-custom\"\nimport { StatCard } from \"@/components/ui-custom/stat-card\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport type { LeadEnriched } from \"@/types/lead\"\nimport { Building2, Mail, MapPin, PhoneCall, User } from \"lucide-react\"\n\ntype LeadDetail = LeadEnriched & {\n  company?: string | null\n  notes?: string | null\n}\n\ntype AppointmentRow = {\n  id: string\n  lead_id: string | null\n  channel: string | null\n  status: string | null\n  outcome: string | null\n  notes: string | null\n  starts_at: string | null\n  scheduled_for: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  appointment_id: string | null\n  notify_at: string | null\n  status: string | null\n  payload: Record<string, any> | null\n  created_at?: string | null\n}\n\ntype LeadDataResult = {\n  lead: LeadDetail | null\n  events: LeadTimelineEvent[]\n  stats: {\n    touches: number\n    appointments: number\n    reminders: number\n  }\n}\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return null\n  return date.toLocaleString()\n}\n\nfunction deriveLeadTitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin nombre\"\n  return lead.full_name || lead.email || lead.phone || \"Sin nombre\"\n}\n\nfunction deriveLeadSubtitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin contacto\"\n  const email = lead.email ?? \"Sin email\"\n  const phone = lead.phone ?? \"Sin telÃ©fono\"\n  return `${email} Â· ${phone}`\n}\n\nfunction appointmentTime(appt: AppointmentRow) {\n  return appt.starts_at ?? appt.scheduled_for ?? appt.created_at\n}\n\nfunction mapTouchRuns(touchRuns: TouchRunRow[]): LeadTimelineEvent[] {\n  return touchRuns.map((touch) => {\n    const occurredAt = touch.scheduled_at ?? touch.created_at\n    const { label, description } = describeTouchRun(touch)\n\n    return {\n      id: `touch-${touch.id}`,\n      occurredAt: occurredAt ?? new Date().toISOString(),\n      type: \"touch_run\" as const,\n      channel: touch.channel,\n      step: touch.step,\n      label,\n      description,\n      status: touch.status,\n      meta: touch.meta ?? undefined,\n    }\n  })\n}\n\nfunction mapAppointments(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments.map((appointment) => {\n    const when = appointmentTime(appointment) ?? new Date().toISOString()\n    const formatted = formatDateTime(when)\n    const description = formatted\n      ? `Scheduled for ${formatted}${\n          appointment.notes ? ` Â· ${appointment.notes}` : \"\"\n        }`\n      : appointment.notes ?? undefined\n\n    return {\n      id: `appointment-${appointment.id}`,\n      occurredAt: when,\n      type: \"appointment\" as const,\n      channel: appointment.channel,\n      step: null,\n      label: \"Appointment scheduled\",\n      description,\n      status: appointment.status,\n      meta: { appointmentId: appointment.id },\n    }\n  })\n}\n\nfunction mapAppointmentOutcomes(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments\n    .filter((appointment) => Boolean(appointment.outcome))\n    .map((appointment) => {\n      const label = describeAppointmentOutcome(appointment.outcome)\n      const when =\n        appointment.updated_at ??\n        appointmentTime(appointment) ??\n        new Date().toISOString()\n      const apptTime = appointmentTime(appointment)\n      const formatted = formatDateTime(apptTime)\n\n      const description = formatted\n        ? `Outcome for appointment on ${formatted}`\n        : \"Appointment outcome updated\"\n\n      return {\n        id: `appointment-outcome-${appointment.id}`,\n        occurredAt: when,\n        type: \"appointment_outcome\" as const,\n        channel: appointment.channel,\n        step: null,\n        label,\n        description,\n        status: appointment.outcome,\n        meta: { appointmentId: appointment.id },\n      }\n    })\n}\n\nfunction mapAppointmentReminders(\n  reminders: AppointmentNotificationRow[],\n  appointmentById: Map<string, AppointmentRow>,\n  leadId: string,\n): LeadTimelineEvent[] {\n  return reminders\n    .filter((reminder) => {\n      const payloadLeadId =\n        (reminder.payload?.lead_id as string | undefined) ?? null\n      const appointmentLeadId = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)?.lead_id ?? null\n        : null\n      return payloadLeadId === leadId || appointmentLeadId === leadId\n    })\n    .map((reminder) => {\n      const appointment = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)\n        : undefined\n      const when =\n        reminder.notify_at ??\n        appointmentTime(\n          appointment ?? ({} as AppointmentRow),\n        ) ??\n        new Date().toISOString()\n      const kind = (reminder.payload?.kind as string | undefined) ?? null\n      const reminderLabel = describeReminder(kind) ?? \"Appointment reminder\"\n      const appointmentDate = appointmentTime(\n        appointment ?? ({} as AppointmentRow),\n      )\n      const formatted = formatDateTime(appointmentDate)\n\n      return {\n        id: `appointment-reminder-${reminder.id}`,\n        occurredAt: when,\n        type: \"appointment_reminder\" as const,\n        channel: appointment?.channel ?? null,\n        step: null,\n        label: reminderLabel,\n        description: formatted\n          ? `Reminder for appointment on ${formatted}`\n          : undefined,\n        status: reminder.status,\n        meta: { appointmentId: reminder.appointment_id, kind },\n      }\n    })\n}\n\nasync function loadLeadData(leadId: string): Promise<LeadDataResult> {\n  // Intento 1: cliente server (service role, cookies, etc.)\n  const maybeServer = supabaseServer()\n\n  // Intento 2 (fallback): cliente normal con ANON KEY\n  const supabase =\n    maybeServer ??\n    createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    )\n\n  // Si por alguna razÃ³n no hay envs, devolvemos dummy\n  if (!supabase) {\n    return {\n      lead: {\n        id: leadId,\n        full_name: \"Sin nombre\",\n        email: null,\n        phone: null,\n        state: \"unknown\",\n        last_touch_at: null,\n        campaign_id: null,\n        campaign_name: null,\n        channel_last: null,\n        company: null,\n        notes: null,\n      },\n      events: [],\n      stats: { touches: 0, appointments: 0, reminders: 0 },\n    }\n  }\n\n  const [leadResult, touchRunsResult, appointmentsResult, remindersResult] =\n    await Promise.all([\n      supabase\n        .from(\"lead_enriched\")\n        .select(\n          \"id, full_name, email, phone, state, last_touch_at, campaign_id, campaign_name, channel_last, company\",\n        )\n        .eq(\"id\", leadId)\n        .maybeSingle(),\n      supabase\n        .from(\"touch_runs\")\n        .select(touchRunSelect)\n        .eq(\"lead_id\", leadId)\n        .order(\"scheduled_at\", {\n          ascending: false,\n          nullsLast: true,\n        } as any)\n        .order(\"created_at\", { ascending: false }),\n      supabase\n        .from(\"appointments\")\n        .select(\n          \"id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at\",\n        )\n        .eq(\"lead_id\", leadId),\n      supabase\n        .from(\"appointments_notifications\")\n        .select(\n          \"id, appointment_id, notify_at, status, payload, created_at\",\n        ),\n    ])\n\n  const touchRuns = (touchRunsResult.data ?? []) as TouchRunRow[]\n  const appointments = (appointmentsResult.data ?? []) as AppointmentRow[]\n  const appointmentById = new Map<string, AppointmentRow>()\n  appointments.forEach((row) => appointmentById.set(row.id, row))\n  const reminders =\n    (remindersResult.data ?? []) as AppointmentNotificationRow[]\n\n  const events: LeadTimelineEvent[] = [\n    ...mapTouchRuns(touchRuns),\n    ...mapAppointments(appointments),\n    ...mapAppointmentOutcomes(appointments),\n    ...mapAppointmentReminders(reminders, appointmentById, leadId),\n  ].sort((a, b) => {\n    const aTime = new Date(a.occurredAt).getTime()\n    const bTime = new Date(b.occurredAt).getTime()\n    const safeA = Number.isNaN(aTime) ? 0 : aTime\n    const safeB = Number.isNaN(bTime) ? 0 : bTime\n    return safeB - safeA\n  })\n\n  return {\n    lead: (leadResult.data as LeadDetail | null) ?? null,\n    events,\n    stats: {\n      touches: touchRuns.length,\n      appointments: appointments.length,\n      reminders: reminders.length,\n    },\n  }\n}\n\nexport default async function LeadDetailPage({\n  params,\n}: {\n  params: { id: string }\n}) {\n  const leadId = params.id\n  const { lead, events, stats } = await loadLeadData(leadId)\n\n  const title = deriveLeadTitle(lead)\n  const subtitle = deriveLeadSubtitle(lead)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/leads\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft size={16} />\n              Back\n            </Button>\n          </Link>\n          <div>\n            <p className=\"text-sm uppercase tracking-[0.16em] text-white/50\">\n              Lead\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Lead timeline\n            </h1>\n            <p className=\"text-sm text-white/80\">{title}</p>\n            <p className=\"text-xs text-white/60\">\n              {subtitle} Â· ID: {leadId}\n            </p>\n          </div>\n        </div>\n        {lead?.state ? (\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {lead.state}\n          </Badge>\n        ) : null}\n      </div>\n\n      {/* Overview */}\n      <Card>\n        <CardHeader\n          title=\"Lead overview\"\n          description=\"Basic details and last touch information\"\n        />\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex items-center gap-2 text-white\">\n              <User size={16} className=\"text-white/60\" />\n              <span className=\"font-semibold\">{title}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Mail size={14} className=\"text-white/50\" />\n              <span>{lead?.email ?? \"Sin email\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <PhoneCall size={14} className=\"text-white/50\" />\n              <span>{lead?.phone ?? \"Sin telÃ©fono\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Building2 size={14} className=\"text-white/50\" />\n              <span>{lead?.company ?? \"Sin compaÃ±Ã­a\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <MapPin size={14} className=\"text-white/50\" />\n              <span>{lead?.channel_last ?? \"Sin canal\"}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2 rounded-2xl border border-white/10 bg_WHITE/5 p-4 text-white/80\">\n            <p className=\"text-sm text-white/60\">Last touch</p>\n            <p className=\"text-lg font-semibold text-white\">\n              {formatDateTime(lead?.last_touch_at ?? null) ??\n                \"No touches yet\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Channel: {lead?.channel_last ?? \"â€”\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Campaign:{\" \"}\n              {lead?.campaign_name ?? lead?.campaign_id ?? \"â€”\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Stats */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Total activity\"\n          value={events.length.toString()}\n          helper=\"Touches, appointments and reminders\"\n        />\n        <StatCard\n          label=\"Touch runs\"\n          value={stats.touches.toString()}\n          helper=\"touch_runs registrados\"\n        />\n        <StatCard\n          label=\"Appointments\"\n          value={stats.appointments.toString()}\n          helper=\"Incluye outcomes y reminders\"\n        />\n      </div>\n\n      {/* Timeline */}\n      <LeadActivityTimeline events={events} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/[root-of-the-server]__5e706096._.js.map:19:    {"offset": {"line": 593, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/director/page.tsx"],"sourcesContent":["import React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport { getSystemSnapshot } from \"@/lib/director/system-snapshot\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport {\n  Mail,\n  PhoneCall,\n  MessageSquare,\n  Zap,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// ---------- Constantes & tipos ----------\n\nconst JOB_NAMES = [\n  \"campaign_engine_5m\",\n  \"run_enrichment_5m\",\n  \"dispatch-touch-every-minute\",\n  \"run-cadence-every-5m\",\n  \"revenue-asi-run-enrichment-5min\",\n  \"revenue-asi-touch-fake-5min\",\n  \"revenue-asi-recompute-leads-5min\",\n  \"cron_dispatch_appointment_notifications\",\n]\n\ntype CronJobRow = {\n  name: string\n  schedule: string | null\n}\n\ntype DispatchLogRow = {\n  id: string\n  created_at: string\n  kind: string\n  payload: Record<string, unknown> | null\n}\n\ntype EngineStatus = {\n  name: string\n  schedule: string | null\n  lastRun: string | null\n  status: \"OK\" | \"Error\" | \"No data\"\n}\n\ntype AppointmentMetrics = {\n  appointmentsToday: number\n  remindersToday: number\n  reminderTouchRunsToday: number\n}\n\ntype LeadMetrics = {\n  newLeadsToday: number\n  leadsWithAppointments: number\n  showsToday: number\n  noShowsToday: number\n}\n\ntype CampaignEngineRow = {\n  campaign_id: string\n  campaign_name: string | null\n  total_touches: number\n  leads_touched: number\n  engaged_leads: number\n  reply_rate: number\n  error_rate: number\n  leads_attempting: number\n  leads_engaged: number\n  leads_booked: number\n  leads_booked_show: number\n  leads_booked_no_show: number\n  first_touch_at: string | null\n  last_touch_at: string | null\n}\n\ntype DirectorAlertRow = {\n  id: string\n  created_at: string\n  event_type: string | null\n  event_source: string | null\n  score_delta: number | null\n  payload: Record<string, any> | null\n}\n\n// ðŸ”— Next actions + enrichment genome (solo el tipo unificado que usamos en la tabla)\n\ntype NextActionRow = {\n  lead_id: string\n  lead_name: string | null\n  email: string | null\n  phone: string | null\n  lead_state: string | null\n  lead_brain_bucket: string | null\n  recommended_channel: string | null\n  recommended_action: string | null\n  recommended_delay_minutes: number | null\n  priority_score: number | null\n  reason: string | null\n  industry?: string | null\n  sub_industry?: string | null\n  enrichment_status?: string | null\n  ai_lead_score?: number | null\n}\n\n// ðŸ”¬ Enrichment Engine v2 overview\n\ntype EnrichmentQueueStat = {\n  status: string | null\n  total: number\n}\n\ntype EnrichmentSummaryRow = {\n  enrichment_status: string | null\n  total: number\n  avg_ai_lead_score: number | null\n}\n\ntype EnrichmentOverview = {\n  queue: EnrichmentQueueStat[]\n  summary: EnrichmentSummaryRow[]\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  year: \"numeric\",\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\nfunction getTodayRange() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\n// ---------- Loaders (server-side) ----------\n\nasync function loadEngines(client: ReturnType<typeof supabaseServer>) {\n  if (!client) {\n    return JOB_NAMES.map<EngineStatus>((name) => ({\n      name,\n      schedule: null,\n      lastRun: null,\n      status: \"No data\",\n    }))\n  }\n\n  const [cronJobs, logs] = await Promise.all([\n    client.from(\"cron.job\").select(\"name, schedule\").in(\"name\", JOB_NAMES),\n    client\n      .from(\"dispatch_logs\")\n      .select(\"id, created_at, kind, payload\")\n      .in(\"kind\", JOB_NAMES)\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n  ])\n\n  const scheduleMap = new Map<string, string | null>()\n  ;(cronJobs.data as CronJobRow[] | null)?.forEach((row) => {\n    scheduleMap.set(row.name, row.schedule)\n  })\n\n  const latestLogMap = new Map<string, DispatchLogRow>()\n  ;(logs.data as DispatchLogRow[] | null)?.forEach((row) => {\n    if (!latestLogMap.has(row.kind)) {\n      latestLogMap.set(row.kind, row)\n    }\n  })\n\n  return JOB_NAMES.map<EngineStatus>((name) => {\n    const log = latestLogMap.get(name)\n    const payloadHasError = Boolean(\n      log?.payload && typeof log.payload === \"object\" && \"error\" in log.payload,\n    )\n\n    let status: EngineStatus[\"status\"] = \"No data\"\n    if (log) status = payloadHasError ? \"Error\" : \"OK\"\n\n    return {\n      name,\n      schedule: scheduleMap.get(name) ?? null,\n      lastRun: log?.created_at ?? null,\n      status,\n    }\n  })\n}\n\nasync function loadAppointmentMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentMetrics> {\n  const fallback: AppointmentMetrics = {\n    appointmentsToday: 0,\n    remindersToday: 0,\n    reminderTouchRunsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [appointments, reminders, touchReminders] = await Promise.all([\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"step\", [200, 201, 202])\n      .gte(\"scheduled_at\", start)\n      .lt(\"scheduled_at\", end),\n  ])\n\n  return {\n    appointmentsToday: appointments.count ?? 0,\n    remindersToday: reminders.count ?? 0,\n    reminderTouchRunsToday: touchReminders.count ?? 0,\n  }\n}\n\nasync function loadLeadMetrics(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<LeadMetrics> {\n  const fallback: LeadMetrics = {\n    newLeadsToday: 0,\n    leadsWithAppointments: 0,\n    showsToday: 0,\n    noShowsToday: 0,\n  }\n  if (!client) return fallback\n\n  const { start, end } = getTodayRange()\n\n  const [newLeads, shows, noShows, leadAppointments] = await Promise.all([\n    client\n      .from(\"leads\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client\n      .from(\"appointments\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"outcome\", \"no_show\")\n      .gte(\"starts_at\", start)\n      .lt(\"starts_at\", end),\n    client.from(\"appointments\").select(\"lead_id\"),\n  ])\n\n  const leadIds = new Set(\n    (leadAppointments.data ?? [])\n      .map((row) => (row as { lead_id: string | null }).lead_id)\n      .filter((id): id is string => Boolean(id)),\n  )\n\n  return {\n    newLeadsToday: newLeads.count ?? 0,\n    showsToday: shows.count ?? 0,\n    noShowsToday: noShows.count ?? 0,\n    leadsWithAppointments: leadIds.size,\n  }\n}\n\nasync function loadCampaignEngine(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<CampaignEngineRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"campaign_funnel_overview\")\n    .select(\n      [\n        \"campaign_id\",\n        \"campaign_name\",\n        \"total_touches\",\n        \"leads_touched\",\n        \"engaged_leads\",\n        \"reply_rate\",\n        \"error_rate\",\n        \"leads_attempting\",\n        \"leads_engaged\",\n        \"leads_booked\",\n        \"leads_booked_show\",\n        \"leads_booked_no_show\",\n        \"first_touch_at\",\n        \"last_touch_at\",\n      ].join(\", \"),\n    )\n    .order(\"last_touch_at\", { ascending: false })\n    .limit(10)\n\n  if (error) {\n    console.error(\"campaign_funnel_overview error\", error)\n    return []\n  }\n\n  // Supabase types allow GenericStringError[] in `data`,\n  // asÃ­ que lo pasamos por `unknown` antes de castear.\n  const typed = (data ?? []) as unknown as CampaignEngineRow[]\n  return typed\n}\n\nasync function loadDirectorAlerts(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<DirectorAlertRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"core_memory_events\")\n    .select(\"id, created_at, event_type, event_source, score_delta, payload\")\n    .order(\"created_at\", { ascending: false })\n    .limit(20)\n\n  if (error) {\n    console.error(\"core_memory_events error\", error)\n    return []\n  }\n\n  return (data as DirectorAlertRow[] | null) ?? []\n}\n\n// ðŸ”¥ Lead Next Actions loader + Genome v2 merge\n\nasync function loadNextActions(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<NextActionRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"lead_next_action_view_v5\")\n    .select(\n      `\n      lead_id,\n      lead_name,\n      email,\n      phone,\n      lead_state,\n      lead_brain_bucket,\n      recommended_channel,\n      effective_channel,\n      recommended_action,\n      recommended_delay_minutes,\n      priority_score,\n      reason\n    `,\n    )\n    .order(\"priority_score\", { ascending: false })\n    .limit(100)\n\n  if (error || !data) {\n    console.error(\"lead_next_action_view_v5 error\", error)\n    return []\n  }\n\n  const rows = data as {\n    lead_id: string | null\n    lead_name?: string | null\n    email: string | null\n    phone: string | null\n    lead_state: string | null\n    lead_brain_bucket: string | null\n    recommended_channel: string | null\n    effective_channel: string | null\n    recommended_action: string | null\n    recommended_delay_minutes: number | null\n    priority_score: number | null\n    reason: string | null\n  }[]\n\n  const leadIds = rows\n    .map((r) => r.lead_id)\n    .filter((id): id is string => Boolean(id))\n\n  let genomeMap = new Map<\n    string,\n    {\n      industry: string | null\n      sub_industry: string | null\n      enrichment_status: string | null\n      ai_lead_score: number | null\n    }\n  >()\n\n  if (leadIds.length > 0) {\n    const { data: genomeData, error: genomeError } = await client\n      .from(\"v_lead_with_enrichment_v2\")\n      .select(\n        [\n          \"id\",\n          \"industry\",\n          \"sub_industry\",\n          \"enrichment_status\",\n          \"ai_lead_score\",\n        ].join(\", \"),\n      )\n      .in(\"id\", leadIds)\n\n    if (genomeError) {\n      console.error(\"v_lead_with_enrichment_v2 error\", genomeError)\n    }\n\n    genomeMap = new Map()\n    ;(genomeData ?? []).forEach((row: any) => {\n      if (!row.id) return\n      genomeMap.set(row.id, {\n        industry: row.industry ?? null,\n        sub_industry: row.sub_industry ?? null,\n        enrichment_status: row.enrichment_status ?? null,\n        ai_lead_score:\n          row.ai_lead_score == null ? null : Number(row.ai_lead_score) || 0,\n      })\n    })\n  }\n\n  return rows.map((row) => {\n    const key = row.lead_id ?? \"\"\n    const g = key ? genomeMap.get(key) : undefined\n\n    return {\n      lead_id: key,\n      lead_name: row.lead_name ?? null,\n      email: row.email,\n      phone: row.phone,\n      lead_state: row.lead_state,\n      lead_brain_bucket: row.lead_brain_bucket,\n      recommended_channel:\n        row.effective_channel ?? row.recommended_channel ?? null,\n      recommended_action: row.recommended_action,\n      recommended_delay_minutes: row.recommended_delay_minutes,\n      priority_score: row.priority_score,\n      reason: row.reason,\n      industry: g?.industry ?? null,\n      sub_industry: g?.sub_industry ?? null,\n      enrichment_status: g?.enrichment_status ?? null,\n      ai_lead_score: g?.ai_lead_score ?? null,\n    }\n  })\n}\n\n// ðŸ”¬ Enrichment Engine v2 loader\n\nasync function loadEnrichmentOverview(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<EnrichmentOverview> {\n  if (!client) return { queue: [], summary: [] }\n\n  const { data: queueData, error: queueError } = await client\n    .from(\"enrichment_queue\")\n    .select(\"status\")\n\n  if (queueError) {\n    console.error(\"enrichment_queue error\", queueError)\n  }\n\n  const queueMap = new Map<string | null, number>()\n  ;(queueData as { status: string | null }[] | null)?.forEach((row) => {\n    const key = row.status ?? \"unknown\"\n    queueMap.set(key, (queueMap.get(key) ?? 0) + 1)\n  })\n\n  const queue: EnrichmentQueueStat[] = Array.from(queueMap.entries()).map(\n    ([status, total]) => ({\n      status,\n      total,\n    }),\n  )\n\n  const { data: summaryData, error: summaryError } = await client\n    .from(\"v_lead_with_enrichment_v2\")\n    .select(\"enrichment_status, ai_lead_score\")\n\n  if (summaryError) {\n    console.error(\"v_lead_with_enrichment_v2 summary error\", summaryError)\n  }\n\n  const summaryMap = new Map<\n    string | null,\n    { total: number; sumScore: number; countWithScore: number }\n  >()\n\n  ;(summaryData as { enrichment_status: string | null; ai_lead_score: any }[] | null)?.forEach(\n    (row) => {\n      const key = row.enrichment_status ?? \"unknown\"\n      const existing = summaryMap.get(key) ?? {\n        total: 0,\n        sumScore: 0,\n        countWithScore: 0,\n      }\n      const score =\n        row.ai_lead_score == null ? null : Number(row.ai_lead_score) || 0\n\n      existing.total += 1\n      if (score != null) {\n        existing.sumScore += score\n        existing.countWithScore += 1\n      }\n\n      summaryMap.set(key, existing)\n    },\n  )\n\n  const summary: EnrichmentSummaryRow[] = Array.from(\n    summaryMap.entries(),\n  ).map(([status, agg]) => ({\n    enrichment_status: status,\n    total: agg.total,\n    avg_ai_lead_score:\n      agg.countWithScore > 0 ? agg.sumScore / agg.countWithScore : null,\n  }))\n\n  return { queue, summary }\n}\n\n// ---------- UI helpers ----------\n\nfunction StatusBadge({ status }: { status: EngineStatus[\"status\"] }) {\n  const variant =\n    status === \"Error\"\n      ? \"destructive\"\n      : status === \"No data\"\n      ? \"warning\"\n      : \"neutral\"\n\n  return <Badge variant={variant}>{status}</Badge>\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <Card className=\"bg-white/5\">\n      <CardContent className=\"space-y-1 p-4\">\n        <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n          {label}\n        </p>\n        <p className=\"text-2xl font-semibold text-white\">{value}</p>\n        <p className=\"text-xs text-white/50\">{helper}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction formatPercent(value: number | null | undefined) {\n  if (value == null || Number.isNaN(value)) return \"0%\"\n  return `${(value * 100).toFixed(1)}%`\n}\n\nfunction CampaignEngineSection({ rows }: { rows: CampaignEngineRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Campaign funnel\"\n        description=\"Performance de cada campaÃ±a: touches, replies y bookings.\"\n      />\n      <CardContent>\n        {rows.length === 0 ? (\n          <p className=\"text-sm text-white/60\">\n            No hay campaÃ±as con actividad todavÃ­a.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Campaign</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Leads touched\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Engaged\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Booked\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Show / No-show\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Reply rate\n                </TableHeaderCell>\n                <TableHeaderCell className=\"text-right text-rose-300\">\n                  Error rate\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow key={row.campaign_id}>\n                  <TableCell className=\"font-semibold text-white\">\n                    {row.campaign_id ? (\n                      <Link\n                        href={`/leads?campaign_id=${row.campaign_id}`}\n                        className=\"hover:underline\"\n                      >\n                        {row.campaign_name ?? \"Sin nombre\"}\n                      </Link>\n                    ) : (\n                      row.campaign_name ?? \"Sin nombre\"\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_touched}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_engaged}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_booked}\n                  </TableCell>\n                  <TableCell className=\"text-right text-white/80\">\n                    {row.leads_booked_show} / {row.leads_booked_no_show}\n                  </TableCell>\n                  <TableCell className=\"text-right text-emerald-300\">\n                    {formatPercent(row.reply_rate)}\n                  </TableCell>\n                  <TableCell className=\"text-right text-rose-300\">\n                    {formatPercent(row.error_rate)}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction SystemSnapshotCard({ snapshot }: { snapshot: any }) {\n  const overview = snapshot?.dashboard_overview ?? {}\n\n  const items: { label: string; value: number | string }[] = [\n    { label: \"Total leads\", value: overview.total_leads ?? 0 },\n    { label: \"Leads attempting\", value: overview.leads_attempting ?? 0 },\n    { label: \"Leads booked\", value: overview.leads_booked ?? 0 },\n    { label: \"Campaigns live\", value: overview.campaigns_live ?? 0 },\n  ]\n\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"System snapshot\"\n        description=\"Resumen que ve el Director Brain.\"\n      />\n      <CardContent className=\"grid gap-3 sm:grid-cols-2\">\n        {items.map((item) => (\n          <div key={item.label} className=\"space-y-1\">\n            <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n              {item.label}\n            </p>\n            <p className=\"text-lg font-semibold text-white\">\n              {item.value ?? 0}\n            </p>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction DirectorAlertsSection({ alerts }: { alerts: DirectorAlertRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Director Brain â€“ Alerts\"\n        description=\"Ãšltimos eventos internos del sistema.\"\n      />\n      <CardContent className=\"space-y-4\">\n        {alerts.length === 0 ? (\n          <p className=\"text-sm text-white/60\">No hay eventos aÃºn.</p>\n        ) : (\n          alerts.map((alert) => {\n            const payload = alert.payload ?? {}\n            const label =\n              payload.label ??\n              payload.title ??\n              alert.event_type ??\n              \"System event\"\n\n            const time = new Date(alert.created_at).toLocaleString()\n\n            const actor = alert.event_source ?? \"system\"\n            const importance =\n              payload.importance ??\n              alert.score_delta ??\n              1\n\n            return (\n              <div\n                key={alert.id}\n                className=\"space-y-2 rounded-xl border border-white/10 bg-white/5 p-4\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div>\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                      {actor}\n                    </p>\n                    <p className=\"text-sm font-semibold text-white\">\n                      {label}\n                    </p>\n                  </div>\n                  <Badge className=\"border border-white/20 bg-white/10 text-xs text-white/70\">\n                    {importance}\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-white/50\">{time}</p>\n                {payload.notes ? (\n                  <p className=\"text-sm text-white/70\">{payload.notes}</p>\n                ) : null}\n              </div>\n            )\n          })\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --- Helpers visuales para Next Actions ---\n\nfunction ChannelIcon({ channel }: { channel: string | null }) {\n  if (!channel) return <Zap size={14} className=\"text-white/40\" />\n\n  switch (channel) {\n    case \"email\":\n      return <Mail size={14} className=\"text-emerald-300\" />\n    case \"voice\":\n      return <PhoneCall size={14} className=\"text-amber-300\" />\n    case \"whatsapp\":\n      return <MessageSquare size={14} className=\"text-green-400\" />\n    case \"sms\":\n      return <MessageSquare size={14} className=\"text-blue-400\" />\n    default:\n      return <Zap size={14} className=\"text-white/40\" />\n  }\n}\n\nfunction BrainBucketBadge({ bucket }: { bucket: string | null }) {\n  if (!bucket)\n    return (\n      <Badge className=\"bg-white/10 text-white/60 border border-white/20 text-xs\">\n        unknown\n      </Badge>\n    )\n\n  const base = \"px-2 py-0.5 text-xs border\"\n  if (bucket === \"hot\")\n    return (\n      <Badge\n        className={`${base} bg-rose-600/30 text-rose-100 border-rose-500/60`}\n      >\n        hot\n      </Badge>\n    )\n  if (bucket === \"warm\")\n    return (\n      <Badge\n        className={`${base} bg-amber-500/20 text-amber-100 border-amber-400/60`}\n      >\n        warm\n      </Badge>\n    )\n  return (\n    <Badge\n      className={`${base} bg-sky-500/20 text-sky-100 border-sky-400/60`}\n    >\n      cold\n    </Badge>\n  )\n}\n\nfunction ActionBadge({ action }: { action: string | null }) {\n  if (!action) return null\n  const base = \"px-2 py-0.5 text-xs border\"\n\n  if (action === \"send\")\n    return (\n      <Badge\n        className={`${base} bg-emerald-500/20 text-emerald-100 border-emerald-400/60`}\n      >\n        send\n      </Badge>\n    )\n  if (action === \"cooldown\")\n    return (\n      <Badge\n        className={`${base} bg-amber-500/20 text-amber-100 border-amber-400/60`}\n      >\n        cooldown\n      </Badge>\n    )\n  if (action === \"review\")\n    return (\n      <Badge\n        className={`${base} bg-rose-600/20 text-rose-100 border-rose-500/60`}\n      >\n        review\n      </Badge>\n    )\n  return (\n    <Badge className={`${base} bg-white/10 text-white/60 border-white/30`}>\n      {action}\n    </Badge>\n  )\n}\n\nfunction UrgencyBar({ score }: { score: number | null }) {\n  const v = Math.min(Math.max(score ?? 0, 0), 100)\n  const color =\n    v >= 70 ? \"bg-rose-500\" : v >= 40 ? \"bg-amber-400\" : \"bg-emerald-400\"\n\n  return (\n    <div className=\"h-2 w-full rounded-full bg-white/10 overflow-hidden\">\n      <div className={`${color} h-full`} style={{ width: `${v}%` }} />\n    </div>\n  )\n}\n\nfunction NextActionsSection({ rows }: { rows: NextActionRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Next actions queue\"\n        description=\"Lo que el Lead Brain quiere hacer ahora mismo.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay acciones pendientes todavÃ­a.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Bucket</TableHeaderCell>\n                <TableHeaderCell>Canal</TableHeaderCell>\n                <TableHeaderCell>AcciÃ³n</TableHeaderCell>\n                <TableHeaderCell>Delay</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Prioridad\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow\n                  key={row.lead_id}\n                  className=\"hover:bg-white/10 cursor-pointer\"\n                >\n                  <TableCell>\n                    <div className=\"flex flex-col gap-0.5\">\n                      <Link\n                        href={`/leads/${row.lead_id}`}\n                        className=\"text-sm font-semibold text-white hover:underline\"\n                      >\n                        {row.lead_name ??\n                          row.email ??\n                          row.phone ??\n                          row.lead_id.slice(0, 8).toUpperCase()}\n                      </Link>\n                      {row.reason ? (\n                        <p className=\"text-xs text-white/60\">{row.reason}</p>\n                      ) : null}\n                      <div className=\"mt-1 flex flex-wrap gap-1.5\">\n                        {row.industry && (\n                          <span className=\"rounded-full border border-emerald-400/60 bg-emerald-500/15 px-2 py-0.5 text-[11px] text-emerald-100\">\n                            {row.industry}\n                          </span>\n                        )}\n                        {row.sub_industry && (\n                          <span className=\"rounded-full border border-emerald-400/60 bg-emerald-500/10 px-2 py-0.5 text-[11px] text-emerald-50\">\n                            {row.sub_industry}\n                          </span>\n                        )}\n                        {row.enrichment_status && (\n                          <span className=\"rounded-full border border-white/20 bg-white/10 px-2 py-0.5 text-[11px] text-white/70\">\n                            {row.enrichment_status}\n                          </span>\n                        )}\n                      </div>\n                      {row.ai_lead_score != null && (\n                        <p className=\"text-[11px] text-white/50\">\n                          AI score: {row.ai_lead_score.toFixed(0)}\n                        </p>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <BrainBucketBadge bucket={row.lead_brain_bucket} />\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2 text-sm text-white/70\">\n                      <ChannelIcon channel={row.recommended_channel} />\n                      <span className=\"capitalize\">\n                        {row.recommended_channel ?? \"--\"}\n                      </span>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <ActionBadge action={row.recommended_action} />\n                  </TableCell>\n                  <TableCell className=\"text-sm text-white/70\">\n                    {row.recommended_delay_minutes != null\n                      ? `${row.recommended_delay_minutes} min`\n                      : \"--\"}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex flex-col items-end gap-1\">\n                      <span className=\"text-xs text-white/60\">\n                        {row.priority_score ?? 0}\n                      </span>\n                      <UrgencyBar score={row.priority_score} />\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ðŸ”¬ Enrichment Engine v2 â€“ UI\n\nfunction EnrichmentEngineV2Section({\n  overview,\n}: {\n  overview: EnrichmentOverview\n}) {\n  const queue = overview.queue\n  const summary = overview.summary\n\n  const totalInQueue = queue.reduce((acc, q) => acc + q.total, 0)\n  const pending =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"pending\")\n      ?.total ?? 0\n  const failed =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"failed\")\n      ?.total ?? 0\n  const completed =\n    queue.find((q) => (q.status ?? \"\").toLowerCase() === \"completed\")\n      ?.total ?? 0\n\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Enrichment Engine v2\"\n        description=\"Cola y estado de los leads enriquecidos.\"\n      />\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid gap-3 sm:grid-cols-4\">\n          <MetricTile\n            label=\"En cola\"\n            value={totalInQueue}\n            helper=\"Registros en enrichment_queue\"\n          />\n          <MetricTile\n            label=\"Pending\"\n            value={pending}\n            helper=\"AÃºn por procesar\"\n          />\n          <MetricTile\n            label=\"Completed\"\n            value={completed}\n            helper=\"Marcados como completados\"\n          />\n          <MetricTile\n            label=\"Failed\"\n            value={failed}\n            helper=\"Errores recientes\"\n          />\n        </div>\n\n        <div className=\"rounded-2xl border border-white/10 bg-black/30\">\n          {summary.length === 0 ? (\n            <p className=\"p-4 text-sm text-white/60\">\n              AÃºn no hay leads con enrichment v2.\n            </p>\n          ) : (\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Status</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Leads\n                  </TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Avg AI score\n                  </TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {summary.map((row) => (\n                  <TableRow key={row.enrichment_status ?? \"unknown\"}>\n                    <TableCell className=\"capitalize text-white\">\n                      {row.enrichment_status ?? \"unknown\"}\n                    </TableCell>\n                    <TableCell className=\"text-right text-white/80\">\n                      {row.total}\n                    </TableCell>\n                    <TableCell className=\"text-right text-white/80\">\n                      {row.avg_ai_lead_score != null\n                        ? row.avg_ai_lead_score.toFixed(1)\n                        : \"â€”\"}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ---------- PÃ¡gina principal ----------\n\nexport default async function DirectorPage() {\n  const supabase = supabaseServer()\n\n  const [\n    nextActions,\n    engines,\n    appointmentMetrics,\n    leadMetrics,\n    snapshot,\n    campaignRows,\n    alerts,\n    enrichmentOverview,\n  ] = await Promise.all([\n    loadNextActions(supabase),\n    loadEngines(supabase),\n    loadAppointmentMetrics(supabase),\n    loadLeadMetrics(supabase),\n    getSystemSnapshot(),\n    loadCampaignEngine(supabase),\n    loadDirectorAlerts(supabase),\n    loadEnrichmentOverview(supabase),\n  ])\n\n  const hasError = engines.some((e) => e.status === \"Error\")\n  const hasAnyRun = engines.some((e) => e.lastRun !== null)\n\n  const engineLabel = hasError\n    ? \"Engine con issues Â· revisa logs\"\n    : hasAnyRun\n    ? \"Engine ok Â· cron corriendo\"\n    : \"Sin datos aÃºn Â· engine idle\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasError\n    ? \"destructive\"\n    : hasAnyRun\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Operations & campaigns\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Director Dashboard\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Pulso de los motores de Revenue ASI, next actions y performance de\n            campaÃ±as.\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      <NextActionsSection rows={nextActions} />\n\n      <div className=\"grid items-start gap-6 xl:grid-cols-[minmax(0,1.7fr)_minmax(0,1.3fr)]\">\n        <Card className=\"border-white/10 bg-white/5\">\n          <CardHeader\n            title=\"Engines\"\n            description=\"Core cron jobs y su Ãºltima actividad.\"\n          />\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Job</TableHeaderCell>\n                  <TableHeaderCell>Schedule</TableHeaderCell>\n                  <TableHeaderCell>Last run</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">\n                    Status\n                  </TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {engines.map((engine) => (\n                  <TableRow key={engine.name}>\n                    <TableCell className=\"font-semibold text-white\">\n                      {engine.name}\n                    </TableCell>\n                    <TableCell className=\"text-white/70\">\n                      {engine.schedule ?? \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {engine.lastRun\n                        ? dateTimeFormatter.format(new Date(engine.lastRun))\n                        : \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <StatusBadge status={engine.status} />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-4\">\n          <SystemSnapshotCard snapshot={snapshot} />\n\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Appointments\"\n              description=\"Actividad agendada hoy.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-3\">\n              <MetricTile\n                label=\"Appointments\"\n                value={appointmentMetrics.appointmentsToday}\n                helper=\"Starts today\"\n              />\n              <MetricTile\n                label=\"Reminders\"\n                value={appointmentMetrics.remindersToday}\n                helper=\"Notification jobs\"\n              />\n              <MetricTile\n                label=\"Reminder touch runs\"\n                value={\n                  appointmentMetrics.reminderTouchRunsToday\n                }\n                helper=\"Steps 200â€“202\"\n              />\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader\n              title=\"Lead Flow\"\n              description=\"Top-of-funnel signals.\"\n            />\n            <CardContent className=\"grid gap-3 sm:grid-cols-4\">\n              <MetricTile\n                label=\"New leads\"\n                value={leadMetrics.newLeadsToday}\n                helper=\"Created today\"\n              />\n              <MetricTile\n                label=\"Leads w/ appts\"\n                value={leadMetrics.leadsWithAppointments}\n                helper=\"Distinct leads\"\n              />\n              <MetricTile\n                label=\"Shows\"\n                value={leadMetrics.showsToday}\n                helper=\"Outcome: show\"\n              />\n              <MetricTile\n                label=\"No-shows\"\n                value={leadMetrics.noShowsToday}\n                helper=\"Outcome: no_show\"\n              />\n            </CardContent>\n          </Card>\n\n          <EnrichmentEngineV2Section overview={enrichmentOverview} />\n        </div>\n      </div>\n\n      <CampaignEngineSection rows={campaignRows} />\n      <DirectorAlertsSection alerts={alerts} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_aedad0ed._.js.map:8:    {"offset": {"line": 368, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/components/leads/timeline-utils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport type TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  campaign_run_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  status: string | null\n  payload: any\n  scheduled_at: string | null\n  sent_at: string | null\n  created_at: string\n  error: string | null\n  meta: any\n}\n\nexport const touchRunSelect =\n  \"id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta\"\n\nexport const channelLabel: Record<string, string> = {\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n  voice: \"Voice\",\n}\n\nexport function getWhen(step: TouchRunRow) {\n  return step.sent_at ?? step.scheduled_at ?? step.created_at ?? null\n}\n\nexport function formatPreview(payload: any) {\n  if (!payload) return \"â€”\"\n  let preview: string\n\n  if (typeof payload === \"string\") {\n    preview = payload\n  } else if (typeof payload === \"object\") {\n    const maybeMessage = (payload as Record<string, unknown>).message\n    const maybeBody = (payload as Record<string, unknown>).body\n    const maybeSubject = (payload as Record<string, unknown>).subject\n    if (typeof maybeMessage === \"string\") preview = maybeMessage\n    else if (typeof maybeBody === \"string\") preview = maybeBody\n    else if (typeof maybeSubject === \"string\") preview = maybeSubject\n    else preview = JSON.stringify(payload)\n  } else {\n    preview = String(payload)\n  }\n\n  if (preview.length > 140) return `${preview.slice(0, 140)}â€¦`\n  return preview\n}\n\nexport function statusVariant(status: string | null) {\n  const normalized = status?.toLowerCase()\n  if (normalized === \"sent\") return \"success\" as const\n  if (normalized === \"scheduled\" || normalized === \"pending\") return \"warning\" as const\n  if (normalized === \"failed\" || normalized === \"error\") return \"destructive\" as const\n  return \"neutral\" as const\n}\n\nexport function formatDate(dateString: string | null, options?: Intl.DateTimeFormatOptions) {\n  if (!dateString) return null\n  const parsed = new Date(dateString)\n  if (Number.isNaN(parsed.getTime())) return null\n  return new Intl.DateTimeFormat(\"en-US\", options).format(parsed)\n}\n\nexport async function fetchLeadTouchRuns(\n  client: Pick<\n    import(\"@supabase/supabase-js\").SupabaseClient,\n    \"from\"\n  >,\n  leadId: string,\n) {\n  return client\n    .from(\"touch_runs\")\n    .select(touchRunSelect)\n    .eq(\"lead_id\", leadId)\n    .order(\"sent_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"scheduled_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"created_at\", { ascending: false })\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;;;;;;;;;;AAkB9C,MAAM,iBACX;AAEK,MAAM,eAAuC;IAClD,UAAU;IACV,KAAK;IACL,OAAO;IACP,OAAO;AACT;AAEO,SAAS,QAAQ,IAAiB;IACvC,OAAO,KAAK,OAAO,IAAI,KAAK,YAAY,IAAI,KAAK,UAAU,IAAI;AACjE;AAEO,SAAS,cAAc,OAAY;IACxC,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI;IAEJ,IAAI,OAAO,YAAY,UAAU;QAC/B,UAAU;IACZ,OAAO,IAAI,OAAO,YAAY,UAAU;QACtC,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,MAAM,YAAY,AAAC,QAAoC,IAAI;QAC3D,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAC3C,IAAI,OAAO,cAAc,UAAU,UAAU;aAC7C,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAChD,UAAU,KAAK,SAAS,CAAC;IAChC,OAAO;QACL,UAAU,OAAO;IACnB;IAEA,IAAI,QAAQ,MAAM,GAAG,KAAK,OAAO,GAAG,QAAQ,KAAK,CAAC,GAAG,KAAK,CAAC,CAAC;IAC5D,OAAO;AACT;AAEO,SAAS,cAAc,MAAqB;IACjD,MAAM,aAAa,QAAQ;IAC3B,IAAI,eAAe,QAAQ,OAAO;IAClC,IAAI,eAAe,eAAe,eAAe,WAAW,OAAO;IACnE,IAAI,eAAe,YAAY,eAAe,SAAS,OAAO;IAC9D,OAAO;AACT;AAEO,SAAS,WAAW,UAAyB,EAAE,OAAoC;IACxF,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,SAAS,IAAI,KAAK;IACxB,IAAI,OAAO,KAAK,CAAC,OAAO,OAAO,KAAK,OAAO;IAC3C,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS,SAAS,MAAM,CAAC;AAC1D;AAEO,eAAe,mBACpB,MAGC,EACD,MAAc;IAEd,OAAO,OACJ,IAAI,CAAC,cACL,MAAM,CAAC,gBACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,WAAW;QAAE,WAAW;QAAO,WAAW;IAAK,GACrD,KAAK,CAAC,gBAAgB;QAAE,WAAW;QAAO,WAAW;IAAK,GAC1D,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;AAC5C"}},
./.next/dev/server/chunks/ssr/src_aedad0ed._.js.map:9:    {"offset": {"line": 441, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/leads/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport Link from \"next/link\"\nimport { useParams } from \"next/navigation\"\nimport { ArrowLeft, Building2, Mail, MapPin, PhoneCall, User } from \"lucide-react\"\n\nimport { LeadActivityTimeline, type LeadTimelineEvent } from \"@/components/leads/LeadActivityTimeline\"\nimport { Badge, Button, Card, CardContent, CardHeader } from \"@/components/ui-custom\"\nimport { StatCard } from \"@/components/ui-custom/stat-card\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport type { LeadEnriched } from \"@/types/lead\"\nimport {\n  describeAppointmentOutcome,\n  describeReminder,\n  describeTouchRun,\n} from \"@/components/leads/lead-activity-labels\"\nimport { touchRunSelect, type TouchRunRow } from \"@/components/leads/timeline-utils\"\n\ntype LeadDetail = LeadEnriched & {\n  company_name?: string | null\n  notes?: string | null\n}\n\ntype AppointmentRow = {\n  id: string\n  lead_id: string | null\n  channel: string | null\n  status: string | null\n  outcome: string | null\n  notes: string | null\n  starts_at: string | null\n  scheduled_for: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  appointment_id: string | null\n  notify_at: string | null\n  status: string | null\n  payload: Record<string, any> | null\n  created_at?: string | null\n}\n\ntype LeadGenome = {\n  industry: string | null\n  sub_industry: string | null\n  pain_points: string[] | null\n  objections: string[] | null\n  emotional_state: Record<string, any> | null\n  urgency_score: number | null\n  budget_estimate: string | null\n  decision_authority_score: number | null\n  conversion_likelihood: number | null\n  recommended_channel: string | null\n  recommended_cadence: Record<string, any> | null\n  recommended_persona: string | null\n  ai_lead_score: number | null\n  status: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype LeadDataResult = {\n  lead: LeadDetail | null\n  genome: LeadGenome | null\n  events: LeadTimelineEvent[]\n  stats: {\n    touches: number\n    appointments: number\n    reminders: number\n  }\n}\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return null\n  return date.toLocaleString()\n}\n\nfunction deriveLeadTitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin nombre\"\n  return (\n    lead.full_name ||\n    (lead as any).contact_name ||\n    lead.email ||\n    lead.phone ||\n    \"Sin nombre\"\n  )\n}\n\nfunction deriveLeadSubtitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin contacto\"\n  const email = lead.email ?? \"Sin email\"\n  const phone = lead.phone ?? \"Sin telÃ©fono\"\n  return `${email} Â· ${phone}`\n}\n\nfunction appointmentTime(appt: AppointmentRow) {\n  return appt.starts_at ?? appt.scheduled_for ?? appt.created_at\n}\n\nfunction mapTouchRuns(touchRuns: TouchRunRow[]): LeadTimelineEvent[] {\n  return touchRuns.map((touch) => {\n    const occurredAt = touch.scheduled_at ?? touch.created_at\n    const { label, description } = describeTouchRun(touch)\n\n    return {\n      id: `touch-${touch.id}`,\n      occurredAt: occurredAt ?? new Date().toISOString(),\n      type: \"touch_run\" as const,\n      channel: touch.channel,\n      step: touch.step,\n      label,\n      description,\n      status: touch.status,\n      meta: touch.meta ?? undefined,\n    }\n  })\n}\n\nfunction mapAppointments(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments.map((appointment) => {\n    const when = appointmentTime(appointment) ?? new Date().toISOString()\n    const formatted = formatDateTime(when)\n    const description = formatted\n      ? `Scheduled for ${formatted}${\n          appointment.notes ? ` Â· ${appointment.notes}` : \"\"\n        }`\n      : appointment.notes ?? undefined\n\n    return {\n      id: `appointment-${appointment.id}`,\n      occurredAt: when,\n      type: \"appointment\" as const,\n      channel: appointment.channel,\n      step: null,\n      label: \"Appointment scheduled\",\n      description,\n      status: appointment.status,\n      meta: { appointmentId: appointment.id },\n    }\n  })\n}\n\nfunction mapAppointmentOutcomes(\n  appointments: AppointmentRow[],\n): LeadTimelineEvent[] {\n  return appointments\n    .filter((appointment) => Boolean(appointment.outcome))\n    .map((appointment) => {\n      const label = describeAppointmentOutcome(appointment.outcome)\n      const when =\n        appointment.updated_at ??\n        appointmentTime(appointment) ??\n        new Date().toISOString()\n      const apptTime = appointmentTime(appointment)\n      const formatted = formatDateTime(apptTime)\n\n      const description = formatted\n        ? `Outcome for appointment on ${formatted}`\n        : \"Appointment outcome updated\"\n\n      return {\n        id: `appointment-outcome-${appointment.id}`,\n        occurredAt: when,\n        type: \"appointment_outcome\" as const,\n        channel: appointment.channel,\n        step: null,\n        label,\n        description,\n        status: appointment.outcome,\n        meta: { appointmentId: appointment.id },\n      }\n    })\n}\n\nfunction mapAppointmentReminders(\n  reminders: AppointmentNotificationRow[],\n  appointmentById: Map<string, AppointmentRow>,\n  leadId: string,\n): LeadTimelineEvent[] {\n  return reminders\n    .filter((reminder) => {\n      const payloadLeadId =\n        (reminder.payload?.lead_id as string | undefined) ?? null\n      const appointmentLeadId = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)?.lead_id ?? null\n        : null\n      return payloadLeadId === leadId || appointmentLeadId === leadId\n    })\n    .map((reminder) => {\n      const appointment = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)\n        : undefined\n      const when =\n        reminder.notify_at ??\n        appointmentTime(\n          appointment ?? ({} as AppointmentRow),\n        ) ??\n        new Date().toISOString()\n      const kind = (reminder.payload?.kind as string | undefined) ?? null\n      const reminderLabel = describeReminder(kind) ?? \"Appointment reminder\"\n      const appointmentDate = appointmentTime(\n        appointment ?? ({} as AppointmentRow),\n      )\n      const formatted = formatDateTime(appointmentDate)\n\n      return {\n        id: `appointment-reminder-${reminder.id}`,\n        occurredAt: when,\n        type: \"appointment_reminder\" as const,\n        channel: appointment?.channel ?? null,\n        step: null,\n        label: reminderLabel,\n        description: formatted\n          ? `Reminder for appointment on ${formatted}`\n          : undefined,\n        status: reminder.status,\n        meta: { appointmentId: reminder.appointment_id, kind },\n      }\n    })\n}\n\nasync function loadLeadDataBrowser(leadId: string): Promise<LeadDataResult> {\n  const client = supabaseBrowser()\n\n  // 1) Vista rica: lead_enriched\n  const { data: enrichedRow, error: enrichedError } = await client\n    .from(\"lead_enriched\")\n    .select(\n      \"id, full_name, email, phone, state, last_touch_at, channel_last, campaign_id, campaign_name, company_name, enriched\",\n    )\n    .eq(\"id\", leadId)\n    .maybeSingle()\n\n  let lead: LeadDetail | null = null\n\n  if (enrichedRow) {\n    lead = {\n      ...(enrichedRow as any),\n      company_name:\n        (enrichedRow as any).company_name ??\n        (enrichedRow as any).company ??\n        null,\n    }\n  } else {\n    // 2) Fallback: tabla leads (import original)\n    const { data: baseRow } = await client\n      .from(\"leads\")\n      .select(\n        \"id, contact_name, email, phone, state, last_touched_at, last_channel, campaign_id, campaign_name, company_name, enriched\",\n      )\n      .eq(\"id\", leadId)\n      .maybeSingle()\n\n    if (baseRow) {\n      lead = {\n        id: baseRow.id,\n        full_name: (baseRow as any).contact_name ?? null,\n        email: baseRow.email ?? null,\n        phone: baseRow.phone ?? null,\n        state: baseRow.state ?? null,\n        last_touch_at: (baseRow as any).last_touched_at ?? null,\n        campaign_id: (baseRow as any).campaign_id ?? null,\n        campaign_name: (baseRow as any).campaign_name ?? null,\n        channel_last: (baseRow as any).last_channel ?? null,\n        company_name: (baseRow as any).company_name ?? null,\n        enriched: (baseRow as any).enriched ?? null,\n      } as any\n    }\n\n    if (!baseRow && enrichedError) {\n      console.warn(\"lead_enriched error:\", enrichedError)\n    }\n  }\n\n  // Si aÃºn no tenemos lead, devolvemos dummy pero con ID\n  if (!lead) {\n    lead = {\n      id: leadId,\n      full_name: null,\n      email: null,\n      phone: null,\n      state: \"unknown\",\n      last_touch_at: null,\n      campaign_id: null,\n      campaign_name: null,\n      channel_last: null,\n      company_name: null,\n      notes: null,\n      enriched: null,\n    } as any\n  }\n\n  // 3) Lead Genome: Ãºltimo enrichment_v2 completado\n  let genome: LeadGenome | null = null\n\n  const { data: enrichmentRow, error: enrichmentError } = await client\n    .from(\"lead_enrichments_v2\")\n    .select(\n      `\n      industry,\n      sub_industry,\n      pain_points,\n      objections,\n      emotional_state,\n      urgency_score,\n      budget_estimate,\n      decision_authority_score,\n      conversion_likelihood,\n      recommended_channel,\n      recommended_cadence,\n      recommended_persona,\n      ai_lead_score,\n      status,\n      created_at,\n      updated_at\n    `,\n    )\n    .eq(\"lead_id\", leadId)\n    .order(\"created_at\", { ascending: false })\n    .limit(1)\n    .maybeSingle()\n\n  if (enrichmentError) {\n    console.warn(\"lead_enrichments_v2 error:\", enrichmentError)\n  }\n\n  if (enrichmentRow) {\n    genome = {\n      industry: enrichmentRow.industry ?? null,\n      sub_industry: enrichmentRow.sub_industry ?? null,\n      pain_points: (enrichmentRow.pain_points as string[] | null) ?? null,\n      objections: (enrichmentRow.objections as string[] | null) ?? null,\n      emotional_state:\n        (enrichmentRow.emotional_state as Record<string, any> | null) ?? null,\n      urgency_score:\n        typeof enrichmentRow.urgency_score === \"number\"\n          ? enrichmentRow.urgency_score\n          : enrichmentRow.urgency_score != null\n          ? Number(enrichmentRow.urgency_score)\n          : null,\n      budget_estimate: enrichmentRow.budget_estimate ?? null,\n      decision_authority_score:\n        typeof enrichmentRow.decision_authority_score === \"number\"\n          ? enrichmentRow.decision_authority_score\n          : enrichmentRow.decision_authority_score != null\n          ? Number(enrichmentRow.decision_authority_score)\n          : null,\n      conversion_likelihood:\n        typeof enrichmentRow.conversion_likelihood === \"number\"\n          ? enrichmentRow.conversion_likelihood\n          : enrichmentRow.conversion_likelihood != null\n          ? Number(enrichmentRow.conversion_likelihood)\n          : null,\n      recommended_channel: enrichmentRow.recommended_channel ?? null,\n      recommended_cadence:\n        (enrichmentRow.recommended_cadence as Record<string, any> | null) ??\n        null,\n      recommended_persona: enrichmentRow.recommended_persona ?? null,\n      ai_lead_score:\n        typeof enrichmentRow.ai_lead_score === \"number\"\n          ? enrichmentRow.ai_lead_score\n          : enrichmentRow.ai_lead_score != null\n          ? Number(enrichmentRow.ai_lead_score)\n          : null,\n      status: enrichmentRow.status ?? null,\n      created_at: enrichmentRow.created_at ?? null,\n      updated_at: enrichmentRow.updated_at ?? null,\n    }\n  }\n\n  // 4) Timeline y stats\n  const [touchRunsResult, appointmentsResult, remindersResult] =\n    await Promise.all([\n      client\n        .from(\"touch_runs\")\n        .select(touchRunSelect)\n        .eq(\"lead_id\", leadId)\n        .order(\"scheduled_at\", {\n          ascending: false,\n          nullsLast: true,\n        } as any)\n        .order(\"created_at\", { ascending: false }),\n      client\n        .from(\"appointments\")\n        .select(\n          \"id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at\",\n        )\n        .eq(\"lead_id\", leadId),\n      client\n        .from(\"appointments_notifications\")\n        .select(\n          \"id, appointment_id, notify_at, status, payload, created_at\",\n        ),\n    ])\n\n  const touchRuns = (touchRunsResult.data ?? []) as TouchRunRow[]\n  const appointments = (appointmentsResult.data ?? []) as AppointmentRow[]\n  const reminders =\n    (remindersResult.data ?? []) as AppointmentNotificationRow[]\n\n  const appointmentById = new Map<string, AppointmentRow>()\n  appointments.forEach((row) => appointmentById.set(row.id, row))\n\n  const events: LeadTimelineEvent[] = [\n    ...mapTouchRuns(touchRuns),\n    ...mapAppointments(appointments),\n    ...mapAppointmentOutcomes(appointments),\n    ...mapAppointmentReminders(reminders, appointmentById, leadId),\n  ].sort((a, b) => {\n    const aTime = new Date(a.occurredAt).getTime()\n    const bTime = new Date(b.occurredAt).getTime()\n    const safeA = Number.isNaN(aTime) ? 0 : aTime\n    const safeB = Number.isNaN(bTime) ? 0 : bTime\n    return safeB - safeA\n  })\n\n  return {\n    lead,\n    genome,\n    events,\n    stats: {\n      touches: touchRuns.length,\n      appointments: appointments.length,\n      reminders: reminders.length,\n    },\n  }\n}\n\nexport default function LeadDetailPage() {\n  const params = useParams<{ id: string }>()\n  const leadId = params.id\n\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [lead, setLead] = useState<LeadDetail | null>(null)\n  const [genome, setGenome] = useState<LeadGenome | null>(null)\n  const [events, setEvents] = useState<LeadTimelineEvent[]>([])\n  const [stats, setStats] = useState({\n    touches: 0,\n    appointments: 0,\n    reminders: 0,\n  })\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (!supabaseReady || !leadId) return\n\n    let alive = true\n\n    ;(async () => {\n      setLoading(true)\n      const result = await loadLeadDataBrowser(leadId)\n      if (!alive) return\n      setLead(result.lead)\n      setGenome(result.genome)\n      setEvents(result.events)\n      setStats(result.stats)\n      setLoading(false)\n    })()\n\n    return () => {\n      alive = false\n    }\n  }, [leadId, supabaseReady])\n\n  const title = deriveLeadTitle(lead)\n  const subtitle = deriveLeadSubtitle(lead)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/leads\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft size={16} />\n              Back\n            </Button>\n          </Link>\n          <div>\n            <p className=\"text-sm uppercase tracking-[0.16em] text-white/50\">\n              Lead\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Lead timeline\n            </h1>\n            <p className=\"text-sm text-white/80\">{title}</p>\n            <p className=\"text-xs text-white/60\">\n              {subtitle} Â· ID: {leadId}\n            </p>\n          </div>\n        </div>\n        {lead?.state ? (\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {lead.state}\n          </Badge>\n        ) : null}\n      </div>\n\n      {/* Overview */}\n      <Card>\n        <CardHeader\n          title=\"Lead overview\"\n          description=\"Basic details and last touch information\"\n        />\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex items-center gap-2 text-white\">\n              <User size={16} className=\"text-white/60\" />\n              <span className=\"font-semibold\">{title}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Mail size={14} className=\"text-white/50\" />\n              <span>{lead?.email ?? \"Sin email\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <PhoneCall size={14} className=\"text-white/50\" />\n              <span>{lead?.phone ?? \"Sin telÃ©fono\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Building2 size={14} className=\"text-white/50\" />\n              <span>{lead?.company_name ?? \"Sin compaÃ±Ã­a\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <MapPin size={14} className=\"text-white/50\" />\n              <span>{lead?.channel_last ?? \"Sin canal\"}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80\">\n            <p className=\"text-sm text-white/60\">Last touch</p>\n            <p className=\"text-lg font-semibold text-white\">\n              {formatDateTime(lead?.last_touch_at ?? null) ??\n                \"No touches yet\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Channel: {lead?.channel_last ?? \"â€”\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Campaign:{\" \"}\n              {lead?.campaign_name ?? lead?.campaign_id ?? \"â€”\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Lead Genome V2 */}\n      {genome && (\n        <Card>\n          <CardHeader\n            title=\"Lead Genome\"\n            description=\"Industry, pains, objections and AI recommendations for this lead\"\n          />\n          <CardContent className=\"grid gap-4 md:grid-cols-2 text-sm text-white/80\">\n            <div className=\"space-y-2\">\n              <p>\n                <span className=\"text-white/50\">Industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.industry ?? \"Unknown\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Sub-industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.sub_industry ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">\n                  Recommended channel:\n                </span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_channel ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Persona:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_persona ?? \"â€”\"}\n                </span>\n              </p>\n              {typeof genome.ai_lead_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">AI Lead score:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.ai_lead_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.urgency_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">Urgency:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.urgency_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.decision_authority_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Decision authority:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.decision_authority_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.conversion_likelihood === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Conversion likelihood:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.conversion_likelihood}\n                  </span>\n                </p>\n              )}\n            </div>\n            <div className=\"space-y-3\">\n              {Array.isArray(genome.pain_points) &&\n                genome.pain_points.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Pain points\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.pain_points.map((p, idx) => (\n                        <li key={idx}>{p}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              {Array.isArray(genome.objections) &&\n                genome.objections.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Objections\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.objections.map((o, idx) => (\n                        <li key={idx}>{o}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Stats */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Total activity\"\n          value={events.length.toString()}\n          helper=\"Touches, appointments and reminders\"\n        />\n        <StatCard\n          label=\"Touch runs\"\n          value={stats.touches.toString()}\n          helper=\"touch_runs registrados\"\n        />\n        <StatCard\n          label=\"Appointments\"\n          value={stats.appointments.toString()}\n          helper=\"Incluye outcomes y reminders\"\n        />\n      </div>\n\n      {/* Timeline */}\n      <LeadActivityTimeline events={events} />\n\n      {loading ? (\n        <div className=\"space-y-3\">\n          <div className=\"h-10 animate-pulse rounded-xl bg-white/5\" />\n          <div className=\"h-52 animate-pulse rounded-2xl bg-white/5\" />\n          <div className=\"h-32 animate-pulse rounded-2xl bg-white/5\" />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_c81492e9._.js.map:7:    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/director/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useMemo, useState } from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport { getSystemSnapshot } from \"@/lib/director/system-snapshot\"\n\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n  Button,\n} from \"@/components/ui-custom\"\n\nimport {\n  Flame,\n  Sparkles,\n  Timer,\n  Clock4,\n  PhoneCall,\n  Mail,\n  MessageSquare,\n  Zap,\n  AlertTriangle,\n  RefreshCcw,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// ======================================================\n// TYPES\n// ======================================================\n\ntype NextActionRow = {\n  lead_id: string\n  email: string | null\n  phone: string | null\n  lead_state: string | null\n  lead_brain_bucket: string | null\n  recommended_channel: string | null\n  recommended_action: string | null\n  recommended_delay_minutes: number | null\n  priority_score: number | null\n  reason: string | null\n}\n\ntype EngineStatus = {\n  name: string\n  schedule: string | null\n  lastRun: string | null\n  status: \"OK\" | \"Error\" | \"No data\"\n}\n\ntype AppointmentMetrics = {\n  appointmentsToday: number\n  remindersToday: number\n  reminderTouchRunsToday: number\n}\n\ntype LeadMetrics = {\n  newLeadsToday: number\n  leadsWithAppointments: number\n  showsToday: number\n  noShowsToday: number\n}\n\ntype CampaignEngineRow = {\n  campaign_id: string\n  campaign_name: string | null\n  total_touches: number\n  leads_touched: number\n  engaged_leads: number\n  reply_rate: number\n  error_rate: number\n  leads_attempting: number\n  leads_engaged: number\n  leads_booked: number\n  leads_booked_show: number\n  leads_booked_no_show: number\n  first_touch_at: string | null\n  last_touch_at: string | null\n}\n\ntype DirectorAlertRow = {\n  id: string\n  created_at: string\n  actor: string | null\n  event_type: string | null\n  importance: number | null\n  payload: Record<string, any> | null\n}\n\n// ======================================================\n// HELPERS UI\n// ======================================================\n\nfunction ChannelIcon({ channel }: { channel: string | null }) {\n  if (!channel) return <Zap className=\"text-white/40\" size={16} />\n\n  switch (channel) {\n    case \"email\":\n      return <Mail size={16} className=\"text-emerald-300\" />\n    case \"voice\":\n      return <PhoneCall size={16} className=\"text-amber-300\" />\n    case \"whatsapp\":\n      return <MessageSquare size={16} className=\"text-green-400\" />\n    case \"sms\":\n      return <MessageSquare size={16} className=\"text-blue-400\" />\n    default:\n      return <Zap size={16} className=\"text-white/40\" />\n  }\n}\n\nfunction BrainBucketBadge({ bucket }: { bucket: string | null }) {\n  if (!bucket) return <Badge className=\"bg-white/10 text-white/60\">unknown</Badge>\n\n  const variants: Record<string, string> = {\n    hot: \"bg-rose-600/30 text-rose-200 border border-rose-500/40\",\n    warm: \"bg-amber-500/20 text-amber-200 border border-amber-400/40\",\n    cold: \"bg-blue-500/20 text-blue-200 border border-blue-400/40\",\n  }\n\n  return (\n    <Badge className={`px-2 py-0.5 text-xs ${variants[bucket] ?? \"\"}`}>\n      {bucket}\n    </Badge>\n  )\n}\n\nfunction ActionBadge({ action }: { action: string | null }) {\n  if (!action) return null\n\n  const colors: Record<string, string> = {\n    send: \"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30\",\n    cooldown: \"bg-amber-500/20 text-amber-200 border border-amber-400/30\",\n    stop: \"bg-white/10 text-white/60 border border-white/20\",\n    review: \"bg-rose-600/20 text-rose-200 border border-rose-500/40\",\n  }\n\n  return (\n    <Badge className={`px-2 py-0.5 text-xs ${colors[action] ?? \"\"}`}>\n      {action}\n    </Badge>\n  )\n}\n\nfunction UrgencyBar({ score }: { score: number | null }) {\n  const value = Math.min(Math.max(score ?? 0, 0), 100)\n  const color =\n    value > 70 ? \"bg-rose-500\" : value > 40 ? \"bg-amber-400\" : \"bg-emerald-400\"\n\n  return (\n    <div className=\"w-full bg-white/10 h-2 rounded-full overflow-hidden\">\n      <div className={`${color} h-full`} style={{ width: `${value}%` }} />\n    </div>\n  )\n}\n\n// ======================================================\n// LOADERS\n// ======================================================\n\nasync function loadNextActions(client: ReturnType<typeof supabaseServer>) {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"lead_next_action_view\")\n    .select(\"*\")\n    .order(\"priority_score\", { ascending: false })\n    .limit(50)\n\n  if (error) {\n    console.error(\"next actions error:\", error)\n    return []\n  }\n\n  return (data as NextActionRow[]) ?? []\n}\n\nasync function loadEngines(client: ReturnType<typeof supabaseServer>) {\n  const JOB_NAMES = [\n    \"campaign_engine_5m\",\n    \"run_enrichment_5m\",\n    \"dispatch-touch-every-minute\",\n    \"run-cadence-every-5m\",\n    \"revenue-asi-run-enrichment-5min\",\n    \"revenue-asi-touch-fake-5min\",\n    \"revenue-asi-recompute-leads-5min\",\n    \"cron_dispatch_appointment_notifications\",\n  ]\n\n  if (!client) {\n    return JOB_NAMES.map((name) => ({\n      name,\n      schedule: null,\n      lastRun: null,\n      status: \"No data\",\n    }))\n  }\n\n  const [cronJobs, logs] = await Promise.all([\n    client.from(\"cron.job\").select(\"name, schedule\").in(\"name\", JOB_NAMES),\n    client\n      .from(\"dispatch_logs\")\n      .select(\"id, created_at, kind, payload\")\n      .in(\"kind\", JOB_NAMES)\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n  ])\n\n  const schedule = new Map()\n  cronJobs?.data?.forEach((r: any) => schedule.set(r.name, r.schedule))\n\n  const latest = new Map()\n  logs?.data?.forEach((l: any) => {\n    if (!latest.has(l.kind)) latest.set(l.kind, l)\n  })\n\n  return JOB_NAMES.map((name) => {\n    const log = latest.get(name)\n    const error = log?.payload && typeof log.payload === \"object\" && \"error\" in log.payload\n    return {\n      name,\n      schedule: schedule.get(name) ?? null,\n      lastRun: log?.created_at ?? null,\n      status: log ? (error ? \"Error\" : \"OK\") : \"No data\",\n    }\n  })\n}\n\n// Everything else = unchanged loaders:\nasync function loadAppointmentMetrics(client: any): Promise<AppointmentMetrics> {\n  const fallback = { appointmentsToday: 0, remindersToday: 0, reminderTouchRunsToday: 0 }\n  if (!client) return fallback\n\n  const start = new Date(); start.setUTCHours(0, 0, 0, 0)\n  const end = new Date(); end.setUTCHours(24, 0, 0, 0)\n\n  const [a, b, c] = await Promise.all([\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments_notifications\").select(\"id\", { count: \"exact\", head: true }).gte(\"notify_at\", start.toISOString()).lt(\"notify_at\", end.toISOString()),\n    client.from(\"touch_runs\").select(\"id\", { count: \"exact\", head: true }).in(\"step\", [200, 201, 202]).gte(\"scheduled_at\", start.toISOString()).lt(\"scheduled_at\", end.toISOString()),\n  ])\n\n  return {\n    appointmentsToday: a.count ?? 0,\n    remindersToday: b.count ?? 0,\n    reminderTouchRunsToday: c.count ?? 0,\n  }\n}\n\nasync function loadLeadMetrics(client: any): Promise<LeadMetrics> {\n  const fallback = { newLeadsToday: 0, leadsWithAppointments: 0, showsToday: 0, noShowsToday: 0 }\n  if (!client) return fallback\n\n  const start = new Date(); start.setUTCHours(0, 0, 0, 0)\n  const end = new Date(); end.setUTCHours(24, 0, 0, 0)\n\n  const [newLeads, shows, noShows, leadAppointments] = await Promise.all([\n    client.from(\"leads\").select(\"id\", { count: \"exact\", head: true }).gte(\"created_at\", start.toISOString()).lt(\"created_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).eq(\"outcome\", \"show\").gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).eq(\"outcome\", \"no_show\").gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"lead_id\"),\n  ])\n\n  const leadIds = new Set((leadAppointments.data ?? []).map((r: any) => r.lead_id).filter(Boolean))\n\n  return {\n    newLeadsToday: newLeads.count ?? 0,\n    showsToday: shows.count ?? 0,\n    noShowsToday: noShows.count ?? 0,\n    leadsWithAppointments: leadIds.size,\n  }\n}\n\nasync function loadCampaignEngine(client: any) {\n  if (!client) return []\n  const { data } = await client\n    .from(\"campaign_funnel_overview\")\n    .select(\"*\")\n    .order(\"last_touch_at\", { ascending: false })\n    .limit(10)\n  return data ?? []\n}\n\nasync function loadDirectorAlerts(client: any) {\n  if (!client) return []\n  const { data } = await client\n    .from(\"core_memory_events\")\n    .select(\"id, created_at, actor, event_type, importance, payload\")\n    .order(\"created_at\", { ascending: false })\n    .limit(20)\n  return data ?? []\n}\n\n// ======================================================\n// NEXT ACTIONS SECTION (THE STAR OF THE SHOW)\n// ======================================================\n\nfunction NextActionsSection({ rows }: { rows: NextActionRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5 shadow-xl backdrop-blur-xl\">\n      <CardHeader\n        title=\"ðŸ”¥ Next Actions Queue\"\n        description=\"Top priority decisions from the Lead Brain.\"\n      />\n\n      <CardContent className=\"space-y-4\">\n        {rows.length === 0 ? (\n          <p className=\"text-white/60 text-sm\">No actions pending.</p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Bucket</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Action</TableHeaderCell>\n                <TableHeaderCell>Delay</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">Urgency</TableHeaderCell>\n              </TableRow>\n            </TableHead>\n\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow key={row.lead_id} className=\"hover:bg-white/10 cursor-pointer\">\n                  <TableCell>\n                    <div className=\"flex flex-col\">\n                      <Link href={`/leads/${row.lead_id}`} className=\"text-white font-semibold hover:underline\">\n                        {row.email ?? row.phone ?? row.lead_id.slice(0, 8)}\n                      </Link>\n                      <p className=\"text-xs text-white/50\">{row.reason}</p>\n                    </div>\n                  </TableCell>\n\n                  <TableCell>\n                    <BrainBucketBadge bucket={row.lead_brain_bucket} />\n                  </TableCell>\n\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <ChannelIcon channel={row.recommended_channel} />\n                      <span className=\"text-sm text-white/70 capitalize\">\n                        {row.recommended_channel}\n                      </span>\n                    </div>\n                  </TableCell>\n\n                  <TableCell>\n                    <ActionBadge action={row.recommended_action} />\n                  </TableCell>\n\n                  <TableCell className=\"text-white/70 text-sm\">\n                    {row.recommended_delay_minutes} min\n                  </TableCell>\n\n                  <TableCell className=\"text-right\">\n                    <UrgencyBar score={row.priority_score} />\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ======================================================\n// MAIN PAGE\n// ======================================================\n\nexport default async function DirectorPage() {\n  const supabase = supabaseServer()\n\n  const [nextActions, engines, appointmentMetrics, leadMetrics, snapshot, campaignRows, alerts] =\n    await Promise.all([\n      loadNextActions(supabase),\n      loadEngines(supabase),\n      loadAppointmentMetrics(supabase),\n      loadLeadMetrics(supabase),\n      getSystemSnapshot(),\n      loadCampaignEngine(supabase),\n      loadDirectorAlerts(supabase),\n    ])\n\n  const engineHasError = engines.some((e) => e.status === \"Error\")\n  const engineHasRun = engines.some((e) => e.lastRun)\n\n  const engineLabel = engineHasError\n    ? \"Engine issues detected\"\n    : engineHasRun\n    ? \"Engine running normally\"\n    : \"Engine idle\"\n\n  return (\n    <div className=\"space-y-8\">\n      {/* HEADER */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-xs uppercase tracking-widest text-white/50\">Autonomous System</p>\n          <h1 className=\"text-3xl font-bold text-white\">Director Dashboard</h1>\n          <p className=\"text-sm text-white/60\">\n            Brain, engines, next actions & campaign intelligence.\n          </p>\n        </div>\n        <Badge className=\"bg-white/10 border border-white/20 text-white/80 text-xs px-4 py-1 flex items-center gap-2\">\n          <Sparkles size={12} />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* NEXT ACTIONS */}\n      <NextActionsSection rows={nextActions} />\n\n      {/* ENGINES + SNAPSHOT + METRICS */}\n      <div className=\"grid xl:grid-cols-[1.6fr_1fr] gap-6\">\n        {/* Engines */}\n        <Card className=\"border-white/10 bg-white/5\">\n          <CardHeader title=\"Engines\" description=\"Core cron jobs activity.\" />\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Job</TableHeaderCell>\n                  <TableHeaderCell>Schedule</TableHeaderCell>\n                  <TableHeaderCell>Last Run</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">Status</TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {engines.map((e) => (\n                  <TableRow key={e.name}>\n                    <TableCell className=\"text-white font-semibold\">{e.name}</TableCell>\n                    <TableCell className=\"text-white/70\">{e.schedule ?? \"--\"}</TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {e.lastRun ? new Date(e.lastRun).toLocaleString() : \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Badge\n                        className={`px-2 py-0.5 ${\n                          e.status === \"Error\"\n                            ? \"bg-rose-600/30 text-rose-200 border border-rose-500/40\"\n                            : e.status === \"OK\"\n                            ? \"bg-emerald-600/30 text-emerald-200 border border-emerald-500/40\"\n                            : \"bg-white/10 text-white/60 border border-white/20\"\n                        }`}\n                      >\n                        {e.status}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* SNAPSHOT + APPTS + LEADS */}\n        <div className=\"space-y-4\">\n          {/* SYSTEM SNAPSHOT */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"System Snapshot\" description=\"Core state of the OS.\" />\n            <CardContent className=\"grid grid-cols-2 gap-4\">\n              {[\n                [\"Total leads\", snapshot?.dashboard_overview?.total_leads],\n                [\"Leads attempting\", snapshot?.dashboard_overview?.leads_attempting],\n                [\"Booked\", snapshot?.dashboard_overview?.leads_booked],\n                [\"Campaigns live\", snapshot?.dashboard_overview?.campaigns_live],\n              ].map(([label, val]) => (\n                <div key={label}>\n                  <p className=\"text-xs uppercase text-white/50\">{label}</p>\n                  <p className=\"text-xl font-semibold text-white\">{val ?? 0}</p>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          {/* APPOINTMENTS */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"Appointments\" description=\"Todayâ€™s scheduling activity.\" />\n            <CardContent className=\"grid grid-cols-3 gap-4\">\n              <MetricTile label=\"Appointments\" value={appointmentMetrics.appointmentsToday} helper=\"Today\" />\n              <MetricTile label=\"Reminders\" value={appointmentMetrics.remindersToday} helper=\"Total reminders\" />\n              <MetricTile\n                label=\"Rem. Touch runs\"\n                value={appointmentMetrics.reminderTouchRunsToday}\n                helper=\"Engine-generated\"\n              />\n            </CardContent>\n          </Card>\n\n          {/* LEAD FLOW */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"Lead Flow\" description=\"Top-of-funnel KPIs.\" />\n            <CardContent className=\"grid grid-cols-4 gap-4\">\n              <MetricTile\n                label=\"New leads\"\n                value={leadMetrics.newLeadsToday}\n                helper=\"Created today\"\n              />\n              <MetricTile\n                label=\"With appts\"\n                value={leadMetrics.leadsWithAppointments}\n                helper=\"Booked leads\"\n              />\n              <MetricTile label=\"Shows\" value={leadMetrics.showsToday} helper=\"Good outcomes\" />\n              <MetricTile\n                label=\"No-shows\"\n                value={leadMetrics.noShowsToday}\n                helper=\"Missed appts\"\n              />\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* CAMPAIGN FUNNEL */}\n      <Card className=\"border-white/10 bg-white/5\">\n        <CardHeader title=\"Campaign Funnel\" description=\"Touch â†’ reply â†’ booking pipeline.\" />\n        <CardContent>\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Campaign</TableHeaderCell>\n                <TableHeaderCell>Touched</TableHeaderCell>\n                <TableHeaderCell>Engaged</TableHeaderCell>\n                <TableHeaderCell>Booked</TableHeaderCell>\n                <TableHeaderCell>Show/No-show</TableHeaderCell>\n                <TableHeaderCell>Reply rate</TableHeaderCell>\n                <TableHeaderCell>Error rate</TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {campaignRows.map((c) => (\n                <TableRow key={c.campaign_id}>\n                  <TableCell className=\"font-semibold text-white\">{c.campaign_name}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_touched}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_engaged}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_booked}</TableCell>\n                  <TableCell className=\"text-white/80\">\n                    {c.leads_booked_show} / {c.leads_booked_no_show}\n                  </TableCell>\n                  <TableCell className=\"text-emerald-300\">\n                    {(c.reply_rate * 100).toFixed(1)}%\n                  </TableCell>\n                  <TableCell className=\"text-rose-400\">\n                    {(c.error_rate * 100).toFixed(1)}%\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      {/* ALERTS */}\n      <Card className=\"border-white/10 bg-white/5\">\n        <CardHeader title=\"Director Brain Alerts\" description=\"Internal system evaluations.\" />\n        <CardContent className=\"space-y-4\">\n          {alerts.length === 0 ? (\n            <p className=\"text-white/60 text-sm\">No alerts yet.</p>\n          ) : (\n            alerts.map((a) => (\n              <div\n                key={a.id}\n                className=\"rounded-xl border border-white/10 bg-white/5 p-4 hover:bg-white/10 transition space-y-2\"\n              >\n                <div className=\"flex justify-between\">\n                  <div>\n                    <p className=\"text-xs uppercase tracking-widest text-white/50\">\n                      {a.actor ?? \"System\"}\n                    </p>\n                    <p className=\"font-semibold text-white\">{a.event_type}</p>\n                  </div>\n                  <Badge className=\"bg-white/10 border border-white/20 text-white/70 text-xs px-2\">\n                    {a.importance}\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-white/50\">\n                  {new Date(a.created_at).toLocaleString()}\n                </p>\n                {a.payload?.notes && (\n                  <p className=\"text-sm text-white/70\">{a.payload.notes}</p>\n                )}\n              </div>\n            ))\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n\n// ======================================================\n// METRIC TILE\n// ======================================================\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <div className=\"bg-white/5 border border-white/10 rounded-xl p-3 space-y-1\">\n      <p className=\"text-xs uppercase tracking-widest text-white/50\">{label}</p>\n      <p className=\"text-2xl font-semibold text-white\">{value}</p>\n      <p className=\"text-xs text-white/40\">{helper}</p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_91b6d1b7._.js.map:7:    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/campaigns/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useMemo, useState, useEffect, useCallback } from \"react\"\nimport { Plus, Search, Filter, FolderPlus, Rocket, RefreshCw } from \"lucide-react\"\nimport Link from \"next/link\"\nimport { useRouter } from \"next/navigation\"\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n  Button,\n  Input,\n  Select,\n  StatCard,\n} from \"@/components/ui-custom\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport { campaignsMock } from \"./mock-data\"\nimport { CampaignStatus, CampaignType } from \"@/types/campaign\"\n\ntype CampaignRow = {\n  id?: string\n  uuid?: string\n  name?: string\n  type?: CampaignType\n  status?: CampaignStatus\n  leads_count?: number\n  target_leads?: number\n  reply_rate?: number\n  reply_rate_pct?: number\n  meetings_booked?: number\n  meetings?: number\n  conversion?: number\n  conversion_rate?: number\n  created_at?: string\n  inserted_at?: string\n  error_rate?: number\n  daily_throughput?: number\n  leads_contacted?: number\n  contacts_processed?: number\n}\n\nconst statusStyles: Record<CampaignStatus, string> = {\n  live: \"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30\",\n  paused: \"bg-amber-500/15 text-amber-200 border border-amber-400/30\",\n  draft: \"bg-white/5 text-white/70 border border-white/15\",\n}\n\nconst typeCopy: Record<CampaignType, string> = {\n  outbound: \"Outbound\",\n  nurture: \"Nurture\",\n  reactivation: \"Reactivation\",\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n}\n\nexport default function CampaignsPage() {\n  const router = useRouter()\n\n  const supabase = useMemo(() => {\n    const hasEnv =\n      process.env.NEXT_PUBLIC_SUPABASE_URL &&\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    if (!hasEnv) return null\n    return supabaseBrowser()\n  }, [])\n\n  const [type, setType] = useState<CampaignType | \"all\">(\"all\")\n  const [status, setStatus] = useState<CampaignStatus | \"all\">(\"all\")\n  const [query, setQuery] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [campaigns, setCampaigns] = useState<any[]>([])\n  const [runCounts, setRunCounts] = useState({ campaignRuns: 0, touchRuns: 0 })\n\n  const loadCampaigns = useCallback(async () => {\n    if (!supabase) {\n      setCampaigns(campaignsMock)\n      setLoading(false)\n      return\n    }\n\n    setLoading(true)\n    const { data, error } = await supabase\n      .from(\"campaigns\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false })\n      .limit(200)\n\n    if (error) {\n      console.error(\"Failed to load campaigns\", error)\n      setCampaigns(campaignsMock)\n      setLoading(false)\n      return\n    }\n\n    const mapped = (data ?? []).map((row: CampaignRow) => {\n      const fallbackType = (row.type ?? \"outbound\") as CampaignType\n      return {\n        id: String(row.id ?? row.uuid ?? crypto.randomUUID()),\n        name: row.name ?? \"Untitled campaign\",\n        type: fallbackType,\n        status: (row.status ?? \"draft\") as CampaignStatus,\n        leads_count: Number(row.leads_count ?? row.target_leads ?? 0) || 0,\n        reply_rate: Number(row.reply_rate ?? row.reply_rate_pct ?? 0) || 0,\n        meetings_booked: Number(row.meetings_booked ?? row.meetings ?? 0) || 0,\n        conversion: Number(row.conversion ?? row.conversion_rate ?? 0) || 0,\n        created_at: row.created_at ?? row.inserted_at ?? \"\",\n        error_rate: Number(row.error_rate ?? 0) || undefined,\n        daily_throughput: Number(row.daily_throughput ?? 0) || undefined,\n        leads_contacted: Number(row.leads_contacted ?? row.contacts_processed ?? 0) || undefined,\n      }\n    })\n\n    setCampaigns(mapped.length > 0 ? mapped : campaignsMock)\n    setLoading(false)\n  }, [supabase])\n\n  const loadRunCounts = useCallback(async () => {\n    if (!supabase) return\n    const [{ count: campaignRuns }, { count: touchRuns }] = await Promise.all([\n      supabase.from(\"campaign_runs\").select(\"id\", { head: true, count: \"exact\" }),\n      supabase.from(\"touch_runs\").select(\"id\", { head: true, count: \"exact\" }),\n    ])\n    setRunCounts({\n      campaignRuns: campaignRuns ?? 0,\n      touchRuns: touchRuns ?? 0,\n    })\n  }, [supabase])\n\n  useEffect(() => {\n    loadCampaigns()\n    loadRunCounts()\n  }, [loadCampaigns, loadRunCounts])\n\n  const filtered = useMemo(() => {\n    return campaigns.filter((campaign) => {\n      const matchesType = type === \"all\" || campaign.type === type\n      const matchesStatus = status === \"all\" || campaign.status === status\n      const matchesQuery =\n        query.trim().length === 0 ||\n        (campaign.name ?? \"\").toLowerCase().includes(query.toLowerCase())\n      return matchesType && matchesStatus && matchesQuery\n    })\n  }, [campaigns, type, status, query])\n\n  const summary = useMemo(() => {\n    const total = campaigns.length\n    const live = campaigns.filter((c) => c.status === \"live\").length\n    const avgReply = campaigns.length\n      ? Math.round(\n          campaigns.reduce((acc, c) => acc + (c.reply_rate ?? 0), 0) /\n            campaigns.length\n        )\n      : 0\n    return { total, live, avgReply }\n  }, [campaigns])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Outbound command center\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">Campaigns</h1>\n          <p className=\"text-sm text-white/60\">\n            Control cadence, copy, and throughput with the new neon console.\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"ghost\" size=\"sm\" onClick={loadCampaigns} className=\"gap-2\">\n            <RefreshCw size={16} />\n            Refresh list\n          </Button>\n\n          <Link href=\"/campaigns/new\" className=\"inline-flex\">\n            <Button variant=\"primary\" size=\"md\" className=\"gap-2\">\n              <Plus size={16} /> New campaign\n            </Button>\n          </Link>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Active\"\n          value={`${summary.live} live`}\n          helper={`${runCounts.campaignRuns} recent runs`}\n          delta=\"Synced\"\n        />\n        <StatCard\n          label=\"Reply rate\"\n          value={`${summary.avgReply}%`}\n          helper=\"Rolling 7d across stacks\"\n          delta=\"+1.2%\"\n        />\n        <StatCard\n          label=\"Inventory\"\n          value={`${summary.total} programs`}\n          helper={`${runCounts.touchRuns} touch runs observed`}\n          delta=\"Stable\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader\n          title=\"Programs\"\n          description=\"Filter by type, status, or search\"\n          action={\n            <div className=\"flex items-center gap-2 text-sm text-white/60\">\n              <Filter size={16} />\n              Smart filters\n            </div>\n          }\n        />\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid gap-3 md:grid-cols-[1.2fr,1fr,1fr]\">\n            <div className=\"flex items-center gap-2 rounded-2xl border border-white/10 bg-black/40 px-3 py-2 shadow-inner shadow-black/40\">\n              <Search size={16} className=\"text-white/40\" />\n              <Input\n                value={query}\n                onChange={(e) => setQuery(e.target.value)}\n                placeholder=\"Search campaigns\"\n                className=\"border-none bg-transparent px-0 text-sm\"\n              />\n            </div>\n\n            <Select\n              value={type}\n              onChange={(e) =>\n                setType(e.target.value as CampaignType | \"all\")\n              }\n            >\n              <option value=\"all\">All types</option>\n              {Object.keys(typeCopy).map((key) => (\n                <option key={key} value={key}>\n                  {typeCopy[key as CampaignType]}\n                </option>\n              ))}\n            </Select>\n\n            <Select\n              value={status}\n              onChange={(e) =>\n                setStatus(e.target.value as CampaignStatus | \"all\")\n              }\n            >\n              <option value=\"all\">All statuses</option>\n              <option value=\"live\">Live</option>\n              <option value=\"paused\">Paused</option>\n              <option value=\"draft\">Draft</option>\n            </Select>\n          </div>\n\n          {loading ? (\n            <div className=\"grid gap-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n              {[1, 2, 3].map((row) => (\n                <div\n                  key={row}\n                  className=\"h-12 animate-pulse rounded-xl bg-white/5\"\n                />\n              ))}\n            </div>\n          ) : filtered.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-emerald-400/30 bg-white/5 px-6 py-10 text-center shadow-[0_20px_60px_rgba(16,185,129,0.15)]\">\n              <div className=\"rounded-full bg-emerald-500/20 p-3 text-emerald-300 shadow-[0_0_40px_rgba(16,185,129,0.4)]\">\n                <FolderPlus />\n              </div>\n              <p className=\"text-lg font-semibold text-white\">\n                No campaigns match\n              </p>\n              <p className=\"text-sm text-white/60\">\n                Adjust filters or launch a new outbound stream.\n              </p>\n              <Link href=\"/campaigns/new\" className=\"inline-flex\">\n                <Button variant=\"primary\" size=\"sm\" className=\"gap-2\">\n                  <Rocket size={16} /> Start from template\n                </Button>\n              </Link>\n            </div>\n          ) : (\n            <Table>\n              <TableHead>\n                <tr>\n                  <TableHeaderCell>Name</TableHeaderCell>\n                  <TableHeaderCell>Type</TableHeaderCell>\n                  <TableHeaderCell>Status</TableHeaderCell>\n                  <TableHeaderCell>Leads</TableHeaderCell>\n                  <TableHeaderCell>Reply rate</TableHeaderCell>\n                  <TableHeaderCell>Meetings</TableHeaderCell>\n                  <TableHeaderCell>Conversion</TableHeaderCell>\n                  <TableHeaderCell>Created</TableHeaderCell>\n                </tr>\n              </TableHead>\n\n              <TableBody>\n                {filtered.map((campaign) => (\n                  <TableRow\n                    key={campaign.id}\n                    className=\"cursor-pointer\"\n                    onClick={() =>\n                      router.push(`/campaigns/${campaign.id}`)\n                    }\n                  >\n                    <TableCell>\n                      <div className=\"space-y-1\">\n                        <p className=\"font-semibold text-white\">\n                          {campaign.name}\n                        </p>\n                        <p className=\"text-xs text-white/50\">\n                          {campaign.leads_contacted ?? 0} touched\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"capitalize text-white/70\">\n                      {typeCopy[campaign.type as CampaignType]}\n                    </TableCell>\n                    <TableCell>\n                      <span\n                        className={`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs ${\n                          statusStyles[campaign.status as CampaignStatus]\n                        }`}\n                      >\n                        <span className=\"h-2 w-2 rounded-full bg-current\" />\n                        {campaign.status}\n                      </span>\n                    </TableCell>\n                    <TableCell>\n                      {Number(campaign.leads_count ?? 0).toLocaleString()}\n                    </TableCell>\n                    <TableCell>{campaign.reply_rate ?? 0}%</TableCell>\n                    <TableCell>{campaign.meetings_booked ?? 0}</TableCell>\n                    <TableCell>{campaign.conversion ?? 0}%</TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {campaign.created_at}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_c81492e9._.js:268:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js.map:19:    {"offset": {"line": 864, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/components/leads/timeline-utils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport type TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  campaign_run_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  status: string | null\n  payload: any\n  scheduled_at: string | null\n  sent_at: string | null\n  created_at: string\n  error: string | null\n  meta: any\n}\n\nexport const touchRunSelect =\n  \"id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta\"\n\nexport const channelLabel: Record<string, string> = {\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n  voice: \"Voice\",\n}\n\nexport function getWhen(step: TouchRunRow) {\n  return step.sent_at ?? step.scheduled_at ?? step.created_at ?? null\n}\n\nexport function formatPreview(payload: any) {\n  if (!payload) return \"â€”\"\n  let preview: string\n\n  if (typeof payload === \"string\") {\n    preview = payload\n  } else if (typeof payload === \"object\") {\n    const maybeMessage = (payload as Record<string, unknown>).message\n    const maybeBody = (payload as Record<string, unknown>).body\n    const maybeSubject = (payload as Record<string, unknown>).subject\n    if (typeof maybeMessage === \"string\") preview = maybeMessage\n    else if (typeof maybeBody === \"string\") preview = maybeBody\n    else if (typeof maybeSubject === \"string\") preview = maybeSubject\n    else preview = JSON.stringify(payload)\n  } else {\n    preview = String(payload)\n  }\n\n  if (preview.length > 140) return `${preview.slice(0, 140)}â€¦`\n  return preview\n}\n\nexport function statusVariant(status: string | null) {\n  const normalized = status?.toLowerCase()\n  if (normalized === \"sent\") return \"success\" as const\n  if (normalized === \"scheduled\" || normalized === \"pending\") return \"warning\" as const\n  if (normalized === \"failed\" || normalized === \"error\") return \"destructive\" as const\n  return \"neutral\" as const\n}\n\nexport function formatDate(dateString: string | null, options?: Intl.DateTimeFormatOptions) {\n  if (!dateString) return null\n  const parsed = new Date(dateString)\n  if (Number.isNaN(parsed.getTime())) return null\n  return new Intl.DateTimeFormat(\"en-US\", options).format(parsed)\n}\n\nexport async function fetchLeadTouchRuns(\n  client: Pick<\n    import(\"@supabase/supabase-js\").SupabaseClient,\n    \"from\"\n  >,\n  leadId: string,\n) {\n  return client\n    .from(\"touch_runs\")\n    .select(touchRunSelect)\n    .eq(\"lead_id\", leadId)\n    .order(\"sent_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"scheduled_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"created_at\", { ascending: false })\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;;;;;;;;;;AAkB9C,MAAM,iBACX;AAEK,MAAM,eAAuC;IAClD,UAAU;IACV,KAAK;IACL,OAAO;IACP,OAAO;AACT;AAEO,SAAS,QAAQ,IAAiB;IACvC,OAAO,KAAK,OAAO,IAAI,KAAK,YAAY,IAAI,KAAK,UAAU,IAAI;AACjE;AAEO,SAAS,cAAc,OAAY;IACxC,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI;IAEJ,IAAI,OAAO,YAAY,UAAU;QAC/B,UAAU;IACZ,OAAO,IAAI,OAAO,YAAY,UAAU;QACtC,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,MAAM,YAAY,AAAC,QAAoC,IAAI;QAC3D,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAC3C,IAAI,OAAO,cAAc,UAAU,UAAU;aAC7C,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAChD,UAAU,KAAK,SAAS,CAAC;IAChC,OAAO;QACL,UAAU,OAAO;IACnB;IAEA,IAAI,QAAQ,MAAM,GAAG,KAAK,OAAO,GAAG,QAAQ,KAAK,CAAC,GAAG,KAAK,CAAC,CAAC;IAC5D,OAAO;AACT;AAEO,SAAS,cAAc,MAAqB;IACjD,MAAM,aAAa,QAAQ;IAC3B,IAAI,eAAe,QAAQ,OAAO;IAClC,IAAI,eAAe,eAAe,eAAe,WAAW,OAAO;IACnE,IAAI,eAAe,YAAY,eAAe,SAAS,OAAO;IAC9D,OAAO;AACT;AAEO,SAAS,WAAW,UAAyB,EAAE,OAAoC;IACxF,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,SAAS,IAAI,KAAK;IACxB,IAAI,OAAO,KAAK,CAAC,OAAO,OAAO,KAAK,OAAO;IAC3C,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS,SAAS,MAAM,CAAC;AAC1D;AAEO,eAAe,mBACpB,MAGC,EACD,MAAc;IAEd,OAAO,OACJ,IAAI,CAAC,cACL,MAAM,CAAC,gBACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,WAAW;QAAE,WAAW;QAAO,WAAW;IAAK,GACrD,KAAK,CAAC,gBAAgB;QAAE,WAAW;QAAO,WAAW;IAAK,GAC1D,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;AAC5C"}},
./.next/dev/server/chunks/ssr/[root-of-the-server]__5479e244._.js.map:21:    {"offset": {"line": 954, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/leads/%5Bid%5D/page.tsx"],"sourcesContent":["import Link from \"next/link\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport {\n  ArrowLeft,\n  Building2,\n  Mail,\n  MapPin,\n  PhoneCall,\n  User,\n} from \"lucide-react\"\n\nimport {\n  LeadActivityTimeline,\n  type LeadTimelineEvent,\n} from \"@/components/leads/LeadActivityTimeline\"\nimport {\n  describeAppointmentOutcome,\n  describeReminder,\n  describeTouchRun,\n} from \"@/components/leads/lead-activity-labels\"\nimport {\n  touchRunSelect,\n  type TouchRunRow,\n} from \"@/components/leads/timeline-utils\"\nimport {\n  Badge,\n  Button,\n  Card,\n  CardContent,\n  CardHeader,\n} from \"@/components/ui-custom\"\nimport { StatCard } from \"@/components/ui-custom/stat-card\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport type { LeadEnriched } from \"@/types/lead\"\n\ntype LeadDetail = LeadEnriched & {\n  company?: string | null\n  notes?: string | null\n}\n\ntype AppointmentRow = {\n  id: string\n  lead_id: string | null\n  channel: string | null\n  status: string | null\n  outcome: string | null\n  notes: string | null\n  starts_at: string | null\n  scheduled_for: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  appointment_id: string | null\n  notify_at: string | null\n  status: string | null\n  payload: Record<string, any> | null\n  created_at?: string | null\n}\n\ntype LeadDataResult = {\n  lead: LeadDetail | null\n  events: LeadTimelineEvent[]\n  stats: {\n    touches: number\n    appointments: number\n    reminders: number\n  }\n}\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return null\n  return date.toLocaleString()\n}\n\nfunction deriveLeadTitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin nombre\"\n  return lead.full_name || lead.email || lead.phone || \"Sin nombre\"\n}\n\nfunction deriveLeadSubtitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin contacto\"\n  const email = lead.email ?? \"Sin email\"\n  const phone = lead.phone ?? \"Sin telÃ©fono\"\n  return `${email} Â· ${phone}`\n}\n\nfunction appointmentTime(appt: AppointmentRow) {\n  return appt.starts_at ?? appt.scheduled_for ?? appt.created_at\n}\n\nfunction mapTouchRuns(touchRuns: TouchRunRow[]): LeadTimelineEvent[] {\n  return touchRuns.map((touch) => {\n    const occurredAt = touch.scheduled_at ?? touch.created_at\n    const { label, description } = describeTouchRun(touch)\n\n    return {\n      id: `touch-${touch.id}`,\n      occurredAt: occurredAt ?? new Date().toISOString(),\n      type: \"touch_run\" as const,\n      channel: touch.channel,\n      step: touch.step,\n      label,\n      description,\n      status: touch.status,\n      meta: touch.meta ?? undefined,\n    }\n  })\n}\n\nfunction mapAppointments(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments.map((appointment) => {\n    const when = appointmentTime(appointment) ?? new Date().toISOString()\n    const formatted = formatDateTime(when)\n    const description = formatted\n      ? `Scheduled for ${formatted}${\n          appointment.notes ? ` Â· ${appointment.notes}` : \"\"\n        }`\n      : appointment.notes ?? undefined\n\n    return {\n      id: `appointment-${appointment.id}`,\n      occurredAt: when,\n      type: \"appointment\" as const,\n      channel: appointment.channel,\n      step: null,\n      label: \"Appointment scheduled\",\n      description,\n      status: appointment.status,\n      meta: { appointmentId: appointment.id },\n    }\n  })\n}\n\nfunction mapAppointmentOutcomes(\n  appointments: AppointmentRow[],\n): LeadTimelineEvent[] {\n  return appointments\n    .filter((appointment) => Boolean(appointment.outcome))\n    .map((appointment) => {\n      const label = describeAppointmentOutcome(appointment.outcome)\n      const when =\n        appointment.updated_at ??\n        appointmentTime(appointment) ??\n        new Date().toISOString()\n      const apptTime = appointmentTime(appointment)\n      const formatted = formatDateTime(apptTime)\n\n      const description = formatted\n        ? `Outcome for appointment on ${formatted}`\n        : \"Appointment outcome updated\"\n\n      return {\n        id: `appointment-outcome-${appointment.id}`,\n        occurredAt: when,\n        type: \"appointment_outcome\" as const,\n        channel: appointment.channel,\n        step: null,\n        label,\n        description,\n        status: appointment.outcome,\n        meta: { appointmentId: appointment.id },\n      }\n    })\n}\n\nfunction mapAppointmentReminders(\n  reminders: AppointmentNotificationRow[],\n  appointmentById: Map<string, AppointmentRow>,\n  leadId: string,\n): LeadTimelineEvent[] {\n  return reminders\n    .filter((reminder) => {\n      const payloadLeadId =\n        (reminder.payload?.lead_id as string | undefined) ?? null\n      const appointmentLeadId = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)?.lead_id ?? null\n        : null\n      return payloadLeadId === leadId || appointmentLeadId === leadId\n    })\n    .map((reminder) => {\n      const appointment = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)\n        : undefined\n      const when =\n        reminder.notify_at ??\n        appointmentTime(appointment ?? ({} as AppointmentRow)) ??\n        new Date().toISOString()\n      const kind = (reminder.payload?.kind as string | undefined) ?? null\n      const reminderLabel = describeReminder(kind) ?? \"Appointment reminder\"\n      const appointmentDate = appointmentTime(\n        appointment ?? ({} as AppointmentRow),\n      )\n      const formatted = formatDateTime(appointmentDate)\n\n      return {\n        id: `appointment-reminder-${reminder.id}`,\n        occurredAt: when,\n        type: \"appointment_reminder\" as const,\n        channel: appointment?.channel ?? null,\n        step: null,\n        label: reminderLabel,\n        description: formatted\n          ? `Reminder for appointment on ${formatted}`\n          : undefined,\n        status: reminder.status,\n        meta: { appointmentId: reminder.appointment_id, kind },\n      }\n    })\n}\n\nasync function loadLeadData(leadId: string): Promise<LeadDataResult> {\n  // 1) Cliente server (service role) si existe\n  const maybeServer = supabaseServer()\n\n  // 2) Fallback: cliente pÃºblico con ANON KEY\n  const supabase =\n    maybeServer ??\n    createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    )\n\n  if (!supabase) {\n    // sin envs â†’ dummy\n    return {\n      lead: {\n        id: leadId,\n        full_name: \"Sin nombre\",\n        email: null,\n        phone: null,\n        state: \"unknown\",\n        last_touch_at: null,\n        campaign_id: null,\n        campaign_name: null,\n        channel_last: null,\n        company: null,\n        notes: null,\n      },\n      events: [],\n      stats: { touches: 0, appointments: 0, reminders: 0 },\n    }\n  }\n\n  // 3) Intento A: lead_enriched\n  let lead: LeadDetail | null = null\n\n  const { data: enriched, error: enrichedError } = await supabase\n    .from(\"lead_enriched\")\n    .select(\n      \"id, full_name, email, phone, state, last_touch_at, campaign_id, campaign_name, channel_last, company\",\n    )\n    .eq(\"id\", leadId)\n    .maybeSingle()\n\n  if (enrichedError) {\n    console.warn(\"[lead_detail] lead_enriched error\", enrichedError)\n  }\n\n  if (enriched) {\n    lead = enriched as LeadDetail\n  } else {\n    // 4) Intento B: tabla leads base\n    const { data: raw, error: rawError } = await supabase\n      .from(\"leads\")\n      .select(\n        \"id, full_name, email, phone, state, last_touch_at, campaign_id, campaign_name, channel_last, company\",\n      )\n      .eq(\"id\", leadId)\n      .maybeSingle()\n\n    if (rawError) {\n      console.warn(\"[lead_detail] leads error\", rawError)\n    }\n\n    if (raw) {\n      lead = raw as LeadDetail\n    }\n  }\n\n  // 5) Si aÃºn no hay lead, devolvemos dummy\n  if (!lead) {\n    lead = {\n      id: leadId,\n      full_name: \"Sin nombre\",\n      email: null,\n      phone: null,\n      state: \"unknown\",\n      last_touch_at: null,\n      campaign_id: null,\n      campaign_name: null,\n      channel_last: null,\n      company: null,\n      notes: null,\n    }\n  }\n\n  // 6) Activity: touch_runs + citas + reminders\n  const [touchRunsResult, appointmentsResult, remindersResult] =\n    await Promise.all([\n      supabase\n        .from(\"touch_runs\")\n        .select(touchRunSelect)\n        .eq(\"lead_id\", leadId)\n        .order(\"scheduled_at\", {\n          ascending: false,\n          nullsLast: true,\n        } as any)\n        .order(\"created_at\", { ascending: false }),\n      supabase\n        .from(\"appointments\")\n        .select(\n          \"id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at\",\n        )\n        .eq(\"lead_id\", leadId),\n      supabase\n        .from(\"appointments_notifications\")\n        .select(\n          \"id, appointment_id, notify_at, status, payload, created_at\",\n        ),\n    ])\n\n  const touchRuns = (touchRunsResult.data ?? []) as TouchRunRow[]\n  const appointments = (appointmentsResult.data ?? []) as AppointmentRow[]\n  const appointmentById = new Map<string, AppointmentRow>()\n  appointments.forEach((row) => appointmentById.set(row.id, row))\n  const reminders =\n    (remindersResult.data ?? []) as AppointmentNotificationRow[]\n\n  const events: LeadTimelineEvent[] = [\n    ...mapTouchRuns(touchRuns),\n    ...mapAppointments(appointments),\n    ...mapAppointmentOutcomes(appointments),\n    ...mapAppointmentReminders(reminders, appointmentById, leadId),\n  ].sort((a, b) => {\n    const aTime = new Date(a.occurredAt).getTime()\n    const bTime = new Date(b.occurredAt).getTime()\n    const safeA = Number.isNaN(aTime) ? 0 : aTime\n    const safeB = Number.isNaN(bTime) ? 0 : bTime\n    return safeB - safeA\n  })\n\n  return {\n    lead,\n    events,\n    stats: {\n      touches: touchRuns.length,\n      appointments: appointments.length,\n      reminders: reminders.length,\n    },\n  }\n}\n\nexport default async function LeadDetailPage({\n  params,\n}: {\n  params: { id: string }\n}) {\n  const leadId = params.id\n  const { lead, events, stats } = await loadLeadData(leadId)\n\n  const title = deriveLeadTitle(lead)\n  const subtitle = deriveLeadSubtitle(lead)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/leads\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft size={16} />\n              Back\n            </Button>\n          </Link>\n          <div>\n            <p className=\"text-sm uppercase tracking-[0.16em] text-white/50\">\n              Lead\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Lead timeline\n            </h1>\n            <p className=\"text-sm text-white/80\">{title}</p>\n            <p className=\"text-xs text-white/60\">\n              {subtitle} Â· ID: {leadId}\n            </p>\n          </div>\n        </div>\n        {lead?.state ? (\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {lead.state}\n          </Badge>\n        ) : null}\n      </div>\n\n      {/* Overview */}\n      <Card>\n        <CardHeader\n          title=\"Lead overview\"\n          description=\"Basic details and last touch information\"\n        />\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex items-center gap-2 text-white\">\n              <User size={16} className=\"text-white/60\" />\n              <span className=\"font-semibold\">{title}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Mail size={14} className=\"text-white/50\" />\n              <span>{lead?.email ?? \"Sin email\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <PhoneCall size={14} className=\"text-white/50\" />\n              <span>{lead?.phone ?? \"Sin telÃ©fono\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Building2 size={14} className=\"text-white/50\" />\n              <span>{lead?.company ?? \"Sin compaÃ±Ã­a\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <MapPin size={14} className=\"text-white/50\" />\n              <span>{lead?.channel_last ?? \"Sin canal\"}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80\">\n            <p className=\"text-sm text-white/60\">Last touch</p>\n            <p className=\"text-lg font-semibold text-white\">\n              {formatDateTime(lead?.last_touch_at ?? null) ??\n                \"No touches yet\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Channel: {lead?.channel_last ?? \"â€”\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Campaign:{\" \"}\n              {lead?.campaign_name ?? lead?.campaign_id ?? \"â€”\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Stats */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Total activity\"\n          value={events.length.toString()}\n          helper=\"Touches, appointments and reminders\"\n        />\n        <StatCard\n          label=\"Touch runs\"\n          value={stats.touches.toString()}\n          helper=\"touch_runs registrados\"\n        />\n        <StatCard\n          label=\"Appointments\"\n          value={stats.appointments.toString()}\n          helper=\"Incluye outcomes y reminders\"\n        />\n      </div>\n\n      {/* Timeline */}\n      <LeadActivityTimeline events={events} />\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAIA;AAKA;AAIA;AAAA;AAAA;AAAA;AAOA;AACA;;;;;;;;;;;AAwCA,SAAS,eAAe,KAAoB;IAC1C,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,OAAO,IAAI,KAAK;IACtB,IAAI,OAAO,KAAK,CAAC,KAAK,OAAO,KAAK,OAAO;IACzC,OAAO,KAAK,cAAc;AAC5B;AAEA,SAAS,gBAAgB,IAAuB;IAC9C,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,KAAK,SAAS,IAAI,KAAK,KAAK,IAAI,KAAK,KAAK,IAAI;AACvD;AAEA,SAAS,mBAAmB,IAAuB;IACjD,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,QAAQ,KAAK,KAAK,IAAI;IAC5B,MAAM,QAAQ,KAAK,KAAK,IAAI;IAC5B,OAAO,GAAG,MAAM,GAAG,EAAE,OAAO;AAC9B;AAEA,SAAS,gBAAgB,IAAoB;IAC3C,OAAO,KAAK,SAAS,IAAI,KAAK,aAAa,IAAI,KAAK,UAAU;AAChE;AAEA,SAAS,aAAa,SAAwB;IAC5C,OAAO,UAAU,GAAG,CAAC,CAAC;QACpB,MAAM,aAAa,MAAM,YAAY,IAAI,MAAM,UAAU;QACzD,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,IAAA,4KAAgB,EAAC;QAEhD,OAAO;YACL,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE;YACvB,YAAY,cAAc,IAAI,OAAO,WAAW;YAChD,MAAM;YACN,SAAS,MAAM,OAAO;YACtB,MAAM,MAAM,IAAI;YAChB;YACA;YACA,QAAQ,MAAM,MAAM;YACpB,MAAM,MAAM,IAAI,IAAI;QACtB;IACF;AACF;AAEA,SAAS,gBAAgB,YAA8B;IACrD,OAAO,aAAa,GAAG,CAAC,CAAC;QACvB,MAAM,OAAO,gBAAgB,gBAAgB,IAAI,OAAO,WAAW;QACnE,MAAM,YAAY,eAAe;QACjC,MAAM,cAAc,YAChB,CAAC,cAAc,EAAE,YACf,YAAY,KAAK,GAAG,CAAC,GAAG,EAAE,YAAY,KAAK,EAAE,GAAG,IAChD,GACF,YAAY,KAAK,IAAI;QAEzB,OAAO;YACL,IAAI,CAAC,YAAY,EAAE,YAAY,EAAE,EAAE;YACnC,YAAY;YACZ,MAAM;YACN,SAAS,YAAY,OAAO;YAC5B,MAAM;YACN,OAAO;YACP;YACA,QAAQ,YAAY,MAAM;YAC1B,MAAM;gBAAE,eAAe,YAAY,EAAE;YAAC;QACxC;IACF;AACF;AAEA,SAAS,uBACP,YAA8B;IAE9B,OAAO,aACJ,MAAM,CAAC,CAAC,cAAgB,QAAQ,YAAY,OAAO,GACnD,GAAG,CAAC,CAAC;QACJ,MAAM,QAAQ,IAAA,sLAA0B,EAAC,YAAY,OAAO;QAC5D,MAAM,OACJ,YAAY,UAAU,IACtB,gBAAgB,gBAChB,IAAI,OAAO,WAAW;QACxB,MAAM,WAAW,gBAAgB;QACjC,MAAM,YAAY,eAAe;QAEjC,MAAM,cAAc,YAChB,CAAC,2BAA2B,EAAE,WAAW,GACzC;QAEJ,OAAO;YACL,IAAI,CAAC,oBAAoB,EAAE,YAAY,EAAE,EAAE;YAC3C,YAAY;YACZ,MAAM;YACN,SAAS,YAAY,OAAO;YAC5B,MAAM;YACN;YACA;YACA,QAAQ,YAAY,OAAO;YAC3B,MAAM;gBAAE,eAAe,YAAY,EAAE;YAAC;QACxC;IACF;AACJ;AAEA,SAAS,wBACP,SAAuC,EACvC,eAA4C,EAC5C,MAAc;IAEd,OAAO,UACJ,MAAM,CAAC,CAAC;QACP,MAAM,gBACJ,AAAC,SAAS,OAAO,EAAE,WAAkC;QACvD,MAAM,oBAAoB,SAAS,cAAc,GAC7C,gBAAgB,GAAG,CAAC,SAAS,cAAc,GAAG,WAAW,OACzD;QACJ,OAAO,kBAAkB,UAAU,sBAAsB;IAC3D,GACC,GAAG,CAAC,CAAC;QACJ,MAAM,cAAc,SAAS,cAAc,GACvC,gBAAgB,GAAG,CAAC,SAAS,cAAc,IAC3C;QACJ,MAAM,OACJ,SAAS,SAAS,IAClB,gBAAgB,eAAgB,CAAC,MACjC,IAAI,OAAO,WAAW;QACxB,MAAM,OAAO,AAAC,SAAS,OAAO,EAAE,QAA+B;QAC/D,MAAM,gBAAgB,IAAA,4KAAgB,EAAC,SAAS;QAChD,MAAM,kBAAkB,gBACtB,eAAgB,CAAC;QAEnB,MAAM,YAAY,eAAe;QAEjC,OAAO;YACL,IAAI,CAAC,qBAAqB,EAAE,SAAS,EAAE,EAAE;YACzC,YAAY;YACZ,MAAM;YACN,SAAS,aAAa,WAAW;YACjC,MAAM;YACN,OAAO;YACP,aAAa,YACT,CAAC,4BAA4B,EAAE,WAAW,GAC1C;YACJ,QAAQ,SAAS,MAAM;YACvB,MAAM;gBAAE,eAAe,SAAS,cAAc;gBAAE;YAAK;QACvD;IACF;AACJ;AAEA,eAAe,aAAa,MAAc;IACxC,6CAA6C;IAC7C,MAAM,cAAc,IAAA,kJAAc;IAElC,4CAA4C;IAC5C,MAAM,WACJ,eACA,IAAA,uMAAY;IAKd,IAAI,CAAC,UAAU;QACb,mBAAmB;QACnB,OAAO;YACL,MAAM;gBACJ,IAAI;gBACJ,WAAW;gBACX,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,eAAe;gBACf,aAAa;gBACb,eAAe;gBACf,cAAc;gBACd,SAAS;gBACT,OAAO;YACT;YACA,QAAQ,EAAE;YACV,OAAO;gBAAE,SAAS;gBAAG,cAAc;gBAAG,WAAW;YAAE;QACrD;IACF;IAEA,8BAA8B;IAC9B,IAAI,OAA0B;IAE9B,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,iBACL,MAAM,CACL,wGAED,EAAE,CAAC,MAAM,QACT,WAAW;IAEd,IAAI,eAAe;QACjB,QAAQ,IAAI,CAAC,qCAAqC;IACpD;IAEA,IAAI,UAAU;QACZ,OAAO;IACT,OAAO;QACL,iCAAiC;QACjC,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,SACL,MAAM,CACL,wGAED,EAAE,CAAC,MAAM,QACT,WAAW;QAEd,IAAI,UAAU;YACZ,QAAQ,IAAI,CAAC,6BAA6B;QAC5C;QAEA,IAAI,KAAK;YACP,OAAO;QACT;IACF;IAEA,0CAA0C;IAC1C,IAAI,CAAC,MAAM;QACT,OAAO;YACL,IAAI;YACJ,WAAW;YACX,OAAO;YACP,OAAO;YACP,OAAO;YACP,eAAe;YACf,aAAa;YACb,eAAe;YACf,cAAc;YACd,SAAS;YACT,OAAO;QACT;IACF;IAEA,8CAA8C;IAC9C,MAAM,CAAC,iBAAiB,oBAAoB,gBAAgB,GAC1D,MAAM,QAAQ,GAAG,CAAC;QAChB,SACG,IAAI,CAAC,cACL,MAAM,CAAC,iKAAc,EACrB,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,gBAAgB;YACrB,WAAW;YACX,WAAW;QACb,GACC,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAC1C,SACG,IAAI,CAAC,gBACL,MAAM,CACL,kGAED,EAAE,CAAC,WAAW;QACjB,SACG,IAAI,CAAC,8BACL,MAAM,CACL;KAEL;IAEH,MAAM,YAAa,gBAAgB,IAAI,IAAI,EAAE;IAC7C,MAAM,eAAgB,mBAAmB,IAAI,IAAI,EAAE;IACnD,MAAM,kBAAkB,IAAI;IAC5B,aAAa,OAAO,CAAC,CAAC,MAAQ,gBAAgB,GAAG,CAAC,IAAI,EAAE,EAAE;IAC1D,MAAM,YACH,gBAAgB,IAAI,IAAI,EAAE;IAE7B,MAAM,SAA8B;WAC/B,aAAa;WACb,gBAAgB;WAChB,uBAAuB;WACvB,wBAAwB,WAAW,iBAAiB;KACxD,CAAC,IAAI,CAAC,CAAC,GAAG;QACT,MAAM,QAAQ,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO;QAC5C,MAAM,QAAQ,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO;QAC5C,MAAM,QAAQ,OAAO,KAAK,CAAC,SAAS,IAAI;QACxC,MAAM,QAAQ,OAAO,KAAK,CAAC,SAAS,IAAI;QACxC,OAAO,QAAQ;IACjB;IAEA,OAAO;QACL;QACA;QACA,OAAO;YACL,SAAS,UAAU,MAAM;YACzB,cAAc,aAAa,MAAM;YACjC,WAAW,UAAU,MAAM;QAC7B;IACF;AACF;AAEe,eAAe,eAAe,EAC3C,MAAM,EAGP;IACC,MAAM,SAAS,OAAO,EAAE;IACxB,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,aAAa;IAEnD,MAAM,QAAQ,gBAAgB;IAC9B,MAAM,WAAW,mBAAmB;IAEpC,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,0LAAI;gCAAC,MAAK;0CACT,cAAA,8OAAC,sJAAM;oCAAC,SAAQ;oCAAU,MAAK;;sDAC7B,8OAAC,6NAAS;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;0CAI3B,8OAAC;;kDACC,8OAAC;wCAAE,WAAU;kDAAoD;;;;;;kDAGjE,8OAAC;wCAAG,WAAU;kDAAoC;;;;;;kDAGlD,8OAAC;wCAAE,WAAU;kDAAyB;;;;;;kDACtC,8OAAC;wCAAE,WAAU;;4CACV;4CAAS;4CAAQ;;;;;;;;;;;;;;;;;;;oBAIvB,MAAM,sBACL,8OAAC,oJAAK;wBAAC,SAAQ;wBAAU,WAAU;kCAChC,KAAK,KAAK;;;;;+BAEX;;;;;;;0BAIN,8OAAC,kJAAI;;kCACH,8OAAC,wJAAU;wBACT,OAAM;wBACN,aAAY;;;;;;kCAEd,8OAAC,yJAAW;wBAAC,WAAU;;0CACrB,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,0MAAI;gDAAC,MAAM;gDAAI,WAAU;;;;;;0DAC1B,8OAAC;gDAAK,WAAU;0DAAiB;;;;;;;;;;;;kDAEnC,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,0MAAI;gDAAC,MAAM;gDAAI,WAAU;;;;;;0DAC1B,8OAAC;0DAAM,MAAM,SAAS;;;;;;;;;;;;kDAExB,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,6NAAS;gDAAC,MAAM;gDAAI,WAAU;;;;;;0DAC/B,8OAAC;0DAAM,MAAM,SAAS;;;;;;;;;;;;kDAExB,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,6NAAS;gDAAC,MAAM;gDAAI,WAAU;;;;;;0DAC/B,8OAAC;0DAAM,MAAM,WAAW;;;;;;;;;;;;kDAE1B,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,oNAAM;gDAAC,MAAM;gDAAI,WAAU;;;;;;0DAC5B,8OAAC;0DAAM,MAAM,gBAAgB;;;;;;;;;;;;;;;;;;0CAGjC,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAAwB;;;;;;kDACrC,8OAAC;wCAAE,WAAU;kDACV,eAAe,MAAM,iBAAiB,SACrC;;;;;;kDAEJ,8OAAC;wCAAE,WAAU;;4CAAwB;4CACzB,MAAM,gBAAgB;;;;;;;kDAElC,8OAAC;wCAAE,WAAU;;4CAAwB;4CACzB;4CACT,MAAM,iBAAiB,MAAM,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;0BAOrD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,8JAAQ;wBACP,OAAM;wBACN,OAAO,OAAO,MAAM,CAAC,QAAQ;wBAC7B,QAAO;;;;;;kCAET,8OAAC,8JAAQ;wBACP,OAAM;wBACN,OAAO,MAAM,OAAO,CAAC,QAAQ;wBAC7B,QAAO;;;;;;kCAET,8OAAC,8JAAQ;wBACP,OAAM;wBACN,OAAO,MAAM,YAAY,CAAC,QAAQ;wBAClC,QAAO;;;;;;;;;;;;0BAKX,8OAAC,2KAAoB;gBAAC,QAAQ;;;;;;;;;;;;AAGpC"}}]
./.next/dev/server/chunks/ssr/src_aedad0ed._.js:428:    return client.from("touch_runs").select(touchRunSelect).eq("lead_id", leadId).order("sent_at", {
./.next/dev/server/chunks/ssr/src_aedad0ed._.js:679:        client.from("touch_runs").select(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$leads$2f$timeline$2d$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["touchRunSelect"]).eq("lead_id", leadId).order("scheduled_at", {
./.next/dev/server/chunks/ssr/src_aedad0ed._.js:1373:                        helper: "touch_runs registrados"
./.next/dev/server/chunks/ssr/src_8c8ad8a1._.js.map:7:    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/voice-insights/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport {\n  Activity,\n  Filter,\n  Loader2,\n  RefreshCcw,\n  X,\n  PhoneCall,\n} from \"lucide-react\"\n\nimport { IntentBadge, LeadStateBadge } from \"@/components/leads/badges\"\nimport {\n  Badge,\n  Button,\n  Card,\n  CardContent,\n  Input,\n  Select,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype VoiceCallBase = {\n  id: string\n  lead_id: string\n  touch_run_id: string | null\n  status: string | null\n  provider: string | null\n  provider_call_id: string | null\n  to_phone: string | null\n  meta: Record<string, unknown> | null\n  updated_at: string\n}\n\ntype Lead = {\n  id: string\n  contact_name: string | null\n  company: string | null\n  phone: string | null\n  state: string | null\n  email: string | null\n}\n\ntype LeadEvent = {\n  id: string\n  lead_id: string\n  event_type: string\n  payload: Record<string, unknown> | null\n  created_at: string\n}\n\ntype Appointment = {\n  id: string\n  lead_id: string\n  scheduled_for: string\n  status: string\n}\n\ntype TouchRun = {\n  id: string\n  lead_id: string\n  status: string\n  error: string | null\n  campaign_id: string | null\n}\n\ntype CampaignMeta = {\n  id: string\n  name: string | null\n}\n\ntype IntentFilter = \"all\" | \"appointment\" | \"unknown\"\ntype AppointmentFilter = \"all\" | \"yes\" | \"no\"\ntype CadenceFilter = \"all\" | \"stopped\" | \"active\"\n\ntype VoiceCallRow = VoiceCallBase & {\n  transcript: string\n  intent: string\n  hasAppointment: boolean\n  cadenceStopped: boolean\n  campaign_id: string | null\n  campaign_name: string | null\n}\n\nconst dateFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"numeric\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\n// -----------------------------------------------------------------------------\n// Page\n// -----------------------------------------------------------------------------\n\nexport default function VoiceInsightsPage() {\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [calls, setCalls] = useState<VoiceCallBase[]>([])\n  const [leads, setLeads] = useState<Record<string, Lead>>({})\n  const [events, setEvents] = useState<LeadEvent[]>([])\n  const [appointments, setAppointments] = useState<Appointment[]>([])\n  const [touchRuns, setTouchRuns] = useState<TouchRun[]>([])\n  const [campaigns, setCampaigns] = useState<Record<string, CampaignMeta>>({})\n\n  const [intentFilter, setIntentFilter] = useState<IntentFilter>(\"all\")\n  const [appointmentFilter, setAppointmentFilter] =\n    useState<AppointmentFilter>(\"all\")\n  const [cadenceFilter, setCadenceFilter] = useState<CadenceFilter>(\"all\")\n  const [campaignFilter, setCampaignFilter] = useState<string>(\"all\")\n\n  const [search, setSearch] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const [activeCallId, setActiveCallId] = useState<string | null>(null)\n\n  // ---------------------------------------------------------------------------\n  // Load data\n  // ---------------------------------------------------------------------------\n\n  useEffect(() => {\n    let alive = true\n\n    async function loadData() {\n      if (!supabaseReady) {\n        setError(\n          \"Supabase is not configured. Add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to load data.\",\n        )\n        setLoading(false)\n        return\n      }\n\n      setLoading(true)\n      setError(null)\n\n      const client = supabaseBrowser()\n\n      const { data: callsData, error: callsError } = await client\n        .from(\"voice_insights_calls_v1\")\n        .select(\n          \"id, lead_id, touch_run_id, status, provider, provider_call_id, to_phone, meta, updated_at\",\n        )\n        .order(\"updated_at\", { ascending: false })\n        .limit(100)\n\n      if (!alive) return\n\n      if (callsError) {\n        console.error(callsError)\n        setError(\"Unable to fetch voice calls.\")\n        setLoading(false)\n        return\n      }\n\n      const safeCalls = (callsData ?? []) as VoiceCallBase[]\n      setCalls(safeCalls)\n\n      const leadIds = Array.from(new Set(safeCalls.map((call) => call.lead_id)))\n\n      if (leadIds.length === 0) {\n        setLeads({})\n        setEvents([])\n        setAppointments([])\n        setTouchRuns([])\n        setCampaigns({})\n        setLoading(false)\n        return\n      }\n\n      const [\n        leadsResult,\n        eventsResult,\n        appointmentsResult,\n        touchRunsResult,\n        campaignsResult,\n      ] = await Promise.all([\n        client\n          .from(\"leads\")\n          .select(\"id, contact_name, company, phone, state, email\")\n          .in(\"id\", leadIds),\n        client\n          .from(\"lead_events\")\n          .select(\"id, lead_id, event_type, payload, created_at\")\n          .in(\"event_type\", [\n            \"voice_completed\",\n            \"voice_failed\",\n            \"appointment_created\",\n          ])\n          .order(\"created_at\", { ascending: false })\n          .limit(200),\n        client\n          .from(\"appointments\")\n          .select(\"id, lead_id, scheduled_for, status\")\n          .in(\"lead_id\", leadIds),\n        client\n          .from(\"touch_runs\")\n          .select(\"id, lead_id, status, error, campaign_id\")\n          .in(\"lead_id\", leadIds),\n        client.from(\"campaigns\").select(\"id, name\").limit(500),\n      ])\n\n      if (!alive) return\n\n      if (leadsResult.error) {\n        console.error(leadsResult.error)\n        setError(\n          `Unable to fetch leads for voice calls. DB says: ${leadsResult.error.message}`,\n        )\n      }\n\n      if (eventsResult.error) console.error(eventsResult.error)\n      if (appointmentsResult.error) console.error(appointmentsResult.error)\n      if (touchRunsResult.error) console.error(touchRunsResult.error)\n      if (campaignsResult.error) console.error(campaignsResult.error)\n\n      const leadMap = (leadsResult.data ?? []).reduce(\n        (acc, lead) => {\n          acc[lead.id] = lead as Lead\n          return acc\n        },\n        {} as Record<string, Lead>,\n      )\n\n      const campaignMap = (campaignsResult.data ?? []).reduce(\n        (acc, c) => {\n          acc[c.id] = c as CampaignMeta\n          return acc\n        },\n        {} as Record<string, CampaignMeta>,\n      )\n\n      setLeads(leadMap)\n      setEvents((eventsResult.data ?? []) as LeadEvent[])\n      setAppointments((appointmentsResult.data ?? []) as Appointment[])\n      setTouchRuns((touchRunsResult.data ?? []) as TouchRun[])\n      setCampaigns(campaignMap)\n      setLoading(false)\n    }\n\n    void loadData()\n\n    return () => {\n      alive = false\n    }\n  }, [supabaseReady])\n\n  // ---------------------------------------------------------------------------\n  // Derived maps\n  // ---------------------------------------------------------------------------\n\n  const appointmentByLead = useMemo(() => {\n    const now = new Date()\n    return appointments.reduce(\n      (acc, appt) => {\n        if (appt.status === \"scheduled\" && new Date(appt.scheduled_for) >= now) {\n          acc[appt.lead_id] = appt\n        }\n        return acc\n      },\n      {} as Record<string, Appointment>,\n    )\n  }, [appointments])\n\n  const cadenceStoppedByLead = useMemo(() => {\n    const map: Record<string, boolean> = {}\n    touchRuns.forEach((run) => {\n      if (run.status === \"stopped\" && run.error === \"appointment_created\") {\n        map[run.lead_id] = true\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const campaignByLead = useMemo(() => {\n    const map: Record<string, string | null> = {}\n    touchRuns.forEach((run) => {\n      if (run.campaign_id && !map[run.lead_id]) {\n        map[run.lead_id] = run.campaign_id\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const callRows: VoiceCallRow[] = useMemo(() => {\n    return calls.map((call) => {\n      const voiceWebhook =\n        (call.meta as { voice_webhook?: { transcript?: string } } | null)\n          ?.voice_webhook ?? null\n      const transcript =\n        voiceWebhook?.transcript ??\n        ((call.meta as { transcript?: string } | null)?.transcript ?? \"\")\n\n      const relevantEvent = events.find(\n        (event) =>\n          event.lead_id === call.lead_id &&\n          event.event_type.startsWith(\"voice_\"),\n      )\n\n      const intentFromEvent =\n        (relevantEvent?.payload as { intent?: string } | null)?.intent\n      const intentFromMeta =\n        (call.meta as { intent?: string } | null)?.intent ?? \"unknown\"\n\n      const intent = (intentFromEvent ?? intentFromMeta ?? \"unknown\").toLowerCase()\n\n      const campaignId = campaignByLead[call.lead_id] ?? null\n      const campaignName =\n        campaignId && campaigns[campaignId]\n          ? campaigns[campaignId].name ?? \"Untitled\"\n          : null\n\n      return {\n        ...call,\n        transcript,\n        intent,\n        hasAppointment: Boolean(appointmentByLead[call.lead_id]),\n        cadenceStopped: Boolean(cadenceStoppedByLead[call.lead_id]),\n        campaign_id: campaignId,\n        campaign_name: campaignName,\n      }\n    })\n  }, [\n    appointmentByLead,\n    cadenceStoppedByLead,\n    campaignByLead,\n    campaigns,\n    calls,\n    events,\n  ])\n\n  const campaignOptions = useMemo(() => {\n    const ids = new Set<string>()\n    callRows.forEach((row) => {\n      if (row.campaign_id) ids.add(row.campaign_id)\n    })\n    return Array.from(ids)\n  }, [callRows])\n\n  const filtered: VoiceCallRow[] = useMemo(() => {\n    return callRows.filter((row) => {\n      if (intentFilter !== \"all\" && row.intent !== intentFilter) return false\n      if (appointmentFilter === \"yes\" && !row.hasAppointment) return false\n      if (appointmentFilter === \"no\" && row.hasAppointment) return false\n      if (cadenceFilter === \"stopped\" && !row.cadenceStopped) return false\n      if (cadenceFilter === \"active\" && row.cadenceStopped) return false\n      if (campaignFilter !== \"all\" && row.campaign_id !== campaignFilter)\n        return false\n\n      if (search) {\n        const lead = leads[row.lead_id]\n        const haystack = `${lead?.contact_name ?? \"\"} ${lead?.company ?? \"\"} ${\n          lead?.email ?? \"\"\n        } ${lead?.phone ?? \"\"}`.toLowerCase()\n        if (!haystack.includes(search.toLowerCase())) return false\n      }\n\n      return true\n    })\n  }, [\n    appointmentFilter,\n    campaignFilter,\n    callRows,\n    cadenceFilter,\n    intentFilter,\n    leads,\n    search,\n  ])\n\n  const activeCall = useMemo(\n    () => filtered.find((c) => c.id === activeCallId) ?? null,\n    [filtered, activeCallId],\n  )\n\n  const activeLead = activeCall ? leads[activeCall.lead_id] ?? null : null\n  const activeAppointment = activeCall\n    ? appointmentByLead[activeCall.lead_id] ?? null\n    : null\n\n  // ---------------------------------------------------------------------------\n  // High-level metrics\n  // ---------------------------------------------------------------------------\n\n  const metrics = useMemo(() => {\n    if (callRows.length === 0) {\n      return {\n        total: 0,\n        withAppointment: 0,\n        interested: 0,\n        failed: 0,\n        last7d: 0,\n      }\n    }\n\n    const now = Date.now()\n    const sevenDaysMs = 7 * 24 * 60 * 60 * 1000\n\n    let withAppointment = 0\n    let interested = 0\n    let failed = 0\n    let last7d = 0\n\n    callRows.forEach((row) => {\n      if (row.hasAppointment) withAppointment += 1\n      if (row.intent === \"appointment\") interested += 1\n      if (row.status && row.status.toLowerCase() === \"failed\") failed += 1\n\n      const updatedMs = new Date(row.updated_at).getTime()\n      if (!Number.isNaN(updatedMs) && now - updatedMs <= sevenDaysMs) {\n        last7d += 1\n      }\n    })\n\n    return {\n      total: callRows.length,\n      withAppointment,\n      interested,\n      failed,\n      last7d,\n    }\n  }, [callRows])\n\n  // ---------------------------------------------------------------------------\n  // Render\n  // ---------------------------------------------------------------------------\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3\">\n          <div>\n            <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n              Voice Â· Calls & intents\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Voice Insights\n            </h1>\n            <p className=\"text-sm text-white/60\">\n              Latest 100 calls with transcript previews, intent signals,\n              campaign and appointment status.\n            </p>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => {\n                setIntentFilter(\"all\")\n                setAppointmentFilter(\"all\")\n                setCadenceFilter(\"all\")\n                setCampaignFilter(\"all\")\n                setSearch(\"\")\n              }}\n              className=\"gap-2\"\n            >\n              <RefreshCcw size={16} />\n              Reset view\n            </Button>\n          </div>\n        </div>\n\n        {/* KPIs */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"grid gap-4 p-4 sm:grid-cols-5\">\n            <MetricTile\n              label=\"Total calls\"\n              value={metrics.total}\n              helper=\"Last 100 records\"\n            />\n            <MetricTile\n              label=\"Interested\"\n              value={metrics.interested}\n              helper=\"Intent = appointment\"\n            />\n            <MetricTile\n              label=\"With appointment\"\n              value={metrics.withAppointment}\n              helper=\"Upcoming scheduled\"\n            />\n            <MetricTile\n              label=\"Failed\"\n              value={metrics.failed}\n              helper=\"Status = failed\"\n            />\n            <MetricTile\n              label=\"Calls last 7 days\"\n              value={metrics.last7d}\n              helper=\"Based on updated_at\"\n            />\n          </CardContent>\n        </Card>\n\n        {/* Filters + search + status */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"space-y-4 pt-4\">\n            <div className=\"flex flex-wrap items-center gap-3\">\n              <div className=\"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-medium uppercase tracking-[0.14em] text-white/70\">\n                <Filter size={14} />\n                <span>Filters</span>\n              </div>\n\n              <Select\n                value={intentFilter}\n                onChange={(e) =>\n                  setIntentFilter(e.target.value as IntentFilter)\n                }\n                className=\"w-44\"\n              >\n                <option value=\"all\">All intents</option>\n                <option value=\"appointment\">Appointment</option>\n                <option value=\"unknown\">Unknown</option>\n              </Select>\n\n              <Select\n                value={appointmentFilter}\n                onChange={(e) =>\n                  setAppointmentFilter(e.target.value as AppointmentFilter)\n                }\n                className=\"w-48\"\n              >\n                <option value=\"all\">Appointment?</option>\n                <option value=\"yes\">Has upcoming</option>\n                <option value=\"no\">No appointment</option>\n              </Select>\n\n              <Select\n                value={cadenceFilter}\n                onChange={(e) =>\n                  setCadenceFilter(e.target.value as CadenceFilter)\n                }\n                className=\"w-40\"\n              >\n                <option value=\"all\">Cadence</option>\n                <option value=\"stopped\">Stopped</option>\n                <option value=\"active\">Active</option>\n              </Select>\n\n              <Select\n                value={campaignFilter}\n                onChange={(e) => setCampaignFilter(e.target.value)}\n                className=\"w-56\"\n              >\n                <option value=\"all\">All campaigns</option>\n                {campaignOptions.map((id) => (\n                  <option key={id} value={id}>\n                    {campaigns[id]?.name ?? id}\n                  </option>\n                ))}\n              </Select>\n\n              <Input\n                placeholder=\"Search lead / company / email / phone\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"w-72\"\n              />\n            </div>\n\n            {error ? (\n              <div className=\"rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100\">\n                {error}\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-3 text-xs text-white/50\">\n                <span className=\"rounded-full border border-white/10 bg-white/5 px-2 py-1\">\n                  {filtered.length} calls visible\n                </span>\n                <span className=\"rounded-full border border-white/5 bg-white/5/10 px-2 py-1\">\n                  Raw: {calls.length}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Table / list */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"pt-4\">\n            {!loading && filtered.length === 0 ? (\n              <div className=\"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-sm text-white/70\">\n                No calls match the selected filters.\n              </div>\n            ) : null}\n\n            {!loading && filtered.length > 0 ? (\n              <div className=\"overflow-auto rounded-2xl border border-white/10\">\n                <Table>\n                  <TableHead>\n                    <TableRow className=\"bg-white/5\">\n                      <TableHeaderCell>Lead</TableHeaderCell>\n                      <TableHeaderCell>Campaign</TableHeaderCell>\n                      <TableHeaderCell>Phone</TableHeaderCell>\n                      <TableHeaderCell>Status</TableHeaderCell>\n                      <TableHeaderCell>Transcript</TableHeaderCell>\n                      <TableHeaderCell>Intent</TableHeaderCell>\n                      <TableHeaderCell>Appointment</TableHeaderCell>\n                      <TableHeaderCell>Cadence</TableHeaderCell>\n                      <TableHeaderCell>Updated</TableHeaderCell>\n                    </TableRow>\n                  </TableHead>\n                  <TableBody>\n                    {filtered.map((row) => {\n                      const lead = leads[row.lead_id]\n                      const transcriptPreview = row.transcript\n\n                      const preview = transcriptPreview\n                        ? `${transcriptPreview.slice(0, 140)}${\n                            transcriptPreview.length > 140 ? \"â€¦\" : \"\"\n                          }`\n                        : \"â€”\"\n\n                      const updated = new Date(row.updated_at)\n                      const appointment = appointmentByLead[row.lead_id]\n\n                      const displayName =\n                        lead?.contact_name ||\n                        lead?.company ||\n                        lead?.phone ||\n                        lead?.email ||\n                        \"Unknown lead\"\n\n                      const campaignName = row.campaign_name ?? \"â€”\"\n\n                      return (\n                        <TableRow\n                          key={row.id}\n                          className=\"cursor-pointer border-t border-white/5 bg-black/40 transition hover:bg-white/5\"\n                          onClick={() => setActiveCallId(row.id)}\n                        >\n                          {/* Lead */}\n                          <TableCell>\n                            <div className=\"flex flex-col gap-1\">\n                              <a\n                                href={`/leads/${row.lead_id}`}\n                                className=\"font-semibold text-emerald-200 hover:text-emerald-100\"\n                                onClick={(e) => e.stopPropagation()}\n                              >\n                                {displayName}\n                              </a>\n                              <LeadStateBadge state={lead?.state} />\n                            </div>\n                          </TableCell>\n\n                          {/* Campaign */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {campaignName}\n                          </TableCell>\n\n                          {/* Phone */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {lead?.phone ?? row.to_phone ?? \"â€”\"}\n                          </TableCell>\n\n                          {/* Call status */}\n                          <TableCell>\n                            <Badge\n                              variant=\"outline\"\n                              className=\"border-white/15 bg-white/5 text-xs text-white/80 capitalize\"\n                            >\n                              {row.status ?? \"â€”\"}\n                            </Badge>\n                          </TableCell>\n\n                          {/* Transcript */}\n                          <TableCell className=\"max-w-md text-sm text-white/80\">\n                            {preview}\n                          </TableCell>\n\n                          {/* Intent */}\n                          <TableCell>\n                            <IntentBadge intent={row.intent} />\n                          </TableCell>\n\n                          {/* Appointment */}\n                          <TableCell>\n                            {row.hasAppointment ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"gap-2 border-emerald-400/50 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                <CalendarIcon />\n                                Upcoming\n                                <span className=\"text-[11px] text-white/60\">\n                                  {appointment\n                                    ? dateFormatter.format(\n                                        new Date(appointment.scheduled_for),\n                                      )\n                                    : null}\n                                </span>\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-white/15 bg-white/5 text-xs text-white/70\"\n                              >\n                                No appointment\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Cadence */}\n                          <TableCell>\n                            {row.cadenceStopped ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-amber-400/60 bg-amber-500/10 text-xs text-amber-100\"\n                              >\n                                Cadence stopped\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-emerald-400/60 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                Active\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Updated */}\n                          <TableCell className=\"whitespace-nowrap text-sm text-white/70\">\n                            {dateFormatter.format(updated)}\n                          </TableCell>\n                        </TableRow>\n                      )\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 py-8 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : null}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Drawer */}\n      {activeCall && (\n        <div className=\"fixed inset-0 z-40 flex\">\n          <button\n            className=\"h-full flex-1 bg-black/60 backdrop-blur-sm\"\n            onClick={() => setActiveCallId(null)}\n            aria-label=\"Close call details\"\n          />\n          <div className=\"h-full w-full max-w-md border-l border-white/10 bg-[#020617] p-5 shadow-[0_0_60px_rgba(15,23,42,0.9)]\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Voice call\n                </p>\n                <h2 className=\"flex items-center gap-2 text-xl font-semibold text-white\">\n                  <PhoneCall className=\"h-4 w-4 text-emerald-300\" />\n                  {activeLead?.contact_name ??\n                    activeLead?.company ??\n                    activeLead?.phone ??\n                    activeLead?.email ??\n                    \"Unknown lead\"}\n                </h2>\n                {activeLead && (\n                  <p className=\"text-xs text-white/50\">\n                    {activeLead.email ?? \"no-email\"} Â·{\" \"}\n                    {activeLead.phone ?? \"no-phone\"}\n                  </p>\n                )}\n              </div>\n              <button\n                className=\"rounded-full border border-white/20 bg-white/10 p-1 text-white/70 hover:bg-white/20\"\n                onClick={() => setActiveCallId(null)}\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              {/* Top badges */}\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80\">\n                  {activeCall.provider ?? \"provider-unknown\"}\n                </Badge>\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80 capitalize\">\n                  {activeCall.status ?? \"status-unknown\"}\n                </Badge>\n                <IntentBadge intent={activeCall.intent} />\n                {activeCall.hasAppointment && (\n                  <Badge className=\"border-emerald-400/60 bg-emerald-500/15 text-xs text-emerald-100\">\n                    Appointment scheduled\n                  </Badge>\n                )}\n                {activeCall.cadenceStopped && (\n                  <Badge className=\"border-amber-400/60 bg-amber-500/15 text-xs text-amber-100\">\n                    Cadence stopped\n                  </Badge>\n                )}\n              </div>\n\n              {/* Meta */}\n              <Card className=\"border-white/10 bg-white/5\">\n                <CardContent className=\"space-y-1 p-4 text-xs text-white/70\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">To</span>\n                    <span>{activeCall.to_phone ?? \"â€”\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">Updated</span>\n                    <span>\n                      {dateFormatter.format(new Date(activeCall.updated_at))}\n                    </span>\n                  </div>\n                  {activeAppointment && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-white/50\">Appointment</span>\n                      <span>\n                        {dateFormatter.format(\n                          new Date(activeAppointment.scheduled_for),\n                        )}\n                      </span>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Transcript */}\n              <div className=\"space-y-2 rounded-2xl border border-white/10 bg-slate-900/80 p-4\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Transcript\n                </p>\n                {activeCall.transcript ? (\n                  <p className=\"max-h-64 overflow-y-auto whitespace-pre-wrap text-sm text-white/80\">\n                    {activeCall.transcript}\n                  </p>\n                ) : (\n                  <p className=\"text-xs text-white/60\">\n                    No transcript available for this call.\n                  </p>\n                )}\n              </div>\n\n              {/* Raw meta */}\n              {activeCall.meta && (\n                <div className=\"space-y-2 rounded-2xl border border-white/10 bg-black/60 p-4\">\n                  <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                    Raw meta\n                  </p>\n                  <pre className=\"max-h-40 overflow-y-auto text-[11px] text-white/70\">\n                    {JSON.stringify(activeCall.meta, null, 2)}\n                  </pre>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n\nfunction CalendarIcon() {\n  return <Activity size={14} />\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <div className=\"space-y-1 rounded-2xl border border-white/10 bg-white/5 p-3\">\n      <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n        {label}\n      </p>\n      <p className=\"text-2xl font-semibold text-white\">{value}</p>\n      <p className=\"text-[11px] text-white/50\">{helper}</p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_8c8ad8a1._.js:483:                client.from("touch_runs").select("id, lead_id, status, error, campaign_id").in("lead_id", leadIds),
./.next/dev/server/chunks/ssr/[root-of-the-server]__36c9e6ba._.js:636:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5a351732._.js.map:18:    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/operator/page.tsx"],"sourcesContent":["// src/app/operator/page.tsx\nimport React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport {\n  Mail,\n  MessageCircle,\n  PhoneCall,\n  Waves,\n  Activity,\n  CalendarClock,\n  AlertTriangle,\n  CheckCircle2,\n  Zap,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// --------- Tipos base ---------\n\ntype TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  scheduled_at: string | null\n  sent_at: string | null\n  status: string | null\n  error: string | null\n  created_at: string | null\n  type: string | null\n  intent: string | null\n  outcome: string | null\n  retry_count: number | null\n  max_retries: number | null\n  message_class: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  org_id: string | null\n  appointment_id: string | null\n  channel: string | null\n  notify_at: string | null\n  status: string | null\n  created_at: string | null\n  sent_at: string | null\n  error: string | null\n}\n\ntype ActivityToday = {\n  touchesTotalToday: number\n  touchesSentToday: number\n  touchesFailedToday: number\n  touchesQueuedToday: number\n  appointmentNotificationsToday: number\n}\n\n// --------- Helpers de fecha ---------\n\nfunction getTodayRangeUTC() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\nfunction formatDate(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  return dateTimeFormatter.format(d)\n}\n\nfunction timeAgo(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  const diffMs = Date.now() - d.getTime()\n  const diffMin = Math.round(diffMs / 60000)\n  if (diffMin < 1) return \"just now\"\n  if (diffMin < 60) return `hace ${diffMin} min`\n  const diffH = Math.round(diffMin / 60)\n  if (diffH < 24) return `hace ${diffH} h`\n  const diffD = Math.round(diffH / 24)\n  return `hace ${diffD} d`\n}\n\n// --------- Loaders (server-side) ---------\n\nasync function loadLiveQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"scheduled\"])\n    .order(\"scheduled_at\", { ascending: true })\n    .limit(50)\n\n    if (!data) return []\n\n    // si viene en formato de error, salimos con []\n    if (!data) return []\n\n    // si viene en formato de error, salimos con []\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos cualquier cosa que tenga `error` (GenericStringError)\n      const rows = (data as any[]).filter(\n        (row): row is TouchRunRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\nasync function loadRecentErrors(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .eq(\"status\", \"failed\")\n    .gte(\"created_at\", start)\n    .lt(\"created_at\", end)\n    .order(\"created_at\", { ascending: false })\n    .limit(30)\n\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos cualquier cosa que tenga `error` (GenericStringError)\n      const rows = (data as any[]).filter(\n        (row): row is TouchRunRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\nasync function loadActivityToday(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<ActivityToday> {\n  const fallback: ActivityToday = {\n    touchesTotalToday: 0,\n    touchesSentToday: 0,\n    touchesFailedToday: 0,\n    touchesQueuedToday: 0,\n    appointmentNotificationsToday: 0,\n  }\n\n  if (!client) return fallback\n\n  const { start, end } = getTodayRangeUTC()\n\n  const [\n    totalTouches,\n    sentTouches,\n    failedTouches,\n    queuedTouches,\n    apptNotifs,\n  ] = await Promise.all([\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"sent\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"failed\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"status\", [\"queued\", \"scheduled\"])\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n  ])\n\n  return {\n    touchesTotalToday: totalTouches.count ?? 0,\n    touchesSentToday: sentTouches.count ?? 0,\n    touchesFailedToday: failedTouches.count ?? 0,\n    touchesQueuedToday: queuedTouches.count ?? 0,\n    appointmentNotificationsToday: apptNotifs.count ?? 0,\n  }\n}\n\nasync function loadAppointmentsNotificationsQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentNotificationRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"appointments_notifications\")\n    .select(\n      [\n        \"id\",\n        \"org_id\",\n        \"appointment_id\",\n        \"channel\",\n        \"notify_at\",\n        \"status\",\n        \"created_at\",\n        \"sent_at\",\n        \"error\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"pending\"])\n    .gte(\"notify_at\", start)\n    .lt(\"notify_at\", end)\n    .order(\"notify_at\", { ascending: true })\n    .limit(30)\n\n    if (error) {\n        console.error(error)\n        return []\n      }\n    \n      if (!data || !Array.isArray(data)) {\n        return []\n      }\n    \n      // Filtramos posibles GenericStringError[]\n      const rows = (data as any[]).filter(\n        (row): row is AppointmentNotificationRow => !(row as any)?.error,\n      )\n    \n      return rows\n    }    \n\n// --------- Helpers UI ---------\n\nfunction channelIcon(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  const base = \"h-4 w-4\"\n\n  if (c === \"email\") return <Mail className={base} />\n  if (c === \"whatsapp\") return <MessageCircle className={base} />\n  if (c === \"sms\") return <Waves className={base} />\n  if (c === \"voice\" || c === \"phone\") return <PhoneCall className={base} />\n  if (c === \"zoom\") return <CalendarClock className={base} />\n  return <Activity className={base} />\n}\n\nfunction channelBadge(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  let classes =\n    \"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (c === \"email\") {\n    classes += \" border-sky-400/60 bg-sky-500/10 text-sky-100\"\n  } else if (c === \"whatsapp\") {\n    classes += \" border-emerald-400/60 bg-emerald-500/10 text-emerald-100\"\n  } else if (c === \"sms\") {\n    classes += \" border-indigo-400/60 bg-indigo-500/10 text-indigo-100\"\n  } else if (c === \"voice\" || c === \"phone\") {\n    classes += \" border-amber-400/60 bg-amber-500/10 text-amber-100\"\n  } else if (c === \"zoom\") {\n    classes += \" border-fuchsia-400/60 bg-fuchsia-500/10 text-fuchsia-100\"\n  } else {\n    classes += \" border-white/20 bg-white/5 text-white/70\"\n  }\n\n  return (\n    <span className={classes}>\n      {channelIcon(channel)}\n      <span className=\"capitalize\">{channel ?? \"â€”\"}</span>\n    </span>\n  )\n}\n\nfunction statusBadge(status: string | null) {\n  const s = (status ?? \"\").toLowerCase()\n  let className =\n    \"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (s === \"sent\") {\n    className +=\n      \" border-emerald-400/70 bg-emerald-500/10 text-emerald-100 shadow-[0_0_20px_rgba(16,185,129,0.35)]\"\n    return (\n      <span className={className}>\n        <CheckCircle2 className=\"h-3 w-3\" />\n        sent\n      </span>\n    )\n  }\n\n  if (s === \"failed\") {\n    className +=\n      \" border-rose-400/70 bg-rose-500/10 text-rose-100 shadow-[0_0_20px_rgba(244,63,94,0.45)]\"\n    return (\n      <span className={className}>\n        <AlertTriangle className=\"h-3 w-3\" />\n        failed\n      </span>\n    )\n  }\n\n  if (s === \"queued\" || s === \"scheduled\") {\n    className +=\n      \" border-amber-400/70 bg-amber-500/10 text-amber-100 shadow-[0_0_20px_rgba(251,191,36,0.35)]\"\n    return (\n      <span className={className}>\n        <Zap className=\"h-3 w-3\" />\n        {s}\n      </span>\n    )\n  }\n\n  className += \" border-white/20 bg-white/5 text-white/70\"\n  return <span className={className}>{status ?? \"unknown\"}</span>\n}\n\nfunction tinyPill(text: string) {\n  return (\n    <span className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] uppercase tracking-[0.16em] text-white/50\">\n      {text}\n    </span>\n  )\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n  icon,\n}: {\n  label: string\n  value: number\n  helper: string\n  icon: React.ReactNode\n}) {\n  return (\n    <Card className=\"border-white/10 bg-gradient-to-b from-slate-900/40 via-slate-900/10 to-slate-900/0\">\n      <CardContent className=\"flex items-center gap-3 p-4\">\n        <div className=\"flex h-9 w-9 items-center justify-center rounded-2xl bg-white/10\">\n          {icon}\n        </div>\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n            {label}\n          </p>\n          <p className=\"text-2xl font-semibold text-white\">{value}</p>\n          <p className=\"text-[11px] text-white/50\">{helper}</p>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- Secciones UI ---------\n\nfunction LiveQueueSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Live queue\"\n        description=\"Touches en cola listos para salir (multi-canal).\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay touches en cola ahora mismo.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Step</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell>Meta</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Scheduled / Age\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const campaignLabel =\n                  row.campaign_id?.slice(0, 8).toUpperCase() ?? \"â€”\"\n                const metaChips: string[] = []\n                if (row.type) metaChips.push(row.type)\n                if (row.intent) metaChips.push(row.intent)\n                if (row.message_class) metaChips.push(row.message_class)\n\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell>\n                      <div className=\"flex flex-col gap-0.5\">\n                        {row.lead_id ? (\n                          <Link\n                            href={`/leads/${row.lead_id}`}\n                            className=\"text-sm font-semibold text-white hover:underline\"\n                          >\n                            {leadLabel}\n                          </Link>\n                        ) : (\n                          <span className=\"text-sm font-semibold text-white\">\n                            {leadLabel}\n                          </span>\n                        )}\n                        <p className=\"text-[11px] text-white/45\">\n                          Campaign: {campaignLabel}\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.step != null ? (\n                        <span className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[11px] text-white/70\">\n                          #{row.step}\n                        </span>\n                      ) : (\n                        \"â€”\"\n                      )}\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell>\n                      {metaChips.length === 0 ? (\n                        <span className=\"text-[11px] text-white/40\">\n                          â€”\n                        </span>\n                      ) : (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {metaChips.map((m) => (\n                            <span\n                              key={m}\n                              className=\"inline-flex items-center rounded-full bg-white/5 px-2 py-[2px] text-[10px] text-white/60\"\n                            >\n                              {m}\n                            </span>\n                          ))}\n                        </div>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right text-[11px] text-white/60\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.scheduled_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.scheduled_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction RecentErrorsSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Recent errors\"\n        description=\"Fallos de entrega hoy por canal.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <div className=\"flex items-center gap-2 p-4 text-sm text-emerald-200\">\n            <CheckCircle2 className=\"h-4 w-4\" />\n            <span>Sin errores hoy. Motor limpio. ðŸ™Œ</span>\n          </div>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>When</TableHeaderCell>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Error</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Status\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const errorText = row.error ?? \"unknown error\"\n                const shortError =\n                  errorText.length > 90\n                    ? `${errorText.slice(0, 90)}â€¦`\n                    : errorText\n\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell className=\"text-[11px] text-white/70\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.created_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.created_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {row.lead_id ? (\n                        <Link\n                          href={`/leads/${row.lead_id}`}\n                          className=\"text-sm font-semibold text-white hover:underline\"\n                        >\n                          {leadLabel}\n                        </Link>\n                      ) : (\n                        <span className=\"text-sm font-semibold text-white\">\n                          {leadLabel}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell className=\"max-w-md text-xs text-rose-200\">\n                      {shortError}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {statusBadge(row.status)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction AppointmentNotificationsSection({\n  rows,\n}: {\n  rows: AppointmentNotificationRow[]\n}) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Appointment notifications\"\n        description=\"Recordatorios de citas en cola para hoy.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <div className=\"flex items-center gap-2 p-4 text-sm text-white/60\">\n            <CalendarClock className=\"h-4 w-4 text-white/40\" />\n            <span>No hay notificaciones de citas en cola para hoy.</span>\n          </div>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Appointment</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Notify at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const apptLabel =\n                  row.appointment_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow\n                    key={row.id}\n                    className=\"transition hover:bg-white/10\"\n                  >\n                    <TableCell className=\"text-sm text-white\">\n                      {apptLabel}\n                    </TableCell>\n                    <TableCell>{channelBadge(row.channel)}</TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-right text-[11px] text-white/70\">\n                      <div className=\"space-y-0.5\">\n                        <span>{formatDate(row.notify_at)}</span>\n                        <span className=\"block text-white/40\">\n                          {timeAgo(row.notify_at)}\n                        </span>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- PÃ¡gina principal ---------\n\nexport default async function OperatorPage() {\n  const supabase = supabaseServer()\n\n  const [liveQueue, recentErrors, activityToday, apptNotifications] =\n    await Promise.all([\n      loadLiveQueue(supabase),\n      loadRecentErrors(supabase),\n      loadActivityToday(supabase),\n      loadAppointmentsNotificationsQueue(supabase),\n    ])\n\n  const totalQueued = liveQueue.length\n  const hasErrorsToday = recentErrors.length > 0\n\n  const engineLabel = hasErrorsToday\n    ? \"Execution engine con errores hoy\"\n    : totalQueued > 0\n    ? `Execution engine activo Â· ${totalQueued} en cola`\n    : \"Execution engine idle pero sano\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasErrorsToday\n    ? \"destructive\"\n    : totalQueued > 0\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n            Operations Â· Execution layer\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Operator Cockpit\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Vista en tiempo casi real del motor que manda emails, WhatsApps,\n            SMS, llamadas y recordatorios de citas.\n          </p>\n          <p className=\"text-[11px] text-white/40\">\n            {tinyPill(\"Today Â· UTC\")}\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* Tiles actividad hoy */}\n      <div className=\"grid gap-3 md:grid-cols-5\">\n        <MetricTile\n          label=\"Touches hoy\"\n          value={activityToday.touchesTotalToday}\n          helper=\"Todos los canales\"\n          icon={<Zap className=\"h-4 w-4 text-emerald-200\" />}\n        />\n        <MetricTile\n          label=\"Sent\"\n          value={activityToday.touchesSentToday}\n          helper=\"Entregados hoy\"\n          icon={<CheckCircle2 className=\"h-4 w-4 text-emerald-200\" />}\n        />\n        <MetricTile\n          label=\"Failed\"\n          value={activityToday.touchesFailedToday}\n          helper=\"Con error hoy\"\n          icon={<AlertTriangle className=\"h-4 w-4 text-rose-200\" />}\n        />\n        <MetricTile\n          label=\"Queued\"\n          value={activityToday.touchesQueuedToday}\n          helper=\"Creados hoy\"\n          icon={<Activity className=\"h-4 w-4 text-amber-200\" />}\n        />\n        <MetricTile\n          label=\"Cita â€“ notifs\"\n          value={activityToday.appointmentNotificationsToday}\n          helper=\"Recordatorios hoy\"\n          icon={<CalendarClock className=\"h-4 w-4 text-sky-200\" />}\n        />\n      </div>\n\n      {/* Live queue + errores */}\n      <div className=\"grid gap-6 xl:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]\">\n        <LiveQueueSection rows={liveQueue} />\n        <RecentErrorsSection rows={recentErrors} />\n      </div>\n\n      {/* Notifs de citas */}\n      <AppointmentNotificationsSection rows={apptNotifications} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/ssr/src_91b6d1b7._.js:259:            supabase.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/[root-of-the-server]__5e706096._.js:703:        client.from("touch_runs").select("id", {
./.next/dev/server/chunks/ssr/src_85f24f3d._.js.map:6:    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/operator/page.tsx"],"sourcesContent":["// src/app/operator/page.tsx\n\"use client\"\n\nimport React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport { Mail, MessageCircle, PhoneCall, Waves, Activity } from \"lucide-react\"\n\nexport const revalidate = 0\n\n// --------- Tipos base ---------\n\ntype TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  scheduled_at: string | null\n  sent_at: string | null\n  status: string | null\n  error: string | null\n  created_at: string | null\n  type: string | null\n  intent: string | null\n  outcome: string | null\n  retry_count: number | null\n  max_retries: number | null\n  message_class: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  org_id: string | null\n  appointment_id: string | null\n  channel: string | null\n  notify_at: string | null\n  status: string | null\n  created_at: string | null\n  sent_at: string | null\n  error: string | null\n}\n\ntype ActivityToday = {\n  touchesTotalToday: number\n  touchesSentToday: number\n  touchesFailedToday: number\n  touchesQueuedToday: number\n  appointmentNotificationsToday: number\n}\n\n// --------- Helpers de fecha ---------\n\nfunction getTodayRangeUTC() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\n// --------- Loaders (server-side) ---------\n\nasync function loadLiveQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"scheduled\"])\n    .order(\"scheduled_at\", { ascending: true })\n    .limit(50)\n\n  if (error) {\n    console.error(\"loadLiveQueue error\", error)\n    return []\n  }\n\n  return (data as TouchRunRow[] | null) ?? []\n}\n\nasync function loadRecentErrors(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .eq(\"status\", \"failed\")\n    .gte(\"created_at\", start)\n    .lt(\"created_at\", end)\n    .order(\"created_at\", { ascending: false })\n    .limit(30)\n\n  if (error) {\n    console.error(\"loadRecentErrors error\", error)\n    return []\n  }\n\n  return (data as TouchRunRow[] | null) ?? []\n}\n\nasync function loadActivityToday(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<ActivityToday> {\n  const fallback: ActivityToday = {\n    touchesTotalToday: 0,\n    touchesSentToday: 0,\n    touchesFailedToday: 0,\n    touchesQueuedToday: 0,\n    appointmentNotificationsToday: 0,\n  }\n\n  if (!client) return fallback\n\n  const { start, end } = getTodayRangeUTC()\n\n  const [\n    totalTouches,\n    sentTouches,\n    failedTouches,\n    queuedTouches,\n    apptNotifs,\n  ] = await Promise.all([\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"sent\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"failed\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"status\", [\"queued\", \"scheduled\"])\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n  ])\n\n  return {\n    touchesTotalToday: totalTouches.count ?? 0,\n    touchesSentToday: sentTouches.count ?? 0,\n    touchesFailedToday: failedTouches.count ?? 0,\n    touchesQueuedToday: queuedTouches.count ?? 0,\n    appointmentNotificationsToday: apptNotifs.count ?? 0,\n  }\n}\n\nasync function loadAppointmentsNotificationsQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentNotificationRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"appointments_notifications\")\n    .select(\n      [\n        \"id\",\n        \"org_id\",\n        \"appointment_id\",\n        \"channel\",\n        \"notify_at\",\n        \"status\",\n        \"created_at\",\n        \"sent_at\",\n        \"error\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"pending\"])\n    .gte(\"notify_at\", start)\n    .lt(\"notify_at\", end)\n    .order(\"notify_at\", { ascending: true })\n    .limit(30)\n\n  if (error) {\n    console.error(\"loadAppointmentsNotificationsQueue error\", error)\n    return []\n  }\n\n  return (data as AppointmentNotificationRow[] | null) ?? []\n}\n\n// --------- Helpers UI ---------\n\nfunction channelIcon(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  if (c === \"email\") return <Mail className=\"h-4 w-4\" />\n  if (c === \"whatsapp\") return <MessageCircle className=\"h-4 w-4\" />\n  if (c === \"sms\") return <Waves className=\"h-4 w-4\" />\n  if (c === \"voice\" || c === \"phone\") return <PhoneCall className=\"h-4 w-4\" />\n  if (c === \"zoom\") return <Activity className=\"h-4 w-4\" />\n  return <Activity className=\"h-4 w-4\" />\n}\n\nfunction formatDate(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  return dateTimeFormatter.format(d)\n}\n\nfunction statusBadge(status: string | null) {\n  const s = (status ?? \"\").toLowerCase()\n  let className =\n    \"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (s === \"sent\") {\n    className += \" border-emerald-400/60 bg-emerald-500/10 text-emerald-100\"\n  } else if (s === \"failed\") {\n    className += \" border-rose-400/60 bg-rose-500/10 text-rose-100\"\n  } else if (s === \"queued\" || s === \"scheduled\") {\n    className += \" border-amber-400/60 bg-amber-500/10 text-amber-100\"\n  } else {\n    className += \" border-white/20 bg-white/5 text-white/70\"\n  }\n\n  return <span className={className}>{status ?? \"unknown\"}</span>\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <Card className=\"bg-white/5 border-white/10\">\n      <CardContent className=\"space-y-1 p-4\">\n        <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n          {label}\n        </p>\n        <p className=\"text-2xl font-semibold text-white\">{value}</p>\n        <p className=\"text-xs text-white/50\">{helper}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- Secciones UI ---------\n\nfunction LiveQueueSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Live queue\"\n        description=\"Touches en cola listos para salir.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay touches en cola ahora mismo.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Step</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell>Retries</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Scheduled at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const campaignLabel =\n                  row.campaign_id?.slice(0, 8).toUpperCase() ?? \"â€”\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell>\n                      <div className=\"flex flex-col gap-0.5\">\n                        {row.lead_id ? (\n                          <Link\n                            href={`/leads/${row.lead_id}`}\n                            className=\"text-sm font-semibold text-white hover:underline\"\n                          >\n                            {leadLabel}\n                          </Link>\n                        ) : (\n                          <span className=\"text-sm font-semibold text-white\">\n                            {leadLabel}\n                          </span>\n                        )}\n                        <p className=\"text-[11px] text-white/50\">\n                          Campaign: {campaignLabel}\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.step ?? \"â€”\"}\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.retry_count ?? 0} / {row.max_retries ?? 3}\n                    </TableCell>\n                    <TableCell className=\"text-right text-sm text-white/70\">\n                      {formatDate(row.scheduled_at)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction RecentErrorsSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Recent errors\"\n        description=\"Fallos de entrega hoy por canal.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">Sin errores hoy. ðŸ™Œ</p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>When</TableHeaderCell>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Error</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Status\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"text-sm text-white/70\">\n                      {formatDate(row.created_at)}\n                    </TableCell>\n                    <TableCell>\n                      {row.lead_id ? (\n                        <Link\n                          href={`/leads/${row.lead_id}`}\n                          className=\"text-sm font-semibold text-white hover:underline\"\n                        >\n                          {leadLabel}\n                        </Link>\n                      ) : (\n                        <span className=\"text-sm font-semibold text-white\">\n                          {leadLabel}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"max-w-md text-sm text-rose-200\">\n                      {row.error ?? \"unknown error\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {statusBadge(row.status)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction AppointmentNotificationsSection({\n  rows,\n}: {\n  rows: AppointmentNotificationRow[]\n}) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Appointment notifications\"\n        description=\"Recordatorios de citas en cola para hoy.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay notificaciones de citas en cola para hoy.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Appointment</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Notify at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const apptLabel =\n                  row.appointment_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"text-sm text-white\">\n                      {apptLabel}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-right text-sm text-white/70\">\n                      {formatDate(row.notify_at)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- PÃ¡gina principal ---------\n\nexport default async function OperatorPage() {\n  const supabase = supabaseServer()\n\n  const [liveQueue, recentErrors, activityToday, apptNotifications] =\n    await Promise.all([\n      loadLiveQueue(supabase),\n      loadRecentErrors(supabase),\n      loadActivityToday(supabase),\n      loadAppointmentsNotificationsQueue(supabase),\n    ])\n\n  const totalQueued = liveQueue.length\n  const hasErrorsToday = recentErrors.length > 0\n\n  const engineLabel = hasErrorsToday\n    ? \"Execution engine con errores hoy\"\n    : totalQueued > 0\n    ? `Execution engine activo Â· ${totalQueued} en cola`\n    : \"Execution engine idle pero sano\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasErrorsToday\n    ? \"destructive\"\n    : totalQueued > 0\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Operations\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Operator Cockpit\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Vista en tiempo casi real del motor de ejecuciÃ³n: touches,\n            errores y recordatorios de citas.\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* Tiles actividad hoy */}\n      <div className=\"grid gap-3 md:grid-cols-5\">\n        <MetricTile\n          label=\"Touches hoy\"\n          value={activityToday.touchesTotalToday}\n          helper=\"Todos los canales\"\n        />\n        <MetricTile\n          label=\"Sent\"\n          value={activityToday.touchesSentToday}\n          helper=\"Entregados hoy\"\n        />\n        <MetricTile\n          label=\"Failed\"\n          value={activityToday.touchesFailedToday}\n          helper=\"Con error hoy\"\n        />\n        <MetricTile\n          label=\"Queued\"\n          value={activityToday.touchesQueuedToday}\n          helper=\"Creados hoy\"\n        />\n        <MetricTile\n          label=\"Cita â€“ notifs\"\n          value={activityToday.appointmentNotificationsToday}\n          helper=\"Recordatorios hoy\"\n        />\n      </div>\n\n      {/* Live queue + errores */}\n      <div className=\"grid gap-6 xl:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]\">\n        <LiveQueueSection rows={liveQueue} />\n        <RecentErrorsSection rows={recentErrors} />\n      </div>\n\n      {/* Notifs de citas */}\n      <AppointmentNotificationsSection rows={apptNotifications} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/server/chunks/[root-of-the-server]__6de3021e._.js.map:5:    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/backend/src/command-os/client.ts"],"sourcesContent":["// backend/src/command-os/client.ts\nimport OpenAI from \"openai\"\n\nexport const COMMAND_OS_VERSION = \"v1\"\n\nexport type CommandOsIntent =\n  | \"lead.enroll\"\n  | \"lead.inspect\"\n  | \"campaign.create\"\n  | \"campaign.pause\"\n  | \"orchestrator.rerun\"\n  | \"touch.simulate\"\n  | \"touch.dispatch_test\"\n  | \"system.status\"\n  | \"system.bottleneck\"\n\nexport interface CommandOsResponse {\n  version: string\n  intent: CommandOsIntent\n  args: Record<string, any>\n  explanation: string\n  confidence: number // 0â€“1\n}\n\n// ðŸ‘‘ Pega aquÃ­ EL PROMPT MAESTRO COMPLETO que ya hicimos\nconst COMMAND_OS_PROMPT_V1 = `\n<<< REVENUE ASI â€” COMMAND OS\nSystem Prompt v1\n\nROL CENTRAL\nEres REVENUE ASI â€” COMMAND OS, la capa de control conversacional de Revenue ASI.\nTu trabajo es traducir lenguaje humano en INTENTS estructurados que el backend ejecuta sobre:\n\nDirector Brain (estrategia de campaÃ±as y prioridades)\n\nLead Brain (scoring, buckets, next actions)\n\nLead State Machine\n\nTouch Orchestrator (agenda y lÃ³gica de touches)\n\nDispatch Layer (WhatsApp, Email, Voice, SMS â€“ reales o mock)\n\nCampaign Engine (creaciÃ³n, ediciÃ³n, parÃ¡metros)\n\nMemory / Timeline (core_memory_events, lead_history)\n\nCron & Jobs (touch_runs, enrichment, etc.)\n\nFunnel Overview (citas, tasas de conversiÃ³n, health)\n\nProviders Layer (Twilio WA, Twilio Voice, Elastic Email, OpenAI), segÃºn el contexto que recibas\n\nTÃº NO ejecutas cÃ³digo, NO corres SQL y NO modificas datos directamente.\nSolo decides:\n\nquÃ© INTENT usar\n\ncon quÃ© ARGUMENTOS\n\nquÃ© explicaciÃ³n darle al usuario\n\ncuÃ¡nta confianza tienes en esa decisiÃ³n.\n\nEl backend se encarga del resto.\n\nINPUT QUE RECIBES\n\nSiempre recibirÃ¡s algo asÃ­ (el backend lo envÃ­a como texto en el mensaje del usuario):\n\nmessage: texto libre del usuario, en espaÃ±ol o inglÃ©s.\n\ncontext: objeto JSON opcional con informaciÃ³n operacional.\nPuede incluir, por ejemplo:\n\nclient_id\n\nuser_id\n\nactive_campaigns\n\nproviders_status (ej. { twilio_wa: \"connected\" | \"mock\" | \"disconnected\", ... })\n\nfeature_flags\n\nenvironment (\"dev\", \"staging\", \"prod\")\n\notros datos de sistema\n\nDebes usar message + context para decidir el INTENT y los ARGS.\nSi el contexto no trae algo crÃ­tico, no lo inventes: pide que el backend lo provea en una prÃ³xima llamada o exige argumentos explÃ­citos en args.\n\nESTILO, PERSONALIDAD Y PRIORIDADES\n\nTu personalidad:\n\nGrowth Director + CTO operativo.\n\nDirecto, sin adornos, sin cortesÃ­as.\n\nCero bullshit. Cero relleno.\n\nCrÃ­tico cuando haga falta; siempre pro-acciÃ³n.\n\nObsesiÃ³n por: claridad, seguridad, siguiente paso.\n\nTus prioridades:\n\nEntender quÃ© quiere lograr el usuario (outcome, no solo comando literal).\n\nEscoger el INTENT que mÃ¡s se acerque a ese outcome.\n\nDiseÃ±ar args mÃ­nimos pero suficientes para que el backend ejecute.\n\nProteger el sistema (no spam, no borrados masivos sin confirmar, etc.).\n\nMantener el flujo moviÃ©ndose hacia generar citas y revenue.\n\nCONTRATO DE SALIDA (OBLIGATORIO)\n\nSIEMPRE debes responder con UN SOLO JSON VÃLIDO, sin texto alrededor, con esta forma EXACTA:\n\n{\n\"version\": \"v1\",\n\"intent\": \"<string>\",\n\"args\": { },\n\"explanation\": \"<string>\",\n\"confidence\": 0.0\n}\n\nversion: siempre \"v1\" en esta versiÃ³n del sistema.\n\nintent: uno de los INTENTS permitidos (ver secciÃ³n 4).\n\nargs: objeto con los parÃ¡metros que el backend necesita.\n\nexplanation: explicaciÃ³n corta, en el mismo idioma del message, sobre lo que piensas hacer y por quÃ©.\n\nconfidence: nÃºmero de 0.0 a 1.0 que representa quÃ© tan seguro estÃ¡s del INTENT elegido.\n\nNO escribas nada fuera del JSON.\nNO uses comentarios dentro del JSON.\nNO expliques tu razonamiento paso a paso: todo eso es interno; solo entregas el JSON final.\n\nSi no estÃ¡s seguro del intent correcto, escoge el mÃ¡s cercano y baja confidence (ej. 0.5) explicando quÃ© te faltÃ³.\n\nLISTA DE INTENTS v1\n\nEstos son los INTENTS vÃ¡lidos en esta versiÃ³n.\nSi el usuario pide algo que no encaja bien, escoge el INTENT mÃ¡s cercano y explÃ­calo en explanation.\n\n\"system.status\"\nUso: el usuario pregunta por el estado general del sistema.\nEjemplos de message:\n\n\"Â¿CÃ³mo estÃ¡ el sistema hoy?\"\n\n\"Dame un health check de Revenue ASI.\"\n\n\"Status rÃ¡pido del motor.\"\n\nArgs sugeridos:\n\npuede ir vacÃ­o {}\n\nopcional: { \"scope\": \"full\" | \"providers\" | \"orchestrator\" | \"campaigns\" }\n\n\"system.bottleneck\"\nUso: el usuario quiere saber cuÃ¡l es el cuello de botella actual.\nEjemplos:\n\n\"Â¿CuÃ¡l es el cuello de botella ahora?\"\n\n\"Â¿QuÃ© me estÃ¡ frenando las citas?\"\n\n- lead.update\n  - Usa este intent cuando el usuario quiera CAMBIAR el estado de un lead, score, notas, etc.\n  - args:\n    - lead_id: string (UUID)\n    - updates: object con uno o varios de:\n      - status, state, score, lead_brain_score, lead_brain_bucket, notes, last_touched_at, last_channel\n  - Ejemplo:\n    {\n      \"intent\": \"lead.update\",\n      \"args\": {\n        \"lead_id\": \"uuid\",\n        \"updates\": {\n          \"status\": \"qualified\",\n          \"notes\": \"interesado en demo esta semana\"\n        }\n      }\n    }\n\n- lead.list.recents\n  - Usa este intent cuando el usuario quiera LISTAR leads recientes.\n  - args:\n    - limit?: number (1â€“100, default 20)\n    - status?: string\n    - state?: string\n  - Ejemplos:\n    - Ãºltimos 10 leads new â†’ { \"intent\": \"lead.list.recents\", \"args\": { \"limit\": 10, \"status\": \"new\" } }\n\nArgs sugeridos:\n\n{ \"time_window\": \"24h\" | \"7d\" | \"30d\" } (si el usuario lo menciona o es deducible)\n\n\"lead.inspect\"\n  - Usa este intent cuando el usuario quiera VER la informaciÃ³n de un lead.\n  - Puedes identificar el lead por:\n    - lead_id (UUID)\n    - email\n    - phone\n    - contact_name\n  - Usa los campos que el usuario te dÃ©. Si NO da lead_id, prefiere email o phone antes que contact_name.\n  - Ejemplos:\n    - \"Inspecciona el lead e5b0a3f7-...\" â†’\n      {\n        \"intent\": \"lead.inspect\",\n        \"args\": {\n          \"lead_id\": \"e5b0a3f7-...\"\n        }\n      }\n    - \"Inspecciona el lead con email pacho@test.com\" â†’\n      {\n        \"intent\": \"lead.inspect\",\n        \"args\": {\n          \"email\": \"pacho@test.com\"\n        }\n      }\n    - \"Inspecciona el lead con telÃ©fono +15055550123\" â†’\n      {\n        \"intent\": \"lead.inspect\",\n        \"args\": {\n          \"phone\": \"+15055550123\"\n        }\n      }\nUso: inspeccionar un lead especÃ­fico.\nEjemplos:\n\n\"RevÃ­same al lead Juan PÃ©rez.\"\n\n\"Â¿QuÃ© pasÃ³ con el lead X?\"\n\nArgs requeridos:\n\n{ \"lead_id\": \"<uuid>\" }\nSi el usuario solo da nombre, puedes pedir que el backend resuelva y poner en args algo tipo { \"lead_reference\": \"Juan PÃ©rez\" }.\n\n\"lead.enroll\"\n  - Usa este intent cuando el usuario quiera ENROLAR lead(s) en una campaÃ±a.\n  - Para identificar leads puedes usar:\n    - lead_ids: string[]\n    - o un selector: email, phone, contact_name\n  - Para identificar la campaÃ±a:\n    - campaign_id\n    - o campaign_name (nombre humano de la campaÃ±a)\n  - Siempre que el usuario diga algo como \"confirma\", pon confirm: true.\n  - Ejemplos:\n    - \"Enrola el lead e5b0a3f7-... en la campaÃ±a de prueba de dentistas y confirma\" â†’\n      {\n        \"intent\": \"lead.enroll\",\n        \"args\": {\n          \"lead_ids\": [\"e5b0a3f7-...\"],\n          \"campaign_name\": \"campaÃ±a de prueba de dentistas\",\n          \"confirm\": true,\n          \"source\": \"manual\"\n        }\n      }\n    - \"Enrola el lead con email pacho@test.com en la campaÃ±a Dentistas PanamÃ¡ y confirma\" â†’\n      {\n        \"intent\": \"lead.enroll\",\n        \"args\": {\n          \"email\": \"pacho@test.com\",\n          \"campaign_name\": \"Dentistas PanamÃ¡\",\n          \"confirm\": true,\n          \"source\": \"manual\"\n        }\n      }\nUso: enrolar uno o varios leads en una campaÃ±a concreta.\nEjemplos:\n\n\"Enrolla estos leads a la campaÃ±a de dentistas.\"\n\n\"Carga este CSV y mÃ©telos en la campaÃ±a X.\"\n\nArgs sugeridos:\n\n{ \"campaign_id\": \"<uuid-opcional>\", \"campaign_name\": \"<string-opcional>\", \"lead_ids\": [\"<uuid>\", ...], \"source\": \"csv|manual|import\", \"confirm\": boolean }\nSi es un volumen grande o ambiguo, pon confirm: false y explÃ­calo.\n\n\"lead.update_state\"\nUso: cambiar el estado de un lead o un grupo de leads dentro de la state machine.\nEjemplos:\n\n\"Marca este lead como no-fit.\"\n\n\"Pasa estos leads a 'hot'.\"\n\nArgs sugeridos:\n\n{ \"lead_ids\": [\"<uuid>\", ...], \"new_state\": \"<string>\", \"reason\": \"<string-opcional>\" }\n\n- lead.list.recents\n  - Usa este intent cuando el usuario quiera LISTAR leads recientes.\n  - args:\n    - limit?: number (1â€“100, default 20)\n    - status?: string\n    - state?: string\n\n\n\"campaign.create\"\nUso: crear una campaÃ±a nueva.\nEjemplos:\n\n\"Crea una campaÃ±a para dentistas en PanamÃ¡ con tono agresivo.\"\n\nArgs sugeridos:\n\n{ \"name\": \"<string>\", \"niche\": \"<string>\", \"market\": \"<string|opcional>\", \"tone\": \"<string>\", \"objective\": \"citas|leads|demo\", \"channels\": [\"whatsapp\",\"email\",\"voice\",\"sms\"], \"notes\": \"<string-opcional>\" }\n\n\"campaign.update\"\nUso: ajustar parÃ¡metros de una campaÃ±a existente.\nEjemplos:\n\n\"Suaviza el tono de la campaÃ±a de dentistas.\"\n\n\"Cambia el objetivo de esta campaÃ±a a solo leads.\"\n\nArgs sugeridos:\n\n{ \"campaign_id\": \"<uuid-opcional>\", \"campaign_name\": \"<string-opcional>\", \"patch\": { ... } }\nDonde patch puede incluir cambios como { \"tone\": \"...\", \"objective\": \"...\", \"channels\": [...] }.\n\n\"campaign.pause\"\nUso: pausar una campaÃ±a (o grupo de campaÃ±as).\nEjemplos:\n\n\"Pausa la campaÃ±a de dentistas.\"\n\n\"DetÃ©n todas las campaÃ±as de este cliente.\"\n\nArgs sugeridos:\n\n{ \"campaign_id\": \"<uuid-opcional>\", \"campaign_name\": \"<string-opcional>\", \"scope\": \"single|all_for_client\", \"confirm\": boolean }\n\n\"orchestrator.rerun\"\nUso: forzar recalcular next actions para un conjunto de leads.\nEjemplos:\n\n\"Rerun del orchestrator para todos los leads activos.\"\n\nArgs sugeridos:\n\n{ \"scope\": \"all|campaign|lead_ids\", \"campaign_id\": \"<uuid-opcional>\", \"lead_ids\": [\"<uuid>\", ...] }\n\n\"touch.simulate\"\nUso: simular un touch run sin enviar mensajes reales.\nEjemplos:\n\n\"Simula un dÃ­a de touches.\"\n\nArgs sugeridos:\n\n{ \"scope\": \"all|campaign|lead_ids\", \"time_window\": \"24h|7d\" }\n\n\"touch.dispatch_test\"\nUso: enviar un touch real controlado (ej. primer WhatsApp de prueba).\nPensado para cuando los proveedores ya estÃ¡n conectados o en modo sandbox.\nEjemplos:\n\n\"MÃ¡ndame un WhatsApp de prueba a mi nÃºmero.\"\n\nArgs sugeridos:\n\n{ \"channel\": \"whatsapp|email|sms|voice\", \"to_test\": \"owner|fixed\", \"test_recipient\": \"<phone/email-opcional>\", \"template_name\": \"<string-opcional>\", \"confirm\": boolean }\n\nSi el contexto indica que los proveedores NO estÃ¡n conectados, puedes igualmente usar este intent pero poner confidence mÃ¡s baja y explicar que se requiere conexiÃ³n/provider.\n\n\"director.next_action\"\nUso: el usuario quiere saber quÃ© hacer ahora para mover el sistema.\nEjemplos:\n\n\"Â¿QuÃ© hago ahora para subir citas?\"\n\n\"Dame la prÃ³xima acciÃ³n mÃ¡s importante.\"\n\nArgs sugeridos:\n\n{ \"focus\": \"citas|margen|testing|infra\", \"time_window\": \"hoy|7d\" }\n\nREGLAS DE SEGURIDAD Y CONFIRMACIÃ“N\n\nNunca asumas que estÃ¡s en producciÃ³n: mira context.environment si existe.\n\nSi es \"dev\" o \"staging\", puedes ser mÃ¡s agresivo para pruebas.\n\nSi es \"prod\", sÃ© mÃ¡s conservador con acciones masivas.\n\nPara acciones peligrosas (pausar muchas campaÃ±as, cambiar estado de muchos leads, enviar mensajes reales), incluye SIEMPRE un campo confirm en args.\n\nSi el usuario explÃ­citamente pide algo fuerte (â€œsÃ­, pausa TODOâ€, â€œsÃ­, mÃ¡ndalo ya a todosâ€), puedes poner confirm: true.\n\nSi no, pon confirm: false y en explanation di que el backend deberÃ­a pedir confirmaciÃ³n.\n\nNo inventes IDs ni detalles tÃ©cnicos (tablas, columnas, nombres internos).\nUsa referencias de mÃ¡s alto nivel (campaign_name, lead_reference) si no tienes uuid.\n\nSi el usuario pide algo fuera de tu alcance (ej. diseÃ±o de copy creativo, redacciÃ³n larga, etc.), escoge el intent mÃ¡s cercano (ej. campaign.create) y en args agrega un campo tipo \"needs_copy_generation\": true, explicÃ¡ndolo en explanation.\n\nCÃ“MO DECIDIR EL INTENT\n\nPrimero, identifica el objetivo del usuario:\n\nÂ¿Quiere ver informaciÃ³n? â†’ system.status, system.bottleneck, lead.inspect.\n\nÂ¿Quiere cambiar algo? â†’ campaign.update, campaign.pause, lead.update_state.\n\nÂ¿Quiere ejecutar el motor? â†’ lead.enroll, orchestrator.rerun, touch.simulate, touch.dispatch_test.\n\nÂ¿Quiere guÃ­a? â†’ director.next_action.\n\nSegundo, mira el contexto (context) para ajustar la decisiÃ³n:\n\nSi providers_status.whatsapp === \"disconnected\", pero pide un envÃ­o real, usa igual touch.dispatch_test pero baja confidence y explÃ­calo.\n\nTercero, diseÃ±a los args mÃ¡s simples que permitan al backend entender quÃ© hacer.\nNo metas ruido.\nNo te inventes parÃ¡metros innecesarios.\n\nIDIOMA Y EXPLANATION\n\nResponde siempre en el idioma del message (espaÃ±ol o inglÃ©s).\n\nexplanation debe ser:\n\ncorta\n\ndirecta\n\nsin adornos\n\nenfocada en: quÃ© intent elegiste, por quÃ©, quÃ© necesitarÃ­a el backend si falta algo.\n\nEjemplo de buena explanation (en espaÃ±ol):\n\"El usuario pidiÃ³ ver el health del sistema. Uso system.status con scope 'full' para que el backend devuelva un health check general.\"\n\nSI NO SABES QUÃ‰ HACER\n\nSi el mensaje es muy ambiguo o no encaja claramente en ningÃºn intent:\n\nEscoge el INTENT mÃ¡s cercano.\n\nPon confidence baja (0.4â€“0.6).\n\nEn explanation, di exactamente quÃ© te faltÃ³ (ej. \"Falta campaign_id\" o \"No sÃ© si el usuario quiere simular o enviar real\").\n\nDiseÃ±a args para que el backend pueda pedir una aclaraciÃ³n en la siguiente interacciÃ³n.\n\nRECORDATORIO FINAL\n\nTu trabajo no es â€œhablar bonitoâ€.\n\nTu trabajo es elegir el INTENT correcto y los ARGS correctos para que Revenue ASI se mueva.\n\nPiensa como un Director de Growth operando una mÃ¡quina de ventas automatizada.\n\nHaz todo tu razonamiento internamente y entrega SOLO el JSON final con:\nversion, intent, args, explanation, confidence.\n\nFIN DEL SYSTEM PROMPT v1 â€” REVENUE ASI â€” COMMAND OS >>>\n` as const\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY!,\n})\n\nexport async function callCommandOs(input: {\n  message: string\n  context?: any\n}): Promise<CommandOsResponse> {\n  const completion = await openai.chat.completions.create({\n    model: \"gpt-5.1\",\n    messages: [\n      {\n        role: \"system\",\n        content:\n          COMMAND_OS_PROMPT_V1 +\n          `\n\nA partir de ahora SIEMPRE responde SOLO con un JSON vÃ¡lido con esta forma exacta:\n{\n  \"version\": \"v1\",\n  \"intent\": \"<string>\",\n  \"args\": { },\n  \"explanation\": \"<string>\",\n  \"confidence\": 0.0\n}\nNo escribas nada fuera de ese JSON.\n`,\n      },\n      {\n        role: \"user\",\n        content: JSON.stringify(input),\n      },\n    ],\n  })\n\n  const raw = completion.choices[0].message?.content?.trim() || \"{}\"\n\n  let parsed: CommandOsResponse\n  try {\n    parsed = JSON.parse(raw)\n  } catch (e) {\n    console.error(\"Command OS devolviÃ³ JSON invÃ¡lido:\", raw)\n    throw new Error(`Command OS JSON parse error`)\n  }\n\n  if (!parsed.version) {\n    parsed.version = COMMAND_OS_VERSION\n  }\n\n  return parsed\n}\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;;;;AACnC;AAAA;;AAEO,MAAM,qBAAqB;AAqBlC,yDAAyD;AACzD,MAAM,uBAAuB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6b9B,CAAC;AAED,MAAM,SAAS,IAAI,mLAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEO,eAAe,cAAc,KAGnC;IACC,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QACtD,OAAO;QACP,UAAU;YACR;gBACE,MAAM;gBACN,SACE,uBACA,CAAC;;;;;;;;;;;AAWX,CAAC;YACK;YACA;gBACE,MAAM;gBACN,SAAS,KAAK,SAAS,CAAC;YAC1B;SACD;IACH;IAEA,MAAM,MAAM,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,UAAU;IAE9D,IAAI;IACJ,IAAI;QACF,SAAS,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MAAM,CAAC,2BAA2B,CAAC;IAC/C;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG;IACnB;IAEA,OAAO;AACT"}},
./.next/dev/static/chunks/src_dfce2b12._.js:75:                supabase.from("touch_runs").select("id, status, created_at").order("created_at", {
./.next/dev/static/chunks/src_dfce2b12._.js:105:                console.warn("Failed to load touch_runs", touchResp.error);
./.next/dev/static/chunks/src_dfce2b12._.js.map:6:    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/health/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\"\nimport { RefreshCw, Shield, Signal } from \"lucide-react\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport { Button, Card, CardContent, CardHeader, StatCard } from \"@/components/ui-custom\"\n\ntype JobRun = {\n  id: string\n  job_name?: string | null\n  status?: string | null\n  created_at?: string | null\n  duration_ms?: number | null\n}\n\ntype TouchRun = {\n  id: string\n  status?: string | null\n  created_at?: string | null\n}\n\nexport default function HealthPage() {\n  const supabase = useMemo(() => {\n    const hasEnv = process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    return hasEnv ? supabaseBrowser() : null\n  }, [])\n  const [runs, setRuns] = useState<JobRun[]>([])\n  const [loading, setLoading] = useState(true)\n  const [jobCounts, setJobCounts] = useState({ success: 0, failed: 0 })\n  const [touchRun, setTouchRun] = useState<TouchRun | null>(null)\n  const [lastJobRun, setLastJobRun] = useState<JobRun | null>(null)\n\n  const refreshHealth = useCallback(async () => {\n    if (!supabase) {\n      setLoading(false)\n      return\n    }\n\n    setLoading(true)\n    const since = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()\n\n    const [jobResp, touchResp] = await Promise.all([\n      supabase\n        .from(\"job_runs\")\n        .select(\"id, job_name, status, created_at, duration_ms\")\n        .order(\"created_at\", { ascending: false })\n        .limit(20),\n      supabase.from(\"touch_runs\").select(\"id, status, created_at\").order(\"created_at\", { ascending: false }).limit(1),\n    ])\n\n    if (jobResp.error) {\n      console.warn(\"Failed to load job_runs\", jobResp.error)\n      setRuns([])\n      setJobCounts({ success: 0, failed: 0 })\n      setLastJobRun(null)\n    } else {\n      const filtered = (jobResp.data ?? []).filter((run) => (run.created_at ?? \"\") >= since)\n      const success = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"succeeded\").length\n      const failed = filtered.filter((run) => (run.status ?? \"\").toLowerCase() === \"failed\").length\n      setRuns(jobResp.data ?? [])\n      setJobCounts({ success, failed })\n      setLastJobRun(jobResp.data?.[0] ?? null)\n    }\n\n    if (touchResp.error) {\n      console.warn(\"Failed to load touch_runs\", touchResp.error)\n      setTouchRun(null)\n    } else {\n      setTouchRun(touchResp.data?.[0] ?? null)\n    }\n\n    setLoading(false)\n  }, [supabase])\n\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/set-state-in-effect\n    void refreshHealth()\n  }, [refreshHealth])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">Systems</p>\n          <h1 className=\"text-3xl font-semibold text-white\">Health</h1>\n          <p className=\"text-sm text-white/60\">Heartbeat across cadences, enrichers, and dispatchers.</p>\n        </div>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"gap-2\"\n          onClick={refreshHealth}\n          aria-label=\"Refresh health\"\n        >\n          <RefreshCw size={16} />\n          Refresh\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Jobs\"\n          value={`${jobCounts.success} succeeded / ${jobCounts.failed} failed`}\n          helper=\"job_runs last 24h\"\n          delta={supabase ? \"Live\" : \"Offline\"}\n        />\n        <StatCard\n          label=\"Dispatch\"\n          value={\n            touchRun\n              ? `${touchRun.status ?? \"pending\"}`\n              : supabase\n                ? \"No dispatch runs\"\n                : \"Supabase env missing\"\n          }\n          helper={\n            touchRun?.created_at\n              ? new Date(touchRun.created_at).toLocaleString()\n              : \"Watching cadence triggers\"\n          }\n          delta={touchRun ? \"Latest\" : \"Idle\"}\n        />\n        <StatCard\n          label=\"Run cadence\"\n          value={lastJobRun ? lastJobRun.status ?? \"pending\" : \"No runs\"}\n          helper={lastJobRun?.created_at ? new Date(lastJobRun.created_at).toLocaleString() : \"Cron via SQL\"}\n          delta={lastJobRun ? \"Latest\" : \"Idle\"}\n        />\n      </div>\n\n      <Card>\n        <CardHeader\n          title=\"Recent checks\"\n          description=\"Edge functions and workers reporting back from Supabase\"\n          action={\n            <div className=\"flex items-center gap-2 text-sm text-white/60\">\n              <Signal size={16} />\n              {loading ? \"Loading\" : `${runs.length} pings`}\n            </div>\n          }\n        />\n        <CardContent className=\"space-y-3\">\n          {loading ? (\n            <div className=\"space-y-2\">\n              {[1, 2, 3].map((row) => (\n                <div key={row} className=\"h-12 animate-pulse rounded-xl bg-white/5\" />\n              ))}\n            </div>\n          ) : runs.length === 0 ? (\n            <div className=\"rounded-2xl border border-dashed border-emerald-400/40 bg-white/5 px-5 py-6 text-center\">\n              <p className=\"text-lg font-semibold text-white\">No health signals yet</p>\n              <p className=\"text-sm text-white/60\">We will surface job_runs as they arrive.</p>\n            </div>\n          ) : (\n            <div className=\"grid gap-2\">\n              {runs.map((run) => {\n                const status = (run.status ?? \"\").toLowerCase()\n                const ok = status === \"succeeded\" || status === \"success\"\n                return (\n                  <div\n                    key={run.id}\n                    className=\"flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-4 py-3\"\n                  >\n                    <div className=\"space-y-1\">\n                      <p className=\"font-semibold text-white\">{run.job_name ?? \"Unknown job\"}</p>\n                      <p className=\"text-xs text-white/50\">{new Date(run.created_at ?? \"\").toLocaleString()}</p>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                      <Shield size={16} className={ok ? \"text-emerald-300\" : \"text-amber-300\"} />\n                      <span className={ok ? \"text-emerald-200\" : \"text-amber-200\"}>\n                        {status || \"pending\"}\n                      </span>\n                      {typeof run.duration_ms === \"number\" && (\n                        <span className=\"text-xs text-white/50\">{Math.round(run.duration_ms)} ms</span>\n                      )}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_a616accd._.js:72:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/static/chunks/src_a616accd._.js:104:    const { data, error } = await client.from("touch_runs").select([
./.next/dev/static/chunks/src_a616accd._.js:141:        client.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_a616accd._.js:145:        client.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_a616accd._.js:149:        client.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_a616accd._.js:153:        client.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_aff5cf83._.js.map:7:    {"offset": {"line": 402, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/voice-insights/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport {\n  Activity,\n  Filter,\n  Loader2,\n  RefreshCcw,\n  X,\n  PhoneCall,\n} from \"lucide-react\"\n\nimport { IntentBadge, LeadStateBadge } from \"@/components/leads/badges\"\nimport {\n  Badge,\n  Button,\n  Card,\n  CardContent,\n  Input,\n  Select,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype VoiceCallBase = {\n  id: string\n  lead_id: string\n  touch_run_id: string | null\n  status: string | null\n  provider: string | null\n  provider_call_id: string | null\n  to_phone: string | null\n  meta: Record<string, unknown> | null\n  updated_at: string\n}\n\ntype Lead = {\n  id: string\n  contact_name: string | null\n  company: string | null\n  phone: string | null\n  state: string | null\n  email: string | null\n}\n\ntype LeadEvent = {\n  id: string\n  lead_id: string\n  event_type: string\n  payload: Record<string, unknown> | null\n  created_at: string\n}\n\ntype Appointment = {\n  id: string\n  lead_id: string\n  scheduled_for: string\n  status: string\n}\n\ntype TouchRun = {\n  id: string\n  lead_id: string\n  status: string\n  error: string | null\n  campaign_id: string | null\n}\n\ntype CampaignMeta = {\n  id: string\n  name: string | null\n}\n\ntype IntentFilter = \"all\" | \"appointment\" | \"unknown\"\ntype AppointmentFilter = \"all\" | \"yes\" | \"no\"\ntype CadenceFilter = \"all\" | \"stopped\" | \"active\"\n\ntype VoiceCallRow = VoiceCallBase & {\n  transcript: string\n  intent: string\n  hasAppointment: boolean\n  cadenceStopped: boolean\n  campaign_id: string | null\n  campaign_name: string | null\n}\n\nconst dateFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"numeric\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\n// -----------------------------------------------------------------------------\n// Page\n// -----------------------------------------------------------------------------\n\nexport default function VoiceInsightsPage() {\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [calls, setCalls] = useState<VoiceCallBase[]>([])\n  const [leads, setLeads] = useState<Record<string, Lead>>({})\n  const [events, setEvents] = useState<LeadEvent[]>([])\n  const [appointments, setAppointments] = useState<Appointment[]>([])\n  const [touchRuns, setTouchRuns] = useState<TouchRun[]>([])\n  const [campaigns, setCampaigns] = useState<Record<string, CampaignMeta>>({})\n\n  const [intentFilter, setIntentFilter] = useState<IntentFilter>(\"all\")\n  const [appointmentFilter, setAppointmentFilter] =\n    useState<AppointmentFilter>(\"all\")\n  const [cadenceFilter, setCadenceFilter] = useState<CadenceFilter>(\"all\")\n  const [campaignFilter, setCampaignFilter] = useState<string>(\"all\")\n\n  const [search, setSearch] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const [activeCallId, setActiveCallId] = useState<string | null>(null)\n\n  // ---------------------------------------------------------------------------\n  // Load data\n  // ---------------------------------------------------------------------------\n\n  useEffect(() => {\n    let alive = true\n\n    async function loadData() {\n      if (!supabaseReady) {\n        setError(\n          \"Supabase is not configured. Add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to load data.\",\n        )\n        setLoading(false)\n        return\n      }\n\n      setLoading(true)\n      setError(null)\n\n      const client = supabaseBrowser()\n\n      const { data: callsData, error: callsError } = await client\n        .from(\"voice_insights_calls_v1\")\n        .select(\n          \"id, lead_id, touch_run_id, status, provider, provider_call_id, to_phone, meta, updated_at\",\n        )\n        .order(\"updated_at\", { ascending: false })\n        .limit(100)\n\n      if (!alive) return\n\n      if (callsError) {\n        console.error(callsError)\n        setError(\"Unable to fetch voice calls.\")\n        setLoading(false)\n        return\n      }\n\n      const safeCalls = (callsData ?? []) as VoiceCallBase[]\n      setCalls(safeCalls)\n\n      const leadIds = Array.from(new Set(safeCalls.map((call) => call.lead_id)))\n\n      if (leadIds.length === 0) {\n        setLeads({})\n        setEvents([])\n        setAppointments([])\n        setTouchRuns([])\n        setCampaigns({})\n        setLoading(false)\n        return\n      }\n\n      const [\n        leadsResult,\n        eventsResult,\n        appointmentsResult,\n        touchRunsResult,\n        campaignsResult,\n      ] = await Promise.all([\n        client\n          .from(\"leads\")\n          .select(\"id, contact_name, company, phone, state, email\")\n          .in(\"id\", leadIds),\n        client\n          .from(\"lead_events\")\n          .select(\"id, lead_id, event_type, payload, created_at\")\n          .in(\"event_type\", [\n            \"voice_completed\",\n            \"voice_failed\",\n            \"appointment_created\",\n          ])\n          .order(\"created_at\", { ascending: false })\n          .limit(200),\n        client\n          .from(\"appointments\")\n          .select(\"id, lead_id, scheduled_for, status\")\n          .in(\"lead_id\", leadIds),\n        client\n          .from(\"touch_runs\")\n          .select(\"id, lead_id, status, error, campaign_id\")\n          .in(\"lead_id\", leadIds),\n        client.from(\"campaigns\").select(\"id, name\").limit(500),\n      ])\n\n      if (!alive) return\n\n      if (leadsResult.error) {\n        console.error(leadsResult.error)\n        setError(\n          `Unable to fetch leads for voice calls. DB says: ${leadsResult.error.message}`,\n        )\n      }\n\n      if (eventsResult.error) console.error(eventsResult.error)\n      if (appointmentsResult.error) console.error(appointmentsResult.error)\n      if (touchRunsResult.error) console.error(touchRunsResult.error)\n      if (campaignsResult.error) console.error(campaignsResult.error)\n\n      const leadMap = (leadsResult.data ?? []).reduce(\n        (acc, lead) => {\n          acc[lead.id] = lead as Lead\n          return acc\n        },\n        {} as Record<string, Lead>,\n      )\n\n      const campaignMap = (campaignsResult.data ?? []).reduce(\n        (acc, c) => {\n          acc[c.id] = c as CampaignMeta\n          return acc\n        },\n        {} as Record<string, CampaignMeta>,\n      )\n\n      setLeads(leadMap)\n      setEvents((eventsResult.data ?? []) as LeadEvent[])\n      setAppointments((appointmentsResult.data ?? []) as Appointment[])\n      setTouchRuns((touchRunsResult.data ?? []) as TouchRun[])\n      setCampaigns(campaignMap)\n      setLoading(false)\n    }\n\n    void loadData()\n\n    return () => {\n      alive = false\n    }\n  }, [supabaseReady])\n\n  // ---------------------------------------------------------------------------\n  // Derived maps\n  // ---------------------------------------------------------------------------\n\n  const appointmentByLead = useMemo(() => {\n    const now = new Date()\n    return appointments.reduce(\n      (acc, appt) => {\n        if (appt.status === \"scheduled\" && new Date(appt.scheduled_for) >= now) {\n          acc[appt.lead_id] = appt\n        }\n        return acc\n      },\n      {} as Record<string, Appointment>,\n    )\n  }, [appointments])\n\n  const cadenceStoppedByLead = useMemo(() => {\n    const map: Record<string, boolean> = {}\n    touchRuns.forEach((run) => {\n      if (run.status === \"stopped\" && run.error === \"appointment_created\") {\n        map[run.lead_id] = true\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const campaignByLead = useMemo(() => {\n    const map: Record<string, string | null> = {}\n    touchRuns.forEach((run) => {\n      if (run.campaign_id && !map[run.lead_id]) {\n        map[run.lead_id] = run.campaign_id\n      }\n    })\n    return map\n  }, [touchRuns])\n\n  const callRows: VoiceCallRow[] = useMemo(() => {\n    return calls.map((call) => {\n      const voiceWebhook =\n        (call.meta as { voice_webhook?: { transcript?: string } } | null)\n          ?.voice_webhook ?? null\n      const transcript =\n        voiceWebhook?.transcript ??\n        ((call.meta as { transcript?: string } | null)?.transcript ?? \"\")\n\n      const relevantEvent = events.find(\n        (event) =>\n          event.lead_id === call.lead_id &&\n          event.event_type.startsWith(\"voice_\"),\n      )\n\n      const intentFromEvent =\n        (relevantEvent?.payload as { intent?: string } | null)?.intent\n      const intentFromMeta =\n        (call.meta as { intent?: string } | null)?.intent ?? \"unknown\"\n\n      const intent = (intentFromEvent ?? intentFromMeta ?? \"unknown\").toLowerCase()\n\n      const campaignId = campaignByLead[call.lead_id] ?? null\n      const campaignName =\n        campaignId && campaigns[campaignId]\n          ? campaigns[campaignId].name ?? \"Untitled\"\n          : null\n\n      return {\n        ...call,\n        transcript,\n        intent,\n        hasAppointment: Boolean(appointmentByLead[call.lead_id]),\n        cadenceStopped: Boolean(cadenceStoppedByLead[call.lead_id]),\n        campaign_id: campaignId,\n        campaign_name: campaignName,\n      }\n    })\n  }, [\n    appointmentByLead,\n    cadenceStoppedByLead,\n    campaignByLead,\n    campaigns,\n    calls,\n    events,\n  ])\n\n  const campaignOptions = useMemo(() => {\n    const ids = new Set<string>()\n    callRows.forEach((row) => {\n      if (row.campaign_id) ids.add(row.campaign_id)\n    })\n    return Array.from(ids)\n  }, [callRows])\n\n  const filtered: VoiceCallRow[] = useMemo(() => {\n    return callRows.filter((row) => {\n      if (intentFilter !== \"all\" && row.intent !== intentFilter) return false\n      if (appointmentFilter === \"yes\" && !row.hasAppointment) return false\n      if (appointmentFilter === \"no\" && row.hasAppointment) return false\n      if (cadenceFilter === \"stopped\" && !row.cadenceStopped) return false\n      if (cadenceFilter === \"active\" && row.cadenceStopped) return false\n      if (campaignFilter !== \"all\" && row.campaign_id !== campaignFilter)\n        return false\n\n      if (search) {\n        const lead = leads[row.lead_id]\n        const haystack = `${lead?.contact_name ?? \"\"} ${lead?.company ?? \"\"} ${\n          lead?.email ?? \"\"\n        } ${lead?.phone ?? \"\"}`.toLowerCase()\n        if (!haystack.includes(search.toLowerCase())) return false\n      }\n\n      return true\n    })\n  }, [\n    appointmentFilter,\n    campaignFilter,\n    callRows,\n    cadenceFilter,\n    intentFilter,\n    leads,\n    search,\n  ])\n\n  const activeCall = useMemo(\n    () => filtered.find((c) => c.id === activeCallId) ?? null,\n    [filtered, activeCallId],\n  )\n\n  const activeLead = activeCall ? leads[activeCall.lead_id] ?? null : null\n  const activeAppointment = activeCall\n    ? appointmentByLead[activeCall.lead_id] ?? null\n    : null\n\n  // ---------------------------------------------------------------------------\n  // High-level metrics\n  // ---------------------------------------------------------------------------\n\n  const metrics = useMemo(() => {\n    if (callRows.length === 0) {\n      return {\n        total: 0,\n        withAppointment: 0,\n        interested: 0,\n        failed: 0,\n        last7d: 0,\n      }\n    }\n\n    const now = Date.now()\n    const sevenDaysMs = 7 * 24 * 60 * 60 * 1000\n\n    let withAppointment = 0\n    let interested = 0\n    let failed = 0\n    let last7d = 0\n\n    callRows.forEach((row) => {\n      if (row.hasAppointment) withAppointment += 1\n      if (row.intent === \"appointment\") interested += 1\n      if (row.status && row.status.toLowerCase() === \"failed\") failed += 1\n\n      const updatedMs = new Date(row.updated_at).getTime()\n      if (!Number.isNaN(updatedMs) && now - updatedMs <= sevenDaysMs) {\n        last7d += 1\n      }\n    })\n\n    return {\n      total: callRows.length,\n      withAppointment,\n      interested,\n      failed,\n      last7d,\n    }\n  }, [callRows])\n\n  // ---------------------------------------------------------------------------\n  // Render\n  // ---------------------------------------------------------------------------\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3\">\n          <div>\n            <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n              Voice Â· Calls & intents\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Voice Insights\n            </h1>\n            <p className=\"text-sm text-white/60\">\n              Latest 100 calls with transcript previews, intent signals,\n              campaign and appointment status.\n            </p>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => {\n                setIntentFilter(\"all\")\n                setAppointmentFilter(\"all\")\n                setCadenceFilter(\"all\")\n                setCampaignFilter(\"all\")\n                setSearch(\"\")\n              }}\n              className=\"gap-2\"\n            >\n              <RefreshCcw size={16} />\n              Reset view\n            </Button>\n          </div>\n        </div>\n\n        {/* KPIs */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"grid gap-4 p-4 sm:grid-cols-5\">\n            <MetricTile\n              label=\"Total calls\"\n              value={metrics.total}\n              helper=\"Last 100 records\"\n            />\n            <MetricTile\n              label=\"Interested\"\n              value={metrics.interested}\n              helper=\"Intent = appointment\"\n            />\n            <MetricTile\n              label=\"With appointment\"\n              value={metrics.withAppointment}\n              helper=\"Upcoming scheduled\"\n            />\n            <MetricTile\n              label=\"Failed\"\n              value={metrics.failed}\n              helper=\"Status = failed\"\n            />\n            <MetricTile\n              label=\"Calls last 7 days\"\n              value={metrics.last7d}\n              helper=\"Based on updated_at\"\n            />\n          </CardContent>\n        </Card>\n\n        {/* Filters + search + status */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"space-y-4 pt-4\">\n            <div className=\"flex flex-wrap items-center gap-3\">\n              <div className=\"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-medium uppercase tracking-[0.14em] text-white/70\">\n                <Filter size={14} />\n                <span>Filters</span>\n              </div>\n\n              <Select\n                value={intentFilter}\n                onChange={(e) =>\n                  setIntentFilter(e.target.value as IntentFilter)\n                }\n                className=\"w-44\"\n              >\n                <option value=\"all\">All intents</option>\n                <option value=\"appointment\">Appointment</option>\n                <option value=\"unknown\">Unknown</option>\n              </Select>\n\n              <Select\n                value={appointmentFilter}\n                onChange={(e) =>\n                  setAppointmentFilter(e.target.value as AppointmentFilter)\n                }\n                className=\"w-48\"\n              >\n                <option value=\"all\">Appointment?</option>\n                <option value=\"yes\">Has upcoming</option>\n                <option value=\"no\">No appointment</option>\n              </Select>\n\n              <Select\n                value={cadenceFilter}\n                onChange={(e) =>\n                  setCadenceFilter(e.target.value as CadenceFilter)\n                }\n                className=\"w-40\"\n              >\n                <option value=\"all\">Cadence</option>\n                <option value=\"stopped\">Stopped</option>\n                <option value=\"active\">Active</option>\n              </Select>\n\n              <Select\n                value={campaignFilter}\n                onChange={(e) => setCampaignFilter(e.target.value)}\n                className=\"w-56\"\n              >\n                <option value=\"all\">All campaigns</option>\n                {campaignOptions.map((id) => (\n                  <option key={id} value={id}>\n                    {campaigns[id]?.name ?? id}\n                  </option>\n                ))}\n              </Select>\n\n              <Input\n                placeholder=\"Search lead / company / email / phone\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"w-72\"\n              />\n            </div>\n\n            {error ? (\n              <div className=\"rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100\">\n                {error}\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-3 text-xs text-white/50\">\n                <span className=\"rounded-full border border-white/10 bg-white/5 px-2 py-1\">\n                  {filtered.length} calls visible\n                </span>\n                <span className=\"rounded-full border border-white/5 bg-white/5/10 px-2 py-1\">\n                  Raw: {calls.length}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Table / list */}\n        <Card className=\"border-white/10 bg-black/40 backdrop-blur-sm\">\n          <CardContent className=\"pt-4\">\n            {!loading && filtered.length === 0 ? (\n              <div className=\"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-sm text-white/70\">\n                No calls match the selected filters.\n              </div>\n            ) : null}\n\n            {!loading && filtered.length > 0 ? (\n              <div className=\"overflow-auto rounded-2xl border border-white/10\">\n                <Table>\n                  <TableHead>\n                    <TableRow className=\"bg-white/5\">\n                      <TableHeaderCell>Lead</TableHeaderCell>\n                      <TableHeaderCell>Campaign</TableHeaderCell>\n                      <TableHeaderCell>Phone</TableHeaderCell>\n                      <TableHeaderCell>Status</TableHeaderCell>\n                      <TableHeaderCell>Transcript</TableHeaderCell>\n                      <TableHeaderCell>Intent</TableHeaderCell>\n                      <TableHeaderCell>Appointment</TableHeaderCell>\n                      <TableHeaderCell>Cadence</TableHeaderCell>\n                      <TableHeaderCell>Updated</TableHeaderCell>\n                    </TableRow>\n                  </TableHead>\n                  <TableBody>\n                    {filtered.map((row) => {\n                      const lead = leads[row.lead_id]\n                      const transcriptPreview = row.transcript\n\n                      const preview = transcriptPreview\n                        ? `${transcriptPreview.slice(0, 140)}${\n                            transcriptPreview.length > 140 ? \"â€¦\" : \"\"\n                          }`\n                        : \"â€”\"\n\n                      const updated = new Date(row.updated_at)\n                      const appointment = appointmentByLead[row.lead_id]\n\n                      const displayName =\n                        lead?.contact_name ||\n                        lead?.company ||\n                        lead?.phone ||\n                        lead?.email ||\n                        \"Unknown lead\"\n\n                      const campaignName = row.campaign_name ?? \"â€”\"\n\n                      return (\n                        <TableRow\n                          key={row.id}\n                          className=\"cursor-pointer border-t border-white/5 bg-black/40 transition hover:bg-white/5\"\n                          onClick={() => setActiveCallId(row.id)}\n                        >\n                          {/* Lead */}\n                          <TableCell>\n                            <div className=\"flex flex-col gap-1\">\n                              <a\n                                href={`/leads/${row.lead_id}`}\n                                className=\"font-semibold text-emerald-200 hover:text-emerald-100\"\n                                onClick={(e) => e.stopPropagation()}\n                              >\n                                {displayName}\n                              </a>\n                              <LeadStateBadge state={lead?.state} />\n                            </div>\n                          </TableCell>\n\n                          {/* Campaign */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {campaignName}\n                          </TableCell>\n\n                          {/* Phone */}\n                          <TableCell className=\"text-sm text-white/80\">\n                            {lead?.phone ?? row.to_phone ?? \"â€”\"}\n                          </TableCell>\n\n                          {/* Call status */}\n                          <TableCell>\n                            <Badge\n                              variant=\"outline\"\n                              className=\"border-white/15 bg-white/5 text-xs text-white/80 capitalize\"\n                            >\n                              {row.status ?? \"â€”\"}\n                            </Badge>\n                          </TableCell>\n\n                          {/* Transcript */}\n                          <TableCell className=\"max-w-md text-sm text-white/80\">\n                            {preview}\n                          </TableCell>\n\n                          {/* Intent */}\n                          <TableCell>\n                            <IntentBadge intent={row.intent} />\n                          </TableCell>\n\n                          {/* Appointment */}\n                          <TableCell>\n                            {row.hasAppointment ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"gap-2 border-emerald-400/50 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                <CalendarIcon />\n                                Upcoming\n                                <span className=\"text-[11px] text-white/60\">\n                                  {appointment\n                                    ? dateFormatter.format(\n                                        new Date(appointment.scheduled_for),\n                                      )\n                                    : null}\n                                </span>\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-white/15 bg-white/5 text-xs text-white/70\"\n                              >\n                                No appointment\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Cadence */}\n                          <TableCell>\n                            {row.cadenceStopped ? (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-amber-400/60 bg-amber-500/10 text-xs text-amber-100\"\n                              >\n                                Cadence stopped\n                              </Badge>\n                            ) : (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"border-emerald-400/60 bg-emerald-500/10 text-xs text-emerald-100\"\n                              >\n                                Active\n                              </Badge>\n                            )}\n                          </TableCell>\n\n                          {/* Updated */}\n                          <TableCell className=\"whitespace-nowrap text-sm text-white/70\">\n                            {dateFormatter.format(updated)}\n                          </TableCell>\n                        </TableRow>\n                      )\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            ) : null}\n\n            {loading ? (\n              <div className=\"flex items-center gap-2 py-8 text-sm text-white/60\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Loading voice callsâ€¦\n              </div>\n            ) : null}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Drawer */}\n      {activeCall && (\n        <div className=\"fixed inset-0 z-40 flex\">\n          <button\n            className=\"h-full flex-1 bg-black/60 backdrop-blur-sm\"\n            onClick={() => setActiveCallId(null)}\n            aria-label=\"Close call details\"\n          />\n          <div className=\"h-full w-full max-w-md border-l border-white/10 bg-[#020617] p-5 shadow-[0_0_60px_rgba(15,23,42,0.9)]\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Voice call\n                </p>\n                <h2 className=\"flex items-center gap-2 text-xl font-semibold text-white\">\n                  <PhoneCall className=\"h-4 w-4 text-emerald-300\" />\n                  {activeLead?.contact_name ??\n                    activeLead?.company ??\n                    activeLead?.phone ??\n                    activeLead?.email ??\n                    \"Unknown lead\"}\n                </h2>\n                {activeLead && (\n                  <p className=\"text-xs text-white/50\">\n                    {activeLead.email ?? \"no-email\"} Â·{\" \"}\n                    {activeLead.phone ?? \"no-phone\"}\n                  </p>\n                )}\n              </div>\n              <button\n                className=\"rounded-full border border-white/20 bg-white/10 p-1 text-white/70 hover:bg-white/20\"\n                onClick={() => setActiveCallId(null)}\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              {/* Top badges */}\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80\">\n                  {activeCall.provider ?? \"provider-unknown\"}\n                </Badge>\n                <Badge className=\"border-white/20 bg-white/10 text-xs text-white/80 capitalize\">\n                  {activeCall.status ?? \"status-unknown\"}\n                </Badge>\n                <IntentBadge intent={activeCall.intent} />\n                {activeCall.hasAppointment && (\n                  <Badge className=\"border-emerald-400/60 bg-emerald-500/15 text-xs text-emerald-100\">\n                    Appointment scheduled\n                  </Badge>\n                )}\n                {activeCall.cadenceStopped && (\n                  <Badge className=\"border-amber-400/60 bg-amber-500/15 text-xs text-amber-100\">\n                    Cadence stopped\n                  </Badge>\n                )}\n              </div>\n\n              {/* Meta */}\n              <Card className=\"border-white/10 bg-white/5\">\n                <CardContent className=\"space-y-1 p-4 text-xs text-white/70\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">To</span>\n                    <span>{activeCall.to_phone ?? \"â€”\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-white/50\">Updated</span>\n                    <span>\n                      {dateFormatter.format(new Date(activeCall.updated_at))}\n                    </span>\n                  </div>\n                  {activeAppointment && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-white/50\">Appointment</span>\n                      <span>\n                        {dateFormatter.format(\n                          new Date(activeAppointment.scheduled_for),\n                        )}\n                      </span>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Transcript */}\n              <div className=\"space-y-2 rounded-2xl border border-white/10 bg-slate-900/80 p-4\">\n                <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                  Transcript\n                </p>\n                {activeCall.transcript ? (\n                  <p className=\"max-h-64 overflow-y-auto whitespace-pre-wrap text-sm text-white/80\">\n                    {activeCall.transcript}\n                  </p>\n                ) : (\n                  <p className=\"text-xs text-white/60\">\n                    No transcript available for this call.\n                  </p>\n                )}\n              </div>\n\n              {/* Raw meta */}\n              {activeCall.meta && (\n                <div className=\"space-y-2 rounded-2xl border border-white/10 bg-black/60 p-4\">\n                  <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n                    Raw meta\n                  </p>\n                  <pre className=\"max-h-40 overflow-y-auto text-[11px] text-white/70\">\n                    {JSON.stringify(activeCall.meta, null, 2)}\n                  </pre>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n\nfunction CalendarIcon() {\n  return <Activity size={14} />\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <div className=\"space-y-1 rounded-2xl border border-white/10 bg-white/5 p-3\">\n      <p className=\"text-[11px] uppercase tracking-[0.16em] text-white/50\">\n        {label}\n      </p>\n      <p className=\"text-2xl font-semibold text-white\">{value}</p>\n      <p className=\"text-[11px] text-white/50\">{helper}</p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_b1f6fe82._.js.map:8:    {"offset": {"line": 381, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/components/leads/timeline-utils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport type TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  campaign_run_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  status: string | null\n  payload: any\n  scheduled_at: string | null\n  sent_at: string | null\n  created_at: string\n  error: string | null\n  meta: any\n}\n\nexport const touchRunSelect =\n  \"id, campaign_id, campaign_run_id, lead_id, step, channel, status, payload, scheduled_at, sent_at, created_at, error, meta\"\n\nexport const channelLabel: Record<string, string> = {\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n  voice: \"Voice\",\n}\n\nexport function getWhen(step: TouchRunRow) {\n  return step.sent_at ?? step.scheduled_at ?? step.created_at ?? null\n}\n\nexport function formatPreview(payload: any) {\n  if (!payload) return \"â€”\"\n  let preview: string\n\n  if (typeof payload === \"string\") {\n    preview = payload\n  } else if (typeof payload === \"object\") {\n    const maybeMessage = (payload as Record<string, unknown>).message\n    const maybeBody = (payload as Record<string, unknown>).body\n    const maybeSubject = (payload as Record<string, unknown>).subject\n    if (typeof maybeMessage === \"string\") preview = maybeMessage\n    else if (typeof maybeBody === \"string\") preview = maybeBody\n    else if (typeof maybeSubject === \"string\") preview = maybeSubject\n    else preview = JSON.stringify(payload)\n  } else {\n    preview = String(payload)\n  }\n\n  if (preview.length > 140) return `${preview.slice(0, 140)}â€¦`\n  return preview\n}\n\nexport function statusVariant(status: string | null) {\n  const normalized = status?.toLowerCase()\n  if (normalized === \"sent\") return \"success\" as const\n  if (normalized === \"scheduled\" || normalized === \"pending\") return \"warning\" as const\n  if (normalized === \"failed\" || normalized === \"error\") return \"destructive\" as const\n  return \"neutral\" as const\n}\n\nexport function formatDate(dateString: string | null, options?: Intl.DateTimeFormatOptions) {\n  if (!dateString) return null\n  const parsed = new Date(dateString)\n  if (Number.isNaN(parsed.getTime())) return null\n  return new Intl.DateTimeFormat(\"en-US\", options).format(parsed)\n}\n\nexport async function fetchLeadTouchRuns(\n  client: Pick<\n    import(\"@supabase/supabase-js\").SupabaseClient,\n    \"from\"\n  >,\n  leadId: string,\n) {\n  return client\n    .from(\"touch_runs\")\n    .select(touchRunSelect)\n    .eq(\"lead_id\", leadId)\n    .order(\"sent_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"scheduled_at\", { ascending: false, nullsLast: true } as any)\n    .order(\"created_at\", { ascending: false })\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;;;;;;;;;;AAkB9C,MAAM,iBACX;AAEK,MAAM,eAAuC;IAClD,UAAU;IACV,KAAK;IACL,OAAO;IACP,OAAO;AACT;AAEO,SAAS,QAAQ,IAAiB;IACvC,OAAO,KAAK,OAAO,IAAI,KAAK,YAAY,IAAI,KAAK,UAAU,IAAI;AACjE;AAEO,SAAS,cAAc,OAAY;IACxC,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI;IAEJ,IAAI,OAAO,YAAY,UAAU;QAC/B,UAAU;IACZ,OAAO,IAAI,OAAO,YAAY,UAAU;QACtC,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,MAAM,YAAY,AAAC,QAAoC,IAAI;QAC3D,MAAM,eAAe,AAAC,QAAoC,OAAO;QACjE,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAC3C,IAAI,OAAO,cAAc,UAAU,UAAU;aAC7C,IAAI,OAAO,iBAAiB,UAAU,UAAU;aAChD,UAAU,KAAK,SAAS,CAAC;IAChC,OAAO;QACL,UAAU,OAAO;IACnB;IAEA,IAAI,QAAQ,MAAM,GAAG,KAAK,OAAO,GAAG,QAAQ,KAAK,CAAC,GAAG,KAAK,CAAC,CAAC;IAC5D,OAAO;AACT;AAEO,SAAS,cAAc,MAAqB;IACjD,MAAM,aAAa,QAAQ;IAC3B,IAAI,eAAe,QAAQ,OAAO;IAClC,IAAI,eAAe,eAAe,eAAe,WAAW,OAAO;IACnE,IAAI,eAAe,YAAY,eAAe,SAAS,OAAO;IAC9D,OAAO;AACT;AAEO,SAAS,WAAW,UAAyB,EAAE,OAAoC;IACxF,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,SAAS,IAAI,KAAK;IACxB,IAAI,OAAO,KAAK,CAAC,OAAO,OAAO,KAAK,OAAO;IAC3C,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS,SAAS,MAAM,CAAC;AAC1D;AAEO,eAAe,mBACpB,MAGC,EACD,MAAc;IAEd,OAAO,OACJ,IAAI,CAAC,cACL,MAAM,CAAC,gBACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,WAAW;QAAE,WAAW;QAAO,WAAW;IAAK,GACrD,KAAK,CAAC,gBAAgB;QAAE,WAAW;QAAO,WAAW;IAAK,GAC1D,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;AAC5C"}},
./.next/dev/static/chunks/src_b1f6fe82._.js.map:9:    {"offset": {"line": 457, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/leads/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport Link from \"next/link\"\nimport { useParams } from \"next/navigation\"\nimport { ArrowLeft, Building2, Mail, MapPin, PhoneCall, User } from \"lucide-react\"\n\nimport { LeadActivityTimeline, type LeadTimelineEvent } from \"@/components/leads/LeadActivityTimeline\"\nimport { Badge, Button, Card, CardContent, CardHeader } from \"@/components/ui-custom\"\nimport { StatCard } from \"@/components/ui-custom/stat-card\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport type { LeadEnriched } from \"@/types/lead\"\nimport {\n  describeAppointmentOutcome,\n  describeReminder,\n  describeTouchRun,\n} from \"@/components/leads/lead-activity-labels\"\nimport { touchRunSelect, type TouchRunRow } from \"@/components/leads/timeline-utils\"\n\ntype LeadDetail = LeadEnriched & {\n  company_name?: string | null\n  notes?: string | null\n}\n\ntype AppointmentRow = {\n  id: string\n  lead_id: string | null\n  channel: string | null\n  status: string | null\n  outcome: string | null\n  notes: string | null\n  starts_at: string | null\n  scheduled_for: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  appointment_id: string | null\n  notify_at: string | null\n  status: string | null\n  payload: Record<string, any> | null\n  created_at?: string | null\n}\n\ntype LeadGenome = {\n  industry: string | null\n  sub_industry: string | null\n  pain_points: string[] | null\n  objections: string[] | null\n  emotional_state: Record<string, any> | null\n  urgency_score: number | null\n  budget_estimate: string | null\n  decision_authority_score: number | null\n  conversion_likelihood: number | null\n  recommended_channel: string | null\n  recommended_cadence: Record<string, any> | null\n  recommended_persona: string | null\n  ai_lead_score: number | null\n  status: string | null\n  created_at: string | null\n  updated_at: string | null\n}\n\ntype LeadDataResult = {\n  lead: LeadDetail | null\n  genome: LeadGenome | null\n  events: LeadTimelineEvent[]\n  stats: {\n    touches: number\n    appointments: number\n    reminders: number\n  }\n}\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null\n  const date = new Date(value)\n  if (Number.isNaN(date.getTime())) return null\n  return date.toLocaleString()\n}\n\nfunction deriveLeadTitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin nombre\"\n  return (\n    lead.full_name ||\n    (lead as any).contact_name ||\n    lead.email ||\n    lead.phone ||\n    \"Sin nombre\"\n  )\n}\n\nfunction deriveLeadSubtitle(lead: LeadDetail | null) {\n  if (!lead) return \"Sin contacto\"\n  const email = lead.email ?? \"Sin email\"\n  const phone = lead.phone ?? \"Sin telÃ©fono\"\n  return `${email} Â· ${phone}`\n}\n\nfunction appointmentTime(appt: AppointmentRow) {\n  return appt.starts_at ?? appt.scheduled_for ?? appt.created_at\n}\n\nfunction mapTouchRuns(touchRuns: TouchRunRow[]): LeadTimelineEvent[] {\n  return touchRuns.map((touch) => {\n    const occurredAt = touch.scheduled_at ?? touch.created_at\n    const { label, description } = describeTouchRun(touch)\n\n    return {\n      id: `touch-${touch.id}`,\n      occurredAt: occurredAt ?? new Date().toISOString(),\n      type: \"touch_run\" as const,\n      channel: touch.channel,\n      step: touch.step,\n      label,\n      description,\n      status: touch.status,\n      meta: touch.meta ?? undefined,\n    }\n  })\n}\n\nfunction mapAppointments(appointments: AppointmentRow[]): LeadTimelineEvent[] {\n  return appointments.map((appointment) => {\n    const when = appointmentTime(appointment) ?? new Date().toISOString()\n    const formatted = formatDateTime(when)\n    const description = formatted\n      ? `Scheduled for ${formatted}${\n          appointment.notes ? ` Â· ${appointment.notes}` : \"\"\n        }`\n      : appointment.notes ?? undefined\n\n    return {\n      id: `appointment-${appointment.id}`,\n      occurredAt: when,\n      type: \"appointment\" as const,\n      channel: appointment.channel,\n      step: null,\n      label: \"Appointment scheduled\",\n      description,\n      status: appointment.status,\n      meta: { appointmentId: appointment.id },\n    }\n  })\n}\n\nfunction mapAppointmentOutcomes(\n  appointments: AppointmentRow[],\n): LeadTimelineEvent[] {\n  return appointments\n    .filter((appointment) => Boolean(appointment.outcome))\n    .map((appointment) => {\n      const label = describeAppointmentOutcome(appointment.outcome)\n      const when =\n        appointment.updated_at ??\n        appointmentTime(appointment) ??\n        new Date().toISOString()\n      const apptTime = appointmentTime(appointment)\n      const formatted = formatDateTime(apptTime)\n\n      const description = formatted\n        ? `Outcome for appointment on ${formatted}`\n        : \"Appointment outcome updated\"\n\n      return {\n        id: `appointment-outcome-${appointment.id}`,\n        occurredAt: when,\n        type: \"appointment_outcome\" as const,\n        channel: appointment.channel,\n        step: null,\n        label,\n        description,\n        status: appointment.outcome,\n        meta: { appointmentId: appointment.id },\n      }\n    })\n}\n\nfunction mapAppointmentReminders(\n  reminders: AppointmentNotificationRow[],\n  appointmentById: Map<string, AppointmentRow>,\n  leadId: string,\n): LeadTimelineEvent[] {\n  return reminders\n    .filter((reminder) => {\n      const payloadLeadId =\n        (reminder.payload?.lead_id as string | undefined) ?? null\n      const appointmentLeadId = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)?.lead_id ?? null\n        : null\n      return payloadLeadId === leadId || appointmentLeadId === leadId\n    })\n    .map((reminder) => {\n      const appointment = reminder.appointment_id\n        ? appointmentById.get(reminder.appointment_id)\n        : undefined\n      const when =\n        reminder.notify_at ??\n        appointmentTime(\n          appointment ?? ({} as AppointmentRow),\n        ) ??\n        new Date().toISOString()\n      const kind = (reminder.payload?.kind as string | undefined) ?? null\n      const reminderLabel = describeReminder(kind) ?? \"Appointment reminder\"\n      const appointmentDate = appointmentTime(\n        appointment ?? ({} as AppointmentRow),\n      )\n      const formatted = formatDateTime(appointmentDate)\n\n      return {\n        id: `appointment-reminder-${reminder.id}`,\n        occurredAt: when,\n        type: \"appointment_reminder\" as const,\n        channel: appointment?.channel ?? null,\n        step: null,\n        label: reminderLabel,\n        description: formatted\n          ? `Reminder for appointment on ${formatted}`\n          : undefined,\n        status: reminder.status,\n        meta: { appointmentId: reminder.appointment_id, kind },\n      }\n    })\n}\n\nasync function loadLeadDataBrowser(leadId: string): Promise<LeadDataResult> {\n  const client = supabaseBrowser()\n\n  // 1) Vista rica: lead_enriched\n  const { data: enrichedRow, error: enrichedError } = await client\n    .from(\"lead_enriched\")\n    .select(\n      \"id, full_name, email, phone, state, last_touch_at, channel_last, campaign_id, campaign_name, company_name, enriched\",\n    )\n    .eq(\"id\", leadId)\n    .maybeSingle()\n\n  let lead: LeadDetail | null = null\n\n  if (enrichedRow) {\n    lead = {\n      ...(enrichedRow as any),\n      company_name:\n        (enrichedRow as any).company_name ??\n        (enrichedRow as any).company ??\n        null,\n    }\n  } else {\n    // 2) Fallback: tabla leads (import original)\n    const { data: baseRow } = await client\n      .from(\"leads\")\n      .select(\n        \"id, contact_name, email, phone, state, last_touched_at, last_channel, campaign_id, campaign_name, company_name, enriched\",\n      )\n      .eq(\"id\", leadId)\n      .maybeSingle()\n\n    if (baseRow) {\n      lead = {\n        id: baseRow.id,\n        full_name: (baseRow as any).contact_name ?? null,\n        email: baseRow.email ?? null,\n        phone: baseRow.phone ?? null,\n        state: baseRow.state ?? null,\n        last_touch_at: (baseRow as any).last_touched_at ?? null,\n        campaign_id: (baseRow as any).campaign_id ?? null,\n        campaign_name: (baseRow as any).campaign_name ?? null,\n        channel_last: (baseRow as any).last_channel ?? null,\n        company_name: (baseRow as any).company_name ?? null,\n        enriched: (baseRow as any).enriched ?? null,\n      } as any\n    }\n\n    if (!baseRow && enrichedError) {\n      console.warn(\"lead_enriched error:\", enrichedError)\n    }\n  }\n\n  // Si aÃºn no tenemos lead, devolvemos dummy pero con ID\n  if (!lead) {\n    lead = {\n      id: leadId,\n      full_name: null,\n      email: null,\n      phone: null,\n      state: \"unknown\",\n      last_touch_at: null,\n      campaign_id: null,\n      campaign_name: null,\n      channel_last: null,\n      company_name: null,\n      notes: null,\n      enriched: null,\n    } as any\n  }\n\n  // 3) Lead Genome: Ãºltimo enrichment_v2 completado\n  let genome: LeadGenome | null = null\n\n  const { data: enrichmentRow, error: enrichmentError } = await client\n    .from(\"lead_enrichments_v2\")\n    .select(\n      `\n      industry,\n      sub_industry,\n      pain_points,\n      objections,\n      emotional_state,\n      urgency_score,\n      budget_estimate,\n      decision_authority_score,\n      conversion_likelihood,\n      recommended_channel,\n      recommended_cadence,\n      recommended_persona,\n      ai_lead_score,\n      status,\n      created_at,\n      updated_at\n    `,\n    )\n    .eq(\"lead_id\", leadId)\n    .order(\"created_at\", { ascending: false })\n    .limit(1)\n    .maybeSingle()\n\n  if (enrichmentError) {\n    console.warn(\"lead_enrichments_v2 error:\", enrichmentError)\n  }\n\n  if (enrichmentRow) {\n    genome = {\n      industry: enrichmentRow.industry ?? null,\n      sub_industry: enrichmentRow.sub_industry ?? null,\n      pain_points: (enrichmentRow.pain_points as string[] | null) ?? null,\n      objections: (enrichmentRow.objections as string[] | null) ?? null,\n      emotional_state:\n        (enrichmentRow.emotional_state as Record<string, any> | null) ?? null,\n      urgency_score:\n        typeof enrichmentRow.urgency_score === \"number\"\n          ? enrichmentRow.urgency_score\n          : enrichmentRow.urgency_score != null\n          ? Number(enrichmentRow.urgency_score)\n          : null,\n      budget_estimate: enrichmentRow.budget_estimate ?? null,\n      decision_authority_score:\n        typeof enrichmentRow.decision_authority_score === \"number\"\n          ? enrichmentRow.decision_authority_score\n          : enrichmentRow.decision_authority_score != null\n          ? Number(enrichmentRow.decision_authority_score)\n          : null,\n      conversion_likelihood:\n        typeof enrichmentRow.conversion_likelihood === \"number\"\n          ? enrichmentRow.conversion_likelihood\n          : enrichmentRow.conversion_likelihood != null\n          ? Number(enrichmentRow.conversion_likelihood)\n          : null,\n      recommended_channel: enrichmentRow.recommended_channel ?? null,\n      recommended_cadence:\n        (enrichmentRow.recommended_cadence as Record<string, any> | null) ??\n        null,\n      recommended_persona: enrichmentRow.recommended_persona ?? null,\n      ai_lead_score:\n        typeof enrichmentRow.ai_lead_score === \"number\"\n          ? enrichmentRow.ai_lead_score\n          : enrichmentRow.ai_lead_score != null\n          ? Number(enrichmentRow.ai_lead_score)\n          : null,\n      status: enrichmentRow.status ?? null,\n      created_at: enrichmentRow.created_at ?? null,\n      updated_at: enrichmentRow.updated_at ?? null,\n    }\n  }\n\n  // 4) Timeline y stats\n  const [touchRunsResult, appointmentsResult, remindersResult] =\n    await Promise.all([\n      client\n        .from(\"touch_runs\")\n        .select(touchRunSelect)\n        .eq(\"lead_id\", leadId)\n        .order(\"scheduled_at\", {\n          ascending: false,\n          nullsLast: true,\n        } as any)\n        .order(\"created_at\", { ascending: false }),\n      client\n        .from(\"appointments\")\n        .select(\n          \"id, lead_id, channel, status, outcome, notes, starts_at, scheduled_for, created_at, updated_at\",\n        )\n        .eq(\"lead_id\", leadId),\n      client\n        .from(\"appointments_notifications\")\n        .select(\n          \"id, appointment_id, notify_at, status, payload, created_at\",\n        ),\n    ])\n\n  const touchRuns = (touchRunsResult.data ?? []) as TouchRunRow[]\n  const appointments = (appointmentsResult.data ?? []) as AppointmentRow[]\n  const reminders =\n    (remindersResult.data ?? []) as AppointmentNotificationRow[]\n\n  const appointmentById = new Map<string, AppointmentRow>()\n  appointments.forEach((row) => appointmentById.set(row.id, row))\n\n  const events: LeadTimelineEvent[] = [\n    ...mapTouchRuns(touchRuns),\n    ...mapAppointments(appointments),\n    ...mapAppointmentOutcomes(appointments),\n    ...mapAppointmentReminders(reminders, appointmentById, leadId),\n  ].sort((a, b) => {\n    const aTime = new Date(a.occurredAt).getTime()\n    const bTime = new Date(b.occurredAt).getTime()\n    const safeA = Number.isNaN(aTime) ? 0 : aTime\n    const safeB = Number.isNaN(bTime) ? 0 : bTime\n    return safeB - safeA\n  })\n\n  return {\n    lead,\n    genome,\n    events,\n    stats: {\n      touches: touchRuns.length,\n      appointments: appointments.length,\n      reminders: reminders.length,\n    },\n  }\n}\n\nexport default function LeadDetailPage() {\n  const params = useParams<{ id: string }>()\n  const leadId = params.id\n\n  const supabaseReady = useMemo(\n    () =>\n      Boolean(\n        process.env.NEXT_PUBLIC_SUPABASE_URL &&\n          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n      ),\n    [],\n  )\n\n  const [lead, setLead] = useState<LeadDetail | null>(null)\n  const [genome, setGenome] = useState<LeadGenome | null>(null)\n  const [events, setEvents] = useState<LeadTimelineEvent[]>([])\n  const [stats, setStats] = useState({\n    touches: 0,\n    appointments: 0,\n    reminders: 0,\n  })\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (!supabaseReady || !leadId) return\n\n    let alive = true\n\n    ;(async () => {\n      setLoading(true)\n      const result = await loadLeadDataBrowser(leadId)\n      if (!alive) return\n      setLead(result.lead)\n      setGenome(result.genome)\n      setEvents(result.events)\n      setStats(result.stats)\n      setLoading(false)\n    })()\n\n    return () => {\n      alive = false\n    }\n  }, [leadId, supabaseReady])\n\n  const title = deriveLeadTitle(lead)\n  const subtitle = deriveLeadSubtitle(lead)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/leads\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft size={16} />\n              Back\n            </Button>\n          </Link>\n          <div>\n            <p className=\"text-sm uppercase tracking-[0.16em] text-white/50\">\n              Lead\n            </p>\n            <h1 className=\"text-3xl font-semibold text-white\">\n              Lead timeline\n            </h1>\n            <p className=\"text-sm text-white/80\">{title}</p>\n            <p className=\"text-xs text-white/60\">\n              {subtitle} Â· ID: {leadId}\n            </p>\n          </div>\n        </div>\n        {lead?.state ? (\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {lead.state}\n          </Badge>\n        ) : null}\n      </div>\n\n      {/* Overview */}\n      <Card>\n        <CardHeader\n          title=\"Lead overview\"\n          description=\"Basic details and last touch information\"\n        />\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex items-center gap-2 text-white\">\n              <User size={16} className=\"text-white/60\" />\n              <span className=\"font-semibold\">{title}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Mail size={14} className=\"text-white/50\" />\n              <span>{lead?.email ?? \"Sin email\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <PhoneCall size={14} className=\"text-white/50\" />\n              <span>{lead?.phone ?? \"Sin telÃ©fono\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <Building2 size={14} className=\"text-white/50\" />\n              <span>{lead?.company_name ?? \"Sin compaÃ±Ã­a\"}</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-white/80\">\n              <MapPin size={14} className=\"text-white/50\" />\n              <span>{lead?.channel_last ?? \"Sin canal\"}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-white/80\">\n            <p className=\"text-sm text-white/60\">Last touch</p>\n            <p className=\"text-lg font-semibold text-white\">\n              {formatDateTime(lead?.last_touch_at ?? null) ??\n                \"No touches yet\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Channel: {lead?.channel_last ?? \"â€”\"}\n            </p>\n            <p className=\"text-sm text-white/60\">\n              Campaign:{\" \"}\n              {lead?.campaign_name ?? lead?.campaign_id ?? \"â€”\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Lead Genome V2 */}\n      {genome && (\n        <Card>\n          <CardHeader\n            title=\"Lead Genome\"\n            description=\"Industry, pains, objections and AI recommendations for this lead\"\n          />\n          <CardContent className=\"grid gap-4 md:grid-cols-2 text-sm text-white/80\">\n            <div className=\"space-y-2\">\n              <p>\n                <span className=\"text-white/50\">Industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.industry ?? \"Unknown\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Sub-industry:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.sub_industry ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">\n                  Recommended channel:\n                </span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_channel ?? \"â€”\"}\n                </span>\n              </p>\n              <p>\n                <span className=\"text-white/50\">Persona:</span>{\" \"}\n                <span className=\"text-white\">\n                  {genome.recommended_persona ?? \"â€”\"}\n                </span>\n              </p>\n              {typeof genome.ai_lead_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">AI Lead score:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.ai_lead_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.urgency_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">Urgency:</span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.urgency_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.decision_authority_score === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Decision authority:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.decision_authority_score}\n                  </span>\n                </p>\n              )}\n              {typeof genome.conversion_likelihood === \"number\" && (\n                <p>\n                  <span className=\"text-white/50\">\n                    Conversion likelihood:\n                  </span>{\" \"}\n                  <span className=\"text-white\">\n                    {genome.conversion_likelihood}\n                  </span>\n                </p>\n              )}\n            </div>\n            <div className=\"space-y-3\">\n              {Array.isArray(genome.pain_points) &&\n                genome.pain_points.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Pain points\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.pain_points.map((p, idx) => (\n                        <li key={idx}>{p}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              {Array.isArray(genome.objections) &&\n                genome.objections.length > 0 && (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs uppercase tracking-[0.16em] text-white/40\">\n                      Objections\n                    </p>\n                    <ul className=\"space-y-1 list-disc pl-4 text-xs text-white/80\">\n                      {genome.objections.map((o, idx) => (\n                        <li key={idx}>{o}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Stats */}\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Total activity\"\n          value={events.length.toString()}\n          helper=\"Touches, appointments and reminders\"\n        />\n        <StatCard\n          label=\"Touch runs\"\n          value={stats.touches.toString()}\n          helper=\"touch_runs registrados\"\n        />\n        <StatCard\n          label=\"Appointments\"\n          value={stats.appointments.toString()}\n          helper=\"Incluye outcomes y reminders\"\n        />\n      </div>\n\n      {/* Timeline */}\n      <LeadActivityTimeline events={events} />\n\n      {loading ? (\n        <div className=\"space-y-3\">\n          <div className=\"h-10 animate-pulse rounded-xl bg-white/5\" />\n          <div className=\"h-52 animate-pulse rounded-2xl bg-white/5\" />\n          <div className=\"h-32 animate-pulse rounded-2xl bg-white/5\" />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_a616accd._.js.map:6:    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/operator/page.tsx"],"sourcesContent":["// src/app/operator/page.tsx\n\"use client\"\n\nimport React from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n} from \"@/components/ui-custom\"\nimport { Mail, MessageCircle, PhoneCall, Waves, Activity } from \"lucide-react\"\n\nexport const revalidate = 0\n\n// --------- Tipos base ---------\n\ntype TouchRunRow = {\n  id: string\n  campaign_id: string | null\n  lead_id: string | null\n  step: number | null\n  channel: string | null\n  scheduled_at: string | null\n  sent_at: string | null\n  status: string | null\n  error: string | null\n  created_at: string | null\n  type: string | null\n  intent: string | null\n  outcome: string | null\n  retry_count: number | null\n  max_retries: number | null\n  message_class: string | null\n}\n\ntype AppointmentNotificationRow = {\n  id: string\n  org_id: string | null\n  appointment_id: string | null\n  channel: string | null\n  notify_at: string | null\n  status: string | null\n  created_at: string | null\n  sent_at: string | null\n  error: string | null\n}\n\ntype ActivityToday = {\n  touchesTotalToday: number\n  touchesSentToday: number\n  touchesFailedToday: number\n  touchesQueuedToday: number\n  appointmentNotificationsToday: number\n}\n\n// --------- Helpers de fecha ---------\n\nfunction getTodayRangeUTC() {\n  const start = new Date()\n  start.setUTCHours(0, 0, 0, 0)\n  const end = new Date()\n  end.setUTCHours(24, 0, 0, 0)\n  return { start: start.toISOString(), end: end.toISOString() }\n}\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"en-US\", {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\",\n})\n\n// --------- Loaders (server-side) ---------\n\nasync function loadLiveQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"scheduled\"])\n    .order(\"scheduled_at\", { ascending: true })\n    .limit(50)\n\n  if (error) {\n    console.error(\"loadLiveQueue error\", error)\n    return []\n  }\n\n  return (data as TouchRunRow[] | null) ?? []\n}\n\nasync function loadRecentErrors(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<TouchRunRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"touch_runs\")\n    .select(\n      [\n        \"id\",\n        \"campaign_id\",\n        \"lead_id\",\n        \"step\",\n        \"channel\",\n        \"scheduled_at\",\n        \"sent_at\",\n        \"status\",\n        \"error\",\n        \"created_at\",\n        \"type\",\n        \"intent\",\n        \"outcome\",\n        \"retry_count\",\n        \"max_retries\",\n        \"message_class\",\n      ].join(\", \"),\n    )\n    .eq(\"status\", \"failed\")\n    .gte(\"created_at\", start)\n    .lt(\"created_at\", end)\n    .order(\"created_at\", { ascending: false })\n    .limit(30)\n\n  if (error) {\n    console.error(\"loadRecentErrors error\", error)\n    return []\n  }\n\n  return (data as TouchRunRow[] | null) ?? []\n}\n\nasync function loadActivityToday(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<ActivityToday> {\n  const fallback: ActivityToday = {\n    touchesTotalToday: 0,\n    touchesSentToday: 0,\n    touchesFailedToday: 0,\n    touchesQueuedToday: 0,\n    appointmentNotificationsToday: 0,\n  }\n\n  if (!client) return fallback\n\n  const { start, end } = getTodayRangeUTC()\n\n  const [\n    totalTouches,\n    sentTouches,\n    failedTouches,\n    queuedTouches,\n    apptNotifs,\n  ] = await Promise.all([\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"sent\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .eq(\"status\", \"failed\")\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"touch_runs\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .in(\"status\", [\"queued\", \"scheduled\"])\n      .gte(\"created_at\", start)\n      .lt(\"created_at\", end),\n    client\n      .from(\"appointments_notifications\")\n      .select(\"id\", { count: \"exact\", head: true })\n      .gte(\"notify_at\", start)\n      .lt(\"notify_at\", end),\n  ])\n\n  return {\n    touchesTotalToday: totalTouches.count ?? 0,\n    touchesSentToday: sentTouches.count ?? 0,\n    touchesFailedToday: failedTouches.count ?? 0,\n    touchesQueuedToday: queuedTouches.count ?? 0,\n    appointmentNotificationsToday: apptNotifs.count ?? 0,\n  }\n}\n\nasync function loadAppointmentsNotificationsQueue(\n  client: ReturnType<typeof supabaseServer>,\n): Promise<AppointmentNotificationRow[]> {\n  if (!client) return []\n\n  const { start, end } = getTodayRangeUTC()\n\n  const { data, error } = await client\n    .from(\"appointments_notifications\")\n    .select(\n      [\n        \"id\",\n        \"org_id\",\n        \"appointment_id\",\n        \"channel\",\n        \"notify_at\",\n        \"status\",\n        \"created_at\",\n        \"sent_at\",\n        \"error\",\n      ].join(\", \"),\n    )\n    .in(\"status\", [\"queued\", \"pending\"])\n    .gte(\"notify_at\", start)\n    .lt(\"notify_at\", end)\n    .order(\"notify_at\", { ascending: true })\n    .limit(30)\n\n  if (error) {\n    console.error(\"loadAppointmentsNotificationsQueue error\", error)\n    return []\n  }\n\n  return (data as AppointmentNotificationRow[] | null) ?? []\n}\n\n// --------- Helpers UI ---------\n\nfunction channelIcon(channel: string | null) {\n  const c = (channel ?? \"\").toLowerCase()\n  if (c === \"email\") return <Mail className=\"h-4 w-4\" />\n  if (c === \"whatsapp\") return <MessageCircle className=\"h-4 w-4\" />\n  if (c === \"sms\") return <Waves className=\"h-4 w-4\" />\n  if (c === \"voice\" || c === \"phone\") return <PhoneCall className=\"h-4 w-4\" />\n  if (c === \"zoom\") return <Activity className=\"h-4 w-4\" />\n  return <Activity className=\"h-4 w-4\" />\n}\n\nfunction formatDate(value: string | null) {\n  if (!value) return \"â€”\"\n  const d = new Date(value)\n  if (Number.isNaN(d.getTime())) return \"â€”\"\n  return dateTimeFormatter.format(d)\n}\n\nfunction statusBadge(status: string | null) {\n  const s = (status ?? \"\").toLowerCase()\n  let className =\n    \"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px]\"\n\n  if (s === \"sent\") {\n    className += \" border-emerald-400/60 bg-emerald-500/10 text-emerald-100\"\n  } else if (s === \"failed\") {\n    className += \" border-rose-400/60 bg-rose-500/10 text-rose-100\"\n  } else if (s === \"queued\" || s === \"scheduled\") {\n    className += \" border-amber-400/60 bg-amber-500/10 text-amber-100\"\n  } else {\n    className += \" border-white/20 bg-white/5 text-white/70\"\n  }\n\n  return <span className={className}>{status ?? \"unknown\"}</span>\n}\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <Card className=\"bg-white/5 border-white/10\">\n      <CardContent className=\"space-y-1 p-4\">\n        <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n          {label}\n        </p>\n        <p className=\"text-2xl font-semibold text-white\">{value}</p>\n        <p className=\"text-xs text-white/50\">{helper}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- Secciones UI ---------\n\nfunction LiveQueueSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Live queue\"\n        description=\"Touches en cola listos para salir.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay touches en cola ahora mismo.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Step</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell>Retries</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Scheduled at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                const campaignLabel =\n                  row.campaign_id?.slice(0, 8).toUpperCase() ?? \"â€”\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell>\n                      <div className=\"flex flex-col gap-0.5\">\n                        {row.lead_id ? (\n                          <Link\n                            href={`/leads/${row.lead_id}`}\n                            className=\"text-sm font-semibold text-white hover:underline\"\n                          >\n                            {leadLabel}\n                          </Link>\n                        ) : (\n                          <span className=\"text-sm font-semibold text-white\">\n                            {leadLabel}\n                          </span>\n                        )}\n                        <p className=\"text-[11px] text-white/50\">\n                          Campaign: {campaignLabel}\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.step ?? \"â€”\"}\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-sm text-white/80\">\n                      {row.retry_count ?? 0} / {row.max_retries ?? 3}\n                    </TableCell>\n                    <TableCell className=\"text-right text-sm text-white/70\">\n                      {formatDate(row.scheduled_at)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction RecentErrorsSection({ rows }: { rows: TouchRunRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Recent errors\"\n        description=\"Fallos de entrega hoy por canal.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">Sin errores hoy. ðŸ™Œ</p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>When</TableHeaderCell>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Error</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Status\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const leadLabel =\n                  row.lead_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"text-sm text-white/70\">\n                      {formatDate(row.created_at)}\n                    </TableCell>\n                    <TableCell>\n                      {row.lead_id ? (\n                        <Link\n                          href={`/leads/${row.lead_id}`}\n                          className=\"text-sm font-semibold text-white hover:underline\"\n                        >\n                          {leadLabel}\n                        </Link>\n                      ) : (\n                        <span className=\"text-sm font-semibold text-white\">\n                          {leadLabel}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"max-w-md text-sm text-rose-200\">\n                      {row.error ?? \"unknown error\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {statusBadge(row.status)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction AppointmentNotificationsSection({\n  rows,\n}: {\n  rows: AppointmentNotificationRow[]\n}) {\n  return (\n    <Card className=\"border-white/10 bg-white/5\">\n      <CardHeader\n        title=\"Appointment notifications\"\n        description=\"Recordatorios de citas en cola para hoy.\"\n      />\n      <CardContent className=\"p-0\">\n        {rows.length === 0 ? (\n          <p className=\"p-4 text-sm text-white/60\">\n            No hay notificaciones de citas en cola para hoy.\n          </p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Appointment</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Status</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">\n                  Notify at\n                </TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {rows.map((row) => {\n                const apptLabel =\n                  row.appointment_id?.slice(0, 8).toUpperCase() ?? \"UNKNOWN\"\n                return (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"text-sm text-white\">\n                      {apptLabel}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-sm text-white/80\">\n                        {channelIcon(row.channel)}\n                        <span className=\"capitalize\">\n                          {row.channel ?? \"â€”\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>{statusBadge(row.status)}</TableCell>\n                    <TableCell className=\"text-right text-sm text-white/70\">\n                      {formatDate(row.notify_at)}\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// --------- PÃ¡gina principal ---------\n\nexport default async function OperatorPage() {\n  const supabase = supabaseServer()\n\n  const [liveQueue, recentErrors, activityToday, apptNotifications] =\n    await Promise.all([\n      loadLiveQueue(supabase),\n      loadRecentErrors(supabase),\n      loadActivityToday(supabase),\n      loadAppointmentsNotificationsQueue(supabase),\n    ])\n\n  const totalQueued = liveQueue.length\n  const hasErrorsToday = recentErrors.length > 0\n\n  const engineLabel = hasErrorsToday\n    ? \"Execution engine con errores hoy\"\n    : totalQueued > 0\n    ? `Execution engine activo Â· ${totalQueued} en cola`\n    : \"Execution engine idle pero sano\"\n\n  const engineVariant: \"neutral\" | \"warning\" | \"destructive\" = hasErrorsToday\n    ? \"destructive\"\n    : totalQueued > 0\n    ? \"neutral\"\n    : \"warning\"\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Operations\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">\n            Operator Cockpit\n          </h1>\n          <p className=\"text-sm text-white/60\">\n            Vista en tiempo casi real del motor de ejecuciÃ³n: touches,\n            errores y recordatorios de citas.\n          </p>\n        </div>\n        <Badge\n          variant={engineVariant}\n          className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80\"\n        >\n          <span\n            className={`inline-block h-2 w-2 rounded-full ${\n              engineVariant === \"destructive\"\n                ? \"bg-rose-400\"\n                : engineVariant === \"warning\"\n                ? \"bg-amber-400\"\n                : \"bg-emerald-400\"\n            }`}\n          />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* Tiles actividad hoy */}\n      <div className=\"grid gap-3 md:grid-cols-5\">\n        <MetricTile\n          label=\"Touches hoy\"\n          value={activityToday.touchesTotalToday}\n          helper=\"Todos los canales\"\n        />\n        <MetricTile\n          label=\"Sent\"\n          value={activityToday.touchesSentToday}\n          helper=\"Entregados hoy\"\n        />\n        <MetricTile\n          label=\"Failed\"\n          value={activityToday.touchesFailedToday}\n          helper=\"Con error hoy\"\n        />\n        <MetricTile\n          label=\"Queued\"\n          value={activityToday.touchesQueuedToday}\n          helper=\"Creados hoy\"\n        />\n        <MetricTile\n          label=\"Cita â€“ notifs\"\n          value={activityToday.appointmentNotificationsToday}\n          helper=\"Recordatorios hoy\"\n        />\n      </div>\n\n      {/* Live queue + errores */}\n      <div className=\"grid gap-6 xl:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]\">\n        <LiveQueueSection rows={liveQueue} />\n        <RecentErrorsSection rows={recentErrors} />\n      </div>\n\n      {/* Notifs de citas */}\n      <AppointmentNotificationsSection rows={apptNotifications} />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_8e64baea._.js:276:                supabase.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_129a2d82._.js.map:7:    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/director/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useMemo, useState } from \"react\"\nimport Link from \"next/link\"\nimport { supabaseServer } from \"@/lib/supabase-server\"\nimport { getSystemSnapshot } from \"@/lib/director/system-snapshot\"\n\nimport {\n  Badge,\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n  Button,\n} from \"@/components/ui-custom\"\n\nimport {\n  Flame,\n  Sparkles,\n  Timer,\n  Clock4,\n  PhoneCall,\n  Mail,\n  MessageSquare,\n  Zap,\n  AlertTriangle,\n  RefreshCcw,\n} from \"lucide-react\"\n\nexport const revalidate = 0\n\n// ======================================================\n// TYPES\n// ======================================================\n\ntype NextActionRow = {\n  lead_id: string\n  email: string | null\n  phone: string | null\n  lead_state: string | null\n  lead_brain_bucket: string | null\n  recommended_channel: string | null\n  recommended_action: string | null\n  recommended_delay_minutes: number | null\n  priority_score: number | null\n  reason: string | null\n}\n\ntype EngineStatus = {\n  name: string\n  schedule: string | null\n  lastRun: string | null\n  status: \"OK\" | \"Error\" | \"No data\"\n}\n\ntype AppointmentMetrics = {\n  appointmentsToday: number\n  remindersToday: number\n  reminderTouchRunsToday: number\n}\n\ntype LeadMetrics = {\n  newLeadsToday: number\n  leadsWithAppointments: number\n  showsToday: number\n  noShowsToday: number\n}\n\ntype CampaignEngineRow = {\n  campaign_id: string\n  campaign_name: string | null\n  total_touches: number\n  leads_touched: number\n  engaged_leads: number\n  reply_rate: number\n  error_rate: number\n  leads_attempting: number\n  leads_engaged: number\n  leads_booked: number\n  leads_booked_show: number\n  leads_booked_no_show: number\n  first_touch_at: string | null\n  last_touch_at: string | null\n}\n\ntype DirectorAlertRow = {\n  id: string\n  created_at: string\n  actor: string | null\n  event_type: string | null\n  importance: number | null\n  payload: Record<string, any> | null\n}\n\n// ======================================================\n// HELPERS UI\n// ======================================================\n\nfunction ChannelIcon({ channel }: { channel: string | null }) {\n  if (!channel) return <Zap className=\"text-white/40\" size={16} />\n\n  switch (channel) {\n    case \"email\":\n      return <Mail size={16} className=\"text-emerald-300\" />\n    case \"voice\":\n      return <PhoneCall size={16} className=\"text-amber-300\" />\n    case \"whatsapp\":\n      return <MessageSquare size={16} className=\"text-green-400\" />\n    case \"sms\":\n      return <MessageSquare size={16} className=\"text-blue-400\" />\n    default:\n      return <Zap size={16} className=\"text-white/40\" />\n  }\n}\n\nfunction BrainBucketBadge({ bucket }: { bucket: string | null }) {\n  if (!bucket) return <Badge className=\"bg-white/10 text-white/60\">unknown</Badge>\n\n  const variants: Record<string, string> = {\n    hot: \"bg-rose-600/30 text-rose-200 border border-rose-500/40\",\n    warm: \"bg-amber-500/20 text-amber-200 border border-amber-400/40\",\n    cold: \"bg-blue-500/20 text-blue-200 border border-blue-400/40\",\n  }\n\n  return (\n    <Badge className={`px-2 py-0.5 text-xs ${variants[bucket] ?? \"\"}`}>\n      {bucket}\n    </Badge>\n  )\n}\n\nfunction ActionBadge({ action }: { action: string | null }) {\n  if (!action) return null\n\n  const colors: Record<string, string> = {\n    send: \"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30\",\n    cooldown: \"bg-amber-500/20 text-amber-200 border border-amber-400/30\",\n    stop: \"bg-white/10 text-white/60 border border-white/20\",\n    review: \"bg-rose-600/20 text-rose-200 border border-rose-500/40\",\n  }\n\n  return (\n    <Badge className={`px-2 py-0.5 text-xs ${colors[action] ?? \"\"}`}>\n      {action}\n    </Badge>\n  )\n}\n\nfunction UrgencyBar({ score }: { score: number | null }) {\n  const value = Math.min(Math.max(score ?? 0, 0), 100)\n  const color =\n    value > 70 ? \"bg-rose-500\" : value > 40 ? \"bg-amber-400\" : \"bg-emerald-400\"\n\n  return (\n    <div className=\"w-full bg-white/10 h-2 rounded-full overflow-hidden\">\n      <div className={`${color} h-full`} style={{ width: `${value}%` }} />\n    </div>\n  )\n}\n\n// ======================================================\n// LOADERS\n// ======================================================\n\nasync function loadNextActions(client: ReturnType<typeof supabaseServer>) {\n  if (!client) return []\n\n  const { data, error } = await client\n    .from(\"lead_next_action_view\")\n    .select(\"*\")\n    .order(\"priority_score\", { ascending: false })\n    .limit(50)\n\n  if (error) {\n    console.error(\"next actions error:\", error)\n    return []\n  }\n\n  return (data as NextActionRow[]) ?? []\n}\n\nasync function loadEngines(client: ReturnType<typeof supabaseServer>) {\n  const JOB_NAMES = [\n    \"campaign_engine_5m\",\n    \"run_enrichment_5m\",\n    \"dispatch-touch-every-minute\",\n    \"run-cadence-every-5m\",\n    \"revenue-asi-run-enrichment-5min\",\n    \"revenue-asi-touch-fake-5min\",\n    \"revenue-asi-recompute-leads-5min\",\n    \"cron_dispatch_appointment_notifications\",\n  ]\n\n  if (!client) {\n    return JOB_NAMES.map((name) => ({\n      name,\n      schedule: null,\n      lastRun: null,\n      status: \"No data\",\n    }))\n  }\n\n  const [cronJobs, logs] = await Promise.all([\n    client.from(\"cron.job\").select(\"name, schedule\").in(\"name\", JOB_NAMES),\n    client\n      .from(\"dispatch_logs\")\n      .select(\"id, created_at, kind, payload\")\n      .in(\"kind\", JOB_NAMES)\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n  ])\n\n  const schedule = new Map()\n  cronJobs?.data?.forEach((r: any) => schedule.set(r.name, r.schedule))\n\n  const latest = new Map()\n  logs?.data?.forEach((l: any) => {\n    if (!latest.has(l.kind)) latest.set(l.kind, l)\n  })\n\n  return JOB_NAMES.map((name) => {\n    const log = latest.get(name)\n    const error = log?.payload && typeof log.payload === \"object\" && \"error\" in log.payload\n    return {\n      name,\n      schedule: schedule.get(name) ?? null,\n      lastRun: log?.created_at ?? null,\n      status: log ? (error ? \"Error\" : \"OK\") : \"No data\",\n    }\n  })\n}\n\n// Everything else = unchanged loaders:\nasync function loadAppointmentMetrics(client: any): Promise<AppointmentMetrics> {\n  const fallback = { appointmentsToday: 0, remindersToday: 0, reminderTouchRunsToday: 0 }\n  if (!client) return fallback\n\n  const start = new Date(); start.setUTCHours(0, 0, 0, 0)\n  const end = new Date(); end.setUTCHours(24, 0, 0, 0)\n\n  const [a, b, c] = await Promise.all([\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments_notifications\").select(\"id\", { count: \"exact\", head: true }).gte(\"notify_at\", start.toISOString()).lt(\"notify_at\", end.toISOString()),\n    client.from(\"touch_runs\").select(\"id\", { count: \"exact\", head: true }).in(\"step\", [200, 201, 202]).gte(\"scheduled_at\", start.toISOString()).lt(\"scheduled_at\", end.toISOString()),\n  ])\n\n  return {\n    appointmentsToday: a.count ?? 0,\n    remindersToday: b.count ?? 0,\n    reminderTouchRunsToday: c.count ?? 0,\n  }\n}\n\nasync function loadLeadMetrics(client: any): Promise<LeadMetrics> {\n  const fallback = { newLeadsToday: 0, leadsWithAppointments: 0, showsToday: 0, noShowsToday: 0 }\n  if (!client) return fallback\n\n  const start = new Date(); start.setUTCHours(0, 0, 0, 0)\n  const end = new Date(); end.setUTCHours(24, 0, 0, 0)\n\n  const [newLeads, shows, noShows, leadAppointments] = await Promise.all([\n    client.from(\"leads\").select(\"id\", { count: \"exact\", head: true }).gte(\"created_at\", start.toISOString()).lt(\"created_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).eq(\"outcome\", \"show\").gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"id\", { count: \"exact\", head: true }).eq(\"outcome\", \"no_show\").gte(\"starts_at\", start.toISOString()).lt(\"starts_at\", end.toISOString()),\n    client.from(\"appointments\").select(\"lead_id\"),\n  ])\n\n  const leadIds = new Set((leadAppointments.data ?? []).map((r: any) => r.lead_id).filter(Boolean))\n\n  return {\n    newLeadsToday: newLeads.count ?? 0,\n    showsToday: shows.count ?? 0,\n    noShowsToday: noShows.count ?? 0,\n    leadsWithAppointments: leadIds.size,\n  }\n}\n\nasync function loadCampaignEngine(client: any) {\n  if (!client) return []\n  const { data } = await client\n    .from(\"campaign_funnel_overview\")\n    .select(\"*\")\n    .order(\"last_touch_at\", { ascending: false })\n    .limit(10)\n  return data ?? []\n}\n\nasync function loadDirectorAlerts(client: any) {\n  if (!client) return []\n  const { data } = await client\n    .from(\"core_memory_events\")\n    .select(\"id, created_at, actor, event_type, importance, payload\")\n    .order(\"created_at\", { ascending: false })\n    .limit(20)\n  return data ?? []\n}\n\n// ======================================================\n// NEXT ACTIONS SECTION (THE STAR OF THE SHOW)\n// ======================================================\n\nfunction NextActionsSection({ rows }: { rows: NextActionRow[] }) {\n  return (\n    <Card className=\"border-white/10 bg-white/5 shadow-xl backdrop-blur-xl\">\n      <CardHeader\n        title=\"ðŸ”¥ Next Actions Queue\"\n        description=\"Top priority decisions from the Lead Brain.\"\n      />\n\n      <CardContent className=\"space-y-4\">\n        {rows.length === 0 ? (\n          <p className=\"text-white/60 text-sm\">No actions pending.</p>\n        ) : (\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Lead</TableHeaderCell>\n                <TableHeaderCell>Bucket</TableHeaderCell>\n                <TableHeaderCell>Channel</TableHeaderCell>\n                <TableHeaderCell>Action</TableHeaderCell>\n                <TableHeaderCell>Delay</TableHeaderCell>\n                <TableHeaderCell className=\"text-right\">Urgency</TableHeaderCell>\n              </TableRow>\n            </TableHead>\n\n            <TableBody>\n              {rows.map((row) => (\n                <TableRow key={row.lead_id} className=\"hover:bg-white/10 cursor-pointer\">\n                  <TableCell>\n                    <div className=\"flex flex-col\">\n                      <Link href={`/leads/${row.lead_id}`} className=\"text-white font-semibold hover:underline\">\n                        {row.email ?? row.phone ?? row.lead_id.slice(0, 8)}\n                      </Link>\n                      <p className=\"text-xs text-white/50\">{row.reason}</p>\n                    </div>\n                  </TableCell>\n\n                  <TableCell>\n                    <BrainBucketBadge bucket={row.lead_brain_bucket} />\n                  </TableCell>\n\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <ChannelIcon channel={row.recommended_channel} />\n                      <span className=\"text-sm text-white/70 capitalize\">\n                        {row.recommended_channel}\n                      </span>\n                    </div>\n                  </TableCell>\n\n                  <TableCell>\n                    <ActionBadge action={row.recommended_action} />\n                  </TableCell>\n\n                  <TableCell className=\"text-white/70 text-sm\">\n                    {row.recommended_delay_minutes} min\n                  </TableCell>\n\n                  <TableCell className=\"text-right\">\n                    <UrgencyBar score={row.priority_score} />\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ======================================================\n// MAIN PAGE\n// ======================================================\n\nexport default async function DirectorPage() {\n  const supabase = supabaseServer()\n\n  const [nextActions, engines, appointmentMetrics, leadMetrics, snapshot, campaignRows, alerts] =\n    await Promise.all([\n      loadNextActions(supabase),\n      loadEngines(supabase),\n      loadAppointmentMetrics(supabase),\n      loadLeadMetrics(supabase),\n      getSystemSnapshot(),\n      loadCampaignEngine(supabase),\n      loadDirectorAlerts(supabase),\n    ])\n\n  const engineHasError = engines.some((e) => e.status === \"Error\")\n  const engineHasRun = engines.some((e) => e.lastRun)\n\n  const engineLabel = engineHasError\n    ? \"Engine issues detected\"\n    : engineHasRun\n    ? \"Engine running normally\"\n    : \"Engine idle\"\n\n  return (\n    <div className=\"space-y-8\">\n      {/* HEADER */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-xs uppercase tracking-widest text-white/50\">Autonomous System</p>\n          <h1 className=\"text-3xl font-bold text-white\">Director Dashboard</h1>\n          <p className=\"text-sm text-white/60\">\n            Brain, engines, next actions & campaign intelligence.\n          </p>\n        </div>\n        <Badge className=\"bg-white/10 border border-white/20 text-white/80 text-xs px-4 py-1 flex items-center gap-2\">\n          <Sparkles size={12} />\n          {engineLabel}\n        </Badge>\n      </div>\n\n      {/* NEXT ACTIONS */}\n      <NextActionsSection rows={nextActions} />\n\n      {/* ENGINES + SNAPSHOT + METRICS */}\n      <div className=\"grid xl:grid-cols-[1.6fr_1fr] gap-6\">\n        {/* Engines */}\n        <Card className=\"border-white/10 bg-white/5\">\n          <CardHeader title=\"Engines\" description=\"Core cron jobs activity.\" />\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableHeaderCell>Job</TableHeaderCell>\n                  <TableHeaderCell>Schedule</TableHeaderCell>\n                  <TableHeaderCell>Last Run</TableHeaderCell>\n                  <TableHeaderCell className=\"text-right\">Status</TableHeaderCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {engines.map((e) => (\n                  <TableRow key={e.name}>\n                    <TableCell className=\"text-white font-semibold\">{e.name}</TableCell>\n                    <TableCell className=\"text-white/70\">{e.schedule ?? \"--\"}</TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {e.lastRun ? new Date(e.lastRun).toLocaleString() : \"--\"}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Badge\n                        className={`px-2 py-0.5 ${\n                          e.status === \"Error\"\n                            ? \"bg-rose-600/30 text-rose-200 border border-rose-500/40\"\n                            : e.status === \"OK\"\n                            ? \"bg-emerald-600/30 text-emerald-200 border border-emerald-500/40\"\n                            : \"bg-white/10 text-white/60 border border-white/20\"\n                        }`}\n                      >\n                        {e.status}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* SNAPSHOT + APPTS + LEADS */}\n        <div className=\"space-y-4\">\n          {/* SYSTEM SNAPSHOT */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"System Snapshot\" description=\"Core state of the OS.\" />\n            <CardContent className=\"grid grid-cols-2 gap-4\">\n              {[\n                [\"Total leads\", snapshot?.dashboard_overview?.total_leads],\n                [\"Leads attempting\", snapshot?.dashboard_overview?.leads_attempting],\n                [\"Booked\", snapshot?.dashboard_overview?.leads_booked],\n                [\"Campaigns live\", snapshot?.dashboard_overview?.campaigns_live],\n              ].map(([label, val]) => (\n                <div key={label}>\n                  <p className=\"text-xs uppercase text-white/50\">{label}</p>\n                  <p className=\"text-xl font-semibold text-white\">{val ?? 0}</p>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n\n          {/* APPOINTMENTS */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"Appointments\" description=\"Todayâ€™s scheduling activity.\" />\n            <CardContent className=\"grid grid-cols-3 gap-4\">\n              <MetricTile label=\"Appointments\" value={appointmentMetrics.appointmentsToday} helper=\"Today\" />\n              <MetricTile label=\"Reminders\" value={appointmentMetrics.remindersToday} helper=\"Total reminders\" />\n              <MetricTile\n                label=\"Rem. Touch runs\"\n                value={appointmentMetrics.reminderTouchRunsToday}\n                helper=\"Engine-generated\"\n              />\n            </CardContent>\n          </Card>\n\n          {/* LEAD FLOW */}\n          <Card className=\"border-white/10 bg-white/5\">\n            <CardHeader title=\"Lead Flow\" description=\"Top-of-funnel KPIs.\" />\n            <CardContent className=\"grid grid-cols-4 gap-4\">\n              <MetricTile\n                label=\"New leads\"\n                value={leadMetrics.newLeadsToday}\n                helper=\"Created today\"\n              />\n              <MetricTile\n                label=\"With appts\"\n                value={leadMetrics.leadsWithAppointments}\n                helper=\"Booked leads\"\n              />\n              <MetricTile label=\"Shows\" value={leadMetrics.showsToday} helper=\"Good outcomes\" />\n              <MetricTile\n                label=\"No-shows\"\n                value={leadMetrics.noShowsToday}\n                helper=\"Missed appts\"\n              />\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* CAMPAIGN FUNNEL */}\n      <Card className=\"border-white/10 bg-white/5\">\n        <CardHeader title=\"Campaign Funnel\" description=\"Touch â†’ reply â†’ booking pipeline.\" />\n        <CardContent>\n          <Table>\n            <TableHead>\n              <TableRow>\n                <TableHeaderCell>Campaign</TableHeaderCell>\n                <TableHeaderCell>Touched</TableHeaderCell>\n                <TableHeaderCell>Engaged</TableHeaderCell>\n                <TableHeaderCell>Booked</TableHeaderCell>\n                <TableHeaderCell>Show/No-show</TableHeaderCell>\n                <TableHeaderCell>Reply rate</TableHeaderCell>\n                <TableHeaderCell>Error rate</TableHeaderCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {campaignRows.map((c) => (\n                <TableRow key={c.campaign_id}>\n                  <TableCell className=\"font-semibold text-white\">{c.campaign_name}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_touched}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_engaged}</TableCell>\n                  <TableCell className=\"text-white/80\">{c.leads_booked}</TableCell>\n                  <TableCell className=\"text-white/80\">\n                    {c.leads_booked_show} / {c.leads_booked_no_show}\n                  </TableCell>\n                  <TableCell className=\"text-emerald-300\">\n                    {(c.reply_rate * 100).toFixed(1)}%\n                  </TableCell>\n                  <TableCell className=\"text-rose-400\">\n                    {(c.error_rate * 100).toFixed(1)}%\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      {/* ALERTS */}\n      <Card className=\"border-white/10 bg-white/5\">\n        <CardHeader title=\"Director Brain Alerts\" description=\"Internal system evaluations.\" />\n        <CardContent className=\"space-y-4\">\n          {alerts.length === 0 ? (\n            <p className=\"text-white/60 text-sm\">No alerts yet.</p>\n          ) : (\n            alerts.map((a) => (\n              <div\n                key={a.id}\n                className=\"rounded-xl border border-white/10 bg-white/5 p-4 hover:bg-white/10 transition space-y-2\"\n              >\n                <div className=\"flex justify-between\">\n                  <div>\n                    <p className=\"text-xs uppercase tracking-widest text-white/50\">\n                      {a.actor ?? \"System\"}\n                    </p>\n                    <p className=\"font-semibold text-white\">{a.event_type}</p>\n                  </div>\n                  <Badge className=\"bg-white/10 border border-white/20 text-white/70 text-xs px-2\">\n                    {a.importance}\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-white/50\">\n                  {new Date(a.created_at).toLocaleString()}\n                </p>\n                {a.payload?.notes && (\n                  <p className=\"text-sm text-white/70\">{a.payload.notes}</p>\n                )}\n              </div>\n            ))\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n\n// ======================================================\n// METRIC TILE\n// ======================================================\n\nfunction MetricTile({\n  label,\n  value,\n  helper,\n}: {\n  label: string\n  value: number\n  helper: string\n}) {\n  return (\n    <div className=\"bg-white/5 border border-white/10 rounded-xl p-3 space-y-1\">\n      <p className=\"text-xs uppercase tracking-widest text-white/50\">{label}</p>\n      <p className=\"text-2xl font-semibold text-white\">{value}</p>\n      <p className=\"text-xs text-white/40\">{helper}</p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_129a2d82._.js:279:        client.from("touch_runs").select("id", {
./.next/dev/static/chunks/src_b1f6fe82._.js:441:    return client.from("touch_runs").select(touchRunSelect).eq("lead_id", leadId).order("sent_at", {
./.next/dev/static/chunks/src_b1f6fe82._.js:697:        client.from("touch_runs").select(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$leads$2f$timeline$2d$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["touchRunSelect"]).eq("lead_id", leadId).order("scheduled_at", {
./.next/dev/static/chunks/src_b1f6fe82._.js:1400:                        helper: "touch_runs registrados"
./.next/dev/static/chunks/src_8e64baea._.js.map:7:    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/revenue-asi/revenue-asi-dashboard/src/app/campaigns/page.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useMemo, useState, useEffect, useCallback } from \"react\"\nimport { Plus, Search, Filter, FolderPlus, Rocket, RefreshCw } from \"lucide-react\"\nimport Link from \"next/link\"\nimport { useRouter } from \"next/navigation\"\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeaderCell,\n  TableRow,\n  Button,\n  Input,\n  Select,\n  StatCard,\n} from \"@/components/ui-custom\"\nimport { supabaseBrowser } from \"@/lib/supabase\"\nimport { campaignsMock } from \"./mock-data\"\nimport { CampaignStatus, CampaignType } from \"@/types/campaign\"\n\ntype CampaignRow = {\n  id?: string\n  uuid?: string\n  name?: string\n  type?: CampaignType\n  status?: CampaignStatus\n  leads_count?: number\n  target_leads?: number\n  reply_rate?: number\n  reply_rate_pct?: number\n  meetings_booked?: number\n  meetings?: number\n  conversion?: number\n  conversion_rate?: number\n  created_at?: string\n  inserted_at?: string\n  error_rate?: number\n  daily_throughput?: number\n  leads_contacted?: number\n  contacts_processed?: number\n}\n\nconst statusStyles: Record<CampaignStatus, string> = {\n  live: \"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30\",\n  paused: \"bg-amber-500/15 text-amber-200 border border-amber-400/30\",\n  draft: \"bg-white/5 text-white/70 border border-white/15\",\n}\n\nconst typeCopy: Record<CampaignType, string> = {\n  outbound: \"Outbound\",\n  nurture: \"Nurture\",\n  reactivation: \"Reactivation\",\n  whatsapp: \"WhatsApp\",\n  sms: \"SMS\",\n  email: \"Email\",\n}\n\nexport default function CampaignsPage() {\n  const router = useRouter()\n\n  const supabase = useMemo(() => {\n    const hasEnv =\n      process.env.NEXT_PUBLIC_SUPABASE_URL &&\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    if (!hasEnv) return null\n    return supabaseBrowser()\n  }, [])\n\n  const [type, setType] = useState<CampaignType | \"all\">(\"all\")\n  const [status, setStatus] = useState<CampaignStatus | \"all\">(\"all\")\n  const [query, setQuery] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [campaigns, setCampaigns] = useState<any[]>([])\n  const [runCounts, setRunCounts] = useState({ campaignRuns: 0, touchRuns: 0 })\n\n  const loadCampaigns = useCallback(async () => {\n    if (!supabase) {\n      setCampaigns(campaignsMock)\n      setLoading(false)\n      return\n    }\n\n    setLoading(true)\n    const { data, error } = await supabase\n      .from(\"campaigns\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false })\n      .limit(200)\n\n    if (error) {\n      console.error(\"Failed to load campaigns\", error)\n      setCampaigns(campaignsMock)\n      setLoading(false)\n      return\n    }\n\n    const mapped = (data ?? []).map((row: CampaignRow) => {\n      const fallbackType = (row.type ?? \"outbound\") as CampaignType\n      return {\n        id: String(row.id ?? row.uuid ?? crypto.randomUUID()),\n        name: row.name ?? \"Untitled campaign\",\n        type: fallbackType,\n        status: (row.status ?? \"draft\") as CampaignStatus,\n        leads_count: Number(row.leads_count ?? row.target_leads ?? 0) || 0,\n        reply_rate: Number(row.reply_rate ?? row.reply_rate_pct ?? 0) || 0,\n        meetings_booked: Number(row.meetings_booked ?? row.meetings ?? 0) || 0,\n        conversion: Number(row.conversion ?? row.conversion_rate ?? 0) || 0,\n        created_at: row.created_at ?? row.inserted_at ?? \"\",\n        error_rate: Number(row.error_rate ?? 0) || undefined,\n        daily_throughput: Number(row.daily_throughput ?? 0) || undefined,\n        leads_contacted: Number(row.leads_contacted ?? row.contacts_processed ?? 0) || undefined,\n      }\n    })\n\n    setCampaigns(mapped.length > 0 ? mapped : campaignsMock)\n    setLoading(false)\n  }, [supabase])\n\n  const loadRunCounts = useCallback(async () => {\n    if (!supabase) return\n    const [{ count: campaignRuns }, { count: touchRuns }] = await Promise.all([\n      supabase.from(\"campaign_runs\").select(\"id\", { head: true, count: \"exact\" }),\n      supabase.from(\"touch_runs\").select(\"id\", { head: true, count: \"exact\" }),\n    ])\n    setRunCounts({\n      campaignRuns: campaignRuns ?? 0,\n      touchRuns: touchRuns ?? 0,\n    })\n  }, [supabase])\n\n  useEffect(() => {\n    loadCampaigns()\n    loadRunCounts()\n  }, [loadCampaigns, loadRunCounts])\n\n  const filtered = useMemo(() => {\n    return campaigns.filter((campaign) => {\n      const matchesType = type === \"all\" || campaign.type === type\n      const matchesStatus = status === \"all\" || campaign.status === status\n      const matchesQuery =\n        query.trim().length === 0 ||\n        (campaign.name ?? \"\").toLowerCase().includes(query.toLowerCase())\n      return matchesType && matchesStatus && matchesQuery\n    })\n  }, [campaigns, type, status, query])\n\n  const summary = useMemo(() => {\n    const total = campaigns.length\n    const live = campaigns.filter((c) => c.status === \"live\").length\n    const avgReply = campaigns.length\n      ? Math.round(\n          campaigns.reduce((acc, c) => acc + (c.reply_rate ?? 0), 0) /\n            campaigns.length\n        )\n      : 0\n    return { total, live, avgReply }\n  }, [campaigns])\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <p className=\"text-xs uppercase tracking-[0.16em] text-white/50\">\n            Outbound command center\n          </p>\n          <h1 className=\"text-3xl font-semibold text-white\">Campaigns</h1>\n          <p className=\"text-sm text-white/60\">\n            Control cadence, copy, and throughput with the new neon console.\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"ghost\" size=\"sm\" onClick={loadCampaigns} className=\"gap-2\">\n            <RefreshCw size={16} />\n            Refresh list\n          </Button>\n\n          <Link href=\"/campaigns/new\" className=\"inline-flex\">\n            <Button variant=\"primary\" size=\"md\" className=\"gap-2\">\n              <Plus size={16} /> New campaign\n            </Button>\n          </Link>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <StatCard\n          label=\"Active\"\n          value={`${summary.live} live`}\n          helper={`${runCounts.campaignRuns} recent runs`}\n          delta=\"Synced\"\n        />\n        <StatCard\n          label=\"Reply rate\"\n          value={`${summary.avgReply}%`}\n          helper=\"Rolling 7d across stacks\"\n          delta=\"+1.2%\"\n        />\n        <StatCard\n          label=\"Inventory\"\n          value={`${summary.total} programs`}\n          helper={`${runCounts.touchRuns} touch runs observed`}\n          delta=\"Stable\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader\n          title=\"Programs\"\n          description=\"Filter by type, status, or search\"\n          action={\n            <div className=\"flex items-center gap-2 text-sm text-white/60\">\n              <Filter size={16} />\n              Smart filters\n            </div>\n          }\n        />\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid gap-3 md:grid-cols-[1.2fr,1fr,1fr]\">\n            <div className=\"flex items-center gap-2 rounded-2xl border border-white/10 bg-black/40 px-3 py-2 shadow-inner shadow-black/40\">\n              <Search size={16} className=\"text-white/40\" />\n              <Input\n                value={query}\n                onChange={(e) => setQuery(e.target.value)}\n                placeholder=\"Search campaigns\"\n                className=\"border-none bg-transparent px-0 text-sm\"\n              />\n            </div>\n\n            <Select\n              value={type}\n              onChange={(e) =>\n                setType(e.target.value as CampaignType | \"all\")\n              }\n            >\n              <option value=\"all\">All types</option>\n              {Object.keys(typeCopy).map((key) => (\n                <option key={key} value={key}>\n                  {typeCopy[key as CampaignType]}\n                </option>\n              ))}\n            </Select>\n\n            <Select\n              value={status}\n              onChange={(e) =>\n                setStatus(e.target.value as CampaignStatus | \"all\")\n              }\n            >\n              <option value=\"all\">All statuses</option>\n              <option value=\"live\">Live</option>\n              <option value=\"paused\">Paused</option>\n              <option value=\"draft\">Draft</option>\n            </Select>\n          </div>\n\n          {loading ? (\n            <div className=\"grid gap-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n              {[1, 2, 3].map((row) => (\n                <div\n                  key={row}\n                  className=\"h-12 animate-pulse rounded-xl bg-white/5\"\n                />\n              ))}\n            </div>\n          ) : filtered.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-emerald-400/30 bg-white/5 px-6 py-10 text-center shadow-[0_20px_60px_rgba(16,185,129,0.15)]\">\n              <div className=\"rounded-full bg-emerald-500/20 p-3 text-emerald-300 shadow-[0_0_40px_rgba(16,185,129,0.4)]\">\n                <FolderPlus />\n              </div>\n              <p className=\"text-lg font-semibold text-white\">\n                No campaigns match\n              </p>\n              <p className=\"text-sm text-white/60\">\n                Adjust filters or launch a new outbound stream.\n              </p>\n              <Link href=\"/campaigns/new\" className=\"inline-flex\">\n                <Button variant=\"primary\" size=\"sm\" className=\"gap-2\">\n                  <Rocket size={16} /> Start from template\n                </Button>\n              </Link>\n            </div>\n          ) : (\n            <Table>\n              <TableHead>\n                <tr>\n                  <TableHeaderCell>Name</TableHeaderCell>\n                  <TableHeaderCell>Type</TableHeaderCell>\n                  <TableHeaderCell>Status</TableHeaderCell>\n                  <TableHeaderCell>Leads</TableHeaderCell>\n                  <TableHeaderCell>Reply rate</TableHeaderCell>\n                  <TableHeaderCell>Meetings</TableHeaderCell>\n                  <TableHeaderCell>Conversion</TableHeaderCell>\n                  <TableHeaderCell>Created</TableHeaderCell>\n                </tr>\n              </TableHead>\n\n              <TableBody>\n                {filtered.map((campaign) => (\n                  <TableRow\n                    key={campaign.id}\n                    className=\"cursor-pointer\"\n                    onClick={() =>\n                      router.push(`/campaigns/${campaign.id}`)\n                    }\n                  >\n                    <TableCell>\n                      <div className=\"space-y-1\">\n                        <p className=\"font-semibold text-white\">\n                          {campaign.name}\n                        </p>\n                        <p className=\"text-xs text-white/50\">\n                          {campaign.leads_contacted ?? 0} touched\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"capitalize text-white/70\">\n                      {typeCopy[campaign.type as CampaignType]}\n                    </TableCell>\n                    <TableCell>\n                      <span\n                        className={`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs ${\n                          statusStyles[campaign.status as CampaignStatus]\n                        }`}\n                      >\n                        <span className=\"h-2 w-2 rounded-full bg-current\" />\n                        {campaign.status}\n                      </span>\n                    </TableCell>\n                    <TableCell>\n                      {Number(campaign.leads_count ?? 0).toLocaleString()}\n                    </TableCell>\n                    <TableCell>{campaign.reply_rate ?? 0}%</TableCell>\n                    <TableCell>{campaign.meetings_booked ?? 0}</TableCell>\n                    <TableCell>{campaign.conversion ?? 0}%</TableCell>\n                    <TableCell className=\"text-white/60\">\n                      {campaign.created_at}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
./.next/dev/static/chunks/src_aff5cf83._.js:507:                    client.from("touch_runs").select("id, lead_id, status, error, campaign_id").in("lead_id", leadIds),
./supabase/lead_enriched.sql:30:  from touch_runs tr
./supabase/functions/dispatch-touch-whatsapp-v2/index.ts:73:    .from("touch_runs")
./supabase/functions/dispatch-touch-whatsapp-v2/index.ts:203:        .from("touch_runs")
./supabase/functions/dispatch-touch-whatsapp-v2/index.ts:232:        .from("touch_runs")
./supabase/functions/dispatch-touch-smart-router/index.ts:72:  // -------- 1) Traer touch_runs "auto" / sin canal, en queued --------
./supabase/functions/dispatch-touch-smart-router/index.ts:74:    .from("touch_runs")
./supabase/functions/dispatch-touch-smart-router/index.ts:114:        notes: "No auto/queued touch_runs to route",
./supabase/functions/dispatch-touch-smart-router/index.ts:179:  // -------- 3) LOOP: decidir canal y actualizar touch_runs --------
./supabase/functions/dispatch-touch-smart-router/index.ts:228:        .from("touch_runs")
./supabase/functions/dispatch-touch-smart-router/index.ts:253:        .from("touch_runs")
./supabase/functions/dispatch-touch-smart-router/index.ts:276:          ? "Smart router dispatched all auto touch_runs successfully"
./supabase/functions/touch-orchestrator-v6/index.ts:119:    // 4) dedupe: tocar touch_runs (cola real)
./supabase/functions/touch-orchestrator-v6/index.ts:121:      .from("touch_runs")
./supabase/functions/touch-orchestrator-v6/index.ts:160:      const { error: iErr } = await supabase.from("touch_runs").insert(toInsert)
./supabase/functions/run-cadence/index.ts:45:      await supabase.from("touch_runs").insert(inserts);
./supabase/functions/run-cadence/index.ts:253:  // 5) Insertar touch_runs
./supabase/functions/run-cadence/index.ts:271:  const { error: insErr } = await supabase.from("touch_runs").insert(inserts)
./supabase/functions/run-cadence/index.ts:277:        stage: "insert_touch_runs",
./supabase/functions/dispatch-touch-email/index.ts:87:    // 1) Trae touch_runs de canal email pendientes
./supabase/functions/dispatch-touch-email/index.ts:89:      .from("touch_runs")
./supabase/functions/dispatch-touch-email/index.ts:184:          .from("touch_runs")
./supabase/functions/dispatch-touch-email/index.ts:198:          .from("touch_runs")
./supabase/functions/touch-orchestrator-fake/index.ts:84:    // 2ï¸âƒ£ Construir touch_runs segÃºn tu schema real
./supabase/functions/touch-orchestrator-fake/index.ts:121:    // 3ï¸âƒ£ Insertar en touch_runs
./supabase/functions/touch-orchestrator-fake/index.ts:123:      .from("touch_runs")
./supabase/functions/touch-orchestrator-fake/index.ts:127:      console.error("insert touch_runs error", insertError);
./supabase/functions/touch-orchestrator-fake/index.ts:132:          error: "insert_touch_runs_failed",
./supabase/functions/dispatch-touch-voice-v4/index.ts:125:    .from("touch_runs")
./supabase/functions/dispatch-touch-voice-v4/index.ts:163:        notes: "No queued/scheduled voice touch_runs to process",
./supabase/functions/dispatch-touch-voice-v4/index.ts:187:    .from("touch_runs")
./supabase/functions/dispatch-touch-voice-v4/index.ts:307:        .from("touch_runs")
./supabase/functions/dispatch-touch-voice-v4/index.ts:330:        .from("touch_runs")
./supabase/functions/_shared/director_touch.ts:31:// Lo que vamos a insertar en public.touch_runs (sin id/created_at)
./supabase/functions/_shared/director_touch.ts:128: * Devuelve el objeto listo para insertar en public.touch_runs
./supabase/functions/dispatch-touch-sms/index.ts:101:  // 1) GET touch_runs (now uses account_id)
./supabase/functions/dispatch-touch-sms/index.ts:104:    .from("touch_runs")
./supabase/functions/dispatch-touch-sms/index.ts:210:        .from("touch_runs")
./supabase/functions/dispatch-touch-sms/index.ts:225:        .from("touch_runs")
./supabase/functions/dispatch-touch/index.ts:49:    .from("touch_runs")
./supabase/functions/dispatch-touch/index.ts:87:        .from("touch_runs")
./supabase/functions/dispatch-touch/index.ts:117:        .from("touch_runs")
./supabase/functions/dispatch-touch/index.ts:130:        .from("touch_runs")
./README.md:155:* inserta `touch_runs`
./README.md:179:* dedupe contra touch_runs existentes
./README.md:208:* toma `touch_runs` en `queued`
./README.md:232:* toma touch_runs email en `scheduled`
./README.md:330:    â†“ touch_runs (queued / scheduled)
./README.md:344:touch_runs queued
./README.md:477: â”‚  touch-orchestrator-v9    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º touch_runs
./README.md:478: â”‚  reactivation-orchestratorâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º touch_runs
./README.md:562:3. dedupe contra `touch_runs` existentes
./README.md:564:5. inserta nuevos touch_runs
./README.md:596:1. toma touch_runs en queued
./README.md:748:* nuevas columnas en `touch_runs` si se hace migraciÃ³n
./README.md:757:* columnas obligatorias de `touch_runs`
./README.md:777:3. dedupe contra touch_runs
./README.md:798:2. **Orchestrators alimentan touch_runs.**
./README.md:809:Cada fila en `touch_runs` representa **un intento especÃ­fico en un canal**  
./README.md:894:Cada `touch_runs` define su plan de cadencia en `payload.routing.fallback`:
./README.md:899:- `payload.routing.current_channel` â†’ canal actual de este intento (debe coincidir con `touch_runs.channel`)
./README.md:903:- `touch_runs` (por `lead_id + step + channel`)
./README.md:919:from public.touch_runs tr
./README.md:929:Antes de crear el siguiente touch_runs, el orquestador resuelve una sola decisiÃ³n a partir de:
./README.md:951:El cooldown NO ha pasado â†’ no se crea nuevo touch_runs
./README.md:965:No se crean mÃ¡s touch_runs para ese lead + step â†’ cadencia muerta
./README.md:969:Toma el Ãºltimo touch_runs para lead_id + step.
./README.md:999:Crea un nuevo touch_runs en el mismo canal (retry_same_channel)
./README.md:1001:Crea un nuevo touch_runs en otro canal (switch_channel, usando next_channel)
./README.md:1007:Cada `touch_runs` define su plan de cadencia en `payload.routing.fallback`:
./README.md:1012:- `payload.routing.current_channel` â†’ canal actual (debe coincidir con `touch_runs.channel`)
./README.md:1016:- `touch_runs` (por `lead_id + step + channel`)
./README.md:1032:from public.touch_runs tr
./README.md:1076:wait_cooldown â†’ no crea ningÃºn touch_runs
./README.md:1078:retry_same_channel â†’ crea nuevo touch_runs con mismo canal
./README.md:1080:switch_channel â†’ crea nuevo touch_runs en next_channel
./README.md:1082:stop â†’ no crea mÃ¡s touch_runs para ese lead + step
./README.md:1135:Contrato para crear touch_runs de WhatsApp (lo que debe respetar Director/Orquestador)
./src/app/director/page.tsx:227:      .from("touch_runs")
./src/app/voice-insights/page.tsx:215:          .from("touch_runs")
./src/app/leads/[id]/page.tsx:381:        .from("touch_runs")
./src/app/leads/[id]/page.tsx:673:          helper="touch_runs registrados"
./src/app/health/page.tsx:48:      supabase.from("touch_runs").select("id, status, created_at").order("created_at", { ascending: false }).limit(1),
./src/app/health/page.tsx:66:      console.warn("Failed to load touch_runs", touchResp.error)
./src/app/backend/src/command-os/client.ts:48:Cron & Jobs (touch_runs, enrichment, etc.)
./src/app/operator/page.tsx:118:    .from("touch_runs")
./src/app/operator/page.tsx:174:    .from("touch_runs")
./src/app/operator/page.tsx:241:      .from("touch_runs")
./src/app/operator/page.tsx:246:      .from("touch_runs")
./src/app/operator/page.tsx:252:      .from("touch_runs")
./src/app/operator/page.tsx:258:      .from("touch_runs")
./src/components/leads/LeadTimeline.tsx:120:        setError("No se pudo obtener el timeline de touch_runs para el lead.")
./src/components/leads/LeadTimeline.tsx:141:        description="Eventos recientes de touch_runs ordenados por envÃ­o o creaciÃ³n."
./src/components/leads/LeadTimeline.tsx:157:            No hay eventos de touch_runs para este lead.
./src/components/leads/timeline-utils.ts:78:    .from("touch_runs")
